<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>vasm manual</title>

<meta name="description" content="vasm manual">
<meta name="keywords" content="vasm manual">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="#The-Assembler" rel="start" title="The Assembler">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="#Standard-Syntax-Module" rel="next" title="Standard Syntax Module">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
ul.mark-bullet {list-style-type: disc}
ul.mark-minus {list-style-type: "\2212"}
-->
</style>


</head>

<body lang="en">





<div class="chapter-level-extent" id="General">
<div class="nav-panel">
<p>
Next: <a href="#Standard-Syntax-Module" accesskey="n" rel="next">Standard Syntax Module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter"><span>1 General<a class="copiable-link" href="#General"> &para;</a></span></h2>

<ul class="mini-toc">
<li><a href="#Introduction" accesskey="1">Introduction</a></li>
<li><a href="#Legal" accesskey="2">Legal</a></li>
<li><a href="#Contact" accesskey="3">Contact</a></li>
<li><a href="#Installation" accesskey="4">Installation</a></li>
</ul>
<div class="section-level-extent" id="Introduction">
<h3 class="section"><span>1.1 Introduction<a class="copiable-link" href="#Introduction"> &para;</a></span></h3>

<p>vasm is a portable and retargetable assembler able to create linkable
objects in different formats as well as absolute code.
Different CPU-, syntax and output-modules are supported.
</p>
<p>Most common directives/pseudo-opcodes are supported (depending on the
syntax module) as well as CPU-specific extensions.
</p>
<p>The assembler supports optimizations and relaxations. For example, choosing
the shortest possible branch instruction or addressing mode as well as
converting a branch to an absolute jump if necessary.
</p>
<p>It also supports target CPUs with more than 8 bits per byte
(word-addressing) but requires that the host system has 8-bit bytes.
</p>
<p>The concept is that you get a special vasm binary for any combination of
CPU- and syntax-module. All output modules, which make sense for the
selected CPU, are included in the vasm binary and you have to make sure to
choose the output file format you need (refer to the next chapter and look for
the <code class="code">-F</code> option). The default is a test output format, only useful for
debugging or analyzing the output.
</p>

</div>
<div class="section-level-extent" id="Legal">
<h3 class="section"><span>1.2 Legal<a class="copiable-link" href="#Legal"> &para;</a></span></h3>

<p>vasm is copyright in 2002-2025 by Volker Barthelmann.
</p>
<p>This archive may be redistributed without modifications and used
    for non-commercial purposes.
</p>
<p>An exception for commercial usage is granted, provided that the target
    CPU is M68k and the target OS is AmigaOS. Resulting binaries may be
    distributed commercially without further licensing.
</p>
<p>In all other cases you need my written consent.
</p>
<p>Certain modules may fall under additional copyrights.
</p>

</div>
<div class="section-level-extent" id="Contact">
<h3 class="section"><span>1.3 Contact<a class="copiable-link" href="#Contact"> &para;</a></span></h3>
<p>Responsible for the current version of vasm and contact address in
case of bug reports or support requests:
</p><ul class="itemize mark-minus">
<li>Volker Barthelmann (vb@compilers.de)
  </li><li>Frank Wille (frank@phoenix.owl.de)
</li></ul>
<p>In case you have an issue with a specific cpu-, syntax- or output-module,
please contact the module&rsquo;s author first, if possible.
</p>

</div>
<div class="section-level-extent" id="Installation">
<h3 class="section"><span>1.4 Installation<a class="copiable-link" href="#Installation"> &para;</a></span></h3>

<p>The vasm binaries do not need additional files, so no further
installation is necessary. To use vasm with vbcc, copy the
binary to <samp class="file">vbcc/bin</samp> after following the installation instructions
for vbcc.
</p>
<p>The vasm binaries are named <code class="code">vasm&lt;cpu&gt;_&lt;syntax&gt;</code> with
<code class="code">&lt;cpu&gt;</code> representing the CPU-module and <code class="code">&lt;syntax&gt;</code>
the syntax-module, e.g. vasm for PPC with the standard syntax
module is called <code class="code">vasmppc_std</code>.
</p>
<p>Sometimes the syntax-modifier may be omitted, e.g. <code class="code">vasmppc</code>.
</p>
<p>Detailed instructions how to build vasm can be found in the last chapter.
</p>
</div>
</div>
<div class="chapter-level-extent" id="The-Assembler">
<h2 class="chapter" id="The-Assembler-1"><span>2 The Assembler<a class="copiable-link" href="#The-Assembler-1"> &para;</a></span></h2>
<p>This chapter describes the module-independent part of the assembler. It
documents the options and extensions which are not specific to a certain
target, syntax or output driver. Be sure to also read the chapters on the
cpu-backend, syntax- and output-module you are using. They will
likely contain important additional information like data-representation
or additional options.
</p>
<ul class="mini-toc">
<li><a href="#General-Assembler-Options" accesskey="1">General Assembler Options</a></li>
<li><a href="#Expressions" accesskey="2">Expressions</a></li>
<li><a href="#Symbols" accesskey="3">Symbols</a></li>
<li><a href="#Predefined-Symbols" accesskey="4">Predefined Symbols</a></li>
<li><a href="#Include-Files" accesskey="5">Include Files</a></li>
<li><a href="#Macros" accesskey="6">Macros</a></li>
<li><a href="#Structures" accesskey="7">Structures</a></li>
<li><a href="#Conditional-Assembly" accesskey="8">Conditional Assembly</a></li>
<li><a href="#Known-Problems" accesskey="9">Known Problems</a></li>
<li><a href="#Credits">Credits</a></li>
<li><a href="#Error-Messages">Error Messages</a></li>
</ul>
<hr>
<div class="section-level-extent" id="General-Assembler-Options">
<div class="nav-panel">
<p>
Up: <a href="#The-Assembler" accesskey="u" rel="up">The Assembler</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h3 class="section" id="General-Assembler-Options-1"><span>2.1 General Assembler Options<a class="copiable-link" href="#General-Assembler-Options-1"> &para;</a></span></h3>

<p><code class="command">vasm</code> is run from the command line using the following syntax:
</p>
<div class="example">
<pre class="example-preformatted">      <code class="command">vasm&lt;target&gt;_&lt;syntax&gt; [options] [sourcefile]</code>
</pre></div>

<p>When the source file name is missing the assembler reads the source
    text from <samp class="file">stdin</samp> until encountering <code class="code">EOF</code> (end-of-file,
    which is <code class="code">CTRL-D</code> in Unix shells, or <code class="code">CTRL-\</code> in AmigaOS
    shells). Note, that most debugging formats (DWARF, etc.) no longer
    function with such temporary source texts.
</p>
<p>The following options are supported by the machine independent part
    of <code class="command">vasm</code>. The most important ones are:
</p>
<dl class="table">
<dt><samp class="option">-D&lt;name&gt;[=&lt;expression&gt;]</samp></dt>
<dd><p>Defines a symbol with the name <code class="code">&lt;name&gt;</code> and assigns the value of the
        expression when given. The assigned value defaults to 1 otherwise.
</p>
</dd>
<dt><samp class="option">-F&lt;fmt&gt;</samp></dt>
<dd><p>Use module <code class="code">&lt;fmt&gt;</code> as output driver. See the chapter on output
        drivers for available formats and options.
</p>
</dd>
<dt><samp class="option">-I&lt;path&gt;</samp></dt>
<dd><p>Define another include path. They are searched in the order of
        occurrence on the command line, and always before any include paths
        defined in the source.
</p>
</dd>
<dt><samp class="option">-L &lt;listfile&gt;</samp></dt>
<dd><p>Enables generation of a listing file and directs the output into
        the file <code class="code">&lt;listfile&gt;</code>.
</p>
</dd>
<dt><samp class="option">-nocase</samp></dt>
<dd><p>Disables case-sensitivity for everything - identifiers, directives
        and instructions. Note that directives and instructions may already
        be case-insensitive by default in some modules.
</p>
</dd>
<dt><samp class="option">-nosym</samp></dt>
<dd><p>Strips all local symbols from the output file and doesn&rsquo;t include
        any other symbols than those which are required for external
        linkage.
</p>
</dd>
<dt><samp class="option">-o &lt;ofile&gt;</samp></dt>
<dd><p>Write the generated assembler output to <code class="code">&lt;ofile&gt;</code> rather than
        <samp class="file">a.out</samp>.
</p>
</dd>
<dt><samp class="option">-quiet</samp></dt>
<dd><p>Do not print the copyright notice and the final statistics.
</p>
</dd>
<dt><samp class="option">-x</samp></dt>
<dd><p>Show an error message, when referencing an undefined symbol.
        The default behaviour is to declare this symbol as externally
        defined.
</p></dd>
</dl>

<p>Other options:
</p>
<dl class="table">
<dt><samp class="option">-chklabels</samp></dt>
<dd><p>Issues a warning when a label matches a mnemonic or directive name
        in either upper or lower case.
</p>
</dd>
<dt><samp class="option">-depend=&lt;type&gt;</samp></dt>
<dd><p>Print all dependencies while assembling the source with the given
        options. No output is generated. <code class="code">&lt;type&gt;</code> may be the word <samp class="option">list</samp>
        for printing one file name in each new line, or <samp class="option">make</samp> for
        printing a sequence of file names on a single line, suitable for
        Makefiles.
        When the output file name is given by <samp class="option">-o outname</samp> then
        <code class="command">vasm</code> will also print <code class="code">outname:</code> in front of it.
        Note that in contrast to option <samp class="option">-dependall</samp> only relative
        include file dependencies will be listed (which is the common case).
</p>
</dd>
<dt><samp class="option">-dependall=&lt;type&gt;</samp></dt>
<dd><p>Prints dependencies in the same way as <samp class="option">-depend</samp>, but
        also prints all include files with absolute paths.
</p>
</dd>
<dt><samp class="option">-depfile &lt;filename&gt;</samp></dt>
<dd><p>Used together with <samp class="option">-depend</samp> or <samp class="option">-dependall</samp> and
        instructs vasm to output all dependencies into a new file, instead
        of stdout. Additionally, code will be generated in parallel to the
        dependencies output.
</p>
</dd>
<dt><samp class="option">-dwarf[=&lt;version&gt;]</samp></dt>
<dd><p>Automatically generate DWARF debugging sections, suitable for
        source level debugging. When the version specification is missing,
        DWARF V3 will be emitted. The only difference to V2 is that it
        creates a <code class="code">.debug_ranges</code> section, with address ranges for all
        sections, instead of using a workaround by specifying
        <code class="code">DW_AT_low_pc=0</code> and <code class="code">DW_AT_high_pc=~0</code>.
        Note, that when you build vasm from source, you may have to set
        your host operating system with <code class="code">-Dname</code> in the Makefile to
        include the appropriate code which can determine the current
        work directory. Otherwise the default would be to set the current
        work directory to an empty string. Currently supported are:
        <code class="code">AMIGA</code>, <code class="code">ATARI</code>, <code class="code">MSDOS</code>,  <code class="code">UNIX</code>,
        <code class="code">_WIN32</code>. MacOSX works with <code class="code">UNIX</code>.
</p>
</dd>
<dt><samp class="option">-esc</samp></dt>
<dd><p>Enable escape character sequences. This will make vasm treat the
        escape character \ in string constants similar as in the C language.
</p>
</dd>
<dt><samp class="option">-ibe</samp></dt>
<dd><p>Use big-endian order when reading target-bytes with more than
        8 bits per byte from the host&rsquo;s file system (default).
</p>
</dd>
<dt><samp class="option">-ignore-mult-inc</samp></dt>
<dd><p>When the same file is included multiple times, using the same path,
        this is silently ignored, causing the file to be processed only
        once. Note, that you can still include the same file twice when
        using different paths to access it.
</p>
</dd>
<dt><samp class="option">-ile</samp></dt>
<dd><p>Use little-endian order when reading target-bytes with more than
        8 bits per byte from the host&rsquo;s file system.
</p>
</dd>
<dt><samp class="option">-Lall</samp></dt>
<dd><p>List all symbols, including unused equates. Default is to list
        all labels and all used expressions only.
</p>
</dd>
<dt><samp class="option">-Lbpl=&lt;n&gt;</samp></dt>
<dd><p>Set the maximum number of bytes per line in a listing file to <code class="code">&lt;n&gt;</code>.
        Defaults to 8 (fmt=<code class="code">wide</code>).
</p>
</dd>
<dt><samp class="option">-Lfmt=&lt;fmt&gt;</samp></dt>
<dd><p>Set the listing file format to <code class="code">&lt;fmt&gt;</code>. Defaults to wide.
        Available are: <code class="code">wide</code>, <code class="code">old</code>.
</p>
</dd>
<dt><samp class="option">-Llo</samp></dt>
<dd><p>Show only program labels in the sorted symbol listing. Default
        is to list all symbols, including absolute expressions.
</p>
</dd>
<dt><samp class="option">-Lni</samp></dt>
<dd><p>Do not show included source files in the listing file (fmt=<code class="code">wide</code>).
</p>
</dd>
<dt><samp class="option">-Lns</samp></dt>
<dd><p>Do not include symbols in the listing file (fmt=<code class="code">wide</code>).
</p>
</dd>
<dt><samp class="option">-maxerrors=&lt;n&gt;</samp></dt>
<dd><p>Sets the maximum number of errors to display before assembly
        is aborted. When <code class="code">&lt;n&gt;</code> is 0 then there is no limit. Defaults to 5.
</p>
</dd>
<dt><samp class="option">-maxmacrecurs=&lt;n&gt;</samp></dt>
<dd><p>Defines the maximum number of recursion levels within a macro.
        Defaults to 1000.
</p>
</dd>
<dt><samp class="option">-maxpasses=&lt;n&gt;</samp></dt>
<dd><p>Adjusts the maximum number of passes while resolving a section.
        Defaults to 1500.
</p>
</dd>
<dt><samp class="option">-no-msrcdebug</samp></dt>
<dd><p>Disable source level debugging within a macro context.
        When generating output with source level debug information, the
        debugger will show the invoking source text line instead.
</p>
</dd>
<dt><samp class="option">-nocompdir</samp></dt>
<dd><p>Do not search for include files relative to the compile directory
        (where the main input source is located).
</p>
</dd>
<dt><samp class="option">-noesc</samp></dt>
<dd><p>No escape character sequences. This will make vasm treat the
        escape character \ as any other character. Might be useful for
        compatibility.
</p>
</dd>
<dt><samp class="option">-noialign</samp></dt>
<dd><p>Perform no automatic alignment for instructions. Note that
        unaligned instructions can make your code crash when executed!
        Only set when you know what you are doing!
</p>
</dd>
<dt><samp class="option">-nomsg=&lt;n&gt;</samp></dt>
<dd><p>Disable the informational message <code class="code">&lt;n&gt;</code>. <code class="code">&lt;n&gt;</code> has to be the number
        of a valid informational message, like an optimization message.
</p>
</dd>
<dt><samp class="option">-nowarn=&lt;n&gt;</samp></dt>
<dd><p>Disable warning message <code class="code">&lt;n&gt;</code>. <code class="code">&lt;n&gt;</code> has to be the number of a valid
        warning message, otherwise an error is generated.
</p>
</dd>
<dt><samp class="option">-obe</samp></dt>
<dd><p>Write target-bytes with more than 8 bits per byte in big-endian
        order to the host&rsquo;s file system (default).
</p>
</dd>
<dt><samp class="option">-ole</samp></dt>
<dd><p>Write target-bytes with more than 8 bits per byte in little-endian
        order to the host&rsquo;s file system.
</p>
</dd>
<dt><samp class="option">-pad=&lt;value&gt;</samp></dt>
<dd><p>The given padding value can be one or multiple bytes (up to the
        cpu-backend&rsquo;s address size). It is used for alignment purposes
        and to fill gaps between absolute <code class="code">ORG</code> sections in the
        binary output module. Defaults to a zero-byte.
</p>
</dd>
<dt><samp class="option">-pic</samp></dt>
<dd><p>Try to generate position independent code. Every relocation
        position is flagged by an error message. This option overrides
        the absolute default mode (<code class="code">ORG 0</code>) of binary output
        modules and doesn&rsquo;t work if you force the assembler into
        absolute mode by such a directive.
</p>
<p>Note, that this means
        you cannot do any PIC-checks in absolute mode, because no
        relocations are generated there.
</p>
</dd>
<dt><samp class="option">-relpath</samp></dt>
<dd><p>Do not interpret a source path starting with &rsquo;/&rsquo; or &rsquo;\&rsquo;, or including
        a colon, as absolute, but always attach it relative to defined
        include paths first.
</p>
</dd>
<dt><samp class="option">-underscore</samp></dt>
<dd><p>Add a leading underscore in front of all imported and exported
        (also common, weak) symbol names, just before writing the
        output file.
</p>
</dd>
<dt><samp class="option">-unnamed-sections</samp></dt>
<dd><p>Sections are no longer distinguished by their name, but only by
        their attributes. This has the effect that when defining a second
        section with a different name but same attributes as a first one,
        it will switch to the first, instead of starting a new section.
        Is enabled automatically, when using an output-module which doesn&rsquo;t
        support section names. For example: aout, tos, xfile.
</p>
</dd>
<dt><samp class="option">-unsshift</samp></dt>
<dd><p>The shift-right operator (<code class="code">&gt;&gt;</code>) treats the value to shift as
        unsigned, which has the effect that only 0 bits are inserted on the
        left side. The number of bits in a value depend on the target
        address type (refer to the appropriate cpu module documentation).
        This may already be the default for some syntax modules, like for
        example mot-syntax in Devpac-compatibility mode.
</p>
</dd>
<dt><samp class="option">-uspc=&lt;value&gt;</samp></dt>
<dd><p>Uninitialized memory regions, declared by &quot;space&quot; directives
        (<code class="code">.space</code> in std-syntax, <code class="code">ds</code> in mot-syntax, etc.)
        are filled with the given value. Defaults to zero.
</p>
</dd>
<dt><samp class="option">-w</samp></dt>
<dd><p>Hide all warning messages.
</p>
</dd>
<dt><samp class="option">-wfail</samp></dt>
<dd><p>The return code of vasm will no longer be 0 (success), when there
        was a warning. Errors always make the return code non-zero (failure).
</p>
</dd>
<dt><samp class="option">-v</samp></dt>
<dd><p>Print version and copyright messages from the assembler and all
        its modules, then exit.
</p></dd>
</dl>

<p>Note, that while most options allow an argument without any separating blank,
some do require it (e.g. <samp class="option">-o</samp> and <samp class="option">-L</samp>).
</p>
</div>
<div class="section-level-extent" id="Expressions">
<h3 class="section"><span>2.2 Expressions<a class="copiable-link" href="#Expressions"> &para;</a></span></h3>

<p>Standard expressions are usually evaluated by vasm&rsquo;s core routines
rather than by one of the modules (unless this is necessary).
</p>
<p>All expressions evaluated by the frontend are calculated in terms
of target address values, i.e. the range depends on the backend.
Constants which exceed the target address range may be supported by
some backends up to 128 bits.
</p>
<p>Backends also have the option to support floating point constants directly
and convert them to a backend-specific format which is described in the
backend&rsquo;s documentation.
</p>
<p><b class="b">Warning:</b> Be aware that the quality and precision of the backend&rsquo;s
floating point output depends on the combination of host- and
backend-format! If you need absolute precision, encode the floating
point constants yourself in binary.
</p>
<p>The available operators include all those which are common in assembler as
well as in C expressions.
</p>
<p>C like operators:
</p><ul class="itemize mark-bullet">
<li>Unary: <code class="code">+ - ! ~</code>
</li><li>Arithmetic: <code class="code">+ - * / % &lt;&lt; &gt;&gt;</code>
</li><li>Bitwise: <code class="code">&amp; | ^</code>
</li><li>Logical: <code class="code">&amp;&amp; ||</code>
</li><li>Comparative: <code class="code">&lt; &gt; &lt;= &gt;= == !=</code>
</li></ul>

<p>Assembler like operators:
</p><ul class="itemize mark-bullet">
<li>Unary: <code class="code">+ - ~</code>
</li><li>Arithmetic: <code class="code">+ - * / // &lt;&lt; &gt;&gt;</code>
</li><li>Bitwise: <code class="code">&amp; ! ~</code>
</li><li>Comparative: <code class="code">&lt; &gt; &lt;= &gt;= = &lt;&gt;</code>
</li></ul>

<p>Up to version 1.4b the operators had the same precedence and associativity as
in the C language. Newer versions have changed the operator priorities to
comply with common assembler behaviour. The expression evaluation
priorities, from highest to lowest, are:
</p>
<ol class="enumerate">
<li> <code class="code">+ - ! ~</code> (unary +/- sign, not, complement)
</li><li> <code class="code">&lt;&lt; &gt;&gt;</code> (shift left, shift right)
</li><li> <code class="code">&amp;</code> (bitwise and)
</li><li> <code class="code">^ ~</code> (two forms of bitwise exclusive-or)
</li><li> <code class="code">| !</code> (two forms bitwise inclusive-or)
</li><li> <code class="code">* / % //</code> (multiply, divide, modulo, modulo)
</li><li> <code class="code">+ -</code> (plus, minus)
</li><li> <code class="code">&lt; &gt; &lt;= &gt;=</code> (less, greater, less or equal, greater or equal)
</li><li> <code class="code">== = != &lt;&gt;</code> (two forms of equality and inequality)
</li><li> <code class="code">&amp;&amp;</code> (logical and)
</li><li> <code class="code">||</code> (logical or)
</li></ol>

<p>Operands are integral values of the target address type. They can either be
specified as integer constants of different bases (see the documentation
on the syntax module to see how the base is specified) or character
constants. Character constants are introduced by <code class="code">'</code> or <code class="code">&quot;</code>
and have to be terminated by the same character that started them.
</p>
<p>Multiple characters are allowed and a constant is built according to the
endianness of the target.
</p>
<p>When the <samp class="option">-esc</samp> option was specified, or automatically enabled by
a syntax module, vasm interprets escape character sequences as in the
C language:
</p>
<dl class="table">
<dt><code class="code">\\</code></dt>
<dd><p>Produces a single <code class="code">\</code>.
</p>
</dd>
<dt><code class="code">\b</code></dt>
<dd><p>The bell character.
</p>
</dd>
<dt><code class="code">\f</code></dt>
<dd><p>Form feed.
</p>
</dd>
<dt><code class="code">\n</code></dt>
<dd><p>Line feed.
</p>
</dd>
<dt><code class="code">\r</code></dt>
<dd><p>Carriage return.
</p>
</dd>
<dt><code class="code">\t</code></dt>
<dd><p>Tabulator.
</p>
</dd>
<dt><code class="code">\&quot;</code></dt>
<dd><p>Produces a single <code class="code">&quot;</code>.
</p>    
</dd>
<dt><code class="code">\'</code></dt>
<dd><p>Produces a single <code class="code">'</code>.
</p>
</dd>
<dt><code class="code">\e</code></dt>
<dd><p>Escape character (27).
</p>
</dd>
<dt><code class="code">\&lt;octal-digits&gt;</code></dt>
<dd><p>One character with the code specified by the digits
        as octal value.
</p>
</dd>
<dt><code class="code">\x&lt;hexadecimal-digits&gt;</code></dt>
<dd><p>One character with the code specified by the digits
        as hexadecimal value.
</p>
</dd>
<dt><code class="code">\X&lt;hexadecimal-digits&gt;</code></dt>
<dd><p>Same as <code class="code">\x</code>.
</p>
</dd>
</dl>

<p>Note, that the default behaviour of vasm has changed since V1.7! Escape
sequence handling has been the default in older versions. This was
changed to improve compatibility with other assemblers. Use <samp class="option">-esc</samp>
to assemble sources with escape character sequences. It is still the
default in the <code class="code">std</code> syntax module, though.
</p>
</div>
<div class="section-level-extent" id="Symbols">
<h3 class="section"><span>2.3 Symbols<a class="copiable-link" href="#Symbols"> &para;</a></span></h3>

<p>You can define as many symbols as your available memory permits. A symbol
may have any length and can be of global or local scope. Internally, there
are three types of symbols:
</p><dl class="table">
<dt><code class="code">Expression</code></dt>
<dd><p>These symbols are usually not visible outside the
      source, unless they are explicitly exported.
</p></dd>
<dt><code class="code">Label</code></dt>
<dd><p>Labels are always addresses within a program section. By
      default they have local scope for the linker.
</p></dd>
<dt><code class="code">Imported</code></dt>
<dd><p>These symbols are externally defined and must be
      resolved by the linker.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="Predefined-Symbols">
<h3 class="section"><span>2.4 Predefined Symbols<a class="copiable-link" href="#Predefined-Symbols"> &para;</a></span></h3>

<p>Beginning with vasm V1.5c at least one expression symbol is always defined
to allow conditional assembly depending on the assembler being used:
<code class="code">__VASM</code>. Its value depends on the selected cpu module.
</p>
<p>Since V1.8i there may be a second internal symbol which reflects the
format of the paths in the host file system. Currently there may be one of:
</p><dl class="table">
<dt><code class="code">__UNIXFS</code></dt>
<dd><p>Host file system uses Unix-style paths.
</p></dd>
<dt><code class="code">__MSDOSFS</code></dt>
<dd><p>Host file system uses MS-DOS-, Windows-, Atari-style paths.
</p></dd>
<dt><code class="code">__AMIGAFS</code></dt>
<dd><p>Host file system uses AmigaDOS-style paths.
</p></dd>
</dl>
<p>Note that such a path-style symbol must be configured by a <code class="code">-D</code> option
while compiling vasm from source. Refer to the section about
building vasm (Interface chapter) for a listing of all supported host
OS options.
</p>
<p>There may be other internal symbols, which are defined by the
syntax- or by the cpu module.
</p>
</div>
<div class="section-level-extent" id="Include-Files">
<h3 class="section"><span>2.5 Include Files<a class="copiable-link" href="#Include-Files"> &para;</a></span></h3>

<p>Vasm supports include files and defining include paths. Whether this
functionality is available depends on the syntax module, which has to
provide the appropriate directives.
</p>
<p>On startup vasm defines one or two default include paths: the current
work directory and, when the main source is not located there, the
compile directory.
</p>
<p>Include paths are searched in the following order:
</p><ol class="enumerate">
<li> Current work directory.
</li><li> Compile directory (path to main source).
</li><li> Paths specified by <samp class="option">-I</samp> in the order of occurrence on the
      command line.
</li><li> Paths specified by directives in the source text (in the order
      of occurrence).
</li></ol>

<p>Additionally, all the relative paths, defined by <samp class="option">-I</samp> or directives,
are first appended to the current work directory name, then to the
compile directory name, while searching for an include file.
</p>
<p>Searching for include files in paths based on the compile directory can be
completely disabled by <samp class="option">-nocompdir</samp>.
</p>
</div>
<div class="section-level-extent" id="Macros">
<h3 class="section"><span>2.6 Macros<a class="copiable-link" href="#Macros"> &para;</a></span></h3>

<p>Macros are supported by vasm, but the directives for defining them have
to be implemented in the syntax module. The assembler core supports 9
macro arguments by default to be passed in the operand field,
which can be extended to any number by the syntax module.
They can be referenced within the macro either by name (<code class="code">\name</code>) or by
number (<code class="code">\1</code> to <code class="code">\9</code>), or both, depending on the syntax module.
Recursions and early exits are supported.
</p>
<p>Refer to the selected syntax module for more details.
</p>
</div>
<div class="section-level-extent" id="Structures">
<h3 class="section"><span>2.7 Structures<a class="copiable-link" href="#Structures"> &para;</a></span></h3>

<p>Vasm supports structures, but the directives for defining them
have to be implemented in the syntax module.
</p>
</div>
<div class="section-level-extent" id="Conditional-Assembly">
<h3 class="section"><span>2.8 Conditional Assembly<a class="copiable-link" href="#Conditional-Assembly"> &para;</a></span></h3>

<p>Has to be provided completely by the syntax module.
</p>
</div>
<div class="section-level-extent" id="Known-Problems">
<h3 class="section"><span>2.9 Known Problems<a class="copiable-link" href="#Known-Problems"> &para;</a></span></h3>

<p>Some known module-independent problems of <code class="command">vasm</code> at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Credits">
<h3 class="section"><span>2.10 Credits<a class="copiable-link" href="#Credits"> &para;</a></span></h3>

<p>All those who wrote parts of the <code class="command">vasm</code> distribution, made suggestions,
    answered my questions, tested <code class="command">vasm</code>, reported errors or were otherwise
    involved in the development of <code class="command">vasm</code> (in descending alphabetical order,
    under work, not complete):
</p>
<ul class="itemize mark-bullet">
<li>Jordan Zebor
    </li><li>Joseph Zatarski
    </li><li>Frank Wille
    </li><li>Jim Westfall
    </li><li>Bernard Thibault
    </li><li>Dimitri Theulings
    </li><li>Yannick Stamm
    </li><li>Jens Sch&ouml;nfeld
    </li><li>Ross
    </li><li>Henryk Richter
    </li><li>Sebastian Pachuta
    </li><li>Thorsten Otto
    </li><li>Esben Norby
    </li><li>Tom Noorduin
    </li><li>Gunther Nikl
    </li><li>George Nakos
    </li><li>Timm S. Mueller
    </li><li>Gareth Morris
    </li><li>Dominic Morris
    </li><li>Garry Marshall
    </li><li>Jean-Paul Mari
    </li><li>Mauricio Mu&ntilde;oz Lucero
    </li><li>Grzegorz Mazur
    </li><li>J&ouml;rg van de Loo
    </li><li>Robert Leffmann
    </li><li>Andreas Larsson
    </li><li>Miro Krop&aacute;&#269;ek
    </li><li>Olav Kr&ouml;meke
    </li><li>Christoph Krc
    </li><li>Chester Kollschen
    </li><li>Richard K&ouml;rber
    </li><li>Mikael Kalms
    </li><li>Mark Jones
    </li><li>Bert Jahn
    </li><li>Daniel Illgen
    </li><li>Jerome Hubert
    </li><li>Matthew Hey
    </li><li>Stefan Haubenthal
    </li><li>S&oslash;ren Hannibal
    </li><li>John Hankinson
    </li><li>Philippe Guichardon
    </li><li>Luis Panadero Guarde&ntilde;o
    </li><li>Romain Giot
    </li><li>Daniel Gerdgren
    </li><li>Fran&ccedil;ois Galea
    </li><li>Tom Duin
    </li><li>Adrien Destugues
    </li><li>Kieran Connell
    </li><li>Jae Choon Cha
    </li><li>Fernando Cabrera
    </li><li>Patrick Bricout
    </li><li>Matthias Bock
    </li><li>Simone Bevilacqua
    </li><li>Karoly Balogh
    </li><li>Anomie-p
</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages">
<h3 class="section"><span>2.11 Error Messages<a class="copiable-link" href="#Error-Messages"> &para;</a></span></h3>

<p>The frontend has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>1: illegal operand types
</li><li>2: unknown mnemonic &lt;%s&gt;
</li><li>3: unknown section &lt;%s&gt;
</li><li>4: no current section specified
</li><li>5: internal error %d in line %d of %s
</li><li>6: symbol &lt;%s&gt; redefined
</li><li>7: %c expected
</li><li>8: cannot resolve section &lt;%s&gt;, maximum number of passes reached
</li><li>9: instruction not supported on selected architecture
</li><li>10: number or identifier expected
</li><li>11: could not initialize %s module
</li><li>12: multiple input files
</li><li>13: could not open &lt;%s&gt; for input
</li><li>14: could not open &lt;%s&gt; for output
</li><li>15: unknown option &lt;%s&gt;
</li><li>16: %s module doesn&rsquo;t support %d-bit bytes
</li><li>17: could not initialize output module &lt;%s&gt;
</li><li>18: out of memory
</li><li>19: symbol &lt;%s&gt; recursively defined
</li><li>20: fail: %s
</li><li>21: section offset is lower than current pc
</li><li>22: target data type overflow (%d bits)
</li><li>23: undefined symbol &lt;%s&gt;
</li><li>24: trailing garbage after option -%c
</li><li>25: missing pacro parameters
</li><li>26: missing end directive for macro &quot;%s&quot;
</li><li>27: macro definition inside macro &quot;%s&quot;
</li><li>28: maximum number of %d macro arguments exceeded
</li><li>29: option %s was specified twice
</li><li>30: read error on &lt;%s&gt;
</li><li>31: expression must be constant
</li><li>32: initialized data in bss
</li><li>33: missing end directive in repeat-block
</li><li>34: #%d is not a valid warning message
</li><li>35: relocation not allowed
</li><li>36: illegal escape sequence \%c
</li><li>37: no current macro to exit
</li><li>38: internal symbol %s redefined by user
</li><li>39: illegal relocation
</li><li>40: label name conflicts with mnemonic
</li><li>41: label name conflicts with directive
</li><li>42: division by zero
</li><li>43: illegal macro argument
</li><li>44: reloc org is already set
</li><li>45: reloc org was not set
</li><li>46: address space overflow
</li><li>47: bad file-offset argument
</li><li>48: assertion &quot;%s&quot; failed: %s
</li><li>49: cannot declare structure within structure
</li><li>50: no structure
</li><li>51: instruction has been auto-aligned
</li><li>52: macro name conflicts with mnemonic
</li><li>53: macro name conflicts with directive
</li><li>54: non-relocatable expression in equate &lt;%s&gt;
</li><li>55: initialized data in offset section
</li><li>56: illegal structure recursion
</li><li>57: maximum number of macro recursions (%d) reached
</li><li>58: data has been auto-aligned
</li><li>59: register symbol &lt;%s&gt; redefined
</li><li>60: cannot evaluate constant huge integer expression
</li><li>61: cannot evaluate floating point expression
</li><li>62: imported symbol &lt;%s&gt; was not referenced
</li><li>63: symbol &lt;%s&gt; already defined with %s scope
</li><li>64: unexpected &quot;else&quot; without &quot;if&quot;
</li><li>65: unexpected &quot;endif&quot; without &quot;if&quot;
</li><li>66: maximum if-nesting depth exceeded (%d levels)
</li><li>67: &quot;endif&quot; missing for conditional block started at %s line %d
</li><li>68: repeatedly defined symbol &lt;%s&gt;
</li><li>69: macro &lt;%s&gt; does not exist
</li><li>70: register &lt;%s&gt; does not exist
</li><li>71: register symbol &lt;%s&gt; has wrong type
</li><li>72: cannot mix positional and keyword arguments
</li><li>73: undefined macro argument name
</li><li>74: required macro argument %d was left out
</li><li>75: label &lt;%s&gt; redefined
</li><li>76: base %d numerical term expected
</li><li>77: section stack overflow
</li><li>78: section stack is empty
</li><li>79: illegal value for option: %s
</li><li>80: %s backend does not support floating point
</li><li>81: unknown listing file format &quot;%s&quot; ignored
</li><li>82: cannot export equate based on imported symbol: &lt;%s&gt;
</li><li>83: label definition not allowed here
</li><li>84: label defined on the same line as a new section
</li><li>85: no debug output possible with source from stdin
</li><li>86: external symbol &lt;%s&gt; must not be defined
</li><li>87: missing definition for symbol &lt;%s&gt;
</li><li>88: additional macro arguments ignored (expecting %d)
</li><li>89: macro previously defined at line %d of %s
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Standard-Syntax-Module">
<div class="nav-panel">
<p>
Next: <a href="#Mot-Syntax-Module" accesskey="n" rel="next">Mot Syntax Module</a>, Previous: <a href="#The-Assembler" accesskey="p" rel="prev">The Assembler</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Standard-Syntax-Module-1"><span>3 Standard Syntax Module<a class="copiable-link" href="#Standard-Syntax-Module-1"> &para;</a></span></h2>
<p>This chapter describes the standard syntax module which is available
with the extension <code class="code">std</code>.
</p>
<ul class="mini-toc">
<li><a href="#Legal-1" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-Syntax" accesskey="3">General Syntax</a></li>
<li><a href="#Directives" accesskey="4">Directives</a></li>
<li><a href="#Known-Problems-1" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-1" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-1">
<h3 class="section"><span>3.1 Legal<a class="copiable-link" href="#Legal-1"> &para;</a></span></h3>

<p>This module is written in 2002-2024 by Volker Barthelmann and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module">
<h3 class="section"><span>3.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module"> &para;</a></span></h3>
 
<p>This syntax module provides the following additional options:
</p> 
<dl class="table">
<dt><samp class="option">-ac</samp></dt>
<dd><p>Immediately allocate common symbols in the <code class="code">.bss</code>/<code class="code">.sbss</code>
 section and define them as externally visible.
</p></dd>
<dt><samp class="option">-align</samp></dt>
<dd><p>Enforces the backend&rsquo;s natural alignment for all data directives
 (<code class="code">.word</code>, <code class="code">.long</code>, <code class="code">.float</code>, etc.).
</p></dd>
<dt><samp class="option">-gas</samp></dt>
<dd><p>Enable GNU-as compatibility mode. Currently this will only prevent
 labels prefixed by a dot to be recognized as local labels and turns
 <code class="code">.org</code> into a pure section-offset.
</p></dd>
<dt><samp class="option">-nodotneeded</samp></dt>
<dd><p>Recognize assembly directives without a leading dot (<code class="code">.</code>).
</p></dd>
<dt><samp class="option">-sdlimit=&lt;n&gt;</samp></dt>
<dd><p>Put data up to a maximum size of n bytes into the small-data
 sections. Default is n=0, which means the function is disabled.
</p>
</dd>
</dl>

</div>
<div class="section-level-extent" id="General-Syntax">
<h3 class="section"><span>3.3 General Syntax<a class="copiable-link" href="#General-Syntax"> &para;</a></span></h3>

<p>Labels always have to be terminated by a colon (<code class="code">:</code>), therefore
they don&rsquo;t necessarily have to start at the first column of a line.
</p>
<p>Local labels may either be preceded by a &rsquo;<code class="code">.</code>&rsquo; (unless option
<samp class="option">-gas</samp> was given) or terminated by &rsquo;<code class="code">$</code>&rsquo;,
and consist out of digits only.
These labels exist and keep their value between two global label definitions.
</p>
<p>A special form of reusable &quot;local&quot; labels, independent of global labels,
may be defined by using a single digit from <code class="code">0</code> to <code class="code">9</code>.
You can reference the nearest previous digit-label with <code class="code">Nb</code> and the
nearest following digit-label with <code class="code">Nf</code>, where <code class="code">N</code> is such a digit.
</p>
<p>Make sure that you don&rsquo;t define a label on the same line as a
directive for conditional assembly (<code class="code">if</code>, <code class="code">else</code>, <code class="code">endif</code>)!
This is not supported.
</p>
<p>The operands are separated from the mnemonic by whitespace.
Multiple operands are separated by comma (<code class="code">,</code>).
</p>
<p>The chracter used to introduce comments is usually the semicolon (<code class="code">;</code>).
Except for the following backends, which change it to a hash (<code class="code">#</code>)
character: ppc, vidcore, x86.
</p>
<p>Example:
</p><div class="example">
<pre class="example-preformatted">mylabel:  inst.q1.q2 op1,op2,op3  # comment
</pre></div>

<p>In expressions, numbers starting with <code class="code">0x</code> or <code class="code">0X</code> are
hexadecimal (e.g. <code class="code">0xfb2c</code>). <code class="code">0b</code> or <code class="code">0B</code> introduce
binary numbers (e.g. <code class="code">0b1100101</code>). Other numbers starting with
<code class="code">0</code> are assumed to be octal numbers, e.g. <code class="code">0237</code>. All
numbers starting with a non-zero digit are decimal, e.g. <code class="code">1239</code>.
</p>
<p>C-like escape characters in string constants are allowed by default,
unless disabled by <samp class="option">-noesc</samp>.
</p>
</div>
<div class="section-level-extent" id="Directives">
<h3 class="section"><span>3.4 Directives<a class="copiable-link" href="#Directives"> &para;</a></span></h3>

<p>All directives are case-insensitive.
The following directives are supported by this syntax module (if the
CPU- and output-module allow it):
</p>
<dl class="table">
<dt><code class="code">.2byte &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>See <code class="code">.uahalf</code>.
</p>
</dd>
<dt><code class="code">.4byte &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>See <code class="code">.uaword</code>. 
</p>
</dd>
<dt><code class="code">.8byte &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>See <code class="code">.uaquad</code>. 
</p>
</dd>
<dt><code class="code">.ascii &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>See <code class="code">.byte</code>. 
</p>
</dd>
<dt><code class="code">.abort &lt;message&gt;</code></dt>
<dd><p>Print an error and stop assembly immediately.
</p>
</dd>
<dt><code class="code">.asciiz &quot;&lt;string1&gt;&quot;[,&quot;&lt;string2&gt;&quot;...]</code></dt>
<dd><p>See <code class="code">.string</code>.    
</p>
</dd>
<dt><code class="code">.align &lt;bitorbyte_count&gt;[,&lt;fill&gt;][,&lt;maxpad&gt;]</code></dt>
<dd><p>Depending on the current CPU backend <code class="code">.align</code> either behaves
      like <code class="code">.balign</code> (x86) or like <code class="code">.p2align</code> (PPC).
</p>
</dd>
<dt><code class="code">.balign &lt;byte_count&gt;[,&lt;fill&gt;][,&lt;maxpad&gt;]</code></dt>
<dd><p>Insert as many fill bytes as required to reach an address which
      is dividable by &lt;byte_count&gt;. For example <code class="code">.balign 2</code> would
      make an alignment to the next 16-bit boundary, on a target with
      8-bit addressable memory.
      The padding bytes are initialized by &lt;fill&gt;, when given. The optional
      third argument defines a maximum number of padding bytes to use. When
      more are needed then the alignment is not done at all.
</p>
</dd>
<dt><code class="code">.balignl &lt;bit_count&gt;[,&lt;fill&gt;][,&lt;maxpad&gt;]</code></dt>
<dd><p>Works like <code class="code">.balign</code>, with the only difference that the optional
      fill value can be specified as a 32-bit word. Padding locations which
      are not already 32-bit aligned, will cause a warning and padded by
      zero-bytes.
</p>
</dd>
<dt><code class="code">.balignw &lt;bit_count&gt;[,&lt;fill&gt;][,&lt;maxpad&gt;]</code></dt>
<dd><p>Works like <code class="code">.balign</code>, with the only difference that the optional
      fill value can be specified as a 16-bit word. Padding locations which
      are not already 16-bit aligned, will cause a warning and padded by
      zero-bytes.
</p>
</dd>
<dt><code class="code">.byte &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Assign the integer or string constant operands into successive
      8-bit memory cells in the current section. Any combination of integer
      and character string constant operands is permitted.
</p>
</dd>
<dt><code class="code">.comm &lt;symbol&gt;,&lt;size&gt;[,&lt;align&gt;]</code></dt>
<dd><p>Defines a common symbol which has a size of &lt;size&gt; bytes. The
      final size and alignment is assigned by the linker, which
      will use the highest size and alignment values of all common
      symbols with the same name found. A common symbol is usually
      allocated in the .bss section of the final executable.
      In case the optional &lt;align&gt; argument was not specified the backend&rsquo;s
      default alignment for the given size will be used.
</p>
</dd>
<dt><code class="code">.double &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Parse one of more IEEE double precision floating point expressions and
      write them into successive blocks of 64 bits into memory using the
      backend&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">.else</code></dt>
<dd><p>Assemble the following block only if the previous <code class="code">.if</code>
      condition was false.
</p>
</dd>
<dt><code class="code">.elseif &lt;exp&gt;</code></dt>
<dd><p>Same as <code class="code">.else</code> followed by <code class="code">.if</code>, but without the
      need for an <code class="code">.endif</code>. Avoids nesting.
</p>
</dd>
<dt><code class="code">.endif</code></dt>
<dd><p>Ends a block of conditional assembly.
</p>
</dd>
<dt><code class="code">.endm</code></dt>
<dd><p>Ends a macro definition.
</p>
</dd>
<dt><code class="code">.endr</code></dt>
<dd><p>Ends a repetition block.
</p>
</dd>
<dt><code class="code">.equ &lt;symbol&gt;,&lt;expression&gt;</code></dt>
<dd><p>See <code class="code">.set</code>.
</p>
</dd>
<dt><code class="code">.equiv &lt;symbol&gt;,&lt;expression&gt;</code></dt>
<dd><p>Assign the &lt;expression&gt; to &lt;symbol&gt; similar to <code class="code">.equ</code> and
      <code class="code">.set</code>, but signals an error when &lt;symbol&gt; has already been
      defined.
</p>
</dd>
<dt><code class="code">.err &lt;message&gt;</code></dt>
<dd><p>Print a user error message. Do not create an output file.
</p>
</dd>
<dt><code class="code">.extern  &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>See <code class="code">.global</code>.
</p>
</dd>
<dt><code class="code">.fail &lt;expression&gt;</code></dt>
<dd><p>Cause a warning when &lt;expression&gt; is greater or equal 500. Otherwise
      cause an error.
</p>
</dd>
<dt><code class="code">.file &quot;string&quot;</code></dt>
<dd><p>Set the filename of the input source. This may be used by some
      output modules. By default, the input filename passed on the
      command line is used.
</p>
</dd>
<dt><code class="code">.float &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Parse one of more IEEE single precision floating point expressions and
      write them into successive blocks of 32 bits into memory using the
      backend&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">.global &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag &lt;symbol&gt; as an external symbol, which means that &lt;symbol&gt; is
      visible to all modules in the linking process. It may be either
      defined or undefined.   
</p>
</dd>
<dt><code class="code">.globl &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>See <code class="code">.global</code>.
</p>
</dd>
<dt><code class="code">.half &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit words of
      memory in the current section using the backend&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">.if &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is non-zero.
</p>
</dd>
<dt><code class="code">.ifeq &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is zero.
</p>
</dd>
<dt><code class="code">.ifne &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is non-zero.
</p>
</dd>
<dt><code class="code">.ifgt &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      greater than zero.
</p>
</dd>
<dt><code class="code">.ifge &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      greater than zero or equal.
</p>
</dd>
<dt><code class="code">.iflt &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      less than zero.
</p>
</dd>
<dt><code class="code">.ifle &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      less than zero or equal.
</p>
</dd>
<dt><code class="code">.ifb &lt;operand&gt;</code></dt>
<dd><p>Conditionally assemble the following lines when &lt;operand&gt; is
      completely blank, except an optional comment.
</p>
</dd>
<dt><code class="code">.ifnb &lt;operand&gt;</code></dt>
<dd><p>Conditionally assemble the following lines when &lt;operand&gt; is
      non-blank.
</p>
</dd>
<dt><code class="code">.ifc &lt;string1&gt;,&lt;string2&gt;</code></dt>
<dd><p>Conditionally assemble the following lines when &lt;string1&gt; matches
      &lt;string2&gt;. Empty strings are allowed. Quotes are optional.
</p>
</dd>
<dt><code class="code">.ifnc &lt;string1&gt;,&lt;string2&gt;</code></dt>
<dd><p>Conditionally assembler the following lines when &lt;string1&gt; differs
      from &lt;string2&gt;. Empty strings are allowed. Quotes are optional.
</p>
</dd>
<dt><code class="code">.ifdef &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is defined.
</p>
</dd>
<dt><code class="code">.ifndef &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is undefined.
</p>
</dd>
<dt><code class="code">.incbin &lt;file&gt;</code></dt>
<dd><p>Inserts the binary contents of &lt;file&gt; into the object code at
      this position.
      When the file size (in 8-bit bytes) is not aligned with the size
      of a target-byte the missing bits are automatically appended and
      assumed to be zero.
      As vasm&rsquo;s internal target-byte endianness for more than 8 bits per byte
      is big-endian, included binary files are assumed to have the same
      endianness. Otherwise you have to specify <samp class="option">-ile</samp> to tell vasm
      that they use little-endian target-bytes (on your 8-bit bytes host
      file system).
</p>
</dd>
<dt><code class="code">.incdir &lt;path&gt;</code></dt>
<dd><p>Add another path to search for include files to the list of
      known paths. Paths defined with <samp class="option">-I</samp> on the command line are
      searched first.
</p>
</dd>
<dt><code class="code">.include &lt;file&gt;</code></dt>
<dd><p>Include source text of &lt;file&gt; at this position.
</p>
</dd>
<dt><code class="code">.int &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive words of
      memory in the current section using the target&rsquo;s endianness and
      address size.
</p>
</dd>
<dt><code class="code">.irp &lt;symbol&gt;[,&lt;val&gt;...]</code></dt>
<dd><p>Iterates the block between <code class="code">.irp</code> and <code class="code">.endr</code> for each
      <code class="code">&lt;val&gt;</code>. The current <code class="code">&lt;val&gt;</code>, which may be embedded in quotes,
      is assigned to <code class="code">\symbol</code>. If no value is given, then the block is
      assembled once, with <code class="code">\symbol</code> set to an empty string.
</p>
</dd>
<dt><code class="code">.irpc &lt;symbol&gt;[,&lt;val&gt;...]</code></dt>
<dd><p>Iterates the block between <code class="code">.irp</code> and <code class="code">.endr</code> for each
      character in each <code class="code">&lt;val&gt;</code>, and assign it to <code class="code">\symbol</code>.
      If no value is given, then the block is assembled once, with
      <code class="code">\symbol</code> set to an empty string.
</p>
</dd>
<dt><code class="code">.lcomm &lt;symbol&gt;,&lt;size&gt;[,&lt;alignment&gt;]</code></dt>
<dd><p>Allocate &lt;size&gt; bytes of space in the .bss section and assign
      the value to that location to &lt;symbol&gt;. If &lt;alignment&gt; is given,
      then the space will be aligned to an address having &lt;alignment&gt;
      low zero bits or 2, whichever is greater.
      &lt;symbol&gt; may be made globally visible by the .globl directive.
</p>
</dd>
<dt><code class="code">.list</code></dt>
<dd><p>The following lines will appear in the listing file, when enabled.
</p>
</dd>
<dt><code class="code">.local &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag &lt;symbol&gt; as a local symbol, which means that &lt;symbol&gt; is
      local for the current file and invisible to other modules in
      the linking process.
</p>
</dd>
<dt><code class="code">.long &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 32-bit words of
      memory in the current section using the backend&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">.macro &lt;name&gt; [&lt;argname1&gt;[=&lt;default&gt;][,&lt;argname2&gt;...]]</code></dt>
<dd><p>Defines a macro, which can be referenced by &lt;name&gt;. The macro
      definition is closed by an <code class="code">.endm</code> directive. The argument
      names, which may be passed to this macro, must be declared directly
      following the macro name, separated by white-space. You can define an
      optional default value in the case an argument is left out.
      Note that macro names are case-insensitive while the argument
      names are case-sensitive.
      Within the macro context arguments are referenced by <code class="code">\argname</code>.
      The special argument <code class="code">\@</code> inserts a unique id,
      useful for defining labels.
      <code class="code">\()</code> may be used as a separator between the name of a macro
      argument and the subsequent text.
</p>
</dd>
<dt><code class="code">.nolist</code></dt>
<dd><p>This line and the following lines will not be visible in a listing file.
</p>
</dd>
<dt><code class="code">.org &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Before any section directive, and in absence of the <samp class="option">-gas</samp>
      option, <code class="code">&lt;exp&gt;</code> defines the absolute start address of
      the following code and <code class="code">&lt;fill&gt;</code> has no meaning.
      Within a relocatable section <code class="code">&lt;exp&gt;</code> defines the relative offset
      from the start of this section for the subsequent code.
      The optional &lt;fill&gt; value is only valid within a section and is used
      to fill the space to the new program counter (defaults to zero).
      When &lt;exp&gt; starts with a current-pc symbol followed by a plus (<code class="code">+</code>)
      operator, then the directive just reserves space (filled with zero).
</p>
</dd>
<dt><code class="code">.p2align &lt;bit_count&gt;[,&lt;fill&gt;][,&lt;maxpad&gt;]</code></dt>
<dd><p>Insert as many fill bytes as required to reach an address where
      &lt;bit_count&gt; low order bits are zero. For example <code class="code">.p2align 2</code> would
      make an alignment to the next 32-bit boundary, when the target has
      8-bit addressable memory.
      The padding bytes are initialized by &lt;fill&gt;, when given. The optional
      third argument defines a maximum number of padding bytes to use. When
      more are needed then the alignment is not done at all.
</p>
</dd>
<dt><code class="code">.p2alignl &lt;bit_count&gt;[,&lt;fill&gt;][,&lt;maxpad&gt;]</code></dt>
<dd><p>Works like <code class="code">.p2align</code>, with the only difference that the optional
      fill value can be specified as a 32-bit word. Padding locations which
      are not already 32-bit aligned, will cause a warning and padded by
      zero-bytes.
</p>
</dd>
<dt><code class="code">.p2alignw &lt;bit_count&gt;[,&lt;fill&gt;][,&lt;maxpad&gt;]</code></dt>
<dd><p>Works like <code class="code">.p2align</code>, with the only difference that the optional
      fill value can be specified as a 16-bit word. Padding locations which
      are not already 16-bit aligned, will cause a warning and padded by
      zero-bytes.
</p>
</dd>
<dt><code class="code">.popsection</code></dt>
<dd><p>Restore the top section from the internal section-stack.
      Also refer to <code class="code">.pushsection</code>.
</p>
</dd>
<dt><code class="code">.pushsection &lt;name&gt;[,&quot;&lt;attributes&gt;&quot;][[,@&lt;type&gt;]|[,%&lt;type&gt;]|[,&lt;mem_flags&gt;]]</code></dt>
<dd><p>Works exactly like <code class="code">.section</code>, but additionally pushes
      the previously active section onto an internal stack, where it may be
      restored from by the <code class="code">.popsection</code> directive.
</p>
</dd>
<dt><code class="code">.quad &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive quadwords
      (64-bit) of memory in the current section using the backend&rsquo;s
      endianness.
</p>
</dd>
<dt><code class="code">.rept &lt;expression&gt;</code></dt>
<dd><p>Repeats the assembly of the block between <code class="code">.rept</code> and <code class="code">.endr</code>
      &lt;expression&gt; number of times. &lt;expression&gt; has to be positive.
</p>
</dd>
<dt><code class="code">.section &lt;name&gt;[,&quot;&lt;attributes&gt;&quot;][[,@&lt;type&gt;]|[,%&lt;type&gt;]|[,&lt;mem_flags&gt;]]</code></dt>
<dd><p>Starts a new section named <code class="code">&lt;name&gt;</code> or reactivates an old one.
      When attributes are given for an already existing section, they must
      match exactly.
      The <code class="code">&quot;&lt;attributes&gt;&quot;</code> string may consist of the following characters:
</p>
<p>Section Contents:
</p><dl class="table">
<dt><code class="code">a</code></dt>
<dd><p>section is allocated in memory
</p>
</dd>
<dt><code class="code">c</code></dt>
<dd><p>section has code
</p>
</dd>
<dt><code class="code">d</code></dt>
<dd><p>section has initialized data
</p>
</dd>
<dt><code class="code">u</code></dt>
<dd><p>section has uninitialized data
</p>
</dd>
<dt><code class="code">i</code></dt>
<dd><p>section has directives (info or offsets section)
</p>
</dd>
<dt><code class="code">n</code></dt>
<dd><p>section can be discarded
</p>            
</dd>
<dt><code class="code">R</code></dt>
<dd><p>remove section at link time
</p></dd>
</dl>

<p>Section Protection:
</p>
<dl class="table">
<dt><code class="code">r</code></dt>
<dd><p>section is readable
</p>            
</dd>
<dt><code class="code">w</code></dt>
<dd><p>section is writable
</p>           
</dd>
<dt><code class="code">x</code></dt>
<dd><p>section is executable
</p>           
</dd>
<dt><code class="code">s</code></dt>
<dd><p>section is shareable
</p></dd>
</dl>

<p>Section Alignment: A digit, which is ignored. The assembler will
      automatically align the section to the highest alignment restriction
      used within.
</p>
<p>Memory attributes:
</p>
<dl class="table">
<dt><code class="code">C</code></dt>
<dd><p>load section to Chip RAM (AmigaOS hunk format)
</p></dd>
<dt><code class="code">F</code></dt>
<dd><p>load section to Fast RAM (AmigaOS hunk format)
</p></dd>
<dt><code class="code">z</code></dt>
<dd><p>load section to zero/direct-page (6502, 65816, 680x, etc.)
</p></dd>
</dl>
<p>Any other attribute will still be accepted by vasm and passed to
      the output driver (which might ignore it).
</p>
<p>The optional <code class="code">&lt;type&gt;</code> argument is mainly used for ELF output
      and may be introduced either by a &rsquo;%&rsquo; or a &rsquo;@&rsquo; character.
      Allowed are:
</p>
<dl class="table">
<dt><code class="code">progbits</code></dt>
<dd><p>This is the default value, which means the section data occupies
        space in the file and may have initialized data.
</p></dd>
<dt><code class="code">nobits</code></dt>
<dd><p>These sections do not occupy any space in the file and will be
        allocated filled with zero bytes by the OS loader.
</p></dd>
</dl>

<p>When the optional, non-standard, <code class="code">&lt;mem_flags&gt;</code> argument is given
      it defines a 32-bit memory attribute, which defines where to load
      the section (platform specific).
      The memory attributes are currently only used in the hunk-format
      output module.
</p>
</dd>
<dt><code class="code">.set &lt;symbol&gt;,&lt;expression&gt;</code></dt>
<dd><p>Create a new program symbol with the name &lt;symbol&gt; and assign to it
      the value of &lt;expression&gt;. If &lt;symbol&gt; is already assigned, it will
      contain a new value from now on.
</p> 
</dd>
<dt><code class="code">.size &lt;symbol&gt;,&lt;size&gt;</code></dt>
<dd><p>Defines the size in bytes associated with the given &lt;symbol&gt;.
      This information is only used by some object file formats (for
      example ELF) and typically sets the size of function symbols.
</p>
</dd>
<dt><code class="code">.short &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit words of
      memory in the current section using the backend&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">.single &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Parse one of more IEEE single precision floating point expressions and
      write them into successive blocks of 32 bits into memory using the
      backend&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">.skip &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.
</p> 
</dd>
<dt><code class="code">.space &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.
</p>
</dd>
<dt><code class="code">.stabs &quot;&lt;name&gt;&quot;,&lt;type&gt;,&lt;other&gt;,&lt;desc&gt;,&lt;exp&gt;</code></dt>
<dd><p>Add a stab-entry for debugging, including a symbol-string and
      an expression.
</p>
</dd>
<dt><code class="code">.stabn &lt;type&gt;,&lt;other&gt;,&lt;desc&gt;,&lt;exp&gt;</code></dt>
<dd><p>Add a stab-entry for debugging, without a symbol-string.
</p>
</dd>
<dt><code class="code">.stabd &lt;type&gt;,&lt;other&gt;,&lt;desc&gt;</code></dt>
<dd><p>Add a stab-entry for debugging, without symbol-string and value.
</p>
</dd>
<dt><code class="code">.string &quot;&lt;string1&gt;&quot;[,&quot;&lt;string2&gt;&quot;...]</code></dt>
<dd><p>Like <code class="code">.byte</code>, but adds a terminating zero-byte.
</p>
</dd>
<dt><code class="code">.swbeg &lt;op&gt;</code></dt>
<dd><p>Just for compatibility. Do nothing.
</p>
</dd>
<dt><code class="code">.type &lt;symbol&gt;,&lt;type&gt;</code></dt>
<dd><p>Set type of symbol named &lt;symbol&gt; to &lt;type&gt;, which must be one of:
</p><dl class="table">
<dt><code class="code">1: Object</code></dt>
<dt><code class="code">2: Function</code></dt>
<dt><code class="code">3: Section</code></dt>
<dt><code class="code">4: File</code></dt>
</dl>
<p>The predefined symbols <code class="code">@object</code> and 
        <code class="code">@function</code> are available for
      this purpose.
      Only used by some object file formats (for example ELF).
</p> 
</dd>
<dt><code class="code">.uahalf &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit areas of
      memory in the current section regardless of current alignment.
</p> 
</dd>
<dt><code class="code">.ualong &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 32-bit areas of
      memory in the current section regardless of current alignment.
</p>
</dd>
<dt><code class="code">.uaquad &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 64-bit areas of
      memory in the current section regardless of current alignment.
</p>
</dd>
<dt><code class="code">.uashort &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit areas of
      memory in the current section regardless of current alignment.
</p> 
</dd>
<dt><code class="code">.uaword &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit areas
      of memory in the current section regardless of current alignment.
</p>
</dd>
<dt><code class="code">.weak &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag &lt;symbol&gt; as a weak symbol, which means that &lt;symbol&gt; is
      visible to all modules in the linking process and may be replaced
      by any global symbol with the same name.
      When a weak symbol remains undefined its value defaults to 0.
</p> 
</dd>
<dt><code class="code">.word &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit words of
      memory in the current section using the backend&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">.zero &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.
</p>
</dd>
</dl>

<p>Predefined section directives:
</p><dl class="table">
<dt><code class="code">.bss</code></dt>
<dd><p>.section &quot;.bss&quot;,&quot;aurw&quot;
</p></dd>
<dt><code class="code">.data</code></dt>
<dd><p>.section &quot;.data&quot;,&quot;adrw&quot;
</p></dd>
<dt><code class="code">.dpage</code></dt>
<dd><p>.section &quot;.dpage&quot;,&quot;adrwz&quot;
</p></dd>
<dt><code class="code">.rodata</code></dt>
<dd><p>.section &quot;.rodata&quot;,&quot;adr&quot;
</p></dd>
<dt><code class="code">.sbss</code></dt>
<dd><p>.section &quot;.sbss&quot;,&quot;aurw&quot;
</p></dd>
<dt><code class="code">.sdata</code></dt>
<dd><p>.section &quot;.sdata&quot;,&quot;adrw&quot;
</p></dd>
<dt><code class="code">.sdata2</code></dt>
<dd><p>.section &quot;.sdata2&quot;,&quot;adr&quot;
</p></dd>
<dt><code class="code">.stab</code></dt>
<dd><p>.section &quot;.stab&quot;,&quot;dr&quot;
</p></dd>
<dt><code class="code">.stabstr</code></dt>
<dd><p>.section &quot;.stabstr&quot;,&quot;dr&quot;
</p></dd>
<dt><code class="code">.text</code></dt>
<dd><p>.section &quot;.text&quot;,&quot;acrx&quot;
</p></dd>
<dt><code class="code">.tocd</code></dt>
<dd><p>.section &quot;.tocd&quot;,&quot;adrw&quot;
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="Known-Problems-1">
<h3 class="section"><span>3.5 Known Problems<a class="copiable-link" href="#Known-Problems-1"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-1">
<h3 class="section"><span>3.6 Error Messages<a class="copiable-link" href="#Error-Messages-1"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>1001: mnemonic expected
</li><li>1002: invalid extension
</li><li>1003: no space before operands
</li><li>1004: too many closing parentheses
</li><li>1005: missing closing parentheses
</li><li>1006: missing operand
</li><li>1007: scratch at end of line
</li><li>1008: section flags expected
</li><li>1009: invalid data operand
</li><li>1010: memory flags expected
</li><li>1011: identifier expected
</li><li>1012: assembly aborted
</li><li>1013: unexpected &quot;%s&quot; without &quot;%s&quot;
</li><li>1014: pointless default value for required parameter &lt;%s&gt;
</li><li>1015: invalid section type ignored, assuming progbits
</li><li>1019: syntax error
</li><li>1021: section name expected
</li><li>1022: .fail %lld encountered
</li><li>1023: .fail %lld encountered
</li><li>1024: alignment too big

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Mot-Syntax-Module">
<div class="nav-panel">
<p>
Next: <a href="#Madmac-Syntax-Module" accesskey="n" rel="next">Madmac Syntax Module</a>, Previous: <a href="#Standard-Syntax-Module" accesskey="p" rel="prev">Standard Syntax Module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Mot-Syntax-Module-1"><span>4 Mot Syntax Module<a class="copiable-link" href="#Mot-Syntax-Module-1"> &para;</a></span></h2>
<p>This chapter describes the Motorola syntax module, mostly used for the
M68k and ColdFire families of CPUs, which is available with the extension
<code class="code">mot</code>.
</p>
<ul class="mini-toc">
<li><a href="#Legal-2" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-1" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-Syntax-1" accesskey="3">General Syntax</a></li>
<li><a href="#Directives-1" accesskey="4">Directives</a></li>
<li><a href="#Known-Problems-2" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-2" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-2">
<h3 class="section"><span>4.1 Legal<a class="copiable-link" href="#Legal-2"> &para;</a></span></h3>

<p>This module is written in 2002-2025 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-1">
<h3 class="section"><span>4.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-1"> &para;</a></span></h3>
 
<p>This syntax module provides the following additional options:
</p> 
<dl class="table">
<dt><samp class="option">-align</samp></dt>
<dd><p>Enables natural alignment for data (e.g. <code class="code">dc</code>, <code class="code">ds</code>) and
 offset directives (<code class="code">rs</code>, <code class="code">so</code>, <code class="code">fo</code>).
</p>
</dd>
<dt><samp class="option">-allmp</samp></dt>
<dd><p>Makes all 35 macro arguments available. Default are 9 arguments (<code class="code">\1</code>
 to <code class="code">\9</code>). More arguments can be accessed through <code class="code">\a</code> to
 <code class="code">\z</code>, which may conflict with escape characters or named arguments,
 therefore they are not enabled by default.
</p>
</dd>
<dt><samp class="option">-cnop=&lt;code&gt;</samp></dt>
<dd><p>Sets the two-byte code used for alignment padding with <code class="code">cnop</code> in
 code sections. Defaults to <code class="code">0x4e71</code> on M68k.
</p>
</dd>
<dt><samp class="option">-devpac</samp></dt>
<dd><p>Devpac-compatibility mode. Only directives known to Devpac are recognized.
</p><ul class="itemize mark-minus">
<li>Enables natural alignment for data and structure offsets
        (see option <samp class="option">-align</samp>).
  </li><li>Predefines offset symbols <code class="code">__RS</code>, <code class="code">__SO</code> and <code class="code">__FO</code> as
        <code class="code">0</code>, which otherwise are undefined until first referenced.
  </li><li>Disable escape codes handling in strings (see <samp class="option">-noesc</samp>).
  </li><li>Enable dots within identifiers (see <samp class="option">-ldots</samp>).
  </li><li>Up to 35 macro arguments (see <samp class="option">-allmp</samp>).
  </li><li>Do not use <code class="code">NOP</code> instructions when aligning code
        (see <samp class="option">-cnop=</samp>).
  </li><li>Allow a label definition on the same line as a section directive.
        Note, that in contrast to Devpac this label is not ignored but
        set to the first address in the section!
</li></ul>

</dd>
<dt><samp class="option">-ldots</samp></dt>
<dd><p>Allow dots (<code class="code">.</code>) within all identifiers.
</p>
</dd>
<dt><samp class="option">-localu</samp></dt>
<dd><p>Local symbols are prefixed by <code class="code">'_'</code> instead of <code class="code">'.'</code>. For
 Devpac compatibility, which offers a similar option.
</p>
</dd>
<dt><samp class="option">-nolocpfx</samp></dt>
<dd><p>Disables local symbols to be recognized by their prefix (usually
 <code class="code">'.'</code>). This allows global symbols to be defined with it.
 The <code class="code">'$'</code> suffix for local symbols still works.
</p>
</dd>
<dt><samp class="option">-phxass</samp></dt>
<dd><p>PhxAss-compatibility mode. Only directives known to PhxAss are recognized.
</p><ul class="itemize mark-minus">
<li>Enable escape codes handling in strings (see <samp class="option">-esc</samp>).
  </li><li>Macro names are case-insensitive.
  </li><li>Up to 35 macro arguments (see <samp class="option">-allmp</samp>).
  </li><li>Allow whitespace in operands.
  </li><li>Enable dots within identifiers (see <samp class="option">-ldots</samp>).
  </li><li>Defines the symbol <code class="code">_PHXASS_</code> with value 2 (to differentiate
        from the real PhxAss with value 1).
  </li><li>When no output file name is given, construct it from the input name.
  </li><li>Allow a label definition on the same line as a section directive.
</li></ul>

</dd>
<dt><samp class="option">-spaces</samp></dt>
<dd><p>Allow whitespace characters in the operand field. Otherwise a whitespace
 would start the comment field there.
</p>
</dd>
<dt><samp class="option">-warncomm</samp></dt>
<dd><p>Warn about all lines, which have comments in the operand field, introduced
 by a whitespace character. For example in: <code class="code">dc.w 1 + 2</code>.
</p>
</dd>
</dl>

</div>
<div class="section-level-extent" id="General-Syntax-1">
<h3 class="section"><span>4.3 General Syntax<a class="copiable-link" href="#General-Syntax-1"> &para;</a></span></h3>

<p>Labels must either start at the first column of a line or have to be
terminated by a colon (<code class="code">:</code>). In the first case the mnemonic
has to be separated from the label by whitespace (not required in any case,
e.g. with the <code class="code">=</code> directive). A double colon (<code class="code">::</code>)
automatically makes the label externally visible (refer to directive
<code class="code">xdef</code>).
</p>
<p>Local labels are either prefixed by &rsquo;<code class="code">.</code>&rsquo; or suffixed by &rsquo;<code class="code">$</code>&rsquo;.
For the rest, any alphanumeric character including &rsquo;<code class="code">_</code>&rsquo; is allowed.
Local labels are valid between two global label definitions.
</p>
<p>Otherwise dots (<code class="code">.</code>) are not allowed within a label by default, unless
the option <samp class="option">-ldots</samp> or <samp class="option">-devpac</samp> was specified. Even then,
labels ending on <code class="code">.b</code>, <code class="code">.w</code> or <code class="code">.l</code> can&rsquo;t be defined.
</p>
<p>It is possible to refer to any local symbol in the source by preceding its
name with the name of the last previously defined global symbol:
<code class="code">global_name\local_name</code>. This is for PhxAss compatibility only,
and is no recommended style. Does not work in a macro, as it conflicts
with macro arguments.
</p>
<p>Make sure that you don&rsquo;t define a label on the same line as a
directive for conditional assembly (if, else, endif)! This is not supported
and leads to undefined behaviour.
</p>
<p>Qualifiers are appended to the mnemonic,
separated by a dot (if the CPU-module supports qualifiers). The
operands are separated from the mnemonic by whitespace. Multiple
operands are separated by comma (<code class="code">,</code>).
</p>
<p>In this syntax module, the operand field must not contain any whitespace
characters, as long as the option <samp class="option">-spaces</samp> was not specified.
</p>
<p>Comments can be introduced everywhere by the characters <code class="code">;</code> or <code class="code">*</code>.
The rest of the line will be ignored. Also everything following the operand
field, separated by a whitespace, will be regarded as comment (unless
<samp class="option">-spaces</samp> was given). Be careful with <code class="code">*</code>, which is either
recognized as the &quot;current pc symbol&quot; or as a multiplication operation
in any operand expression
</p>
<p>Example:
</p><div class="example">
<pre class="example-preformatted">mylabel inst.q op1,op2,op3  ;comment
</pre></div>

<p>In expressions, numbers starting with <code class="code">$</code> are hexadecimal (e.g.
<code class="code">$fb2c</code>). <code class="code">%</code> introduces binary numbers (e.g. <code class="code">%1100101</code>).
Numbers starting with <code class="code">@</code> are assumed to be octal numbers, e.g.
<code class="code">@237</code>. All numbers starting with a digit are decimal, e.g. 
<code class="code">1239</code>.
</p>

</div>
<div class="section-level-extent" id="Directives-1">
<h3 class="section"><span>4.4 Directives<a class="copiable-link" href="#Directives-1"> &para;</a></span></h3>

<p>The following directives are supported by this syntax module (provided the
CPU- and output-module support them):
</p>
<dl class="table">
<dt><code class="code">&lt;symbol&gt; = &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; =.s &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.s &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; =.d &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.d &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; =.x &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.x &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; =.p &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.p &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">align &lt;bitcount&gt;</code></dt>
<dd><p>Insert as many zero bytes as required to reach an address where
      &lt;bitcount&gt; low order bits are zero. For example <code class="code">align 2</code> would
      make an alignment to the next 32-bit boundary.
</p>
</dd>
<dt><code class="code">assert &lt;expression&gt;[,&lt;message&gt;]</code></dt>
<dd><p>Display an error with the optional &lt;message&gt; when the expression
      is false.
</p>
</dd>
<dt><code class="code">blk.b &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">dcb.b &lt;exp&gt;,&lt;fill&gt;</code>.
</p>
</dd>
<dt><code class="code">blk.d &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">dcb.d &lt;exp&gt;,&lt;fill&gt;</code>.
</p>
</dd>
<dt><code class="code">blk.l &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">dcb.l &lt;exp&gt;,&lt;fill&gt;</code>.
</p>
</dd>
<dt><code class="code">blk.q &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">dcb.q &lt;exp&gt;,&lt;fill&gt;</code>.
</p>
</dd>
<dt><code class="code">blk.s &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">dcb.s &lt;exp&gt;,&lt;fill&gt;</code>.
</p>
</dd>
<dt><code class="code">blk.w &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">dcb.w &lt;exp&gt;,&lt;fill&gt;</code>.
</p>
</dd>
<dt><code class="code">blk.x &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">dcb.x &lt;exp&gt;,&lt;fill&gt;</code>.
</p>
</dd>
<dt><code class="code">bss</code></dt>
<dd><p>Equivalent to <code class="code">section bss,bss</code>.
</p>
</dd>
<dt><code class="code">bss_c</code></dt>
<dd><p>Equivalent to <code class="code">section bss_c,bss,chip</code>.
</p>
</dd>
<dt><code class="code">bss_f</code></dt>
<dd><p>Equivalent to <code class="code">section bss_f,bss,fast</code>.
</p>
</dd>
<dt><code class="code">cargs [#&lt;offset&gt;,]&lt;symbol1&gt;[.&lt;size1&gt;][,&lt;symbol2&gt;[.&lt;size2&gt;]]...</code></dt>
<dd><p>Defines &lt;symbol1&gt; with the value of &lt;offset&gt;. Further symbols
      on the line, separated by comma, will be assigned the &lt;offset&gt; plus
      the size of the previous symbol. The size defaults to 2. Valid
      optional size extensions are: <code class="code">.b</code>, <code class="code">.w</code>, <code class="code">.l</code>,
      where <code class="code">.l</code> results in a size of 4, the others 2.
      The &lt;offset&gt; argument defaults to the target&rsquo;s address size
      (4 for M68k) when omitted.
</p>
</dd>
<dt><code class="code">clrfo</code></dt>
<dd><p>Reset stack-frame offset counter to zero. See <code class="code">fo</code> directive.
</p>
</dd>
<dt><code class="code">clrso</code></dt>
<dd><p>Reset structure offset counter to zero. See <code class="code">so</code> directive.
</p>
</dd>
<dt><code class="code">cnop &lt;offset&gt;,&lt;alignment&gt;</code></dt>
<dd><p>Insert as many padding bytes as required to reach an address which
      can be divided by &lt;alignment&gt;. Then add &lt;offset&gt; padding bytes.
      May fill the alignment- and padding-bytes with no-operation
      instructions for certain cpus. See option <samp class="option">-cnop</samp>.
</p>
</dd>
<dt><code class="code">code</code></dt>
<dd><p>Equivalent to <code class="code">section code,code</code>.
</p>
</dd>
<dt><code class="code">code_c</code></dt>
<dd><p>Equivalent to <code class="code">section code_c,code,chip</code>.
</p>
</dd>
<dt><code class="code">code_f</code></dt>
<dd><p>Equivalent to <code class="code">section code_f,code,fast</code>.
</p>
</dd>
<dt><code class="code">comm &lt;symbol&gt;,&lt;size&gt;</code></dt>
<dd><p>Create a common symbol with the given size. The alignment is always
      32 bits.
</p>
</dd>
<dt><code class="code">comment</code></dt>
<dd><p>Starting with the operand field everything is ignored and
      seen as a comment.
      There is only one exception, when the operand contains <code class="code">HEAD=</code>.
      Then the following expression is passed to the TOS output module
      via the symbol &rsquo;<code class="code">TOSFLAGS</code>&rsquo;, to define the Atari specific TOS
      flags.
</p>
</dd>
<dt><code class="code">cseg</code></dt>
<dd><p>Equivalent to <code class="code">section code,code</code>.
</p>
</dd>
<dt><code class="code">data</code></dt>
<dd><p>Equivalent to <code class="code">section data,data</code>.
</p>
</dd>
<dt><code class="code">data_c</code></dt>
<dd><p>Equivalent to <code class="code">section data_c,data,chip</code>.
</p>
</dd>
<dt><code class="code">data_f</code></dt>
<dd><p>Equivalent to <code class="code">section data_f,data,fast</code>.
</p>
</dd>
<dt><code class="code">db &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;,'&lt;string2&gt;'...]</code></dt>
<dd><p>Equivalent to <code class="code">dc.b</code> for ArgAsm, BAsm, HX68, Macro68, ProAsm, etc.
      compatibility. Does not exist in PhxAss- or Devpac-compatiblity mode.
</p>
</dd>
<dt><code class="code">dc.b &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;,'&lt;string2&gt;'...]</code></dt>
<dd><p>Assign the integer or string constant operands into successive
      bytes of memory in the current section. Any combination of integer
      and character string constant operands is permitted.
</p>
</dd>
<dt><code class="code">dc.d &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 64-bit words
      of memory in the current section, using the IEEE double precision
      format when specifying them as floating point constants.
</p>
</dd>
<dt><code class="code">dc.l &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 32-bit words
      of memory in the current section.
</p>
</dd>
<dt><code class="code">dc.p &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 96-bit words
      of memory in the current section, using the Packed Decimal format
      when specifying them as floating point constants.
</p>
</dd>
<dt><code class="code">dc.q &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 64-bit words
      of memory in the current section.
</p>
</dd>
<dt><code class="code">dc.s &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 32-bit words
      of memory in the current section, using the IEEE single precision
      format when specifying them as floating point constants.
</p>
</dd>
<dt><code class="code">dc.w &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit words
      of memory in the current section.
</p>
</dd>
<dt><code class="code">dc.x &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 96-bit words
      of memory in the current section, using the IEEE extended precision
      format when specifying them as floating point constants.
</p>
</dd>
<dt><code class="code">dcb.b &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.
</p>
</dd>
<dt><code class="code">dcb.d &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 64-bit words into the current section.
      &lt;fill&gt; may also be a floating point constant which is then written
      in IEEE double precision format.
</p>
</dd>
<dt><code class="code">dcb.l &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 32-bit words into the current section.
</p>
</dd>
<dt><code class="code">dcb.q &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 64-bit words into the current section.
</p>
</dd>
<dt><code class="code">dcb.s &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 32-bit words into the current section.
      &lt;fill&gt; may also be a floating point constant which is then written
      in IEEE single precision format.
</p>
</dd>
<dt><code class="code">dcb.w &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 16-bit words into the current section.
</p>
</dd>
<dt><code class="code">dcb.x &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 96-bit words into the current section.
      &lt;fill&gt; may also be a floating point constant which is then written
      in IEEE extended precision format.
</p>
</dd>
<dt><code class="code">dl &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">dc.l</code> for ArgAsm, BAsm, HX68, Macro68, ProAsm, etc.
      compatibility. Does not exist in PhxAss- or Devpac-compatiblity mode.
</p>
</dd>
<dt><code class="code">dr.b &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Calculates &lt;expN&gt; - &lt;current pc value&gt; and stores it into successive
      bytes of memory in the current section.
</p>
</dd>
<dt><code class="code">dr.w &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Calculates &lt;expN&gt; - &lt;current pc value&gt; and stores it into successive
      16-bit words of memory in the current section.
</p>
</dd>
<dt><code class="code">dr.l &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Calculates &lt;expN&gt; - &lt;current pc value&gt; and stores it into successive
      32-bit words of memory in the current section.
</p>
</dd>
<dt><code class="code">ds.b &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.b &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.d &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.d &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.l &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.l &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.q &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.q &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.s &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.s &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.w &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.w &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.x &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.x &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">dseg</code></dt>
<dd><p>Equivalent to <code class="code">section data,data</code>.
</p>
</dd>
<dt><code class="code">dw &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">dc.w</code> for ArgAsm, BAsm, HX68, Macro68, ProAsm, etc.
      compatibility. Does not exist in PhxAss- or Devpac-compatiblity mode.
</p>
</dd>
<dt><code class="code">dx.b &lt;exp&gt;</code></dt>
<dd><p>Tries to allocate space in the DataBss portion of a code or
      data section. Otherwise equivalent to <code class="code">dcb.b &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">dx.d &lt;exp&gt;</code></dt>
<dd><p>Tries to allocate space in the DataBss portion of a code or
      data section. Otherwise equivalent to <code class="code">dcb.d &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">dx.l &lt;exp&gt;</code></dt>
<dd><p>Tries to allocate space in the DataBss portion of a code or
      data section. Otherwise equivalent to <code class="code">dcb.l &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">dx.q &lt;exp&gt;</code></dt>
<dd><p>Tries to allocate space in the DataBss portion of a code or
      data section. Otherwise equivalent to <code class="code">dcb.q &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">dx.s &lt;exp&gt;</code></dt>
<dd><p>Tries to allocate space in the DataBss portion of a code or
      data section. Otherwise equivalent to <code class="code">dcb.s &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">dx.w &lt;exp&gt;</code></dt>
<dd><p>Tries to allocate space in the DataBss portion of a code or
      data section. Otherwise equivalent to <code class="code">dcb.w &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">dx.x &lt;exp&gt;</code></dt>
<dd><p>Tries to allocate space in the DataBss portion of a code or
      data section. Otherwise equivalent to <code class="code">dcb.x &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">echo &lt;&quot;string&quot;|exp&gt;[,&lt;&quot;string&quot;|exp&gt;]...</code></dt>
<dd><p>Prints one or more strings or expressions to stdout, terminated
      by a newline. Strings are identified by single- or double-quotes.
      In PhxAss-comapatibility mode only a single string can be printed.
</p>
</dd>
<dt><code class="code">einline</code></dt>
<dd><p>End a block of isolated local labels, started by <code class="code">inline</code>.
</p>
</dd>
<dt><code class="code">else</code></dt>
<dd><p>Assemble the following lines if the previous <code class="code">if</code> condition
      was false.
</p>
</dd>
<dt><code class="code">elseif</code></dt>
<dd><p>Same as <code class="code">else</code>, for compatibility!
</p>
</dd>
<dt><code class="code">elif &lt;exp&gt;</code></dt>
<dd><p>This is a real else-if directive! Not supported by Devpac.
      It&rsquo;s the same as <code class="code">else</code> followed by <code class="code">if</code>, but without the
      need for a matching <code class="code">endif</code> directive. Avoids nesting.
</p>
</dd>
<dt><code class="code">end</code></dt>
<dd><p>Assembly will terminate with this line. The subsequent source text
      is ignored.
</p>
</dd>
<dt><code class="code">endif</code></dt>
<dd><p>Ends a section of conditional assembly.
</p>
</dd>
<dt><code class="code">endm</code></dt>
<dd><p>Ends a macro definition.
</p>
</dd>
<dt><code class="code">endr</code></dt>
<dd><p>Ends a repetition block.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code></dt>
<dd><p>Define a new program symbol with the name &lt;symbol&gt; and assign to it
      the value of &lt;expression&gt;. Defining &lt;symbol&gt; twice will cause
      an error.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equ.s &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.s &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equ.d &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.d &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equ.x &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.x &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equ.p &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.p &lt;expression&gt;</code>. PhxAss compatibility.
</p>
</dd>
<dt><code class="code">erem</code></dt>
<dd><p>Ends an outcommented block. Assembly will continue.
</p>
</dd>
<dt><code class="code">even</code></dt>
<dd><p>Aligns to an even address. Equivalent to <code class="code">cnop 0,2</code>.
</p>
</dd>
<dt><code class="code">fail &lt;message&gt;</code></dt>
<dd><p>Show an error message including the &lt;message&gt; string. Do not generate
      an output file.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; fequ.s &lt;expression&gt;</code></dt>
<dd><p>Define a new program symbol with the name &lt;symbol&gt; and assign to it
      the floating point value of &lt;expression&gt;. Defining &lt;symbol&gt; twice
      will cause an error. The extension is for Devpac-compatibility, but
      will be ignored.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; fequ.d &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.s &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; fequ.x &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.s &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; fequ.p &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; fequ.s &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;label&gt; fo.&lt;size&gt; &lt;expression&gt;</code></dt>
<dd><p>Assigns the current value of the stack-frame offset counter to &lt;label&gt;.
      Afterwards the counter is decremented by the instruction&rsquo;s &lt;size&gt;
      multiplied by &lt;expression&gt;. Any valid M68k size extension is allowed
      for &lt;size&gt;: b, w, l, q, s, d, x, p.
      The offset counter can also be referenced directly under the name
      <code class="code">__FO</code>.
</p>
</dd>
<dt><code class="code">idnt &lt;name&gt;</code></dt>
<dd><p>Sets the file or module name in the generated object file to
      &lt;name&gt;, when the selected output module supports it. By default,
      the input filename passed on the command line is used.
</p>
</dd>
<dt><code class="code">if &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is non-zero.
</p>
</dd>
<dt><code class="code">if1</code></dt>
<dd><p>Just for compatibility. Not really supported, as vasm parses a
      source text only once. Always true.
</p>
</dd>
<dt><code class="code">if2</code></dt>
<dd><p>Just for compatibility. Not really supported, as vasm parses a
      source text only once. Always false.
</p>
</dd>
<dt><code class="code">ifeq &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is zero.
</p>
</dd>
<dt><code class="code">ifne &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is non-zero.
</p>
</dd>
<dt><code class="code">ifgt &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      greater than zero.
</p>
</dd>
<dt><code class="code">ifge &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      greater than zero or equal.
</p>
</dd>
<dt><code class="code">iflt &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      less than zero.
</p>
</dd>
<dt><code class="code">ifle &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      less than zero or equal.
</p>
</dd>
<dt><code class="code">ifb &lt;operand&gt;</code></dt>
<dd><p>Conditionally assemble the following lines when &lt;operand&gt; is
      completely blank, except for an optional comment.
</p>
</dd>
<dt><code class="code">ifnb &lt;operand&gt;</code></dt>
<dd><p>Conditionally assemble the following lines when &lt;operand&gt; is
      non-blank.
</p>
</dd>
<dt><code class="code">ifc &lt;string1&gt;,&lt;string2&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;string1&gt; matches
      &lt;string2&gt;.
</p>
</dd>
<dt><code class="code">ifnc &lt;string1&gt;,&lt;string2&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;string1&gt; does not
      match &lt;string2&gt;.
</p>
</dd>
<dt><code class="code">ifd &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is defined.
</p>
</dd>
<dt><code class="code">ifnd &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is undefined.
</p>
</dd>
<dt><code class="code">ifmacrod &lt;macro&gt;</code></dt>
<dd><p>Conditionally assemble the following line if &lt;macro&gt; is defined.
</p>
</dd>
<dt><code class="code">ifmacrond &lt;macro&gt;</code></dt>
<dd><p>Conditionally assemble the following line if &lt;macro&gt; is undefined.
</p>
</dd>
<dt><code class="code">ifp1</code></dt>
<dd><p>Just for compatibility. Equivalent to <code class="code">if1</code>.
</p>
</dd>
<dt><code class="code">iif &lt;expression&gt; &lt;statement&gt;</code></dt>
<dd><p>Conditionally assemble the &lt;statement&gt; following &lt;expression&gt;.
      IIF stands for Immediate IF.
      If the value of &lt;expression&gt; is non-zero then &lt;statement&gt; is assembled.
      No <code class="code">ENDC</code> must be used in conjunction with this directive.
      The &lt;statement&gt; cannot include a label, but a label may precede the
      <code class="code">IIF</code> directive. For example:
</p><div class="example">
<pre class="example-preformatted">foo IIF bar equ 42
</pre></div>
<p>The <code class="code">foo</code> label will be assigned with <code class="code">42</code> if <code class="code">bar</code>
      evaluates to true, otherwise <code class="code">foo</code> will be assigned with the
      current program counter.
      Assigning a value in the <code class="code">IIF &lt;statement&gt;</code> using
      the equal (<code class="code">=</code>) operator, while the option <samp class="option">-spaces</samp>
      was given, cannot work, because the equal operator will be
      evaluated as part of the expression.
      I.e. <code class="code">foo IIF 1+1 = 42</code> works, but <code class="code">foo IIF 1 + 1 = 42</code>,
      when the option <samp class="option">-spaces</samp> was specified, won&rsquo;t, as
      <code class="code">= 42</code> is evaluated as part of the expression.
</p>
</dd>
<dt><code class="code">incbin &lt;filename&gt;[,&lt;offset&gt;[,&lt;length&gt;]]</code></dt>
<dd><p>Inserts the binary contents of &lt;filename&gt; into the object code at
      this position. When &lt;offset&gt; is specified, then the given number
      of bytes will be skipped at the beginning of the file. The optional
      &lt;length&gt; argument specifies the maximum number of bytes to be read
      from that file.
</p>
</dd>
<dt><code class="code">incdir &lt;path&gt;</code></dt>
<dd><p>Add another path to search for include files to the list of
      known paths. Paths defined with <samp class="option">-I</samp> on the command line are
      searched first.
</p>
</dd>
<dt><code class="code">include &lt;filename&gt;</code></dt>
<dd><p>Include source text of &lt;filename&gt; at this position. When the file name
      specified has no absolute path, then search it in all defined
      paths in the order of occurrence, starting with the current work
      directory.
</p>
</dd>
<dt><code class="code">inline</code></dt>
<dd><p>Local labels in the following block are isolated from previous
      local labels and those after <code class="code">einline</code>.
</p>
</dd>
<dt><code class="code">list</code></dt>
<dd><p>The following lines will appear in the listing file, if it was
      requested.
</p>
</dd>
<dt><code class="code">llen &lt;len&gt;</code></dt>
<dd><p>Set the line length in a listing file to a maximum of &lt;len&gt; characters.
      Currently without any effect.
</p>
</dd>
<dt><code class="code">local</code></dt>
<dd><p>Separates two blocks of local labels. Which means, local labels
      from above this directive may be reused.
</p>
</dd>
<dt><code class="code">macro &lt;name&gt;</code></dt>
<dd><p>Defines a macro which can be referenced by &lt;name&gt;. For compatibility,
      the &lt;name&gt; may alternatively appear on the left side of
      the <code class="code">macro</code> directive, starting on the first column.
      Then the operand field is ignored. The macro definition is terminated
      by an <code class="code">endm</code> directive. When calling a macro you may pass
      up to 9 arguments, separated by comma. These arguments are
      referenced within the macro context as <code class="code">\1</code> to <code class="code">\9</code>.
      Parameter <code class="code">\0</code> is set to the macro&rsquo;s first qualifier
      (mnemonic extension), when given.
      In Devpac- and PhxAss-compatibility mode, or with option
      <samp class="option">-allmp</samp>, up to 35 arguments are accepted,
      where argument 10-35 can be referenced by <code class="code">\a</code> to <code class="code">\z</code>.
      In case you have a macro argument which contains commas or spaces you
      may enclose it between <code class="code">&lt;</code> and <code class="code">&gt;</code> characters. A <code class="code">&gt;</code>
      character may still be included by writing <code class="code">&gt;&gt;</code>, or when
      embedded within a string. (Note that strings are ignored in Devpac
      compatibility mode.)
</p>
<p>Special macro parameters:
</p><dl class="table">
<dt><code class="code">\@</code></dt>
<dd><p>Insert a unique id, useful for defining labels. Every macro call
      gets its own unique id.
</p></dd>
<dt><code class="code">\@!</code></dt>
<dd><p>Push the current unique id onto a global id stack, then insert it.
</p></dd>
<dt><code class="code">\@?</code></dt>
<dd><p>Push the current unique id below the top element of the global id
      stack, then insert it.
</p></dd>
<dt><code class="code">\@@</code></dt>
<dd><p>Pull the top element from the global id stack and insert it. The
      macro&rsquo;s current unique id is not affected by this operation.
</p></dd>
<dt><code class="code">\#</code></dt>
<dd><p>Insert the number of arguments that have been passed to this macro.
      Equivalent to the contents of the symbol <code class="code">NARG</code>.
</p></dd>
<dt><code class="code">\?n</code></dt>
<dd><p>Insert the length of the <code class="code">n</code>&rsquo;th macro argument.
</p></dd>
<dt><code class="code">\.</code></dt>
<dd><p>Insert the argument which is selected by the current value of the
      <code class="code">CARG</code> symbol (first argument, when <code class="code">CARG</code> is <code class="code">1</code>).
</p></dd>
<dt><code class="code">\+</code></dt>
<dd><p>Works like <code class="code">\.</code>, but increments the value of <code class="code">CARG</code> after
      that.
</p></dd>
<dt><code class="code">\-</code></dt>
<dd><p>Works like <code class="code">\.</code>, but decrements the value of <code class="code">CARG</code> after
      that.
</p></dd>
<dt><code class="code">\&lt;symbolname&gt;</code></dt>
<dd><p>Inserts the current decimal value of the absolute
      symbol <code class="code">symbolname</code>.
</p></dd>
<dt><code class="code">\&lt;$symbolname&gt;</code></dt>
<dd><p>Inserts the current hexadecimal value of the absolute
      symbol <code class="code">symbolname</code>, without leading <code class="code">$</code>.
</p></dd>
</dl>

</dd>
<dt><code class="code">mexit</code></dt>
<dd><p>Leave the current macro and continue with assembling the parent
      context. Note that this directive also resets the level of conditional
      assembly to a state before the macro was invoked; which means that
      it also works as a &rsquo;break&rsquo; command on all new <code class="code">if</code> directives.
</p>
</dd>
<dt><code class="code">msource on/off</code></dt>
<dd><p>Enable or disable source level debugging within a macro context.
      It can be used before one or more macro definitions.
      When off, the debugger will show the invoking source text line
      instead. Defaults to <code class="code">on</code>. Also numeric expressions like
      <code class="code">0</code> or <code class="code">1</code> are allowed.
      Note, that this directive currently only has a meaning when using
      the <samp class="option">-linedebug</samp> option with the hunk-format output module
      (<samp class="option">-Fhunk</samp>).
</p>
</dd>
<dt><code class="code">nolist</code></dt>
<dd><p>This line and the following lines will not be visible in a listing file.
</p>
</dd>
<dt><code class="code">nopage</code></dt>
<dd><p>Never start a new page in the listing file.
      This implementation will only prevent emitting the formfeed code.
</p>
</dd>
<dt><code class="code">nref &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag &lt;symbol&gt; as externally defined, similar to <code class="code">xref</code>,
      but also indicate that references can be optimized to base-relative
      addressing modes, when possible. This directive is only present
      in PhxAss-compatibility mode.
</p>
</dd>
<dt><code class="code">odd</code></dt>
<dd><p>Aligns to an odd address. Equivalent to <code class="code">cnop 1,2</code>.
      Bugs: Note that this is not a real <code class="code">odd</code> directive, as it
      wastes two bytes when the address is already odd.
</p>
</dd>
<dt><code class="code">offset [&lt;expression&gt;]</code></dt>
<dd><p>Switches to a special offset-section, similar to a <code class="code">section</code>
      directive, although its contents is not included in the output.
      Its labels may be referenced as absolute offset symbols.
      Can be used to define structure offsets.
      The optional <code class="code">&lt;expression&gt;</code> gives the start offset for this section.
      When missing, the last offset of the previous offset-section is used,
      or 0.
      <code class="code">&lt;expression&gt;</code> must evaluate as a constant!
</p>
</dd>
<dt><code class="code">org &lt;expression&gt;</code></dt>
<dd><p>Sets the base address for the subsequent code. Note that it is allowed
      to embed such an absolute ORG block into a section. Return to
      relocatable mode with any new <code class="code">section</code> directive.
      Although, in Devpac compatibility mode the previous section will
      stay absolute.
</p>
</dd>
<dt><code class="code">output &lt;name&gt;</code></dt>
<dd><p>Sets the output file name to <code class="code">&lt;name&gt;</code> when no output name was
      given on the command line. A special case for Devpac-compatibility
      is when <code class="code">&lt;name&gt;</code> starts with a <code class="code">'.'</code> and an output name was
      already given. Then the current output name gets <code class="code">&lt;name&gt;</code>
      appended as an extension. When an extension already exists,
      then it is replaced.
</p>
</dd>
<dt><code class="code">page</code></dt>
<dd><p>Start a new page in the listing file (not implemented).
      Make sure to start a new page when the maximum page length is reached.
</p>
</dd>
<dt><code class="code">plen &lt;len&gt;</code></dt>
<dd><p>Set the page length for a listing file to <code class="code">&lt;len&gt;</code> lines.
      Currently ignored.
</p>
</dd>
<dt><code class="code">printt &lt;string&gt;[,&lt;string&gt;...]</code></dt>
<dd><p>Prints <code class="code">&lt;string&gt;</code> to stdout. Every additional string into a new line.
      Quotes are optional.
</p>
</dd>
<dt><code class="code">printv &lt;expression&gt;[,&lt;expression&gt;...]</code></dt>
<dd><p>Evaluate <code class="code">&lt;expression&gt;</code> and print it to stdout out in hexadecimal,
      decimal, ASCII and binary format.
</p>
</dd>
<dt><code class="code">public &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag <code class="code">&lt;symbol&gt;</code> as an external symbol, which means that
      <code class="code">&lt;symbol&gt;</code> is visible to all modules in the linking process.
      It may be either defined or undefined.
</p>
</dd>
<dt><code class="code">popsection</code></dt>
<dd><p>Restore the top section from the internal section-stack and
      activate it. Also refer to <code class="code">pushsection</code>.
</p>
</dd>
<dt><code class="code">pushsection</code></dt>
<dd><p>Pushes the current section onto an internal stack, where it may be
      restored from by the <code class="code">popsection</code> directive.
</p>
</dd>
<dt><code class="code">rem</code></dt>
<dd><p>The assembler will ignore everything from encountering the <code class="code">rem</code>
      directive until an <code class="code">erem</code> directive was found.
</p>
</dd>
<dt><code class="code">rept &lt;expression&gt;[,&lt;symbol&gt;]</code></dt>
<dd><p>Repeats the assembly of the block between <code class="code">rept</code> and <code class="code">endr</code>
      <code class="code">&lt;expression&gt;</code> number of times. <code class="code">&lt;expression&gt;</code> should be
      positive. Negative values are regarded as <code class="code">0</code>.
      The internal symbol <code class="code">REPTN</code> always holds the iteration counter
      of the inner repeat loop, starting with 0. <code class="code">REPTN</code> is -1 outside
      of any repeat block.
      The optional <code class="code">SET</code>-symbol <code class="code">&lt;symbol&gt;</code> receives a copy of the
      current iteration counter, when given (this is a non-standard
      extension!).
</p>
</dd>
<dt><code class="code">rorg &lt;expression&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Sets the program counter to an offset relative to the start
      of the current section, as defined by <code class="code">&lt;expression&gt;</code>.
      The new program counter (section offset) must not be smaller than the
      current one. Any space will be padded by the optional <code class="code">&lt;fill&gt;</code>
      value, or zero.
</p>
</dd>
<dt><code class="code">&lt;label&gt; rs.&lt;size&gt; &lt;expression&gt;</code></dt>
<dd><p>Works like the <code class="code">so</code> directive, with the only difference that
      the offset symbol is named <code class="code">__RS</code>.
</p>
</dd>
<dt><code class="code">rseven</code></dt>
<dd><p>Align the structure offset counter (<code class="code">__RS</code>) to an even count.
</p>
</dd>
<dt><code class="code">rsreset</code></dt>
<dd><p>Equivalent to <code class="code">clrso</code>, but the symbol manipulated is <code class="code">__RS</code>.
</p>
</dd>
<dt><code class="code">rsset &lt;expression&gt;</code></dt>
<dd><p>Sets the structure offset counter (<code class="code">__RS</code>) to <code class="code">&lt;expression&gt;</code>.
      See <code class="code">rs</code> directive.
</p>
</dd>
<dt><code class="code">section &lt;name&gt;[,&lt;sec_type&gt;][,&lt;mem_type&gt;]</code></dt>
<dd><p>Starts a new section named <code class="code">&lt;name&gt;</code> or reactivates an old one.
      <code class="code">&lt;sec_type&gt;</code> defines the section type and may be <code class="code">code</code>,
      <code class="code">text</code> (same as <code class="code">code</code>), <code class="code">data</code> or <code class="code">bss</code>.
      If the selected output format does not support section names (like
      &quot;aout&quot;, &quot;tos&quot; or &quot;xfile&quot;), then a missing <code class="code">&lt;sec_type&gt;</code>
      argument makes vasm interpret the first argument, <code class="code">&lt;name&gt;</code>,
      as section type instead. Otherwise a missing <code class="code">&lt;sec_type&gt;</code>
      defaults to a <code class="code">code</code> section with the given name.
      The optional <code class="code">&lt;mem_type&gt;</code> has currently only a meaning for
      the hunk-format output module and defines a 32-bit
      memory attribute which specifies where to load the section.
      <code class="code">&lt;mem_type&gt;</code> is either a numerical constant or one of the
      keywords <code class="code">chip</code> (for Chip-RAM) or <code class="code">fast</code> (for Fast-RAM).
      Optionally it is also possible to attach the suffix <code class="code">_C</code>, <code class="code">_F</code>
      or <code class="code">_P</code> to the <code class="code">&lt;sec_type&gt;</code> argument for defining the memory
      type.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; set &lt;expression&gt;</code></dt>
<dd><p>Create a new symbol with the name &lt;symbol&gt; and assign
      the value of &lt;expression&gt;. If &lt;symbol&gt; is already assigned, it will
      contain a new value from now on.
</p>
</dd>
<dt><code class="code">setfo &lt;expression&gt;</code></dt>
<dd><p>Sets the stack-frame offset counter (<code class="code">__FO</code>) to <code class="code">&lt;expression&gt;</code>.
      See <code class="code">fo</code> directive.
</p>
</dd>
<dt><code class="code">setso &lt;expression&gt;</code></dt>
<dd><p>Sets the structure offset counter (<code class="code">__SO</code>) to <code class="code">&lt;expression&gt;</code>.
      See <code class="code">so</code> directive.
</p>
</dd>
<dt><code class="code">showoffset [&lt;text&gt;]</code></dt>
<dd><p>Print current section offset (or absolute address) to the console,
      preceded by the optional <code class="code">&lt;text&gt;</code> (may use quotes).
      PhxAss compatibility. Do not use in new code.
</p>
</dd>
<dt><code class="code">&lt;label&gt; so.&lt;size&gt; &lt;expression&gt;</code></dt>
<dd><p>Assigns the current value of the structure offset counter to
      <code class="code">&lt;label&gt;</code>.
      Afterwards the counter is incremented by the instruction&rsquo;s
      <code class="code">&lt;size&gt;</code> multiplied by <code class="code">&lt;expression&gt;</code>.
      Any valid M68k size extension is allowed for <code class="code">&lt;size&gt;</code>:
      <code class="code">b</code>, <code class="code">w</code>, <code class="code">l</code>, <code class="code">q</code>, <code class="code">s</code>, <code class="code">d</code>, <code class="code">x</code>,
      <code class="code">p</code>.
      The offset counter can also be referenced directly under the name
      <code class="code">__SO</code>.
</p>
</dd>
<dt><code class="code">spc &lt;lines&gt;</code></dt>
<dd><p>Output <code class="code">&lt;lines&gt;</code> number of blank lines in the listing file.
      Currently without any effect.
</p>
</dd>
<dt><code class="code">text</code></dt>
<dd><p>Equivalent to <code class="code">section code,code</code>.
</p>
</dd>
<dt><code class="code">ttl &lt;name&gt;</code></dt>
<dd><p>Devpac/PhxAss syntax. Set current page title for the listing file.
</p>
</dd>
<dt><code class="code">&lt;name&gt; ttl</code></dt>
<dd><p>Motorola syntax. Set current page title for the listing file.
</p>
</dd>
<dt><code class="code">weak &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag <code class="code">&lt;symbol&gt;</code> as a weak symbol, which means that <code class="code">&lt;symbol&gt;</code>
      is visible to all modules in the linking process, but may be replaced
      by any global symbol with the same name.
      When a weak symbol remains undefined its value defaults to 0.
</p>
</dd>
<dt><code class="code">xdef &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag <code class="code">&lt;symbol&gt;</code> as a global symbol, which means that
      <code class="code">&lt;symbol&gt;</code> is visible to all modules in the linking process.
      See also <code class="code">public</code>.
</p>
</dd>
<dt><code class="code">xref &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag <code class="code">&lt;symbol&gt;</code> as externally defined, which means it has to
      be imported from another module into the linking process.
      See also <code class="code">public</code>.
</p>
</dd>
</dl>

</div>
<div class="section-level-extent" id="Known-Problems-2">
<h3 class="section"><span>4.5 Known Problems<a class="copiable-link" href="#Known-Problems-2"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li><code class="code">odd</code> directive wastes two bytes, when address is already odd.
</li><li>Some listing file directives have no effect.
</li><li>Macro parameter replacement is also done when a line is
      commented out. This is a problem for special codes which modify the
      internal state, like \@@, \@!, \@?, \+, \-.
</li><li><code class="code">echo</code>, <code class="code">printt</code> and <code class="code">printv</code> do not work when the
      source text doesn&rsquo;t contain any real code.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-2">
<h3 class="section"><span>4.6 Error Messages<a class="copiable-link" href="#Error-Messages-2"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>1001: mnemonic expected
</li><li>1002: invalid extension
</li><li>1003: no space before operands
</li><li>1004: too many closing parentheses
</li><li>1005: missing closing parentheses
</li><li>1006: missing operand
</li><li>1007: garbage at end of line
</li><li>1008: syntax error
</li><li>1009: invalid data operand
</li><li>1010: , expected
</li><li>1011: identifier expected
</li><li>1012: directive has no effect
</li><li>1013: unexpected &quot;%s&quot; without &quot;%s&quot;
</li><li>1014: illegal section type
</li><li>1015: macro id insert on empty stack
</li><li>1016: illegal memory type
</li><li>1017: macro id stack overflow
</li><li>1018: macro id pull without matching push
</li><li>1019: check comment
</li><li>1020: invalid numeric expansion
</li><li>1021: einline without inline
</li><li>1022: missing %c
</li><li>1023: maximum inline nesting depth exceeded (%d)
</li><li>1024: skipping instruction in struct init
</li><li>1025: last %d bytes of string constant have been cut
</li><li>1026: conditional assembly for pass 1 is not really supported, assuming true
</li><li>1027: conditional assembly for pass 2 is not really supported, assuming false
</li><li>1028: modified memory attributes for section &quot;%s&quot;

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Madmac-Syntax-Module">
<div class="nav-panel">
<p>
Next: <a href="#Oldstyle-Syntax-Module" accesskey="n" rel="next">Oldstyle Syntax Module</a>, Previous: <a href="#Mot-Syntax-Module" accesskey="p" rel="prev">Mot Syntax Module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Madmac-Syntax-Module-1"><span>5 Madmac Syntax Module<a class="copiable-link" href="#Madmac-Syntax-Module-1"> &para;</a></span></h2>
<p>This chapter describes the madmac syntax module, which is compatible
to the MadMac assembler syntax, written by Landon Dyer for Atari and
improved later to support Jaguar and JRISC.
It is mainly intended for Atari&rsquo;s 6502, 68000 and Jaguar systems.
</p>
<ul class="mini-toc">
<li><a href="#Legal-3" accesskey="1">Legal</a></li>
<li><a href="#General-Syntax-2" accesskey="2">General Syntax</a></li>
<li><a href="#Directives-2" accesskey="3">Directives</a></li>
<li><a href="#Known-Problems-3" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-3" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-3">
<h3 class="section"><span>5.1 Legal<a class="copiable-link" href="#Legal-3"> &para;</a></span></h3>

<p>This module is written in 2015-2023 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="General-Syntax-2">
<h3 class="section"><span>5.2 General Syntax<a class="copiable-link" href="#General-Syntax-2"> &para;</a></span></h3>

<p>A statement may contain up to four fields which are identified by order
of appearance and terminating characters. The general form is:
</p><div class="example">
<pre class="example-preformatted">label:    operator    operand(s)    ; comment
</pre></div>

<p>Labels must not start at the first column, as they are identified by the
mandatory terminating colon (<code class="code">:</code>) character. A double colon (<code class="code">::</code>)
automatically makes the label externally visible.
</p>
<p>Labels preceded by &rsquo;<code class="code">.</code>&rsquo; have local scope and are only valid between
two global labels.
</p>
<p>Equate directives, starting in the operator field, have a symbol without
terminating colon in the first field, left of the operator.
The equals-character (<code class="code">=</code>) can be used as an alias for <code class="code">equ</code>.
A double-equals (<code class="code">==</code>) automatically makes the symbol externally
visible.
</p><div class="example">
<pre class="example-preformatted">symbol    equate    expression    ; comment
</pre></div>

<p>Identifiers, like symbols or labels, may start with any upper- or lower-case
character, a dot (<code class="code">.</code>), question-mark (<code class="code">?</code>) or underscore
(<code class="code">_</code>). The remaining characters may be any alphanumeric character,
a dollar-sign (<code class="code">$</code>), question-mark (<code class="code">?</code>) or underscore (<code class="code">_</code>).
</p>
<p>The operands are separated from the operator by whitespace. Multiple
operands are separated by comma (<code class="code">,</code>).
</p>
<p>Comments are introduced by the comment character <code class="code">;</code>. The asterisk
(<code class="code">*</code>) can be used at the first column to start a comment.
The rest of the line will be ignored.
</p>
<p>In expressions, numbers starting with <code class="code">$</code> are hexadecimal (e.g.
<code class="code">$fb2c</code>). <code class="code">%</code> introduces binary numbers (e.g. <code class="code">%1100101</code>).
Numbers starting with <code class="code">@</code> are assumed to be octal numbers, e.g.
<code class="code">@237</code>.
All other numbers starting with a digit are decimal, e.g. <code class="code">1239</code>.
</p>
<p>NOTE: Unlike the original Madmac assembler all expressions are evaluated
following the usual mathematical operator priorities.
</p>
<p>C-like escape characters are supported in strings.
</p>

</div>
<div class="section-level-extent" id="Directives-2">
<h3 class="section"><span>5.3 Directives<a class="copiable-link" href="#Directives-2"> &para;</a></span></h3>

<p>The following directives are supported by this syntax module (if the
CPU- and output-module allow it). Note that all directives, besides the
equals-character, may be optionally preceded by a dot (<code class="code">.</code>).
</p>
<dl class="table">
<dt><code class="code">&lt;symbol&gt; = &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; == &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code>, but declare &lt;symbol&gt;
      as externally visible.
</p>
</dd>
<dt><code class="code">abs [&lt;expression&gt;]</code></dt>
<dd><p>Equivaluent to <code class="code">offset</code> for compatibility with older Madmac
      versions. Note that <code class="code">abs</code> is not available for the jagrisc
      cpu backend as it conflicts with an instruction name.
</p>
</dd>
<dt><code class="code">assert &lt;expression&gt;[,&lt;expression&gt;...]</code></dt>
<dd><p>Assert that all conditions are true (non-zero), otherwise issue a
      warning.
</p>
</dd>
<dt><code class="code">bss</code></dt>
<dd><p>The following data (space definitions) are going into the BSS section.
      The BSS section cannot contain any initialized data.
</p>
</dd>
<dt><code class="code">data</code></dt>
<dd><p>The following data are going into the data section, which usually
      contains pre-initialized data and no executable code.
</p>
</dd>
<dt><code class="code">dc &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">dc.w</code>.
</p>
</dd>
<dt><code class="code">dc.b &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;,'&lt;string2&gt;'...]</code></dt>
<dd><p>Assign the integer or string constant operands into successive
      bytes of memory in the current section. Any combination of integer
      and character string constant operands is permitted.
</p>
</dd>
<dt><code class="code">dc.i &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 32-bit words
      of memory in the current section. In contrast to <code class="code">dc.l</code> the
      high and low half-words will be swapped as with the Jaguar-RISC
      <code class="code">movei</code> instruction.
</p>
</dd>
<dt><code class="code">dc.l &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 32-bit words
      of memory in the current section.
</p>
</dd>
<dt><code class="code">dc.w &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit words
      of memory in the current section.
</p>
</dd>
<dt><code class="code">dcb</code></dt>
<dd><p>Equivalent to <code class="code">dcb.w</code>.
</p>
</dd>
<dt><code class="code">dcb.b &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.
</p>
</dd>
<dt><code class="code">dcb.l &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 32-bit words into the current section.
</p>
</dd>
<dt><code class="code">dcb.w &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zero or &lt;fill&gt; 16-bit words into the current section.
</p>
</dd>
<dt><code class="code">dphrase</code></dt>
<dd><p>Align the program counter to the next integral double phrase
      boundary (16 bytes).
</p>
</dd>
<dt><code class="code">ds &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.w &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.b &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.b &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.l &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.l &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">ds.w &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">dcb.w &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">else</code></dt>
<dd><p>Else-part of a conditional-assembly block. Refer to &rsquo;<code class="code">if</code>&rsquo;.
</p>
</dd>
<dt><code class="code">end</code></dt>
<dd><p>End the assembly of the current file. Parsing of an include file is 
      terminated here and assembling of the parent source commences. It
      also works to break the current conditional block, repetition or macro.
</p>
</dd>
<dt><code class="code">endif</code></dt>
<dd><p>Ends a block of conditional assembly.
</p>
</dd>
<dt><code class="code">endm</code></dt>
<dd><p>Ends a macro definition.
</p>
</dd>
<dt><code class="code">endr</code></dt>
<dd><p>Ends a repetition block.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code></dt>
<dd><p>Define a new program symbol with the name &lt;symbol&gt; and assign to it
      the value of &lt;expression&gt;. Defining &lt;symbol&gt; twice will cause
      an error.
</p>
</dd>
<dt><code class="code">even</code></dt>
<dd><p>Align the program counter to an even value, by inserting a zero-byte
      when it is odd.
</p>
</dd>
<dt><code class="code">exitm</code></dt>
<dd><p>Exit the current macro (proceed to <code class="code">endm</code>) at this point and
      continue assembling the parent context.
      Note that this directive also resets the level of conditional
      assembly to a state before the macro was invoked (which means that
      it works as a &rsquo;break&rsquo; command on all new <code class="code">if</code> directives).
</p>
</dd>
<dt><code class="code">extern &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Declare the given symbols as externally defined. Internally there is
      no difference to <code class="code">globl</code>, as both declare the symbols, no
      matter if defined or not, as externally visible.
</p>
</dd>
<dt><code class="code">globl &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Declare the given symbols as externally visible in the object file
      for the linker. Note that you can have the same effect by using
      a double-colon (<code class="code">::</code>) on labels or a double-equal (<code class="code">==</code>)
      on equate-symbols.
</p>
</dd>
<dt><code class="code">if &lt;expression&gt;</code></dt>
<dd><p>Start of block of conditional assembly. If <code class="code">&lt;expression&gt;</code> is true, 
      the block between &rsquo;<code class="code">if</code>&rsquo; and the matching &rsquo;<code class="code">endif</code>&rsquo; or
      &rsquo;<code class="code">else</code>&rsquo; will be assembled. When false, ignore all lines until
      an &rsquo;<code class="code">else</code>&rsquo; or &rsquo;<code class="code">endif</code>&rsquo; directive is encountered.
      It is possible to leave such a block early from within an include
      file (with <code class="code">end</code>) or a macro (with <code class="code">endm</code>).
      Note, that <code class="code">&lt;expression&gt;</code> must be constant and defined during
      the first pass, otherwise this is an error.
</p>
</dd>
<dt><code class="code">ifdef &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assembles the following lines when the symbol is defined
      at this point during the first pass.
      Note, that this is no official Madmac directive and makes your source
      incompatible.
</p>
</dd>
<dt><code class="code">ifndef &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assembles the following lines when the symbol is undefined
      at this point during the first pass.
      Note, that this is no official Madmac directive and makes your source
      incompatible.
</p>
</dd>
<dt><code class="code">iif &lt;expression&gt;, &lt;statement&gt;</code></dt>
<dd><p>A single-line conditional assembly. The &lt;statement&gt; will be parsed
      when &lt;expression&gt; evaluates to true (non-zero).
      &lt;statement&gt; may be a normal source line, including labels, operators
      and operands.
</p>
</dd>
<dt><code class="code">incbin &quot;&lt;file&gt;&quot;</code></dt>
<dd><p>Inserts the binary contents of &lt;file&gt; into the object code at
      this position.
</p>
</dd>
<dt><code class="code">include &quot;&lt;file&gt;&quot;</code></dt>
<dd><p>Include source text of &lt;file&gt; at this position.
</p>
</dd>
<dt><code class="code">list</code></dt>
<dd><p>The following lines will appear in the listing file, if it was
      requested.
</p>
</dd>
<dt><code class="code">long</code></dt>
<dd><p>Align the program counter to the next integral longword boundary
      (4 bytes), by inserting as many zero-bytes as needed.
</p>
</dd>
<dt><code class="code">macro &lt;name&gt; [&lt;argname&gt;[,&lt;argname&gt;...]]</code></dt>
<dd><p>Defines a macro which can be referenced by &lt;name&gt; (case-sensitive).
      The macro definition is terminated by an <code class="code">endm</code> directive
      and may be exited by <code class="code">exitm</code>.
      When calling a macro you may pass up to 64 arguments, separated by
      comma. The first ten arguments are referenced within the macro
      context as <code class="code">\1</code> to <code class="code">\9</code> and <code class="code">\0</code> for the tenth.
      Optionally you can specify a list of argument names, which are
      referenced with a leading backslash character (<code class="code">\</code>) within the macro.
      The special code <code class="code">\~</code> inserts a unique id, useful for
      defining labels. <code class="code">\#</code> is replaced by the number of arguments.
      <code class="code">\!</code> writes the the size-qualifier (M68k) including the dot.
      <code class="code">\?argname</code> expands to <code class="code">1</code> when the named argument is
      specified and non-empty, otherwise it expands to <code class="code">0</code>.
      It is also allowed to enclose argument names in curly braces, which
      is useful in situations where the argument name is followed by
      another valid identifier character.
</p>
</dd>
<dt><code class="code">macundef &lt;name&gt;[,&lt;name&gt;...]</code></dt>
<dd><p>Undefine one or more already defined macros, making them unknown for
      the following source to assemble.
</p>
</dd>
<dt><code class="code">nlist</code></dt>
<dd><p>This line and the following lines will not be visible in a listing file.
</p>
</dd>
<dt><code class="code">nolist</code></dt>
<dd><p>The following lines will not be visible in a listing file.
</p>
</dd>
<dt><code class="code">offset [&lt;expression&gt;]</code></dt>
<dd><p>Switches to a special offset-section. The contents of such a section
      is not included in the output. Their labels may be referenced as
      absolute offset symbols. Can be used to define structure offsets.
      The optional <code class="code">&lt;expression&gt;</code> gives the start offset for this
      section. Defaults to zero when omitted.
      <code class="code">&lt;expression&gt;</code> must evaluate as a constant!
</p>
</dd>
<dt><code class="code">org &lt;expression&gt;</code></dt>
<dd><p>Sets the base address for the subsequent code and switch into
      absolute mode. Such a block is terminated by any section directive
      or by <code class="code">.68000</code>.
</p>
</dd>
<dt><code class="code">phrase</code></dt>
<dd><p>Align the program counter to the next integral phrase
      boundary (8 bytes).
</p>
</dd>
<dt><code class="code">print &lt;expression&gt;[,&lt;expression&gt;...]</code></dt>
<dd><p>Prints strings and formatted expressions to the assembler&rsquo;s console.
      &lt;expression&gt; is either a string in quotes or an expression, which
      is optionally preceded by special format flags:
</p>
<p>Several flags can be used to format the output of expressions.
      The default is a 16-bit signed decimal.
      </p><dl class="table">
<dt><code class="code">/x</code></dt>
<dd><p>hexadecimal
      </p></dd>
<dt><code class="code">/d</code></dt>
<dd><p>signed decimal
      </p></dd>
<dt><code class="code">/u</code></dt>
<dd><p>unsigned decimal
      </p></dd>
<dt><code class="code">/w</code></dt>
<dd><p>16-bit word
      </p></dd>
<dt><code class="code">/l</code></dt>
<dd><p>32-bit longword
      </p></dd>
</dl>
<p>For example:
</p><div class="example">
<pre class="example-preformatted">        .print  &quot;Value: &quot;, /d/l xyz
</pre></div>

</dd>
<dt><code class="code">qphrase</code></dt>
<dd><p>Align the program counter to the next integral quad phrase
      boundary (32 bytes).
</p>
</dd>
<dt><code class="code">rept &lt;expression&gt;</code></dt>
<dd><p>The block between <code class="code">rept</code> and <code class="code">endr</code> will be repeated
      &lt;expression&gt; times, which has to be positive.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; set &lt;expression&gt;</code></dt>
<dd><p>Create a new symbol with the name &lt;symbol&gt; and assign
      the value of &lt;expression&gt;. If &lt;symbol&gt; is already assigned, it will
      contain a new value from now on.
</p>
</dd>
<dt><code class="code">text</code></dt>
<dd><p>The following code and data is going into the text section, which
      usually is the first program section, containing the executable code.
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="Known-Problems-3">
<h3 class="section"><span>5.4 Known Problems<a class="copiable-link" href="#Known-Problems-3"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Not all Madmac, smac and extended Jaguar-Madmac directives are
supported.

</li><li>Expressions are not evaluated left-to-right, but mathematically
correct.

</li><li>Square-brackets (<code class="code">[ ]</code>) are currently not supported to
prioritize terms, as an alternative for parentheses.

</li><li>Functions (<code class="code">^^func</code>) are currently not supported.

</li></ul>


</div>
<div class="section-level-extent" id="Error-Messages-3">
<h3 class="section"><span>5.5 Error Messages<a class="copiable-link" href="#Error-Messages-3"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>1001: malformed immediate-if
</li><li>1003: cannot export local symbol
</li><li>1004: no space before operands
</li><li>1005: too many closing parentheses
</li><li>1006: missing closing parentheses
</li><li>1007: missing operand
</li><li>1008: garbage at end of line
</li><li>1009: unknown print format flag &rsquo;%c&rsquo;
</li><li>1010: invalid data operand
</li><li>1011: print format corrupted
</li><li>1012: identifier expected
</li><li>1014: unexpected &quot;%s&quot; without &quot;%s&quot;
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Oldstyle-Syntax-Module">
<div class="nav-panel">
<p>
Next: <a href="#Test-output-module" accesskey="n" rel="next">Test output module</a>, Previous: <a href="#Madmac-Syntax-Module" accesskey="p" rel="prev">Madmac Syntax Module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Oldstyle-Syntax-Module-1"><span>6 Oldstyle Syntax Module<a class="copiable-link" href="#Oldstyle-Syntax-Module-1"> &para;</a></span></h2>
<p>This chapter describes the oldstyle syntax module suitable
for some 8-bit CPUs (6502, 65816, 680x, 68HC1x, Z80, etc.),
which is available with the extension <code class="code">oldstyle</code>.
</p>

<ul class="mini-toc">
<li><a href="#Legal-4" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-2" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-Syntax-3" accesskey="3">General Syntax</a></li>
<li><a href="#Directives-3" accesskey="4">Directives</a></li>
<li><a href="#Structures-1" accesskey="5">Structures</a></li>
<li><a href="#Known-Problems-4" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-4" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-4">
<h3 class="section"><span>6.1 Legal<a class="copiable-link" href="#Legal-4"> &para;</a></span></h3>

<p>This module is written in 2002-2025 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-2">
<h3 class="section"><span>6.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-2"> &para;</a></span></h3>
 
<p>This syntax module provides the following additional options:
</p> 
<dl class="table">
<dt><samp class="option">-autoexp</samp></dt>
<dd><p>Automatically export all non-local symbols, making them visible
 to other modules during linking.
</p>
</dd>
<dt><samp class="option">-ast</samp></dt>
<dd><p>Allow the asterisk (<code class="code">*</code>) for starting comments in the first
 column. This disables the possibility to set the code origin with
 <code class="code">*=addr</code> in the first column.
</p>
</dd>
<dt><samp class="option">-dotdir</samp></dt>
<dd><p>Directives have to be preceded by a dot (<code class="code">.</code>).
</p>
</dd>
<dt><samp class="option">-i</samp></dt>
<dd><p>Ignore everything after a blank in the operand field and treat it as a
 comment. This option is only available when the backend does not separate
 its operands with blanks as well.
</p>
</dd>
<dt><samp class="option">-ldots</samp></dt>
<dd><p>Allow dots (<code class="code">.</code>) within all identifiers.
</p>
</dd>
<dt><samp class="option">-noc</samp></dt>
<dd><p>Disable C-style constant prefixes.
</p>
</dd>
<dt><samp class="option">-noi</samp></dt>
<dd><p>Disable intel-style constant suffixes.
</p>
</dd>
<dt><samp class="option">-sect</samp></dt>
<dd><p>Enables the additional section directives <code class="code">text</code>, <code class="code">data</code> and
 <code class="code">bss</code>, which switch to their respective section type. The original
 <code class="code">text</code> directive for creating string-constants and the <code class="code">data</code>
 directive for creating byte-constants are no longer available. But there
 are still other directives for the same purpose.
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="General-Syntax-3">
<h3 class="section"><span>6.3 General Syntax<a class="copiable-link" href="#General-Syntax-3"> &para;</a></span></h3>

<p>Labels starting at the first column may be terminated by a colon (<code class="code">:</code>).
Either a terminating colon, or an assign directive like <code class="code">=</code>, <code class="code">EQU</code>
or <code class="code">SET</code>, is required when the label is preceded by whitespace.
</p>
<p>Local labels are introduced by &rsquo;<code class="code">.</code>&rsquo; or terminated by &rsquo;<code class="code">$</code>&rsquo;.
For the rest, any alphanumeric character, including &rsquo;<code class="code">_</code>&rsquo;, is allowed.
Local labels are valid between two global label definitions.
</p>
<p>It is allowed, but not recommended, to refer to any local symbol starting with
&rsquo;<code class="code">.</code>&rsquo; in the source, by prefixing it with the name of the last
previously defined global symbol: <code class="code">global_name.local_name</code>.
</p>
<p>The option <samp class="option">-ldots</samp> allows dots (<code class="code">.</code>) within labels and other
identifiers, but disables the above mentioned feature.
</p>
<p>Anonymous labels are supported by defining them with a single &rsquo;<code class="code">:</code>&rsquo;
at the beginning of a line. They may be referenced by &rsquo;<code class="code">:</code>&rsquo; followed
directly by one or more &rsquo;<code class="code">+</code>&rsquo; or &rsquo;<code class="code">-</code>&rsquo; signs. A <code class="code">+</code> selects
the first anonymous label following the point of reference. A <code class="code">++</code>
selects the second anonymous label in that direction, and so on. A <code class="code">-</code>
selects the first anonymous label before the point of reference. Example:
</p><div class="example">
<pre class="example-preformatted">:       jmp     :-    ;infinite loop
</pre></div>

<p>The opcode field (mnemonics, directives, macros) cannot start at the first
column and must be separated by whitespace from the label field, except
the label is followed by a <code class="code">:</code> or <code class="code">=</code>.
</p>
<p>The operand field is again separated from the opcode field by whitespace.
Multiple operands are separated by comma (<code class="code">,</code>), or in some backends by
whitespace.
</p>
<p>Make sure that you don&rsquo;t define a label on the same line as a
directive for conditional assembly (if, else, endif)! This is not supported
and leads to undefined behaviour.
</p>
<p>Some CPU backends may support multiple statements (directives or
mnemonics) per line, separated by a special character (e.g. <code class="code">:</code> for Z80).
</p>
<p>Comments are introduced by the comment character (<code class="code">;</code>), or the first
blank following the operand field when option <samp class="option">-i</samp> was given.
The rest of the line will be ignored.
</p>
<p>Example:
</p><div class="example">
<pre class="example-preformatted">mylabel instr op1,op2  ;comment
</pre></div>

<p>In expressions, numbers starting with <code class="code">$</code> are hexadecimal (e.g.
<code class="code">$fb2c</code>). For Z80 also <code class="code">&amp;</code> may be used as a hexadecimal prefix,
but make sure to avoid conflicts with the and-operator (either by using
parentheses or blanks).
<code class="code">%</code> introduces binary numbers (e.g. <code class="code">%1100101</code>).
Numbers starting with <code class="code">@</code> are assumed to be octal numbers, e.g.
<code class="code">@237</code> (except for Z80, where it means binary).
A special case is a digit followed by a <code class="code">#</code>, which can be used to
define an arbitrary base between 2 and 9 (e.g. <code class="code">4#3012</code>).
Intel-style constant suffixes are supported: <code class="code">h</code> for hexadecimal,
<code class="code">d</code> for decimal, <code class="code">o</code> or <code class="code">q</code> for octal and <code class="code">b</code> for
binary. Hexadecimal intel-style constants must start with a digit (prepend
<code class="code">0</code>, when required).
Also C-style prefixes are supported for hexadecimal (<code class="code">0x</code>) and
binary (<code class="code">0b</code>).
All other numbers starting with a digit are decimal, e.g. <code class="code">1239</code>.
The one character following a <code class="code">'</code> or <code class="code">&quot;</code> is converted into
ASCII code. A closing quote behind that character is optional in
expressions. Not optional for strings.
</p>
<p>The current-PC symbols is <code class="code">*</code>, unless redefined by a CPU backend
(e.g. Z80 sets <code class="code">$</code>).
</p>
</div>
<div class="section-level-extent" id="Directives-3">
<h3 class="section"><span>6.4 Directives<a class="copiable-link" href="#Directives-3"> &para;</a></span></h3>

<p>Most data directives, like <code class="code">byt</code>, <code class="code">dfb</code>, <code class="code">db</code>, <code class="code">word</code>,
<code class="code">dfw</code>, <code class="code">dw</code>, etc. may optionally be written without any operand.
In this case they are treated like space directives, which just increment the
program counter by the appropriate number of bytes.
</p>
<p>Note, that the size of multi-byte data directives, like <code class="code">dw</code>, <code class="code">word</code>,
<code class="code">dl</code>, etc., depends on the CPU backend. Exmaple: <code class="code">dl</code> has 24 bits
for the 65816.
</p>
<p>The following directives are supported by this syntax module (if the
CPU- and output-module allow it):
</p>
<dl class="table">
<dt><code class="code">&lt;symbol&gt; = &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">abyte &lt;modifier&gt;,&lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Write the integer or string constants into successive 8-bit memory
      cells of the current section while modifying each expression
      (and string-character) by the modifier expression.
      When the modifier contains the special <code class="code">._</code> symbol, then it
      is a placeholder for any expression from the line. Otherwise the
      modifier will be just added to each element.
      Any combination of integer and character string constants is
      permitted.
</p>
</dd>
<dt><code class="code">addr &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive words
      of memory in the current section, using the target&rsquo;s endianness
      and address pointer size.
      Note that <code class="code">addr</code> is not available for 6809. You may use the
      alternative directive <code class="code">da</code> instead.
</p>
</dd>
<dt><code class="code">align &lt;bitcount&gt;</code></dt>
<dd><p>Insert as many zero bytes as required to reach an address where
      &lt;bit_count&gt; low order bits are zero. For example <code class="code">align 2</code> would
      make an alignment to the next 32-bit boundary on a target with
      8-bit addressable memory.
</p>
</dd>
<dt><code class="code">asc &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Equivalent to <code class="code">ascii &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code>.
</p>
</dd>
<dt><code class="code">ascii &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Assign the integer or string constant operands into successive
      8-bit memory cells of the current section. Any combination of integer
      and character string constant operands is permitted.
</p>
</dd>
<dt><code class="code">asciiz &quot;&lt;string1&gt;&quot;[,&quot;&lt;string2&gt;&quot;...]</code></dt>
<dd><p>Defines one or multiple string constants into successive 8-bit memory
      cells of the current section, where each string will be automatically
      terminated by a zero-byte.
</p>
</dd>
<dt><code class="code">assert &lt;expression&gt;[,&lt;message&gt;]</code></dt>
<dd><p>Display an error with the optional &lt;message&gt; when the expression
      is false.
</p>
</dd>
<dt><code class="code">binary &lt;file&gt;</code></dt>
<dd><p>Inserts the binary contents of &lt;file&gt; into the object code at
      this position.
</p>
</dd>
<dt><code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; bytes into the current section.
</p>
</dd>
<dt><code class="code">blkl &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; long words into the current section-
      The endianess and the number of bits per word depend on the target CPU.
      For example, will be 24 bits for 6502 and 65816.
</p>
</dd>
<dt><code class="code">blkw &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; words into the current section.
      The endianess and the number of bits per word depend on the target CPU,
      but the size will usually be the size of two bytes.
</p>
</dd>
<dt><code class="code">bss &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;,0</code>.
      (Not available with option <samp class="option">-sect</samp>.)
</p>
</dd>
<dt><code class="code">bss</code></dt>
<dd><p>With option <samp class="option">-sect</samp>:
      switches to a bss section with attributes <code class="code">&quot;aurw&quot;</code>.
</p>
</dd>
<dt><code class="code">bsz &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p>
</dd>
<dt><code class="code">byt &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Assign the integer or string constant operands into successive
      8-bit memory cells of the current section. Any combination of integer
      and character string constant operands is permitted.
</p>
</dd>
<dt><code class="code">byte &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Equivalent to <code class="code">byt &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code>.
</p>
</dd>
<dt><code class="code">di8 &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 8-bit memory cells
      of the current section.
</p>
</dd>
<dt><code class="code">di16 &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 16-bit words of
      memory in the current section, using the target&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">di24 &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 24-bit words of
      memory in the current section, using the target&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">di32 &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 32-bit words of
      memory in the current section, using the target&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">di64 &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive 64-bit words of
      memory in the current section, using the target&rsquo;s endianness.
</p>
</dd>
<dt><code class="code">da &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive words
      of memory in the current section, using the target&rsquo;s endianness
      and address pointer size.
</p>
</dd>
<dt><code class="code">data &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Equivalent to <code class="code">byt &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code>.
      (Not available with option <samp class="option">-sect</samp>.)
</p>
</dd>
<dt><code class="code">data</code></dt>
<dd><p>With option <samp class="option">-sect</samp>:
      switches to a data section with attributes <code class="code">&quot;adrw&quot;</code>.
</p>
</dd>
<dt><code class="code">db &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Equivalent to <code class="code">byt &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code>.
</p>
</dd>
<dt><code class="code">dc &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p>
</dd>
<dt><code class="code">defb &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Equivalent to <code class="code">byte &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code>.
</p>
</dd>
<dt><code class="code">defc &lt;symbol&gt; = &lt;expression&gt;</code></dt>
<dd><p>Define a new program symbol with the name &lt;symbol&gt; and assign to it
      the value of &lt;expression&gt;. Defining &lt;symbol&gt; twice will cause
      an error.
</p>
</dd>
<dt><code class="code">defl &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive long words
      of memory in the current section, using the endianness of the target
      CPU. The number of bits per long word also depends on the CPU.
      For example, will be 24 bits for 6502 and 65816.
</p>
</dd>
<dt><code class="code">defp &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive words
      of memory in the current section, using the target&rsquo;s endianness
      and address pointer size.
</p>
</dd>
<dt><code class="code">defm &quot;string&quot;</code></dt>
<dd><p>Equivalent to <code class="code">fcc &quot;&lt;string&gt;&quot;</code>.
</p>
</dd>
<dt><code class="code">defw &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">word &lt;exp1&gt;[,&lt;exp2&gt;...]</code>.
</p>
</dd>
<dt><code class="code">dfb &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Equivalent to <code class="code">byte &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code>.
</p>
</dd>
<dt><code class="code">dfw &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">word &lt;exp1&gt;[,&lt;exp2&gt;...]</code>.
</p>
</dd>
<dt><code class="code">defs &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p>
</dd>
<dt><code class="code">dend</code></dt>
<dd><p>Ends an offset-section started by <code class="code">dsect</code> and restores the
      previously active section.
</p>
</dd>
<dt><code class="code">dephase</code></dt>
<dd><p>Equivalent to <code class="code">rend</code>.
</p>
</dd>
<dt><code class="code">dl &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive long words
      of memory in the current section, using the endianness of the target
      CPU. The number of bits per long word also depends on the CPU.
      For example, will be 24 bits for 6502 and 65816.
</p>
</dd>
<dt><code class="code">ds &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p>
</dd>
<dt><code class="code">dsb &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p>
</dd>
<dt><code class="code">dsect</code></dt>
<dd><p>Starts an &rsquo;offset-section&rsquo; (the original directive in ADE was called
      &rsquo;dummy-section&rsquo;) which does not generate any code in the output file.
      Its only purpose is to define absolute labels. Within a <code class="code">dsect</code>
      block you may use <code class="code">org</code> directives to set a new offset, which
      defaults to zero for the first <code class="code">dsect</code> otherwise. Following
      <code class="code">dsect</code> sections continue with the last offset from the former.
      Such an offsect-section block is closed by the <code class="code">dend</code> directive,
      which restores the previous &rsquo;real&rsquo; section.
</p>
</dd>
<dt><code class="code">dsl &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blkl &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p>
</dd>
<dt><code class="code">dsw &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blkw &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p>
</dd>
<dt><code class="code">dw &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">word &lt;exp1&gt;[,&lt;exp2&gt;...]</code>.
</p>
</dd>
<dt><code class="code">end</code></dt>
<dd><p>Assembly will terminate behind this line.
</p>
</dd>
<dt><code class="code">endif</code></dt>
<dd><p>Ends a section of conditional assembly.
</p>
</dd>
<dt><code class="code">el</code></dt>
<dd><p>Equivalent to <code class="code">else</code>.
</p>
</dd>
<dt><code class="code">else</code></dt>
<dd><p>Assemble the following lines when the previous <code class="code">if</code>-condition
      was false.
</p>
</dd>
<dt><code class="code">ei</code></dt>
<dd><p>Equivalent to <code class="code">endif</code>. (Not available for Z80 CPU)
</p>
</dd>
<dt><code class="code">einline</code></dt>
<dd><p>End a block of isolated local labels, started by <code class="code">inline</code>.
</p>
</dd>
<dt><code class="code">endm</code></dt>
<dd><p>Ends a macro definition.
</p>
</dd>
<dt><code class="code">endmac</code></dt>
<dd><p>Ends a macro definition.
</p>
</dd>
<dt><code class="code">endmacro</code></dt>
<dd><p>Ends a macro definition.
</p>
</dd>
<dt><code class="code">endr</code></dt>
<dd><p>Ends a repetition block.
</p>
</dd>
<dt><code class="code">endrep</code></dt>
<dd><p>Ends a repetition block.
</p>
</dd>
<dt><code class="code">endrepeat</code></dt>
<dd><p>Ends a repetition block.
</p>
</dd>
<dt><code class="code">endstruct</code></dt>
<dd><p>Ends a structure definition.
</p>
</dd>
<dt><code class="code">endstructure</code></dt>
<dd><p>Ends a structure definition.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; eq &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equ &lt;expression&gt;</code></dt>
<dd><p>Define a new program symbol with the name &lt;symbol&gt; and assign to it
      the value of &lt;expression&gt;. Defining &lt;symbol&gt; twice will cause
      an error.
</p>
</dd>
<dt><code class="code">exitmacro</code></dt>
<dd><p>Exit the current macro (proceed to <code class="code">endm</code>) at this point and
      continue assembling the parent context.
      Note, that this directive also resets the level of conditional
      assembly to a state before the macro was invoked (which means that
      it works as a &rsquo;break&rsquo; command on all new <code class="code">if</code> directives).
</p>
</dd>
<dt><code class="code">extern  &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>See <code class="code">global</code>.
</p>
</dd>
<dt><code class="code">even</code></dt>
<dd><p>Aligns to an even address. Equivalent to <code class="code">align 1</code>.
</p>
</dd>
<dt><code class="code">fail &lt;message&gt;</code></dt>
<dd><p>Show an error message including the &lt;message&gt; string. Do not generate
      an output file.
</p>
</dd>
<dt><code class="code">fi</code></dt>
<dd><p>Equivalent to <code class="code">endif</code>.
</p>
</dd>
<dt><code class="code">fill &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">fcb &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Equivalent to <code class="code">byte &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code>.
</p>
</dd>
<dt><code class="code">fcc &quot;&lt;string&gt;&quot;</code></dt>
<dd><p>Puts a single string constant into successive 8-bit memory cells
      of the current section. The string delimiters may be any
      printable ASCII character.
</p>
</dd>
<dt><code class="code">fcs &quot;&lt;string&gt;&quot;</code></dt>
<dd><p>Works like <code class="code">fcc</code> and <code class="code">defm</code>, but additionally sets the
      most significant bit of the last byte. This can be used as a
      string terminator on some systems.
</p>
</dd>
<dt><code class="code">fdb &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;string1&gt;&quot;...]</code></dt>
<dd><p>Assign the values of the operands into successive double-bytes
      of memory in the current section, using the endianness of the target
      CPU.
</p>
</dd>
<dt><code class="code">global &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag &lt;symbol&gt; as an external symbol, which means that &lt;symbol&gt; is
      visible to all modules in the linking process. It may be either
      defined or undefined.  
</p>
</dd>
<dt><code class="code">if &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is non-zero.
</p>
</dd>
<dt><code class="code">ifblank &lt;something&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if there are non-blank
      characters in the operand, which are not a comment.
</p>
</dd>
<dt><code class="code">ifnblank &lt;something&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if there are any
      non-blank, non-comment characters in the operand.
</p>
</dd>
<dt><code class="code">ifdef &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is defined.
</p>
</dd>
<dt><code class="code">ifndef &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is undefined.
</p>
</dd>
<dt><code class="code">ifd &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is defined.
</p>
</dd>
<dt><code class="code">ifnd &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; is undefined.
</p>
</dd>
<dt><code class="code">ifeq &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is zero.
</p>
</dd>
<dt><code class="code">ifne &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is non-zero.
</p>
</dd>
<dt><code class="code">ifgt &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      greater than zero.
</p>
</dd>
<dt><code class="code">ifge &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      greater than zero or equal.
</p>
</dd>
<dt><code class="code">iflt &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      less than zero.
</p>
</dd>
<dt><code class="code">ifle &lt;expression&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;expression&gt; is
      less than zero or equal.
</p>
</dd>
<dt><code class="code">ifused &lt;symbol&gt;</code></dt>
<dd><p>Conditionally assemble the following lines if &lt;symbol&gt; has been
      previously referenced in an expression or in a parameter of an opcode.
      Issue a warning, when &lt;symbol&gt; is already defined.
      Note that <code class="code">ifused</code> does not work, when the symbol has only been
      used in the following lines of the source.
</p>
</dd>
<dt><code class="code">incbin &lt;file&gt;[,&lt;offset&gt;[,&lt;nbytes&gt;]]</code></dt>
<dd><p>Inserts the binary contents of &lt;file&gt; into the object code at
      this position. When &lt;offset&gt; is specified, then the given number
      of 8-bit bytes will be skipped at the beginning of the file. The optional
      &lt;nbytes&gt; argument specifies the maximum number of 8-bit bytes to be read
      from that file.
      When the file size (in 8-bit bytes) is not aligned with the size
      of a target-byte the missing bits are automatically appended and
      assumed to be zero.
      As vasm&rsquo;s internal target-byte endianness for more than 8 bits per byte
      is big-endian, included binary files are assumed to have the same
      endianness. Otherwise you have to specify <samp class="option">-ile</samp> to tell vasm
      that they use little-endian target-bytes (on your 8-bit bytes host
      file system).
</p>
</dd>
<dt><code class="code">incdir &lt;path&gt;</code></dt>
<dd><p>Add another path to search for include files to the list of
      known paths. Paths defined with <samp class="option">-I</samp> on the command line are
      searched first.
</p>
</dd>
<dt><code class="code">include &lt;file&gt;</code></dt>
<dd><p>Include source text of &lt;file&gt; at this position.
</p>
</dd>
<dt><code class="code">inline</code></dt>
<dd><p>Local labels in the following block are isolated from previous
      local labels and those after <code class="code">einline</code>.
</p>
</dd>
<dt><code class="code">mac &lt;name&gt;</code></dt>
<dd><p>Equivalent to <code class="code">macro &lt;name&gt;</code>. (Not available for unSP CPU)
</p>
</dd>
<dt><code class="code">list</code></dt>
<dd><p>The following lines will appear in the listing file, if it was
      requested.
</p>
</dd>
<dt><code class="code">local &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag &lt;symbol&gt; as a local symbol, which means that &lt;symbol&gt; is
      local for the current file and invisible to other modules in
      the linking process.
</p>
</dd>
<dt><code class="code">macro &lt;name&gt;[,&lt;argname&gt;...]</code></dt>
<dd><p>Defines a macro which can be referenced by &lt;name&gt;. The &lt;name&gt;
      may also appear at the left side of the <code class="code">macro</code> directive,
      starting on the first column. The macro definition is closed
      by an <code class="code">endm</code> directive. When calling a macro you may pass
      up to 9 arguments, separated by comma. These arguments are
      referenced within the macro context as <code class="code">\1</code> to <code class="code">\9</code>,
      or optionally by named arguments, which you have to specify in
      the operand.
      Argument <code class="code">\0</code> is set to the macro&rsquo;s first qualifier
      (mnemonic extension), when given.
      The special argument <code class="code">\@</code> inserts an underscore followed by
      a six-digit unique id, useful for defining labels.
      <code class="code">\()</code> may be used as a separator between the name of a macro
      argument and the subsequent text.
      <code class="code">\&lt;symbolname&gt;</code> inserts the current decimal value of the absolute
      symbol <code class="code">symbolname</code>.
</p>
</dd>
<dt><code class="code">mdat &lt;file&gt;</code></dt>
<dd><p>Equivalent to <code class="code">incbin &lt;file&gt;</code>.
</p>
</dd>
<dt><code class="code">needs &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">symdepend &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">nolist</code></dt>
<dd><p>This line and the following lines will not be visible in a listing file.
</p>
</dd>
<dt><code class="code">org [#]&lt;expression&gt;</code></dt>
<dd><p>Sets the base address for the subsequent code. This is equivalent
      to <code class="code">*=&lt;expression&gt;</code>. An optional <code class="code">#</code> is supported for
      compatibility reasons.
</p>
</dd>
<dt><code class="code">phase &lt;expression&gt;</code></dt>
<dd><p>Equivalent to <code class="code">rorg &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">repeat &lt;expression&gt;[,&lt;symbol&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">rept &lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">rept &lt;expression&gt;[,&lt;symbol&gt;]</code></dt>
<dd><p>Repeats the assembly of the block between <code class="code">rept</code> and <code class="code">endr</code>
      &lt;expression&gt; number of times. &lt;expression&gt; has to be positive.
      The internal symbol <code class="code">__RPTCNT</code> always holds the iteration counter
      of the inner repeat loop, starting with 0. <code class="code">__RPTCNT</code> is -1 outside
      of any repeat block.
      The optional <code class="code">SET</code>-symbol <code class="code">&lt;symbol&gt;</code> receives a copy of the
      current iteration counter, when given.
</p>
</dd>
<dt><code class="code">reserve &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">rend</code></dt>
<dd><p>Ends a <code class="code">rorg</code> block of label relocation. Following labels will
      be based on <code class="code">org</code> again.
</p>
</dd>
<dt><code class="code">rmb &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code>. (Not available for 6502 CPU.)
</p>
</dd>
<dt><code class="code">roffs &lt;expression&gt;</code></dt>
<dd><p>Sets the program counter &lt;expression&gt; bytes behind the start of the
      current section. The new program counter must not be smaller than the
      current one. The space will be padded with zeros.
</p>
</dd>
<dt><code class="code">rorg &lt;expression&gt;</code></dt>
<dd><p>Relocate all labels between <code class="code">rorg</code> and <code class="code">rend</code> based on the
      new origin from <code class="code">&lt;expression&gt;</code>.
</p>
</dd>
<dt><code class="code">ds8 &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; 8-bit words into the current section.
</p>
</dd>
<dt><code class="code">ds16 &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; 16-bit words into the current section,
      using the target&rsquo;s endianess.
</p>
</dd>
<dt><code class="code">ds24 &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; 24-bit words into the current section,
      using the target&rsquo;s endianess.
</p>
</dd>
<dt><code class="code">ds32 &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; 32-bit words into the current section,
      using the target&rsquo;s endianess.
</p>
</dd>
<dt><code class="code">ds64 &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Insert &lt;exp&gt; zeroed or &lt;fill&gt; 64-bit words into the current section,
      using the target&rsquo;s endianess.
</p>
</dd>
<dt><code class="code">section &lt;name&gt;[,&quot;&lt;attributes&gt;&quot;]</code></dt>
<dd><p>Starts a new section named &lt;name&gt; or reactivate an old one. If
      attributes are given for an already existing section, they must
      match exactly. The section&rsquo;s name will also be defined as a new
      symbol, which represents the section&rsquo;s start address.
      The &quot;&lt;attributes&gt;&quot; string may consist of the following characters:
</p>
<p>Section Contents:
</p><dl class="table">
<dt><code class="code">c</code></dt>
<dd><p>section has code
</p>
</dd>
<dt><code class="code">d</code></dt>
<dd><p>section has initialized data
</p>
</dd>
<dt><code class="code">u</code></dt>
<dd><p>section has uninitialized data
</p>
</dd>
<dt><code class="code">i</code></dt>
<dd><p>section has directives (info section)
</p>
</dd>
<dt><code class="code">n</code></dt>
<dd><p>section can be discarded
</p>            
</dd>
<dt><code class="code">R</code></dt>
<dd><p>remove section at link time
</p>            
</dd>
<dt><code class="code">a</code></dt>
<dd><p>section is allocated in memory
</p></dd>
</dl>

<p>Section Protection:
</p><dl class="table">
<dt><code class="code">r</code></dt>
<dd><p>section is readable
</p>            
</dd>
<dt><code class="code">w</code></dt>
<dd><p>section is writable
</p>           
</dd>
<dt><code class="code">x</code></dt>
<dd><p>section is executable
</p>           
</dd>
<dt><code class="code">s</code></dt>
<dd><p>section is shareable
</p></dd>
</dl>

<p>Additional Attributes:
</p><dl class="table">
<dt><code class="code">f</code></dt>
<dd><p>mark section for far-addressing
</p></dd>
<dt><code class="code">z</code></dt>
<dd><p>mark section for near-addressing (e.g. direct/zero-page for 6502/65816)
</p></dd>
</dl>

<p>When attributes are missing they are automatically set for the section
      names <code class="code">text</code>, <code class="code">data</code>, <code class="code">rodata</code>, <code class="code">bss</code>,
      <code class="code">.text</code>, <code class="code">.data</code>, <code class="code">.rodata</code> and <code class="code">.bss</code>.
      Otherwise they default to <code class="code">&quot;acrwx&quot;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; set &lt;expression&gt;</code></dt>
<dd><p>Create a new symbol with the name &lt;symbol&gt; and assign
      the value of &lt;expression&gt;. If &lt;symbol&gt; was already assigned by
      <code class="code">set</code> before, it will hold the new value from now on.
</p>
</dd>
<dt><code class="code">spc &lt;exp&gt;</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;,0</code>.
</p>
</dd>
<dt><code class="code">str &quot;&lt;string1&gt;&quot;[,&quot;&lt;string2&gt;&quot;...]</code></dt>
<dd><p>Like <code class="code">asciiz</code> and <code class="code">string</code>, but adds a terminating carriage
      return (ASCII code 13) instead of a zero-byte.
</p>
</dd>
<dt><code class="code">string &quot;&lt;string1&gt;&quot;[,&quot;&lt;string2&gt;&quot;...]</code></dt>
<dd><p>Defines one or multiple string constants into successive 8-bit memory
      cells of the current section, where each string will be automatically
      terminated by a zero-byte.
</p>
</dd>
<dt><code class="code">struct &lt;name&gt;</code></dt>
<dd><p>Defines a structure which can be referenced by &lt;name&gt;. Labels within
      a structure definitation can be used as field offsets. They will be
      defined as local labels of <code class="code">&lt;name&gt;</code> and can be referenced through
      <code class="code">&lt;name&gt;.&lt;label&gt;</code>. All directives are allowed, but instructions will
      be ignored when such a structure is used. Data definitions can be used as
      default values when the structure is used as initializer. The structure
      name, &lt;name&gt;, is defined as a global symbol with the structure&rsquo;s size.
      A structure definition is ended by <code class="code">endstruct</code>.
</p>
</dd>
<dt><code class="code">structure &lt;name&gt;</code></dt>
<dd><p>Equivalent to <code class="code">struct &lt;name&gt;</code>.
</p>
</dd>
<dt><code class="code">symdepend &lt;expression&gt;</code></dt>
<dd><p>Declare the current section being dependent on an externally defined
      symbol from <code class="code">&lt;expression&gt;</code>. In object file formats which
      support it, this will generate an external symbol reference without
      any actual relocation being performed (<code class="code">R_NONE</code> in ELF).
</p>
</dd>
<dt><code class="code">text &quot;&lt;string&gt;&quot;</code></dt>
<dd><p>Equivalent to <code class="code">fcc &quot;&lt;string&gt;&quot;</code>.
      Not available with option <samp class="option">-sect</samp>.
</p>
</dd>
<dt><code class="code">text</code></dt>
<dd><p>With option <samp class="option">-sect</samp>:
      switches to a code section with attributes <code class="code">&quot;acrx&quot;</code>.
</p>
</dd>
<dt><code class="code">weak &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>Flag &lt;symbol&gt; as a weak symbol, which means that &lt;symbol&gt; is
      visible to all modules in the linking process and may be replaced
      by any global symbol with the same name.
      When a weak symbol remains undefined its value defaults to 0.
</p>
</dd>
<dt><code class="code">wor &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">word &lt;exp1&gt;[,&lt;exp2&gt;...]</code>.
</p>
</dd>
<dt><code class="code">wrd &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Equivalent to <code class="code">word &lt;exp1&gt;[,&lt;exp2&gt;...]</code>.
</p>
</dd>
<dt><code class="code">word &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>Assign the values of the operands into successive words
      of memory in the current section, using the endianness of the target
      CPU. The number of bits per word also depends on the CPU, but will
      usually have the size of two bytes.
</p>
</dd>
<dt><code class="code">xdef  &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>See <code class="code">global</code>.
</p>
</dd>
<dt><code class="code">xlib  &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>See <code class="code">global</code>.
</p>
</dd>
<dt><code class="code">xref  &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>See <code class="code">global</code>.
</p>
</dd>
<dt><code class="code">zmb &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>Equivalent to <code class="code">blk &lt;exp&gt;[,&lt;fill&gt;]</code>.
</p></dd>
</dl>


</div>
<div class="section-level-extent" id="Structures-1">
<h3 class="section"><span>6.5 Structures<a class="copiable-link" href="#Structures-1"> &para;</a></span></h3>
<p>The oldstyle syntax is able to manage structures.
Structures can be defined in two ways:
</p><div class="example">
<pre class="example-preformatted">mylabel struct[ure]
        &lt;fields&gt;
        endstruct[ure]
</pre></div>
<p>or:    
</p><div class="example">
<pre class="example-preformatted">        struct[ure] mylabel
        &lt;fields&gt;
        endstruct[ure]
</pre></div>

<p>Any directive is allowed to define the structure fields. Labels can be used
to define offsets into the structure. The initialized data is used as default
value, whenever no value is given for a field when the structure is referenced.
</p>
<p>Some examples of structure declarations:
</p><div class="example">
<pre class="example-preformatted">  struct point
x    db 4
y    db 5
z    db 6
  endstruct
</pre></div>

<p>This will create the following labels:
</p><div class="example">
<pre class="example-preformatted">point.x  ; 0   offsets
point.y  ; 1
point.z  ; 2
point    ; 3   size of the structure
</pre></div>

<p>The structure can be used by optionally redefining the field values:
</p><div class="example">
<pre class="example-preformatted">point1 point
point2 point 1, 2, 3
point3 point ,,4
</pre></div>
<p>is equivalent to
</p><div class="example">
<pre class="example-preformatted">point1  
               db 4
               db 5
               db 6
point2
               db 1
               db 2
               db 3
point3
               db 4
               db 5
               db 4
</pre></div>


</div>
<div class="section-level-extent" id="Known-Problems-4">
<h3 class="section"><span>6.6 Known Problems<a class="copiable-link" href="#Known-Problems-4"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Addresses assigned with <code class="code">org</code> or to the current pc symbol <code class="code">'*'</code>
(on the Z80 the pc symbol is <code class="code">'$'</code>) must be constant.

</li><li>Expressions in any form of conditional <code class="code">if</code> directive must be constant.

</li></ul>


</div>
<div class="section-level-extent" id="Error-Messages-4">
<h3 class="section"><span>6.7 Error Messages<a class="copiable-link" href="#Error-Messages-4"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>1001: syntax error
</li><li>1002: invalid extension
</li><li>1003: no space before operands
</li><li>1004: too many closing parentheses
</li><li>1005: missing closing parentheses
</li><li>1006: missing operand
</li><li>1007: garbage at end of line
</li><li>1008: %c expected
</li><li>1009: invalid data operand
</li><li>1010: , expected
</li><li>1011: identifier expected
</li><li>1012: illegal escape sequence %c
</li><li>1013: unexpected &quot;%s&quot; without &quot;%s&quot;
</li><li>1014: dsect already active
</li><li>1015: dend without dsect
</li><li>1016: missing dend
</li><li>1018: maximum inline nesting depth exceeded (%d)
</li><li>1017: einline without inline
</li><li>1021: cannot open binary file &quot;%s&quot;
</li><li>1023: alignment too big
</li><li>1024: label &lt;%s&gt; has already been defined
</li><li>1025: skipping instruction in struct init
</li><li>1026: last %d bytes of string constant have been cut

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Test-output-module">
<div class="nav-panel">
<p>
Next: <a href="#ELF-output-module" accesskey="n" rel="next">ELF output module</a>, Previous: <a href="#Oldstyle-Syntax-Module" accesskey="p" rel="prev">Oldstyle Syntax Module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Test-output-module-1"><span>7 Test output module<a class="copiable-link" href="#Test-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the test output module which can be
selected with the <samp class="option">-Ftest</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-5" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-3" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-1" accesskey="3">General</a></li>
<li><a href="#Restrictions" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-5" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-5" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-5">
<h3 class="section"><span>7.1 Legal<a class="copiable-link" href="#Legal-5"> &para;</a></span></h3>

<p>This module is written in 2002 by Volker Barthelmann and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-3">
<h3 class="section"><span>7.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-3"> &para;</a></span></h3>
 
<p>This output module provides no additional options.
</p> 
</div>
<div class="section-level-extent" id="General-1">
<h3 class="section"><span>7.3 General<a class="copiable-link" href="#General-1"> &para;</a></span></h3>

<p>This output module outputs a textual description of the contents of
all sections. It is mainly intended for debugging.
</p>

</div>
<div class="section-level-extent" id="Restrictions">
<h3 class="section"><span>7.4 Restrictions<a class="copiable-link" href="#Restrictions"> &para;</a></span></h3>

<p>None.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-5">
<h3 class="section"><span>7.5 Known Problems<a class="copiable-link" href="#Known-Problems-5"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-5">
<h3 class="section"><span>7.6 Error Messages<a class="copiable-link" href="#Error-Messages-5"> &para;</a></span></h3>

<p>This module has the following error messages:
</p><ul class="itemize mark-minus">
<li>None.
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="ELF-output-module">
<div class="nav-panel">
<p>
Next: <a href="#a_002eout-output-module" accesskey="n" rel="next">a.out output module</a>, Previous: <a href="#Test-output-module" accesskey="p" rel="prev">Test output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="ELF-output-module-1"><span>8 ELF output module<a class="copiable-link" href="#ELF-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the ELF output module which can be
selected with the <samp class="option">-Felf</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-6" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-4" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-2" accesskey="3">General</a></li>
<li><a href="#Restrictions-1" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-6" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-6" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-6">
<h3 class="section"><span>8.1 Legal<a class="copiable-link" href="#Legal-6"> &para;</a></span></h3>

<p>This module is written in 2002-2016 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-4">
<h3 class="section"><span>8.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-4"> &para;</a></span></h3>
<dl class="table">
<dt><samp class="option">-keepempty</samp></dt>
<dd><p>Do not delete empty sections without any symbol definition.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-2">
<h3 class="section"><span>8.3 General<a class="copiable-link" href="#General-2"> &para;</a></span></h3>

<p>This output module outputs the <code class="code">ELF</code> (Executable and Linkable Format)
format, which is a portable object file format and works for a variety
of 32- and 64-bit operating systems.
</p>
</div>
<div class="section-level-extent" id="Restrictions-1">
<h3 class="section"><span>8.4 Restrictions<a class="copiable-link" href="#Restrictions-1"> &para;</a></span></h3>

<p>The <code class="code">ELF</code> output format, as implemented in vasm, currently supports
the following architectures:
</p>
<ul class="itemize mark-minus">
<li>ARM
</li><li>i386
</li><li>Jaguar RISC
</li><li>M68k, ColdFire
</li><li>PowerPC
</li><li>x86_64

</li></ul>

<p>The supported relocation types depend on the selected architecture.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-6">
<h3 class="section"><span>8.5 Known Problems<a class="copiable-link" href="#Known-Problems-6"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-6">
<h3 class="section"><span>8.6 Error Messages<a class="copiable-link" href="#Error-Messages-6"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3002: output module doesn&rsquo;t support cpu &lt;name&gt;
</li><li>3003: write error
</li><li>3005: reloc type &lt;m&gt;, size &lt;n&gt;, mask &lt;mask&gt; (symbol &lt;sym&gt; + &lt;offset&gt;) not supported
</li><li>3006: reloc type &lt;n&gt; not supported
</li><li>3010: section &lt;%s&gt;: alignment padding (%lu) not a multiple of %lu at 0x%llx
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="a_002eout-output-module">
<div class="nav-panel">
<p>
Next: <a href="#TOS-output-module" accesskey="n" rel="next">TOS output module</a>, Previous: <a href="#ELF-output-module" accesskey="p" rel="prev">ELF output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="a_002eout-output-module-1"><span>9 a.out output module<a class="copiable-link" href="#a_002eout-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the a.out output module which can be
selected with the <samp class="option">-Faout</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-7" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-5" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-3" accesskey="3">General</a></li>
<li><a href="#Restrictions-2" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-7" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-7" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-7">
<h3 class="section"><span>9.1 Legal<a class="copiable-link" href="#Legal-7"> &para;</a></span></h3>

<p>This module is written in 2008-2016,2020,2021 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-5">
<h3 class="section"><span>9.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-5"> &para;</a></span></h3>
 
<dl class="table">
<dt><samp class="option">-mid=&lt;machine id&gt;</samp></dt>
<dd><p>Sets the MID field of the a.out header to the specified value.
        The MID defaults to 2 (Sun020 big-endian) for M68k and to 100
        (PC386 little-endian) for x86.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-3">
<h3 class="section"><span>9.3 General<a class="copiable-link" href="#General-3"> &para;</a></span></h3>

<p>This output module emits the <code class="code">a.out</code> (assembler output)
format, which is an older 32-bit format for Unix-like operating systems,
originally invented by AT&amp;T.
</p>
</div>
<div class="section-level-extent" id="Restrictions-2">
<h3 class="section"><span>9.4 Restrictions<a class="copiable-link" href="#Restrictions-2"> &para;</a></span></h3>

<p>The <code class="code">a.out</code> output format, as implemented in vasm, currently supports
the following architectures:
</p>
<ul class="itemize mark-minus">
<li>M68k
</li><li>i386
</li></ul>

<p>The following standard relocations are supported by default:
</p><ul class="itemize mark-minus">
<li>absolute, 8, 16, 32 bits
</li><li>pc-relative, 8, 16, 32 bits
</li><li>base-relative
</li></ul>

<p>Standard relocation table entries occupy 8 bytes and don&rsquo;t include an addend,
so they are not suitable for most RISC CPUs. The extended relocation
format occupies 12 bytes and also allows more relocation types.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-7">
<h3 class="section"><span>9.5 Known Problems<a class="copiable-link" href="#Known-Problems-7"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>The extended relocation format is not supported.
</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-7">
<h3 class="section"><span>9.6 Error Messages<a class="copiable-link" href="#Error-Messages-7"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3004: section attributes &lt;attr&gt; not supported
</li><li>3008: output module doesn&rsquo;t allow multiple sections of the same type
</li><li>3010: section &lt;%s&gt;: alignment padding (%lu) not a multiple of %lu at 0x%llx
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="TOS-output-module">
<div class="nav-panel">
<p>
Next: <a href="#GST-output-module" accesskey="n" rel="next">GST output module</a>, Previous: <a href="#a_002eout-output-module" accesskey="p" rel="prev">a.out output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="TOS-output-module-1"><span>10 TOS output module<a class="copiable-link" href="#TOS-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the TOS output module, which can be
selected with option <samp class="option">-Ftos</samp> to generate Atari TOS
executable files, or with option <samp class="option">-Fdri</samp> to generate DRI-format object
files.
Additionally you can generate absolute Z-file executables for the Sharp
X68000, when specifying option <samp class="option">-zfile</samp> together with <samp class="option">-Ftos</samp>.
</p>
<ul class="mini-toc">
<li><a href="#Legal-8" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-6" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-4" accesskey="3">General</a></li>
<li><a href="#Restrictions-3" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-8" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-8" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-8">
<h3 class="section"><span>10.1 Legal<a class="copiable-link" href="#Legal-8"> &para;</a></span></h3>

<p>This module is written in 2009-2016,2020-2024 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-6">
<h3 class="section"><span>10.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-6"> &para;</a></span></h3>

<dl class="table">
<dt><samp class="option">-szbx</samp></dt>
<dd><p>Use the SozobonX extension, which allows symbol names with
        unlimited length in DRI objects and executables.
        Overrides the HiSoft extension.
    </p></dd>
<dt><samp class="option">-stdsymbols</samp></dt>
<dd><p>Do not write HiSoft extended symbol names. Cut names after 8 characters.
</p></dd>
</dl>
<p>These options are valid for the <code class="code">tos</code> module only:
</p><dl class="table">
<dt><samp class="option">-monst</samp></dt>
<dd><p>Write Devpac &quot;MonST&quot;-compatible symbols.
    </p></dd>
<dt><samp class="option">-tos-flags=&lt;flags&gt;</samp></dt>
<dd><p>Sets the flags field in the TOS file header. Defaults to 0.
        Overwrites a TOS flags definition in the assembler source.
    </p></dd>
<dt><samp class="option">-zfile=&lt;load-address&gt;</samp></dt>
<dd><p>Outputs an absolute Z-file for Sharp X68000 computers to be loaded
        at <code class="code">&lt;load-address&gt;</code> in memory.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-4">
<h3 class="section"><span>10.3 General<a class="copiable-link" href="#General-4"> &para;</a></span></h3>

<dl class="table">
<dt><samp class="option">-Ftos</samp></dt>
<dd><p>The TOS executable file format is used on Atari 16/32-bit computers
    with 68000 up to 68060 CPU running TOS, MiNT or any compatible
    operating system. The symbol table is in DRI format and may use
    HiSoft (default) or SozobonX extended symbol names.
  </p></dd>
<dt><samp class="option">-Fdri</samp></dt>
<dd><p>The object file format defined by Digital Research for Atari M68k
    systems. May use SozobonX extended symbol names.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="Restrictions-3">
<h3 class="section"><span>10.4 Restrictions<a class="copiable-link" href="#Restrictions-3"> &para;</a></span></h3>

<ul class="itemize mark-minus">
<li>These file formats only support a single Text (code), Data and BSS
  section.
</li><li>For <code class="code">tos</code> all symbols must be defined, otherwise the generation
  of the executable fails. Unknown symbols are listed by vasm.
</li><li>The only relocations allowed in <code class="code">tos</code> are 32-bit absolute. For
  <code class="code">dri</code> all 16- and 32-bit absolute and PC-relative relocations
  are supported. 16-bit base-relative appears as a 16-bit absolute symbol
  reference.
</li><li>The maximum symbol length is 8 characters only. The <code class="code">tos</code>
  format increases the maximum length to 22 by using an extension
  created by HiSoft, unless forbidden by <samp class="option">-stdsymbols</samp>.
  With <samp class="option">-szbx</samp> you may enable the SozobonX extension for
  unlimited length - but you need a linker which supports that format.
</li><li>Symbol references in <code class="code">dri</code> object files are limited to a
  maximum of 8192 symbols.
</li></ul>
<p>All these restrictions are defined by the file format itself.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-8">
<h3 class="section"><span>10.5 Known Problems<a class="copiable-link" href="#Known-Problems-8"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.
</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-8">
<h3 class="section"><span>10.6 Error Messages<a class="copiable-link" href="#Error-Messages-8"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3004: section attributes &lt;attr&gt; not supported
</li><li>3005: reloc type %d, size %d, mask 0x%lx (symbol %s + 0x%lx) not supported
</li><li>3006: reloc type %d not supported
</li><li>3007: undefined symbol &lt;%s&gt;
</li><li>3008: output module doesn&rsquo;t allow multiple sections of the same type
</li><li>3009: undefined symbol &lt;%s&gt; at %s+%#lx, reloc type %d
</li><li>3010: section &lt;%s&gt;: alignment padding (%lu) not a multiple of %lu at 0x%llx
</li><li>3011: weak symbol &lt;%s&gt; not supported by output format, treating as global
</li><li>3020: too many symbols for selected output file format
</li><li>3024: section &lt;%s&gt;: maximum size of 0x%llx bytes exceeded (0x%llx)
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="GST-output-module">
<div class="nav-panel">
<p>
Next: <a href="#Hunk_002dformat-output-module" accesskey="n" rel="next">Hunk-format output module</a>, Previous: <a href="#TOS-output-module" accesskey="p" rel="prev">TOS output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="GST-output-module-1"><span>11 GST output module<a class="copiable-link" href="#GST-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the gst output module which can be
selected with the <samp class="option">-Fgst</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-9" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-7" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-5" accesskey="3">General</a></li>
<li><a href="#Restrictions-4" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-9" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-9" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-9">
<h3 class="section"><span>11.1 Legal<a class="copiable-link" href="#Legal-9"> &para;</a></span></h3>

<p>This module is written in 2023 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-7">
<h3 class="section"><span>11.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-7"> &para;</a></span></h3>

<p>None.
</p>
</div>
<div class="section-level-extent" id="General-5">
<h3 class="section"><span>11.3 General<a class="copiable-link" href="#General-5"> &para;</a></span></h3>

<p>This module outputs the GST object file format by GST Software, which
was used by several development tools on the Atari M68k computers.
For example by the GST assembler and Devpac.
</p>
</div>
<div class="section-level-extent" id="Restrictions-4">
<h3 class="section"><span>11.4 Restrictions<a class="copiable-link" href="#Restrictions-4"> &para;</a></span></h3>

<ul class="itemize mark-minus">
<li>Although there can be multiple sections, they don&rsquo;t have a type.
</li><li>Maximum length of section and symbol names is 255 characters.
</li><li>Only absolute, pc-relative and common-symbol relocations are
      supported at the moment.
</li><li>Possible relocation sizes are 8, 16 and 32 bits.
</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-9">
<h3 class="section"><span>11.5 Known Problems<a class="copiable-link" href="#Known-Problems-9"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Needs testing.
</li><li>Missing support for base-relative relocations.
</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-9">
<h3 class="section"><span>11.6 Error Messages<a class="copiable-link" href="#Error-Messages-9"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3002: output module doesn&rsquo;t support cpu %s
</li><li>3011: weak symbol &lt;%s&gt; not supported by output format, treating as global
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Hunk_002dformat-output-module">
<div class="nav-panel">
<p>
Next: <a href="#X68k-output-module" accesskey="n" rel="next">X68k output module</a>, Previous: <a href="#GST-output-module" accesskey="p" rel="prev">GST output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Hunk_002dformat-output-module-1"><span>12 Hunk-format output module<a class="copiable-link" href="#Hunk_002dformat-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the AmigaOS hunk-format output module which can be
selected with the <samp class="option">-Fhunk</samp> option to generate objects and with the
<samp class="option">-Fhunkexe</samp> option to generate executable files.
</p>
<ul class="mini-toc">
<li><a href="#Legal-10" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-8" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-6" accesskey="3">General</a></li>
<li><a href="#Restrictions-5" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-10" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-10" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-10">
<h3 class="section"><span>12.1 Legal<a class="copiable-link" href="#Legal-10"> &para;</a></span></h3>

<p>This module is written in 2002-2025 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-8">
<h3 class="section"><span>12.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-8"> &para;</a></span></h3>
<dl class="table">
<dt><samp class="option">-dbg-globloc</samp></dt>
<dd><p>Adds all local labels to the debug symbol hunk, by trying to
        construct a unique name out of the previous global label and
        the original local label name: <code class="code">global$local</code>.
        The default is to write global labels only.
    </p></dd>
<dt><samp class="option">-dbg-local</samp></dt>
<dd><p>Adds all local labels with their original name to the debug
        symbol hunk. The default is to write global labels only.
    </p></dd>
<dt><samp class="option">-hunkpad=&lt;code&gt;</samp></dt>
<dd><p>Sets a two-byte code used for aligning a code hunk to the
        next 32-bit border. Defaults to 0x4e71 for M68k code sections, to
        allow linking of functions which extend over two object files.
        Otherwise it defaults to zero.
    </p></dd>
<dt><samp class="option">-keepempty</samp></dt>
<dd><p>Do not delete empty sections without any symbol definition.
    </p></dd>
<dt><samp class="option">-kick1hunks</samp></dt>
<dd><p>Use only those hunk types and external reference types which have
        been valid at the time of Kickstart 1.x, for compatibility with
        old assembler sources and old linkers. For example: no longer
        differentiate between absolute and relative references.
        In executables it will prevent the assembler from using
        16-bit relocation offsets in hunks and rejects 32-bit PC-relative
        relocations.
    </p></dd>
<dt><samp class="option">-linedebug</samp></dt>
<dd><p>Automatically generate an SAS/C-compatible LINE DEBUG hunk for
        the input source. Overrides any line debugging directives from
        the source text.
    </p></dd>
<dt><samp class="option">-noabspath</samp></dt>
<dd><p>Do not make absolute paths from source file names for the
        LINE DEBUG format. Except the path was already specified as
        absolute on the command line or via a directive.
</p></dd>
</dl>

<p>These options are valid for the <code class="code">hunkexe</code> module only:
</p><dl class="table">
<dt><samp class="option">-databss</samp></dt>
<dd><p>Try to shorten sections in the output file by removing zero words
        without relocation from the end. This technique is only supported
        by AmigaOS 2.0 and higher.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-6">
<h3 class="section"><span>12.3 General<a class="copiable-link" href="#General-6"> &para;</a></span></h3>

<p>This module outputs the <code class="code">hunk</code> object (standard for <code class="code">M68k</code>
and extended for <code class="code">PowerPC</code>) and <code class="code">hunkexe</code> executable format, which
is a proprietary file format used by AmigaOS and WarpOS.
</p>
<p>The <code class="code">hunkexe</code> module will generate directly executable files, without
the need for another linker run. But you have to make sure that there are
no undefined symbols, common symbols, or unusual relocations (e.g. small
data) left.
</p>
<p>It is allowed to define sections with the same name but different
attributes. They will be regarded as different entities.
</p>

</div>
<div class="section-level-extent" id="Restrictions-5">
<h3 class="section"><span>12.4 Restrictions<a class="copiable-link" href="#Restrictions-5"> &para;</a></span></h3>

<p>The <code class="code">hunk</code>/<code class="code">hunkexe</code> output format is only intended for <code class="code">M68k</code>
and <code class="code">PowerPC</code> cpu modules and will abort when used otherwise.
</p>
<p>The <code class="code">hunk</code> module supports the following relocation types:
</p>
<ul class="itemize mark-minus">
<li>absolute, 32-bit

</li><li>absolute, 16-bit

</li><li>absolute, 8-bit

</li><li>relative, 8-bit

</li><li>relative, 14-bit (mask 0xfffc) for PPC branch instructions.

</li><li>relative, 16-bit

</li><li>relative, 24-bit (mask 0x3fffffc) for PPC branch instructions.

</li><li>relative, 32-bit

</li><li>base-relative, 16-bit

</li><li>common symbols are supported as 32-bit absolute and relative
      references

</li></ul>

<p>The <code class="code">hunkexe</code> module supports absolute 32-bit relocations only.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-10">
<h3 class="section"><span>12.5 Known Problems<a class="copiable-link" href="#Known-Problems-10"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>The <code class="code">hunkexe</code> module won&rsquo;t process common symbols and allocate
them in a <code class="code">BSS</code> section. Use a real linker for that.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-10">
<h3 class="section"><span>12.6 Error Messages<a class="copiable-link" href="#Error-Messages-10"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3001: multiple sections not supported by this format
</li><li>3002: output module doesn&rsquo;t support cpu &lt;name&gt;
</li><li>3003: write error
</li><li>3004: section attributes &lt;attr&gt; not supported
</li><li>3005: reloc type &lt;m&gt;, size &lt;n&gt;, mask &lt;mask&gt; (symbol &lt;sym&gt; + &lt;offset&gt;) not supported
</li><li>3006: reloc type &lt;n&gt; not supported
</li><li>3009: undefined symbol &lt;%s&gt; at %s+%#lx, reloc type %d
</li><li>3010: section &lt;%s&gt;: alignment padding (%lu) not a multiple of %lu at 0x%llx
</li><li>3011: weak symbol &lt;%s&gt; not supported by output format, treating as global
</li><li>3014: data definition following a databss space directive
</li><li>3016: absolute file path exceeds maximum size of %d characters
</li><li>3017: converting NONE relocation &lt;%s&gt; to 8-bit ABS with zero addend
</li><li>3018: no additional space in section to convert NONE relocation &lt;%s&gt; to ABS
</li><li>3019: section &lt;%s&gt;: kickstart 1.x cannot initialize bss sections &gt;256k to zero
</li><li>3023: unaligned relocation offset at %s+%#lx
</li><li>3024: section &lt;%s&gt;: maximum size of %#llx bytes exceeded (%#llx)
</li><li>3025: section &lt;%s&gt;: memory flags %#lx have been ignored

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="X68k-output-module">
<div class="nav-panel">
<p>
Next: <a href="#O65-output-module" accesskey="n" rel="next">O65 output module</a>, Previous: <a href="#Hunk_002dformat-output-module" accesskey="p" rel="prev">Hunk-format output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="X68k-output-module-1"><span>13 X68k output module<a class="copiable-link" href="#X68k-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the Xfile output module which can be
selected with the <samp class="option">-Fxfile</samp> option.
Refer to the TOS output module for generating absolute Z-file executables.
</p>
<ul class="mini-toc">
<li><a href="#Legal-11" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-9" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-7" accesskey="3">General</a></li>
<li><a href="#Restrictions-6" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-11" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-11" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-11">
<h3 class="section"><span>13.1 Legal<a class="copiable-link" href="#Legal-11"> &para;</a></span></h3>

<p>This module is written in 2018,2020,2021,2024 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-9">
<h3 class="section"><span>13.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-9"> &para;</a></span></h3>
 
<dl class="table">
<dt><samp class="option">-exec=&lt;symbol&gt;</samp></dt>
<dd><p>Use the given label <code class="code">&lt;symbol&gt;</code> as entry point of the program.
        Omitting this option will define the execution address
        to be the same as the code section&rsquo;s base address.
    </p></dd>
<dt><samp class="option">-loadhigh</samp></dt>
<dd><p>Set the load mode in the header to <code class="code">high address (2)</code>.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-7">
<h3 class="section"><span>13.3 General<a class="copiable-link" href="#General-7"> &para;</a></span></h3>

<p>This module outputs the Xfile executable file format, which is used
on Sharp X68000 16/32-bit computer with 68000 up to 68040 CPU.
</p>
</div>
<div class="section-level-extent" id="Restrictions-6">
<h3 class="section"><span>13.4 Restrictions<a class="copiable-link" href="#Restrictions-6"> &para;</a></span></h3>

<ul class="itemize mark-minus">
<li>The source must not define more than one code, data and bss section
  each. More complex sources with <code class="code">.rdata</code> or <code class="code">.stack</code> sections
  require a linker.
</li><li>All symbols must be defined, otherwise the generation of the executable
  fails. Unknown symbols are listed by vasm.
</li><li>The only relocations allowed in this format are 32-bit absolute.
</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-11">
<h3 class="section"><span>13.5 Known Problems<a class="copiable-link" href="#Known-Problems-11"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.
</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-11">
<h3 class="section"><span>13.6 Error Messages<a class="copiable-link" href="#Error-Messages-11"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3004: section attributes &lt;attr&gt; not supported
</li><li>3005: reloc type %d, size %d, mask 0x%lx (symbol %s + 0x%lx) not supported
</li><li>3006: reloc type %d not supported
</li><li>3007: undefined symbol &lt;%s&gt;
</li><li>3008: output module doesn&rsquo;t allow multiple sections of the same type
</li><li>3009: undefined symbol &lt;%s&gt; at %s+%#lx, reloc type %d
</li><li>3011: weak symbol &lt;%s&gt; not supported by output format, treating as global
</li><li>3024: section &lt;%s&gt;: maximum size of 0x%llx bytes exceeded (0x%llx)
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="O65-output-module">
<div class="nav-panel">
<p>
Next: <a href="#vobj-output-module" accesskey="n" rel="next">vobj output module</a>, Previous: <a href="#X68k-output-module" accesskey="p" rel="prev">X68k output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="O65-output-module-1"><span>14 O65 output module<a class="copiable-link" href="#O65-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the O65 binary relocation format V1.3 for the 6502
family, as defined by Andre Fachat on 6502.org.
Option <samp class="option">-Fo65</samp> outputs object files suitable for another linker pass,
while <samp class="option">-Fo65exe</samp> outputs executable files for an O65 loader. The
difference is just a flag which declares the file being an object, and
vasm will make sure that the load-addresses of sections in an executable
will be consecutive and do not overlay.
</p>
<ul class="mini-toc">
<li><a href="#Legal-12" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-10" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-8" accesskey="3">General</a></li>
<li><a href="#Restrictions-7" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-12" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-12" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-12">
<h3 class="section"><span>14.1 Legal<a class="copiable-link" href="#Legal-12"> &para;</a></span></h3>

<p>This module is written in 2021 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-10">
<h3 class="section"><span>14.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-10"> &para;</a></span></h3>
<dl class="table">
<dt><samp class="option">-bss=&lt;addr&gt;</samp></dt>
<dd><p>Sets a start address for the <code class="code">bss</code> section.
    </p></dd>
<dt><samp class="option">-data=&lt;addr&gt;</samp></dt>
<dd><p>Sets a start address for the <code class="code">data</code> section.
    </p></dd>
<dt><samp class="option">-fopts</samp></dt>
<dd><p>Enable informational header options, generated by the assembler:
        file name, assembler name and version, creation date.
    </p></dd>
<dt><samp class="option">-foauthor=&lt;name&gt;</samp></dt>
<dd><p>Write author&rsquo;s name to the header options.
    </p></dd>
<dt><samp class="option">-foname=&lt;name&gt;</samp></dt>
<dd><p>Write file name to the header options. Overwrites the real file
        name, which would be set by <samp class="option">-fopts</samp>.
    </p></dd>
<dt><samp class="option">-paged</samp></dt>
<dd><p>Make the output file use paged alignment and simplified paged
        relocations.
    </p></dd>
<dt><samp class="option">-secalign=&lt;align&gt;</samp></dt>
<dd><p>Set minimum alignment for all sections as number of least significant
        bits which have to be zero. <code class="code">align</code> may be 0, 1, 2, 8.
        The default behaviour is to use the maximum alignment given by the
        input sections.
    </p></dd>
<dt><samp class="option">-stack=&lt;stacksize&gt;</samp></dt>
<dd><p>Store required stack size in the header.
    </p></dd>
<dt><samp class="option">-text=&lt;addr&gt;</samp></dt>
<dd><p>Sets a start address for the <code class="code">text</code> section.
    </p></dd>
<dt><samp class="option">-zero=&lt;addr&gt;</samp></dt>
<dd><p>Sets a start address for the <code class="code">zero</code> (zero/direct page) section.
</p></dd>
</dl>

<p>These options are valid for the <code class="code">o65exe</code> module only:
</p><dl class="table">
<dt><samp class="option">-bsszero</samp></dt>
<dd><p>Set a flag in the header which requests automatic clearing of the
        <code class="code">bss</code> section.
</p></dd>
</dl>


</div>
<div class="section-level-extent" id="General-8">
<h3 class="section"><span>14.3 General<a class="copiable-link" href="#General-8"> &para;</a></span></h3>

<p>This output module outputs the <code class="code">o65</code> object file and <code class="code">o65exe</code>
executable file format for 6502-family processors and the 65816.
The processor type is determined by the selected CPU of the active backend
and stored in the header.
</p>
<p>The <code class="code">o65exe</code> module generates executable files for a o65-loader,
which is present in some 6502 operating systems (e.g. Lunix, SMOS, OS/A65).
Unresolved symbols are allowed in o65 object- and executable-files.
In the latter case the o65-loader is responsible to resolve them.
Common symbols, weak symbol and most relocation types, except absolute
addresses, are not supported by o65.
</p>
<p>The o65 format recognizes four different sections by their attributes
or name:
</p><ul class="itemize mark-minus">
<li>text, sections which have executable code and/or are not
      writable (<code class="code">acrx</code>).
</li><li>data, sections which have initialized data and may be read and
      written (<code class="code">adrw</code>).
</li><li>bss, sections which have uninitialized data and may be read and
      written (<code class="code">aurw</code>).
</li><li>zero, sections which have uninitialized data, may be read
      and written, and do not have the string <code class="code">&quot;bss&quot;</code> anywhere in
      their name (<code class="code">aurwz</code>).
</li></ul>

<p>Up to two absolute sections (<code class="code">ORG</code> directive) can be stored in
the <code class="code">text</code> and <code class="code">data</code> slots, in the order of occurrence.
</p>

</div>
<div class="section-level-extent" id="Restrictions-7">
<h3 class="section"><span>14.4 Restrictions<a class="copiable-link" href="#Restrictions-7"> &para;</a></span></h3>

<p>Currently the <code class="code">o65</code>/<code class="code">o65exe</code> output module is only intended to
work with the <code class="code">6502</code> cpu module and will abort when used otherwise.
</p>
<p>It supports all relocation types defined by o65, which are:
</p><ul class="itemize mark-minus">
<li>0x20: absolute, 8-bit value or low-byte of 16-bit address
</li><li>0x40: absolute, 8-bit high-byte of 16-bit address
</li><li>0x80: absolute, 16-bit address
</li><li>0xa0: absolute, 8-bit segment-byte of 24-bit address
</li><li>0xc0: absolute, 24-bit address
</li></ul>

<p>Common or weak symbols are not supported.
</p>

</div>
<div class="section-level-extent" id="Known-Problems-12">
<h3 class="section"><span>14.5 Known Problems<a class="copiable-link" href="#Known-Problems-12"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Needs a better way to set start addresses for the sections
      in the assembler.
</li></ul>


</div>
<div class="section-level-extent" id="Error-Messages-12">
<h3 class="section"><span>14.6 Error Messages<a class="copiable-link" href="#Error-Messages-12"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3004: section attributes &lt;attr&gt; not supported
</li><li>3008: output module doesn&rsquo;t allow multiple sections of the same type (%s)
</li><li>3011: weak symbol &lt;%s&gt; not supported by output format, treating as global
</li><li>3013: reloc type %d, mask %#lx to symbol %s + %#lx does not fit into %u bits
</li><li>3015: file option %d max size exceeded: %lu
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="vobj-output-module">
<div class="nav-panel">
<p>
Next: <a href="#Simple-binary-output-module" accesskey="n" rel="next">Simple binary output module</a>, Previous: <a href="#O65-output-module" accesskey="p" rel="prev">O65 output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="vobj-output-module-1"><span>15 vobj output module<a class="copiable-link" href="#vobj-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the simple binary output module which can be
selected with the <samp class="option">-Fvobj</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-13" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-11" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-9" accesskey="3">General</a></li>
<li><a href="#Restrictions-8" accesskey="4">Restrictions</a></li>
<li><a href="#Known-Problems-13" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-13" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-13">
<h3 class="section"><span>15.1 Legal<a class="copiable-link" href="#Legal-13"> &para;</a></span></h3>

<p>This module is written in 2002-2023 by Volker Barthelmann and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-11">
<h3 class="section"><span>15.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-11"> &para;</a></span></h3>
<dl class="table">
<dt><samp class="option">-vobj2</samp></dt>
<dd><p>Use vobj format version 2 which generally reduces file size.
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="General-9">
<h3 class="section"><span>15.3 General<a class="copiable-link" href="#General-9"> &para;</a></span></h3>

<p>This output module outputs the <code class="code">vobj</code> object format, a simple
portable proprietary object file format of <code class="code">vasm</code>.
</p>
<p>The Format is defined as follows:
</p>
<div class="example">
<pre class="example-preformatted">

Header
  .byte 0x56,0x4f,0x42,0x4a
  .byte flags
    Bits 0-1:
     1: BIGENDIAN
     2: LITTLENDIAN
    Bits 2-7:
     VOBJ-Version (0-based)
  .number bitsperbyte 
  .number bytespertaddr
  .string cpu
  .number nsections [1-based]
  .number nsymbols [1-based]
  
nsymbols
  .string name
  .number type
  .number flags
  .number secindex
  .number val
  .number size

nsections
  .string name
  .string attr
  .number flags
  .number align
  .number size
  .number nrelocs
  .number databytes
  .byte[databytes]

nrelocs [standard|special]
standard
   .number type
   .number byteoffset
   .number bitoffset
   .number size
   .number mask
   .number addend
   .number symbolindex | 0 (sectionbase)

special
    .number type
    .number size
    .byte[size]

.number:[taddr]
    .byte 0--127 [0--127]
    .byte 128-191 [x-0x80 bytes little-endian], fill remaining with 0
    .byte 192-255 [x-0xC0 bytes little-endian], fill remaining with 0xff
    (.byte 192-255 is supported by vobj version 2+ only.)
</pre></div>

</div>
<div class="section-level-extent" id="Restrictions-8">
<h3 class="section"><span>15.4 Restrictions<a class="copiable-link" href="#Restrictions-8"> &para;</a></span></h3>

<p>None.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-13">
<h3 class="section"><span>15.5 Known Problems<a class="copiable-link" href="#Known-Problems-13"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-13">
<h3 class="section"><span>15.6 Error Messages<a class="copiable-link" href="#Error-Messages-13"> &para;</a></span></h3>

<p>This module has the following error messages:
</p><ul class="itemize mark-minus">
<li>3010: section &lt;%s&gt;: alignment padding (%lu) not a multiple of %lu at 0x%llx
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Simple-binary-output-module">
<div class="nav-panel">
<p>
Next: <a href="#Motorola-S_002dRecord-output-module" accesskey="n" rel="next">Motorola S-Record output module</a>, Previous: <a href="#vobj-output-module" accesskey="p" rel="prev">vobj output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Simple-binary-output-module-1"><span>16 Simple binary output module<a class="copiable-link" href="#Simple-binary-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the simple binary output module which can be
selected with the <samp class="option">-Fbin</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-14" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-12" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-10" accesskey="3">General</a></li>
<li><a href="#Known-Problems-14" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-14" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-14">
<h3 class="section"><span>16.1 Legal<a class="copiable-link" href="#Legal-14"> &para;</a></span></h3>

<p>This module is written in 2002-2025 by Volker Barthelmann and
    Frank Wille and is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-12">
<h3 class="section"><span>16.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-12"> &para;</a></span></h3>
 
<dl class="table">
<dt><samp class="option">-apple-bin</samp></dt>
<dd><p>Prepends a 4-byte header with load-address and length to the
        raw binary file, as used by the <code class="command">AppleCommander</code> to write
        such files onto a DOS 3.3 disk image.
    </p></dd>
<dt><samp class="option">-atari-com</samp></dt>
<dd><p>Writes an Atari DOS COM header preceding the output file. It has
        a standard header (<code class="code">0xFFFF</code>), which is followed by any
        number of sections. Each section starts with two little-endian
        words defining the address of the first and last byte in memory.
    </p></dd>
<dt><samp class="option">-coalesced</samp></dt>
<dd><p>Do not pad the space between separate org-blocks, but output
        all of them in a coalesced manner (sorted by address).
    </p></dd>
<dt><samp class="option">-cbm-prg</samp></dt>
<dd><p>Writes a Commodore PRG header preceding the output file, which
        consists of two bytes in little-endian order, defining the load
        address of the program.
    </p></dd>
<dt><samp class="option">-coco-ml</samp></dt>
<dd><p>Writes a Tandy Color Computer machine language file, which has
        a header with load address and length for each section and is
        terminated by a trailer with the execution address.
    </p></dd>
<dt><samp class="option">-dragon-bin</samp></dt>
<dd><p>Writes a Dragon DOS header preceding the output file, where the
        file type is set to <code class="code">$02</code> for binary. The load address is
        taken from the first section&rsquo;s start address. This will also be
        the execute-address, when not specified otherwise. Refer to
        option <samp class="option">-exec</samp>.
    </p></dd>
<dt><samp class="option">-exec=&lt;symbol&gt;</samp></dt>
<dd><p>Use the given symbol <code class="code">&lt;symbol&gt;</code> as entry point of the program,
        for those output format headers which support it. Otherwise this
        option will be silently ignored.
        Omitting this option will usually define the execution address
        to be the same as the load address.
    </p></dd>
<dt><samp class="option">-foenix-pgx</samp></dt>
<dd><p>Writes a simple, single-segment format for the 65C02- and 65816-based
        Foenix computers. The header defines the program&rsquo;s load address,
        which is also the start address.
    </p></dd>
<dt><samp class="option">-foenix-pgz</samp></dt>
<dd><p>Write a multi-segment format for Foenix computers.
        The format is derived from binary format used by Western Design
        Center&rsquo;s C compiler. Every segment is stored with load address and
        size, and there is also a start address defined.
        There is a 24-bit (<code class="code">'Z'</code>) and a 32-bit (<code class="code">'z'</code>) format
        which will be selected according to the target CPU.
    </p></dd>
<dt><samp class="option">-oric-mc</samp></dt>
<dd><p>Writes a machine code file header for Oric-1, Oric-Atmos and
        compatible systems. It includes the file type and name, as well as
        the first and last address of the program to load. Note, that the
        name defaults to the output file name, limited to 15 characters.
        A &quot;.tap&quot; extension will be removed automatically.
    </p></dd>
<dt><samp class="option">-oric-mcx</samp></dt>
<dd><p>Same as <samp class="option">-oric-mc</samp>, but sets the auto-execute flag in
        the header.
    </p></dd>
<dt><samp class="option">-start=&lt;address&gt;</samp></dt>
<dd><p>Set the start address for the default section, when no
        <code class="code">section</code> or <code class="code">org</code> directive was given.
</p></dd>
</dl>
 
</div>
<div class="section-level-extent" id="General-10">
<h3 class="section"><span>16.3 General<a class="copiable-link" href="#General-10"> &para;</a></span></h3>

<p>This output module outputs the contents of all sections as simple
binary data, by default without any header or additional information.
When there are multiple sections, they must not overlap. Gaps between
sections or org-blocks are filled with zero bytes, when not using a
special header format, like Atari COM. The padding can be avoided by
option <samp class="option">-coalesced</samp>. Undefined symbols are not allowed.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-14">
<h3 class="section"><span>16.4 Known Problems<a class="copiable-link" href="#Known-Problems-14"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-14">
<h3 class="section"><span>16.5 Error Messages<a class="copiable-link" href="#Error-Messages-14"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3001: sections &lt;%s&gt;:%llx-%llx and &lt;%s&gt;:%llx-%llx must not overlap
</li><li>3007: undefined symbol &lt;%s&gt;
</li><li>3010: section &lt;%s&gt;: alignment padding (%lu) not a multiple of %lu at 0x%llx
</li><li>3013: reloc type %d, mask 0x%lx to symbol %s + 0x%lx does not fit into %u bits
</li><li>3021: all sections are absolute, nothing to relocate
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Motorola-S_002dRecord-output-module">
<div class="nav-panel">
<p>
Next: <a href="#Intel-Hex-output-module" accesskey="n" rel="next">Intel Hex output module</a>, Previous: <a href="#Simple-binary-output-module" accesskey="p" rel="prev">Simple binary output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Motorola-S_002dRecord-output-module-1"><span>17 Motorola S-Record output module<a class="copiable-link" href="#Motorola-S_002dRecord-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the Motorola srecord output module which can be
selected with the <samp class="option">-Fsrec</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-15" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-13" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-11" accesskey="3">General</a></li>
<li><a href="#Known-Problems-15" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-15" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-15">
<h3 class="section"><span>17.1 Legal<a class="copiable-link" href="#Legal-15"> &para;</a></span></h3>

<p>This module is written in 2015 by Joseph Zatarski and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-13">
<h3 class="section"><span>17.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-13"> &para;</a></span></h3>
 
<dl class="table">
<dt><samp class="option">-crlf</samp></dt>
<dd><p>Enforce Carriage-Return and Line-Feed (<code class="code">&quot;\r\n&quot;</code>) line
        endings. Default is to use the host&rsquo;s line endings.
    </p></dd>
<dt><samp class="option">-exec[=&lt;symbol&gt;]</samp></dt>
<dd><p>Use the given symbol &lt;symbol&gt; as entry point of the program.
        This start address will be written into the trailer record,
        which is otherwise zero.
        When the symbol assignment is omitted, then the default symbol
        <code class="code">start</code> will be used.
    </p></dd>
<dt><samp class="option">-s19</samp></dt>
<dd><p>Writes S1 data records and S9 trailers with 16-bit addresses.
    </p></dd>
<dt><samp class="option">-s28</samp></dt>
<dd><p>Writes S2 data records and S8 trailers with 24-bit addresses.
    </p></dd>
<dt><samp class="option">-s37</samp></dt>
<dd><p>Writes S3 data records and S7 trailers with 32-bit addresses.
        This is the default setting.
</p></dd>
</dl>
 
</div>
<div class="section-level-extent" id="General-11">
<h3 class="section"><span>17.3 General<a class="copiable-link" href="#General-11"> &para;</a></span></h3>

<p>This output module outputs the contents of all sections in Motorola srecord
format, which is a simple ASCII output of hexadecimal digits. Each record
starts with &rsquo;<code class="code">S</code>&rsquo; and a one-digit ID. It is followed by the data
and terminated by a checksum and a newline character.
Every section starts with a new header record.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-15">
<h3 class="section"><span>17.4 Known Problems<a class="copiable-link" href="#Known-Problems-15"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>A new header is written for every new section. This may cause
      compatibility issues.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-15">
<h3 class="section"><span>17.5 Error Messages<a class="copiable-link" href="#Error-Messages-15"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3007: undefined symbol &lt;%s&gt;
</li><li>3010: section &lt;%s&gt;: alignment padding (%lu) not a multiple of %lu at 0x%llx
</li><li>3012: address 0x%llx out of range for selected format
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Intel-Hex-output-module">
<div class="nav-panel">
<p>
Next: <a href="#C-_0023define-output-module" accesskey="n" rel="next">C #define output module</a>, Previous: <a href="#Motorola-S_002dRecord-output-module" accesskey="p" rel="prev">Motorola S-Record output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Intel-Hex-output-module-1"><span>18 Intel Hex output module<a class="copiable-link" href="#Intel-Hex-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the Intel Hex output module which can be
selected with the <samp class="option">-Fihex</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-16" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-14" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-12" accesskey="3">General</a></li>
<li><a href="#Known-Problems-16" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-16" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-16">
<h3 class="section"><span>18.1 Legal<a class="copiable-link" href="#Legal-16"> &para;</a></span></h3>

<p>This module is written in 2020 by Rida Dzhaafar and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-14">
<h3 class="section"><span>18.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-14"> &para;</a></span></h3>
 
<dl class="table">
<dt><samp class="option">-crlf</samp></dt>
<dd><p>Enforce Carriage-Return and Line-Feed (<code class="code">&quot;\r\n&quot;</code>) line
        endings. Default is to use the host&rsquo;s line endings.
    </p></dd>
<dt><samp class="option">-i8hex</samp></dt>
<dd><p>Selects a format supporting 16-bit address space (default).
    </p></dd>
<dt><samp class="option">-i16hex</samp></dt>
<dd><p>Selects a format supporting 20-bit address space.
    </p></dd>
<dt><samp class="option">-i32hex</samp></dt>
<dd><p>Selects a format supporting 32-bit address space.
    </p></dd>
<dt><samp class="option">-record-size=&lt;n&gt;</samp></dt>
<dd><p>Sets the number of bytes per record to <code class="code">n</code>.
        Defaults to 32 bytes.
</p></dd>
</dl>
 
</div>
<div class="section-level-extent" id="General-12">
<h3 class="section"><span>18.3 General<a class="copiable-link" href="#General-12"> &para;</a></span></h3>

<p>This output module outputs the contents of all sections in Intel hex
format, which is a simple ASCII output of hexadecimal digits.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-16">
<h3 class="section"><span>18.4 Known Problems<a class="copiable-link" href="#Known-Problems-16"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None?

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-16">
<h3 class="section"><span>18.5 Error Messages<a class="copiable-link" href="#Error-Messages-16"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3001: sections &lt;%s&gt;:%llx-%llx and &lt;%s&gt;:%llx-%llx must not overlap
</li><li>3002: output module doesn&rsquo;t support cpu %s
</li><li>3007: undefined symbol &lt;%s&gt;
</li><li>3012: address 0x%llx out of range for selected format
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="C-_0023define-output-module">
<div class="nav-panel">
<p>
Next: <a href="#Project-Hans-custom-output-module" accesskey="n" rel="next">Project Hans custom output module</a>, Previous: <a href="#Intel-Hex-output-module" accesskey="p" rel="prev">Intel Hex output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="C-_0023define-output-module-1"><span>19 C #define output module<a class="copiable-link" href="#C-_0023define-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the C #define output module which can be
selected with the <samp class="option">-Fcdef</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-17" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-15" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-13" accesskey="3">General</a></li>
<li><a href="#Known-Problems-17" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-17" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-17">
<h3 class="section"><span>19.1 Legal<a class="copiable-link" href="#Legal-17"> &para;</a></span></h3>

<p>This module is written in 2020 by Volker Barthelmann and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-15">
<h3 class="section"><span>19.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-15"> &para;</a></span></h3>

<p>There are currently no additional options for this output module.
</p>
</div>
<div class="section-level-extent" id="General-13">
<h3 class="section"><span>19.3 General<a class="copiable-link" href="#General-13"> &para;</a></span></h3>

<p>This output module outputs the values of global absolute symbols as a series of
<code class="code">#define</code> directives that can be included in a C compiler. No code is generated.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-17">
<h3 class="section"><span>19.4 Known Problems<a class="copiable-link" href="#Known-Problems-17"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-17">
<h3 class="section"><span>19.5 Error Messages<a class="copiable-link" href="#Error-Messages-17"> &para;</a></span></h3>

<p>This module has no error messages:
</p>
<hr>
</div>
</div>
<div class="chapter-level-extent" id="Project-Hans-custom-output-module">
<div class="nav-panel">
<p>
Next: <a href="#Wozmon-output-module" accesskey="n" rel="next">Wozmon output module</a>, Previous: <a href="#C-_0023define-output-module" accesskey="p" rel="prev">C #define output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Project-Hans-custom-output-module-1"><span>20 Project Hans custom output module<a class="copiable-link" href="#Project-Hans-custom-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the custom output module for the project &quot;Hans&quot; which 
can be selected with the <samp class="option">-Fhans</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-18" accesskey="1">Legal</a></li>
<li><a href="#General-14" accesskey="2">General</a></li>
<li><a href="#Known-Problems-18" accesskey="3">Known Problems</a></li>
<li><a href="#Error-Messages-18" accesskey="4">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-18">
<h3 class="section"><span>20.1 Legal<a class="copiable-link" href="#Legal-18"> &para;</a></span></h3>

<p>This module is written in 2024 by Yannik Stamm and
    is covered by the vasm copyright without modifications.
</p> 
</div>
<div class="section-level-extent" id="General-14">
<h3 class="section"><span>20.2 General<a class="copiable-link" href="#General-14"> &para;</a></span></h3>

<p>This output module outputs the contents of all sections in a custom verbose
object format. It is mainly thought to be used together with a custom linker.
</p>

</div>
<div class="section-level-extent" id="Known-Problems-18">
<h3 class="section"><span>20.3 Known Problems<a class="copiable-link" href="#Known-Problems-18"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None?

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-18">
<h3 class="section"><span>20.4 Error Messages<a class="copiable-link" href="#Error-Messages-18"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3022: expression type of symbol %s not supported
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Wozmon-output-module">
<div class="nav-panel">
<p>
Next: <a href="#MOS-paper-tape-output-module" accesskey="n" rel="next">MOS paper tape output module</a>, Previous: <a href="#Project-Hans-custom-output-module" accesskey="p" rel="prev">Project Hans custom output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Wozmon-output-module-1"><span>21 Wozmon output module<a class="copiable-link" href="#Wozmon-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the wozmon output module which can be
selected with the <samp class="option">-Fwoz</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-19" accesskey="1">Legal</a></li>
<li><a href="#Contact-1" accesskey="2">Contact</a></li>
<li><a href="#Additional-options-for-this-module-16" accesskey="3">Additional options for this module</a></li>
<li><a href="#General-15" accesskey="4">General</a></li>
<li><a href="#Known-Problems-19" accesskey="5">Known Problems</a></li>
<li><a href="#Error-Messages-19" accesskey="6">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-19">
<h3 class="section"><span>21.1 Legal<a class="copiable-link" href="#Legal-19"> &para;</a></span></h3>

<p>This module is written in 2023 by anomie-p and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Contact-1">
<h3 class="section"><span>21.2 Contact<a class="copiable-link" href="#Contact-1"> &para;</a></span></h3>

<p>The author of this module may be contacted for bug
    reports:
</p><ul class="itemize mark-minus">
<li>anomie-p (anomie-p@protonmail.com)
</li></ul>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-16">
<h3 class="section"><span>21.3 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-16"> &para;</a></span></h3>

<p>There are no additional options for this module. 
</p> 
</div>
<div class="section-level-extent" id="General-15">
<h3 class="section"><span>21.4 General<a class="copiable-link" href="#General-15"> &para;</a></span></h3>

<p>This output module outputs the contents of all sections as
    wozmon monitor commands, which is a simple ASCII output of
    hexadecimal digits.
</p>
<p>The output is suitable for an ascii transfer via serial
    connection to a system running wozmon. Character and/or
    line delays are likely to be necessary for a successful
    transfer.
</p>
<p>The wozmon command parser converts up to sixteen bit
    hexadecimal values. An error containing the maximum
    out of range address is reported if a sixteen bit address
    space is exceeded.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-19">
<h3 class="section"><span>21.5 Known Problems<a class="copiable-link" href="#Known-Problems-19"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-19">
<h3 class="section"><span>21.6 Error Messages<a class="copiable-link" href="#Error-Messages-19"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3001: sections &lt;%s&gt;:%llx-%llx and &lt;%s&gt;:%llx-%llx must not overlap
</li><li>3002: output module doesn&rsquo;t support cpu %s
</li><li>3007: undefined symbol &lt;%s&gt;
</li><li>3012: address 0x%llx out of range for selected format
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="MOS-paper-tape-output-module">
<div class="nav-panel">
<p>
Next: <a href="#M68k-cpu-module" accesskey="n" rel="next">M68k cpu module</a>, Previous: <a href="#Wozmon-output-module" accesskey="p" rel="prev">Wozmon output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="MOS-paper-tape-output-module-1"><span>22 MOS paper tape output module<a class="copiable-link" href="#MOS-paper-tape-output-module-1"> &para;</a></span></h2>
<p>This chapter describes the MOS paper tape output module which can be
selected with the <samp class="option">-Fpap</samp> option.
</p>
<ul class="mini-toc">
<li><a href="#Legal-20" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-17" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-16" accesskey="3">General</a></li>
<li><a href="#Known-Problems-20" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-20" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-20">
<h3 class="section"><span>22.1 Legal<a class="copiable-link" href="#Legal-20"> &para;</a></span></h3>

<p>This module was written in 2024 by Dimitri Theulings and
    is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-17">
<h3 class="section"><span>22.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-17"> &para;</a></span></h3>

<dl class="table">
<dt><samp class="option">-strict</samp></dt>
<dd><p>Enforce strict compliance with MOS paper tape format.
        In particular, in strict mode six NULL characters (ASCII 0x00)
        are appended after the carriage return (ASCII 0x0D) and line feed
        (ASCII 0x0A) for each record. Additionally the file is terminated
        with XOFF (ASCII 0x13).
    </p></dd>
<dt><samp class="option">-record-size=&lt;number&gt;</samp></dt>
<dd><p>Set the number of data bytes per record. Defaults to 24.
    </p></dd>
<dt><samp class="option">-start=&lt;address&gt;</samp></dt>
<dd><p>Set the start address for the default section, when no
        <code class="code">section</code> or <code class="code">org</code> directive was given.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-16">
<h3 class="section"><span>22.3 General<a class="copiable-link" href="#General-16"> &para;</a></span></h3>

<p>This module outputs the contents of all sections in MOS Paper Tape format,
which is a simple ASCII output of hexadecimal digits. Each record starts
with &rsquo;<code class="code">;</code>&rsquo; followed by a single byte indicating number of data bytes
contained in the record (by default 24). The record&rsquo;s starting address
high (1 byte, 2 characters), starting address low (1 byte, 2 characters),
and data (<em class="emph">n</em> bytes, <em class="emph">2n</em> characters) follow. Each record
is terminated by the record&rsquo;s check-sum (2 bytes, 4 characters), a carriage
return (ASCII 0x0D), line feed (ASCII 0x0A). The final record does not
contain data bytes and instead lists the number of records, followed by a
checksum.
</p>
<p>In <samp class="option">strict</samp> mode, each record is followed by six NULL characters
(ASCII 0x00) and the file is terminated with XOFF (ASCII 0x13).
</p>
</div>
<div class="section-level-extent" id="Known-Problems-20">
<h3 class="section"><span>22.4 Known Problems<a class="copiable-link" href="#Known-Problems-20"> &para;</a></span></h3>

<p>There are currently no known problems.
</p>
</div>
<div class="section-level-extent" id="Error-Messages-20">
<h3 class="section"><span>22.5 Error Messages<a class="copiable-link" href="#Error-Messages-20"> &para;</a></span></h3>

<p>This module may return the following error messages:
</p>
<ul class="itemize mark-minus">
<li>3001: sections &lt;%s&gt;:%llx-%llx and &lt;%s&gt;:%llx-%llx must not overlap
</li><li>3002: output module doesn&rsquo;t support cpu %s
</li><li>3007: undefined symbol &lt;%s&gt;
</li><li>3012: address 0x%llx out of range for selected format
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="M68k-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#PowerPC-cpu-module" accesskey="n" rel="next">PowerPC cpu module</a>, Previous: <a href="#MOS-paper-tape-output-module" accesskey="p" rel="prev">MOS paper tape output module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="M68k-cpu-module-1"><span>23 M68k cpu module<a class="copiable-link" href="#M68k-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the Motorola M68k/CPU32/ColdFire
microprocessor family.
</p>
<ul class="mini-toc">
<li><a href="#Legal-21" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-18" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-17" accesskey="3">General</a></li>
<li><a href="#Internal-symbols" accesskey="4">Internal symbols</a></li>
<li><a href="#Extensions" accesskey="5">Extensions</a></li>
<li><a href="#Optimizations" accesskey="6">Optimizations</a></li>
<li><a href="#Known-Problems-21" accesskey="7">Known Problems</a></li>
<li><a href="#Error-Messages-21" accesskey="8">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-21">
<h3 class="section"><span>23.1 Legal<a class="copiable-link" href="#Legal-21"> &para;</a></span></h3>

<p>This module is written in 2002-2024 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-18">
<h3 class="section"><span>23.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-18"> &para;</a></span></h3>

<p>Note, that the order on the command line may be important when specifying
options. For example, if you specify <samp class="option">-devpac</samp> compatibility
mode behind enabling some optimization options, the Devpac-mode might
disable these optimizations again.
</p>
<p>This module provides the following additional options:
</p>
<ul class="mini-toc">
<li><a href="#CPU-selections" accesskey="1">CPU selections</a></li>
<li><a href="#Optimization-options" accesskey="2">Optimization options</a></li>
<li><a href="#Other-options" accesskey="3">Other options</a></li>
</ul>
<div class="subsection-level-extent" id="CPU-selections">
<h4 class="subsection"><span>23.2.1 CPU selections<a class="copiable-link" href="#CPU-selections"> &para;</a></span></h4>
<dl class="table">
<dt><samp class="option">-m68000</samp></dt>
<dd><p>Generate code for the MC68000 CPU (default).
</p>
</dd>
<dt><samp class="option">-m68008</samp></dt>
<dd><p>Generate code for the MC68008 CPU.
</p>
</dd>
<dt><samp class="option">-m68010</samp></dt>
<dd><p>Generate code for the MC68010 CPU.
</p>
</dd>
<dt><samp class="option">-m68020</samp></dt>
<dd><p>Generate code for the MC68020 CPU.
</p>
</dd>
<dt><samp class="option">-m68030</samp></dt>
<dd><p>Generate code for the MC68030 CPU.
</p>
</dd>
<dt><samp class="option">-m68040</samp></dt>
<dd><p>Generate code for the MC68040 CPU.
</p>
</dd>
<dt><samp class="option">-m68060</samp></dt>
<dd><p>Generate code for the MC68060 CPU.
</p>
</dd>
<dt><samp class="option">-m68020up</samp></dt>
<dd><p>Generate code for the MC68020-68060 CPU. Be careful with
        instructions like <code class="code">PFLUSHA</code>, which exist on 68030 and 68040/060
        with a different opcode (vasm will use the 040/060 version).
</p>
</dd>
<dt><samp class="option">-m68080</samp></dt>
<dd><p>Generate code for the Apollo Core AC68080 CPU.
        Note, that using register banking (using AMMX registers instead of
        <code class="code">d0</code> - <code class="code">d7</code> or <code class="code">a0</code> - <code class="code">a7</code>) in general purpose
        instructions might not yet work correctly with current Apollo Cores
        (at least up to 2024). This will change with future Core releases.
        Register banking for FPU instructions should be final already.
</p>
</dd>
<dt><samp class="option">-mcpu32</samp></dt>
<dd><p>Generate code for the CPU32 family (MC6833x, MC6834x, etc.).
</p>
</dd>
<dt><samp class="option">-mcf5...</samp></dt>
<dt><samp class="option">-m5...</samp></dt>
<dd><p>Generate code for a ColdFire family CPU. The following types are
        recognized: 5202, 5204, 5206, 520x, 5206e, 5207, 5208, 5210a, 5211a,
        5212, 5213, 5214, 5216, 5224, 5225, 5232, 5233, 5234, 5235, 523x,
        5249, 5250, 5253, 5270, 5271, 5272, 5274, 5275, 5280, 5281, 528x,
        52221, 52553, 52230, 52231, 52232, 52233, 52234, 52235, 52252,
        52254, 52255, 52256, 52258, 52259, 52274, 52277,
        5307, 5327, 5328, 5329, 532x, 5372, 5373, 537x, 53011, 53012, 53013,
        53014, 53015, 53016, 53017, 5301x,
        5407, 5470, 5471, 5472, 5473, 5474, 5475, 547x, 5480, 5481, 5482,
        5483, 5484, 5485, 548x, 54450, 54451, 54452, 54453, 5445x.
</p>
</dd>
<dt><samp class="option">-mcfv2</samp></dt>
<dd><p>Generate code for the V2 ColdFire core. This option selects
        ISA_A (no hardware division or MAC), which is the most limited ISA
        supported by 5202, 5204 and 5206. All other ColdFire chips are
        backwards compatible to V2.
</p>
</dd>
<dt><samp class="option">-mcfv3</samp></dt>
<dd><p>Generate code for the V3 ColdFire core. This option selects
        ISA_A+, hardware division MAC and EMAC instructions, which are
        supported by nearly all V3 CPUs, except the 5307.
</p>
</dd>
<dt><samp class="option">-mcfv4</samp></dt>
<dd><p>Generate code for the V4 ColdFire core. This option selects ISA_B
        and MAC as supported by the 5407.
</p>
</dd>
<dt><samp class="option">-mcfv4e</samp></dt>
<dd><p>Generate code for the V4e ColdFire core. This option selects ISA_B,
        USP-, FPU-, MAC- and EMAC-instructions (no hardware division) as
        supported by all 547x and 548x CPUs.
</p>
</dd>
<dt><samp class="option">-m68851</samp></dt>
<dd><p>Generate code for the MC68851 MMU. May be used in combination
        with another <samp class="option">-m</samp> option.
</p>
</dd>
<dt><samp class="option">-m68881</samp></dt>
<dd><p>Generate code for the MC68881 FPU. May be used in combination
        with another <samp class="option">-m</samp> option.
</p>
</dd>
<dt><samp class="option">-m68882</samp></dt>
<dd><p>Generate code for the MC68882 FPU. May be used in combination
        with another <samp class="option">-m</samp> option.
</p>
</dd>
<dt><samp class="option">-no-fpu</samp></dt>
<dd><p>Ignore any FPU options or directives, which has the effect that
        no 68881/2 FPU instructions will be accepted. This option can
        override the default behaviour of <samp class="option">-gas</samp> enabling the FPU.
</p></dd>
</dl>

</div>
<div class="subsection-level-extent" id="Optimization-options">
<h4 class="subsection"><span>23.2.2 Optimization options<a class="copiable-link" href="#Optimization-options"> &para;</a></span></h4>
<dl class="table">
<dt><samp class="option">-no-opt</samp></dt>
<dd><p>Disable all optimizations. Can be seen as a main switch to ignore
        all other optimization options on the command line and in the source.
</p>
</dd>
<dt><samp class="option">-opt-allbra</samp></dt>
<dd><p>When specified the assembler will also try to optimize branch
        instructions which already have a valid size extension.
        This option is automatically enabled in <samp class="option">-phxass</samp> mode.
</p>
</dd>
<dt><samp class="option">-opt-brajmp</samp></dt>
<dd><p>Translate relative branch instructions, whose destination is in a
        different section, into absolute jump instructions.
</p>
</dd>
<dt><samp class="option">-opt-clr</samp></dt>
<dd><p>Enables optimization from <code class="code">MOVE #0,&lt;ea&gt;</code> into <code class="code">CLR &lt;ea&gt;</code>
        for the MC68000. Note that <code class="code">CLR</code> will execute a read-modify-write
        cycle on the 68000, so it is disabled by default. With 68010 and
        higher this is a generic standard optimization.
</p>
</dd>
<dt><samp class="option">-opt-div</samp></dt>
<dd><p>Unsigned immediate divisors, which are a power of two (from 2 to 256),
        are optimized to shifts. Divisions by 1 are replaced by <code class="code">TST.L Dn</code>
        (32-bit) or <code class="code">MVZ.W Dn,Dn</code> (16-bit, ColdFire only). Divisions by
        -1 are replaced by <code class="code">NEG.L Dn</code> (32-bit) or by a combination of
        <code class="code">NEG.W Dn</code> and <code class="code">MVZ.W Dn,Dn</code> (16-bit, ColdFire only).
        This optimization will leave the flags in a different state as
        can normally be expected after a division instruction.
</p>
</dd>
<dt><samp class="option">-opt-fconst</samp></dt>
<dd><p>Floating point constants are loaded with the lowest precision
        possible. This means that <code class="code">FMOVE.D #1.0,FP0</code> would be
        optimized to <code class="code">FMOVE.S #1.0,FP0</code>, or even <code class="code">FMOVE.W #1,FP0</code>,
        because it is faster and shorter at the same precision.
        The optimization will be performed on all FPU instructions with
        immediate addressing mode.
        When an FDIV-family instruction (<code class="code">FSDIV</code>, <code class="code">FDDIV</code>,
        <code class="code">FSGLDIV</code>) is detected it will additionally be checked if the
        immediate constant is a power of 2 and then converted into
        <code class="code">FMUL #1/c,FPn</code>.
</p>
</dd>
<dt><samp class="option">-opt-jbra</samp></dt>
<dd><p><code class="code">JMP</code> and <code class="code">JSR</code> instructions to external labels will be
        converted into <code class="code">BRA.L</code> and <code class="code">BSR.L</code>, when the selected
        CPU is 68020 or higher (or CPU32).
</p>
</dd>
<dt><samp class="option">-opt-lsl</samp></dt>
<dd><p>Allows optimization of <code class="code">LSL #1</code> into <code class="code">ADD</code>. It is also
        needed to optimize <code class="code">ASL #2</code> and <code class="code">LSL #2</code> into two <code class="code">ADD</code>
        instructions (together with <samp class="option">-opt-speed</samp>).
        These optimizations can modify the V-flag, which may not be intended.
</p>
</dd>
<dt><samp class="option">-opt-movem</samp></dt>
<dd><p>Enables optimization from <code class="code">MOVEM &lt;ea&gt;,Rn</code> into
        <code class="code">MOVE &lt;ea&gt;,Rn</code> (or the other way around). May also optimize
        <code class="code">MOVEM</code> with two registers into two separate <code class="code">MOVE</code>
        insructions, when advantageous for the currently selected CPU.
        This optimization will modify the flags when the destination is
        no address register.
</p>
</dd>
<dt><samp class="option">-opt-mul</samp></dt>
<dd><p>Immediate multplication factors, which are a power of two (from 2
        to 256), are optimized to shifts. Multiplications with zero are
        replaced by a <code class="code">MOVEQ #0,Dn</code>, with -1 are replaced by a
        <code class="code">NEG.L Dn</code> and with 1 by <code class="code">EXT.L Dn</code> or <code class="code">TST.L Dn</code>
        (long-form). Not all optimizations are available for all cpu types
        (e.g. <code class="code">MULU.W</code> can only be optimized on ColdFire by using
        the <code class="code">MVZ.W</code> instruction).
        This optimization will leave the flags in a different state as
        can normally be expected after a multiplication instruction, and
        the size of the optimized code may be bigger than before in some
        situations (e.g. <code class="code">MULS.W #4,Dn</code>). So the latter will additionally
        require the <samp class="option">-opt-speed</samp> flag.
</p>
</dd>
<dt><samp class="option">-opt-nmoveq</samp></dt>
<dd><p>Optimizes <code class="code">MOVE.L #x,Dn</code> into a combination of <code class="code">MOVEQ</code>
        and <code class="code">NEG.W</code>, which works for ranges from
        <code class="code">$ff81&lt;=x&lt;=$ffff</code> and <code class="code">$ffff0001&lt;=x&lt;=$ffff0080</code>.
        Note that this optimization flips the N-flag!
</p>
</dd>
<dt><samp class="option">-opt-pea</samp></dt>
<dd><p>Enables optimization from <code class="code">MOVE #x,-(SP)</code> into <code class="code">PEA x</code>.
        This optimization will leave the flags unmodified, which might
        not be intended.
</p>
</dd>
<dt><samp class="option">-opt-size</samp></dt>
<dd><p>Optimize for size, even if this would make the code slower.
        This enables for example optimization of <code class="code">MOVE.L #x,Dn</code>
        into <code class="code">MOVEQ #x&gt;&gt;n,Dn + LSL.W #n,Dn</code>. It is mostly used
        together with other optimization flags.
</p>
</dd>
<dt><samp class="option">-opt-speed</samp></dt>
<dd><p>Optimize for speed, even if this would increase code size.
        For example it enables optimization of <code class="code">ASL.W #2,Dn</code> into two
        <code class="code">ADD.W Dn,Dn</code> instructions. Or <code class="code">MULS.W #-4,Dn</code> into
        <code class="code">EXT.L Dn + ASL.L #2,Dn + NEG.L Dn</code>.
</p>
</dd>
<dt><samp class="option">-opt-st</samp></dt>
<dd><p>Enables optimization from <code class="code">MOVE.B #-1,&lt;ea&gt;</code> into <code class="code">ST &lt;ea&gt;</code>.
        This optimization will leave the flags unmodified, which might
        not be intended.
</p>
</dd>
<dt><samp class="option">-opt-&lt;option&gt;</samp></dt>
<dd><p>Alternatively, you can use <samp class="option">-opt-</samp> followed by a
        Devpac-compatible option, as described under the <code class="code">OPT</code>
        directive. Example: <samp class="option">-opt-o1-</samp> disables branch optimization
        in the same way as an <code class="code">OPT o1-</code> directive would do at the
        top of the source text.
</p>
</dd>
<dt><samp class="option">-sc</samp></dt>
<dd><p>Small code model.
        All <code class="code">JMP</code> and <code class="code">JSR</code> instructions to external labels
        will be converted into 16-bit PC-relative jumps.
</p>
</dd>
<dt><samp class="option">-sd</samp></dt>
<dd><p>References to labels in a
        small data section (named &quot;__MERGED&quot;) are optimized into
        base-relative addressing mode, using the current base register set
        by an active <code class="code">NEAR</code> directive.
        This option is automatically enabled in <samp class="option">-phxass</samp> mode.
</p>
</dd>
<dt><samp class="option">-showcrit</samp></dt>
<dd><p>Print all critical optimizations which have side effects. Among
        those are <samp class="option">-opt-lsl</samp>, <samp class="option">-opt-mul</samp>, <samp class="option">-opt-st</samp>,
        <samp class="option">-opt-pea</samp>, <samp class="option">-opt-movem</samp> and <samp class="option">-opt-clr</samp>.
</p>
</dd>
<dt><samp class="option">-showopt</samp></dt>
<dd><p>Print all optimizations and translations vasm is doing
        (same as <code class="code">opt ow+</code>).
</p>
</dd>
<dt><samp class="option">-warnabs16</samp></dt>
<dd><p>Show a warning for every access to an absolute 16-bit address.
</p>
</dd>
<dt><samp class="option">-warnabs32</samp></dt>
<dd><p>Show a warning for every access to an absolute 32-bit address.
        This doesn&rsquo;t include section labels.
</p></dd>
</dl>

<p>In its default setting (no <samp class="option">-devpac</samp> or <samp class="option">-phxass</samp> option)
vasm performs the following optimizations:
</p><ul class="itemize mark-minus">
<li>Absolute to PC-relative.
</li><li>Branches without explicit size.
</li><li>Displacements (32 to 16 bit, <code class="code">(0,An)</code> to <code class="code">(An)</code>, etc).
</li><li>Optimize floating point constants to the lowest possible precision.
</li><li>Many instruction optimizations which are safe.
</li></ul>

</div>
<div class="subsection-level-extent" id="Other-options">
<h4 class="subsection"><span>23.2.3 Other options<a class="copiable-link" href="#Other-options"> &para;</a></span></h4>
<dl class="table">
<dt><samp class="option">-conv-brackets</samp></dt>
<dd><p>Brackets (<code class="code">'['</code> and <code class="code">']'</code>) in an operand are automatically
        treated like parentheses (<code class="code">'('</code> and <code class="code">')'</code>) as long as
        the CPU is 68000 or 68010. This is a compatibility option for some
        old assemblers.
</p>
</dd>
<dt><samp class="option">-devpac</samp></dt>
<dd><p>All options are initially set to be Devpac compatible. Which means
        that all optimizations are disabled, no debugging symbols will be
        written and vasm will warn about any optimization being done.
        When symbol output is enabled by <code class="code">opt d+</code>, then the TOS symbol
        table defaults to standard DRI format (limited to 8 characters).
        Shift-right operations are performed using an unsigned 32-bit value.
        Other options are the same as vasm&rsquo;s defaults.
        The symbol <code class="code">__G2</code> is defined, which contains information
        about the selected cpu type.
        The symbol <code class="code">__LK</code> reflects the type of output file to generate.
        Which is 0 for TOS executables, 1 for DRI objects, 2 for GST objects,
        3 for AmigaDOS objects and 4 for AmigaDOS executables.
        All other formats are represented by 99, as they are unknown to Devpac.
        It will also automatically enable <samp class="option">-guess-ext</samp> and
        <samp class="option">-nodpc</samp>.
</p>
</dd>
<dt><samp class="option">-elfregs</samp></dt>
<dd><p>Register names have to be prefixed by a &rsquo;%&rsquo; to prevent confusion
        with symbol names.
</p>
</dd>
<dt><samp class="option">-extsd</samp></dt>
<dd><p>Recognize small data references in all 020+ extended addressing modes
        using 16-bit displacements on the base register. By default only the
        16-bit address register displacement addressing mode can be used
        with small data (for compatibility reasons).
</p>
</dd>
<dt><samp class="option">-gas</samp></dt>
<dd><p>Enable additional GNU-as compatibility mnemonics, like
        <code class="code">mov</code>, <code class="code">movm</code> and <code class="code">jra</code>. Also accepts <code class="code">|</code>
        instead of <code class="code">;</code> for comments.
        GNU-as compatibility mode selects the 68020 CPU and 68881/2 FPU
        by default and enables <samp class="option">-opt-jbra</samp>.
</p>
</dd>
<dt><samp class="option">-guess-ext</samp></dt>
<dd><p>Accept illegal size extensions for an instruction, as long as
        the instruction is unsized or there is just a single size possible.
        This is the default setting in PhxAss and Devpac compatibility mode.
</p>
</dd>
<dt><samp class="option">-kick1hunks</samp></dt>
<dd><p>Prevents optimization of JMP/JSR to 32-bit PC-relative (BRA/BSR),
        which requires a relocation type that is missing for Kickstart 1.x.
</p>
</dd>
<dt><samp class="option">-nodpc</samp></dt>
<dd><p>Do not attempt to encode absolute PC-displacements directly.
        Example: <code class="code">10(PC)</code>
</p>
</dd>
<dt><samp class="option">-no-typechk</samp></dt>
<dd><p>Do not check the size and type of expressions (<code class="code">OPT t-</code>).
        Example: <code class="code">dc.b 300</code>
</p>
</dd>
<dt><samp class="option">-phxass</samp></dt>
<dd><p>PhxAss-compatibilty mode. The &quot;current PC symbol&quot; (e.g. <code class="code">*</code> in
        mot-syntax module) is set to the instruction&rsquo;s address + 2 whenever
        an instruction is parsed.
        According to the current cpu setting the symbols <code class="code">__CPU</code>,
        <code class="code">__FPU</code> and <code class="code">__MMU</code> are defined.
        <code class="code">JMP/JSR (label,PC)</code> will never be optimized (into a branch,
        for example).
        It will also automatically enable <samp class="option">-opt-allbra</samp>,
        <samp class="option">-sd</samp> and <samp class="option">-guess-ext</samp>.
</p>
</dd>
<dt><samp class="option">-rangewarnings</samp></dt>
<dd><p>Recognized for backwards-compatibility only.
        No longer needed since V2.0.
</p>
</dd>
<dt><samp class="option">-regsymredef</samp></dt>
<dd><p>Allow redefining register symbols with <code class="code">EQUR</code>. This should
        only be used for compatibility with old sources. Not many assemblers
        support that.
</p>
</dd>
<dt><samp class="option">-sdreg=&lt;n&gt;</samp></dt>
<dd><p>Set the small data base register to <code class="code">An</code>. &lt;n&gt; is valid
        between 0 and 6.
</p>
</dd>
<dt><samp class="option">-sgs</samp></dt>
<dd><p>Additionally allow immediate operands to be prefixed by
        <code class="code">&amp;</code> instead of just by <code class="code">#</code>. This syntax was used by
        the SGS assembler.
</p></dd>
</dl>

</div>
</div>
<div class="section-level-extent" id="General-17">
<h3 class="section"><span>23.3 General<a class="copiable-link" href="#General-17"> &para;</a></span></h3>

<p>This backend accepts M68k and CPU32 instructions as described in
Mototola&rsquo;s M68000 family Programmer&rsquo;s Reference Manual. Additionally
it supports ColdFire instructions as described in Motorola&rsquo;s ColdFire
Microprocessor Family Programmer&rsquo;s Reference Manual.
</p>
<p>The syntax for the scale factor in ColdFire <code class="code">MAC</code> instructions is
<code class="code">&lt;&lt;</code> for left- and <code class="code">&gt;&gt;</code> for right-shift. The scale factor may be
appended as an optional operand, when needed.
Example: <code class="code">mac d0.l,d1.u,&lt;&lt;</code>.
</p>
<p>The mask flag in <code class="code">MAC</code> instructions is written as <code class="code">&amp;</code> and is
appended directly to the effective address operand. Example:
<code class="code">mac d0,d1,(a0)&amp;,d2</code>.
</p>
<p>The register list in <code class="code">MOVEM</code>, <code class="code">FMOVEM</code>, etc. instructions
may optionally be specified by an immediate addressing mode, using a
16 or 8 (<code class="code">FMOVEM</code>) bit register mask constant.
Example (push no registers): <code class="code">movem.l #0,-(sp)</code>.
</p>
<p>The target address type is 32 bit. Floating point constants in
instructions and data are supported and encoded in IEEE format.
</p>
<p>Default alignment for instructions is 2 bytes. The default alignment for
data is 2 bytes, when the data size is larger than 8 bits. Note, that
data is not auto-aligned unless you specify the <samp class="option">-align</samp> option
(or use Devpac-compatibility mode: <samp class="option">-devpac</samp>).
</p>
</div>
<div class="section-level-extent" id="Internal-symbols">
<h3 class="section"><span>23.4 Internal symbols<a class="copiable-link" href="#Internal-symbols"> &para;</a></span></h3>

<p>Depending on the selected cpu type the <code class="code">__VASM</code> symbol will have
a value defined by the following bits:
</p><dl class="table">
<dt><code class="code">bit 0</code></dt>
<dd><p>MC68000 instruction set. Also used by MC6830x, MC68322, MC68356.
</p></dd>
<dt><code class="code">bit 1</code></dt>
<dd><p>MC68010 instruction set.
</p></dd>
<dt><code class="code">bit 2</code></dt>
<dd><p>MC68020 instruction set.
</p></dd>
<dt><code class="code">bit 3</code></dt>
<dd><p>MC68030 instruction set.
</p></dd>
<dt><code class="code">bit 4</code></dt>
<dd><p>MC68040 instruction set.
</p></dd>
<dt><code class="code">bit 5</code></dt>
<dd><p>MC68060 instruction set.
</p></dd>
<dt><code class="code">bit 6</code></dt>
<dd><p>MC68881 or MC68882 FPU.
</p></dd>
<dt><code class="code">bit 7</code></dt>
<dd><p>MC68851 PMMU.
</p></dd>
<dt><code class="code">bit 8</code></dt>
<dd><p>CPU32. Any MC6833x or MC6834x CPU.
</p></dd>
<dt><code class="code">bit 9</code></dt>
<dd><p>ColdFire ISA_A.
</p></dd>
<dt><code class="code">bit 10</code></dt>
<dd><p>ColdFire ISA_A+.
</p></dd>
<dt><code class="code">bit 11</code></dt>
<dd><p>ColdFire ISA_B.
</p></dd>
<dt><code class="code">bit 12</code></dt>
<dd><p>ColdFire ISA_C.
</p></dd>
<dt><code class="code">bit 13</code></dt>
<dd><p>ColdFire hardware division support.
</p></dd>
<dt><code class="code">bit 14</code></dt>
<dd><p>ColdFire MAC instructions.
</p></dd>
<dt><code class="code">bit 15</code></dt>
<dd><p>ColdFire enhanced MAC instructions.
</p></dd>
<dt><code class="code">bit 16</code></dt>
<dd><p>ColdFire USP register.
</p></dd>
<dt><code class="code">bit 17</code></dt>
<dd><p>ColdFire FPU instructions.
</p></dd>
<dt><code class="code">bit 18</code></dt>
<dd><p>ColdFire MMU instructions.
</p></dd>
<dt><code class="code">bit 20</code></dt>
<dd><p>Apollo Core AC68080 instruction set.
</p></dd>
</dl>

<p>The following symbols are defined for compatibility with other assemblers,
so their function is not described here.
</p><dl class="table">
<dt>Devpac</dt>
<dd><p><code class="code">__G2</code>, <code class="code">__LK</code>
</p></dd>
<dt>PhxAss</dt>
<dd><p><code class="code">__CPU</code>, <code class="code">__FPU</code>, <code class="code">__MMU</code>, <code class="code">__OPTC</code>
</p></dd>
<dt>BAsm</dt>
<dd><p><code class="code">_MOVEMBYTES</code>, <code class="code">__MOVEMREGS</code>
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="Extensions">
<h3 class="section"><span>23.5 Extensions<a class="copiable-link" href="#Extensions"> &para;</a></span></h3>

<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl class="table">
<dt><code class="code">.sdreg &lt;An&gt;</code></dt>
<dd><p>Equivalent to <code class="code">near &lt;An&gt;</code>.
</p>
</dd>
<dt><code class="code">basereg &lt;expression&gt;,&lt;An&gt;</code></dt>
<dd><p>Starts a block of base-relative addressing through register <code class="code">An</code>
      (remember that <code class="code">A7</code> is not allowed as a base register).
      The developer has to make sure that &lt;expression&gt; is placed
      into <code class="code">An</code> first, while the assembler automatically subtracts
      &lt;expression&gt;, which is usually a program label with an optional offset,
      from each displacement in a <code class="code">(d,An)</code> addressing mode.
      <code class="code">basereg</code> has priority over the <code class="code">near</code> directive. Its effect
      can be suspended with the <code class="code">endb</code> directive.
      It is allowed to use several base registers in parallel.
</p>
</dd>
<dt><code class="code">cpu32</code></dt>
<dd><p>Generate code for the CPU32 family.
</p>
</dd>
<dt><code class="code">endb &lt;An&gt;</code></dt>
<dd><p>Ends a <code class="code">basereg</code> block and suspends its effect onto the
      specified base register <code class="code">An</code>. It may be reused with a different
      base expression thereafter (refer to <code class="code">basereg</code>).
</p>
</dd>
<dt><code class="code">far</code></dt>
<dd><p>Disables small data (base-relative) mode. All data references
      will be absolute.
</p>
</dd>
<dt><code class="code">fpu &lt;cpID&gt;</code></dt>
<dd><p>Enables 68881/68882 FPU code generation. The &lt;cpID&gt; is inserted
      into the FPU instructions to select the correct coprocessor. Note
      that &lt;cpID&gt; is always 1 for the on-chip FPUs in the 68040 and
      68060. A &lt;cpID&gt; of zero will disable FPU code generation.
</p>
</dd>
<dt><code class="code">initnear</code></dt>
<dd><p>Initializes the selected small data base register. In contrast to
      PhxAss, where this directive comes from, just a reference to
      <code class="code">_LinkerDB</code> is generated, which has to be resolved by a linker:
      <code class="code">lea _LinkerDB,An</code>
</p>
</dd>
<dt><code class="code">machine &lt;cpu_type&gt;</code></dt>
<dd><p>Makes the assembler generate code for &lt;cpu_type&gt;, which can be
      the following: <code class="code">68000</code>, <code class="code">68010</code>, <code class="code">68020</code>, <code class="code">68030</code>,
      <code class="code">68040</code>, <code class="code">68060</code>, <code class="code">68080</code>,
      <code class="code">68851</code>, <code class="code">68881</code>, <code class="code">68882</code>, <code class="code">cpu32</code>.
      And various ColdFire CPUs, starting with <code class="code">5...</code>.
</p>
</dd>
<dt><code class="code">mc68000</code></dt>
<dd><p>Generate code for the MC68000 CPU.
</p>
</dd>
<dt><code class="code">mc68010</code></dt>
<dd><p>Generate code for the MC68010 CPU.
</p>
</dd>
<dt><code class="code">mc68020</code></dt>
<dd><p>Generate code for the MC68020 CPU.
</p>
</dd>
<dt><code class="code">mc68030</code></dt>
<dd><p>Generate code for the MC68030 CPU.
</p>
</dd>
<dt><code class="code">mc68040</code></dt>
<dd><p>Generate code for the MC68040 CPU.
</p>
</dd>
<dt><code class="code">mc68060</code></dt>
<dd><p>Generate code for the MC68060 CPU.
</p>
</dd>
<dt><code class="code">ac68080</code></dt>
<dd><p>Generate code for the Apollo Core AC68080 FPGA CPU.
</p>
</dd>
<dt><code class="code">mcf5...</code></dt>
<dd><p>Generate code for a ColdFire CPU. The recognized models are listed
      in the assembler-options section.
</p>
</dd>
<dt><code class="code">near [&lt;An&gt;]</code></dt>
<dd><p>Enables small data (base-relative) mode and sets the base register
      to <code class="code">An</code>. <code class="code">near</code> without an argument will reactivate a
      previously defined small data mode, which might have been switched off
      by a <code class="code">far</code> directive.
</p>
</dd>
<dt><code class="code">near code</code></dt>
<dd><p>All <code class="code">JMP</code> and <code class="code">JSR</code> instructions to external labels
      will be converted into 16-bit PC-relative jumps. The small code
      mode can be switched off by a <code class="code">far</code> directive.
</p>
</dd>
<dt><code class="code">opt &lt;option&gt;[,&lt;option&gt;...]</code></dt>
<dd><p>Sets Devpac-compatible options. When option <samp class="option">-phxass</samp> is
      given, then it will parse PhxAss options instead (which is discouraged
      for new code, so there is no detailed description here).
      Most supported Devpac2-style options are always suffixed by a
      <code class="code">+</code> or <code class="code">-</code> to enable or disable the option:
   </p><dl class="table">
<dt><code class="code">a</code></dt>
<dd><p>Automatically optimize absolute to PC-relative references.
        Default is off in Devpac-comptability mode, otherwise on.
      </p></dd>
<dt><code class="code">c</code></dt>
<dd><p>Case-sensitivity for all symbols, instructions and macros.
        Default is on.
      </p></dd>
<dt><code class="code">d</code></dt>
<dd><p>Include all symbols for debugging in the output file. May also
        generate line debugging information in some output formats.
        Default is off in Devpac-comptability mode, otherwise on.
      </p></dd>
<dt><code class="code">l</code></dt>
<dd><p>Generate a linkable object file. The default is defined by the
        selected output format via the assembler&rsquo;s <samp class="option">-F</samp> option.
        This option was supported by Devpac-Amiga only.
      </p></dd>
<dt><code class="code">l0</code></dt>
<dt><code class="code">l1</code></dt>
<dt><code class="code">l2</code></dt>
<dd><p>Nonzero selects object file, zero selects executable file format,
        when Atari-TOS (<samp class="option">-Ftos</samp>) or Amiga-hunk output format
        (<samp class="option">-Fhunk</samp>) was set on the command line.
        This option was supported by Devpac-Atari only and its original
        function was to select TOS-executable (0), DRI-object (1) or
        GST-object (2) output. For GST objects use (<samp class="option">-Fgst</samp>) instead.
      </p></dd>
<dt><code class="code">o</code></dt>
<dd><p>Enable all optimizations (o1 to o12), or disable all optimizations.
        The default is that all are disabled in Devpac-compatibility mode
        and enabled otherwise.
        When running in native vasm mode this option will also enable
        PC-relative (<code class="code">opt a</code>) and
        the following safe vasm-specific optimizations (see below):
        <code class="code">og</code>, <code class="code">of</code>.
      </p></dd>
<dt><code class="code">o1</code></dt>
<dd><p>Optimize branches without an explicit size extension.
      </p></dd>
<dt><code class="code">o2</code></dt>
<dd><p>Standard displacement optimizations (e.g. <code class="code">(0,An) -&gt; (An)</code>).
      </p></dd>
<dt><code class="code">o3</code></dt>
<dd><p>Optimize absolute addresses to short words.
      </p></dd>
<dt><code class="code">o4</code></dt>
<dd><p>Optimize <code class="code">move.l</code> to <code class="code">moveq</code>.
      </p></dd>
<dt><code class="code">o5</code></dt>
<dd><p>Optimize <code class="code">add #x</code> and <code class="code">sub #x</code> into their quick forms.
      </p></dd>
<dt><code class="code">o6</code></dt>
<dd><p>No effect in vasm.
      </p></dd>
<dt><code class="code">o7</code></dt>
<dd><p>Replace <code class="code">bra.b</code> by a 2-byte no-operation instruction, like
        <code class="code">lea (a6),a6</code>, when branching to the next instruction.
        Note: <code class="code">nop</code> is not really a no-operation instruction on 68040
        and higher.
      </p></dd>
<dt><code class="code">o8</code></dt>
<dd><p>Optimize 68020+ base displacements to 16 bit.
      </p></dd>
<dt><code class="code">o9</code></dt>
<dd><p>Optimize 68020+ outer displacements to 16 bit.
      </p></dd>
<dt><code class="code">o10</code></dt>
<dd><p>Optimize <code class="code">add/sub #x,An</code> to <code class="code">lea</code>.
      </p></dd>
<dt><code class="code">o11</code></dt>
<dd><p>Optimize <code class="code">lea (d,An),An</code> to <code class="code">addq/subq</code>.
      </p></dd>
<dt><code class="code">o12</code></dt>
<dd><p>Optimize <code class="code">&lt;op&gt;.l #x,An</code> to <code class="code">&lt;op&gt;.w #x,An</code>.
      </p></dd>
<dt><code class="code">ow</code></dt>
<dd><p>Show all optimizations being performed.
        Default is on in Devpac-compatibility mode, otherwise off.
      </p></dd>
<dt><code class="code">p</code></dt>
<dd><p>Check if code is position independent. This will cause an error on
        every relocation entry being required.
        Default is off.
      </p></dd>
<dt><code class="code">s</code></dt>
<dd><p>Include symbols in listing file.
        Default is on.
      </p></dd>
<dt><code class="code">t</code></dt>
<dd><p>Check size and type of all expressions.
        Default is on.
      </p></dd>
<dt><code class="code">w</code></dt>
<dd><p>Show assembler warnings.
        Default is on.
      </p></dd>
<dt><code class="code">x</code></dt>
<dd><p>For Amiga hunk format objects <code class="code">x+</code> strips local symbols from
        the symbol table (symbols without <code class="code">xdef</code>).
        For Atari TOS executables this will enable the extended (HiSoft)
        DRI symbol table format, which allows symbols with up to 22
        characters. DRI standard only supports 8 characters.
   </p></dd>
</dl>

<p>Devpac options without +/- suffix:
   </p><dl class="table">
<dt><code class="code">l0</code></dt>
<dt><code class="code">l1</code></dt>
<dt><code class="code">l2</code></dt>
<dd><p>Nonzero selects object file, zero selects executable file format,
        when Atari-TOS (<samp class="option">-Ftos</samp>) or Amiga-hunk output format
        (<samp class="option">-Fhunk</samp>) was set on the command line.
        This option was supported by Devpac-Atari only and its original
        function was to select TOS-executable (0), DRI-object (1) or
        GST-object (2) output. For GST objects use (<samp class="option">-Fgst</samp>) instead.
      </p></dd>
<dt><code class="code">p=&lt;type&gt;[/&lt;type&gt;]</code></dt>
<dd><p>Sets the CPU type to any model vasm supports (Devpac only allows
        68000-68040, 68332, 68881, 68882 and 68851).
   </p></dd>
</dl>

<p>Also the following Devpac3-style options are supported:
   </p><dl class="table">
<dt><code class="code">autopc</code></dt>
<dd><p>Corresponds to <code class="code">a+</code>.
      </p></dd>
<dt><code class="code">case</code></dt>
<dd><p>Corresponds to <code class="code">c+</code>.
      </p></dd>
<dt><code class="code">chkpc</code></dt>
<dd><p>Corresponds to <code class="code">p+</code>.
      </p></dd>
<dt><code class="code">debug</code></dt>
<dd><p>Corresponds to <code class="code">d+</code>.
      </p></dd>
<dt><code class="code">symtab</code></dt>
<dd><p>Corresponds to <code class="code">s+</code>.
      </p></dd>
<dt><code class="code">type</code></dt>
<dd><p>Corresponds to <code class="code">t+</code>.
      </p></dd>
<dt><code class="code">warn</code></dt>
<dd><p>Corresponds to <code class="code">w+</code>.
      </p></dd>
<dt><code class="code">xdebug</code></dt>
<dd><p>Corresponds to <code class="code">x+</code>.
      </p></dd>
<dt><code class="code">noautopc</code></dt>
<dd><p>Corresponds to <code class="code">a-</code>.
      </p></dd>
<dt><code class="code">nocase</code></dt>
<dd><p>Corresponds to <code class="code">c-</code>.
      </p></dd>
<dt><code class="code">nochkpc</code></dt>
<dd><p>Corresponds to <code class="code">p-</code>.
      </p></dd>
<dt><code class="code">nodebug</code></dt>
<dd><p>Corresponds to <code class="code">d-</code>.
      </p></dd>
<dt><code class="code">nosymtab</code></dt>
<dd><p>Corresponds to <code class="code">s-</code>.
      </p></dd>
<dt><code class="code">notype</code></dt>
<dd><p>Corresponds to <code class="code">t-</code>.
      </p></dd>
<dt><code class="code">nowarn</code></dt>
<dd><p>Corresponds to <code class="code">w-</code>.
      </p></dd>
<dt><code class="code">noxdebug</code></dt>
<dd><p>Corresponds to <code class="code">x-</code>.
   </p></dd>
</dl>

<p>The following options are vasm specific and should not be used when
   writing portable source. Using <code class="code">opt o+</code> or <code class="code">opt o-</code> in
   Devpac mode only toggles <code class="code">og</code> and <code class="code">of</code>.
   </p><dl class="table">
<dt><code class="code">oa</code></dt>
<dd><p>Automatically optimize absolute Apollo destination operands to
        PC-relative references (requires 68080 code-generation enabled).
      </p></dd>
<dt><code class="code">ob</code></dt>
<dd><p>Convert absolute jumps to external labels into long-branches
        (refer to <samp class="option">-opt-jbra</samp>).
      </p></dd>
<dt><code class="code">oc</code></dt>
<dd><p>Enable optimizations to <code class="code">CLR</code> (refer to <samp class="option">-opt-clr</samp>).
      </p></dd>
<dt><code class="code">od</code></dt>
<dd><p>Enable optimization of divisions into shifts (refer to
        <samp class="option">-opt-div</samp>).
      </p></dd>
<dt><code class="code">of</code></dt>
<dd><p>Enable immediate float constant optimizations (refer to
        <samp class="option">-opt-fconst</samp>).
      </p></dd>
<dt><code class="code">og</code></dt>
<dd><p>Enable generic vasm optimizations. This includes all safe
        optimizations which cannot be controlled by another option.
      </p></dd>
<dt><code class="code">oj</code></dt>
<dd><p>Enable branch to jump translations (refer to <samp class="option">-opt-brajmp</samp>).
      </p></dd>
<dt><code class="code">ol</code></dt>
<dd><p>Enable shift optimizations to <code class="code">ADD</code> (refer to <samp class="option">-opt-lsl</samp>).
      </p></dd>
<dt><code class="code">om</code></dt>
<dd><p>Enable <code class="code">MOVEM</code> optimizations (refer to <samp class="option">-opt-movem</samp>).
      </p></dd>
<dt><code class="code">on</code></dt>
<dd><p>Enable small data optimizations. References to absolute symbols in a
        small data section (named &quot;__MERGED&quot;) are optimized into a
        base-relative addressing mode (refer to <samp class="option">-sd</samp>).
      </p></dd>
<dt><code class="code">op</code></dt>
<dd><p>Enable optimizations to <code class="code">PEA</code> (refer to <samp class="option">-opt-pea</samp>).
      </p></dd>
<dt><code class="code">oq</code></dt>
<dd><p>Optimizes <code class="code">MOVE.L</code> into a combination of <code class="code">MOVEQ</code> and
        <code class="code">NEG.W</code> (refer to <samp class="option">-opt-nmoveq</samp>).
      </p></dd>
<dt><code class="code">os</code></dt>
<dd><p>Optimize for speed before optimizing for size (refer to
        <samp class="option">-opt-speed</samp>).
      </p></dd>
<dt><code class="code">ot</code></dt>
<dd><p>Enable optimizations to <code class="code">ST</code> (refer to <samp class="option">-opt-st</samp>).
      </p></dd>
<dt><code class="code">ox</code></dt>
<dd><p>Enable optimization of multiplications into shifts
        (refer to <samp class="option">-opt-mul</samp>).
      </p></dd>
<dt><code class="code">oz</code></dt>
<dd><p>Enable optimization for size, even if the code becomes slower
        (refer to <samp class="option">-opt-size</samp>).
   </p></dd>
</dl>
<p>The default state is &rsquo;off&rsquo; for all these vasm specific options,
   except for <code class="code">of</code> and <code class="code">og</code>, which are &rsquo;on&rsquo;.
</p></dd>
</dl>

<p>The following directives are only available for the Motorola syntax
module:
</p>
<dl class="table">
<dt><code class="code">&lt;symbol&gt; equr &lt;Rn&gt;</code></dt>
<dd><p>Define a new symbol named &lt;symbol&gt; and assign the data or
      address register <code class="code">Rn</code>, which can be used from now on in operands.
      When 68080 code generation is enabled, also <code class="code">Bn</code> base address
      registers and <code class="code">En</code> vector registers are allowed to be assigned.
      Note that a register symbol must be defined before it can be
      used!
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equrl &lt;reglist&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; reg &lt;reglist&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; fequr &lt;FPn&gt;</code></dt>
<dd><p>Define a new symbol named &lt;symbol&gt; and assign the FPU register
      <code class="code">FPn</code>, which can be used from now on in operands.
      Note that a register symbol must be defined before it can be
      used!
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; fequrl &lt;reglist&gt;</code></dt>
<dd><p>Equivalent to <code class="code">&lt;symbol&gt; freg &lt;reglist&gt;</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; freg &lt;reglist&gt;</code></dt>
<dd><p>Defines a new symbol named &lt;symbol&gt; and assign the FPU register
      list &lt;reglist&gt; to it. Registers in a list must be separated
      by a slash (<code class="code">/</code>) and ranges or registers can be defined
      by using a hyphen (<code class="code">-</code>). No character at all represents
      an empty regiser list. Optionally you may specify the &lt;reglist&gt;
      as an 8-bit register mask constant (<code class="code">fp0</code> is bit 0, <code class="code">fp7</code>
      is bit 7). Examples for valid FPU register lists are: <code class="code">fp0-fp7</code>,
      <code class="code">fp1-3/fp5/fp7</code>, <code class="code">fpiar/fpcr</code>.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; reg &lt;reglist&gt;</code></dt>
<dd><p>Defines a new symbol named &lt;symbol&gt; and assign the register
      list &lt;reglist&gt; to it. Registers in a list must be separated
      by a slash (<code class="code">/</code>) and ranges or registers can be defined
      by using a hyphen (<code class="code">-</code>). No character at all represents
      an empty regiser list. Optionally you may specify the &lt;reglist&gt;
      as a 16-bit register mask constant (<code class="code">d0</code> is bit 0, <code class="code">a7</code>
      is bit 15). Examples for valid register lists are: <code class="code">d0-d7/a0-a6</code>,
      <code class="code">d3-6/a0/a1/a4-5</code>.
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="Optimizations">
<h3 class="section"><span>23.6 Optimizations<a class="copiable-link" href="#Optimizations"> &para;</a></span></h3>

<ul class="mini-toc">
<li><a href="#Operand-optimizations" accesskey="1">Operand optimizations</a></li>
<li><a href="#Instruction-optimizations" accesskey="2">Instruction optimizations</a></li>
</ul>
<div class="subsection-level-extent" id="Operand-optimizations">
<h4 class="subsection"><span>23.6.1 Operand optimizations<a class="copiable-link" href="#Operand-optimizations"> &para;</a></span></h4>
<p>This backend performs the following operand optimizations:
</p>
<ul class="itemize mark-minus">
<li><code class="code">(0,An)</code> optimized to <code class="code">(An)</code>.

</li><li><code class="code">(d16,An)</code> translated to <code class="code">(bd32,An,ZDn.w)</code>, when <code class="code">d16</code> is not
 between -32768 and 32767 and the selected CPU allows it (68020 up or
 CPU32).

</li><li><code class="code">(d16,PC)</code> translated to <code class="code">(bd32,PC,ZDn.w)</code>, when <code class="code">d16</code> is not
 between -32768 and 32767 and the selected CPU allows it (68020 up or
 CPU32).

</li><li><code class="code">(d8,An,Rn)</code> translated to <code class="code">(bd,An,Rn)</code>, when <code class="code">d8</code> is not
 between -128 and 127 and the selected CPU allows it (68020 up or
 CPU32).

</li><li><code class="code">(d8,PC,Rn)</code> translated to <code class="code">(bd,PC,Rn)</code>, when <code class="code">d8</code> is not
 between -128 and 127 and the selected CPU allows it (68020 up or
 CPU32).

</li><li><code class="code">&lt;exp&gt;.l</code> optimized to <code class="code">&lt;exp&gt;.w</code>, when <code class="code">&lt;exp&gt;</code> is absolute
 and between -32768 and 32767.

</li><li><code class="code">&lt;exp&gt;.w</code> translated to <code class="code">&lt;exp&gt;.l</code>, when <code class="code">&lt;exp&gt;</code> is a program
 label or absolute and not between -32768 and 32767.

</li><li><code class="code">(0,An,...)</code> optimized to <code class="code">(An,...)</code> (which means the base
 displacement will be suppressed). This allows further optimization
 to <code class="code">(An)</code>, when the index is suppressed.

</li><li><code class="code">(bd16,An,...)</code> translated to <code class="code">(bd32,An,...)</code>, when <code class="code">bd16</code> is
 not between -32768 and 32767.

</li><li><code class="code">(bd32,An,...)</code> optimized to <code class="code">(bd16,An,...)</code>, when <code class="code">bd16</code> is
 between -32768 and 32767.

</li><li><code class="code">(bd32,An,ZRn)</code> optimized to <code class="code">(d16,An)</code>, when <code class="code">bd32</code> is
 between -32768 and 32767, and the index is suppressed (zero-Rn).

</li><li><code class="code">(An,ZRn)</code> optimized to <code class="code">(An)</code>, when the index is suppressed.

</li><li><code class="code">(0,PC,...)</code> optimized to <code class="code">(PC,...)</code> (which means the base
 displacement will be suppressed).

</li><li><code class="code">(bd16,PC,...)</code> translated to <code class="code">(bd32,PC,...)</code>, when <code class="code">bd16</code> is
 not between -32768 and 32767.

</li><li><code class="code">(bd32,PC,...)</code> optimized to <code class="code">(bd16,PC,...)</code>, when <code class="code">bd16</code> is
 between -32768 and 32767.

</li><li><code class="code">(bd32,PC,ZRn)</code> optimized to <code class="code">(d16,PC)</code>, when <code class="code">bd32</code> is
 between -32768 and 32767, and the index is suppressed (zero-Rn).

</li><li><code class="code">([0,Rn,...],...)</code> optimized to <code class="code">([An,...],...)</code> (which means the base
 displacement will be suppressed).

</li><li><code class="code">([bd16,Rn,...],...)</code> translated to <code class="code">([bd32,An,...],...)</code>, when <code class="code">bd16</code>
 is not between -32768 and 32768.

</li><li><code class="code">([bd32,Rn,...],...)</code> optimized to <code class="code">([bd16,An,...],...)</code>, when <code class="code">bd32</code>
 is between -32768 and 32768.

</li><li><code class="code">([...],0)</code> optimized to <code class="code">([...])</code> (which means the outer displacement
 will be suppressed).

</li><li><code class="code">([...],od16)</code> translated to <code class="code">([...],od32)</code>, when <code class="code">od16</code> is
 not between -32768 and 32767.

</li><li><code class="code">([...],od32)</code> translated to <code class="code">([...],od16)</code>, when <code class="code">od32</code> is
 between -32768 and 32767.

</li></ul>

<p>Note that an operand optimization will only take place when a displacement&rsquo;s
size was not enforced by the developer through an explicit size
extension (e.g. <code class="code">(4.l,a0)</code>)!
</p>
</div>
<div class="subsection-level-extent" id="Instruction-optimizations">
<h4 class="subsection"><span>23.6.2 Instruction optimizations<a class="copiable-link" href="#Instruction-optimizations"> &para;</a></span></h4>
<p>This backend performs the following instruction optimizations and
translations:
</p>
<ul class="itemize mark-minus">
<li><code class="code">&lt;op&gt;.L #x,An</code> optimized to <code class="code">&lt;op&gt;.W #x,An</code>, when <code class="code">x</code> is
 between -32768 and 32767.

</li><li><code class="code">ADD.? #x,&lt;ea&gt;</code> optimized to <code class="code">ADDQ.? #x,&lt;ea&gt;</code>, when <code class="code">x</code> is
 between 1 and 8.

</li><li><code class="code">ADD.? #x,&lt;ea&gt;</code> optimized to <code class="code">SUBQ.? #x,&lt;ea&gt;</code>, when <code class="code">x</code> is
 between -1 and -8.

</li><li><code class="code">ADDA.? #0,An</code> and <code class="code">SUBA.? #0,An</code> will be deleted.

</li><li><code class="code">ADDA.? #x,An</code> translated to <code class="code">LEA (x,An),An</code>, when <code class="code">x</code> is
 between -32768 and 32767.

</li><li><code class="code">ANDI.L #$ff,Dn</code> optimized to <code class="code">MVZ.B Dn,Dn</code>,
 for ColdFire ISA_B/C.

</li><li><code class="code">ANDI.L #$ffff,Dn</code> optimized to <code class="code">MVZ.W Dn,Dn</code>,
 for ColdFire ISA_B/C.

</li><li><code class="code">ANDI.? #0,&lt;ea&gt;</code> optimized to <code class="code">CLR.? &lt;ea&gt;</code>, when allowed
 by the option <samp class="option">-opt-clr</samp> or a different CPU than the MC68000 was
 selected.

</li><li><code class="code">ANDI.? #-1,&lt;ea&gt;</code> optimized to <code class="code">TST.? &lt;ea&gt;</code>.

</li><li><code class="code">ASL.? #1,Dn</code> optimized to <code class="code">ADD.? Dn,Dn</code> for 68000 and 68010.

</li><li><code class="code">ASL.? #2,Dn</code> optimized into a sequence of two <code class="code">ADD.? Dn,Dn</code>
for 68000 and 68010, when the operation size is either byte or word and
the options <samp class="option">-opt-speed</samp> and <samp class="option">-opt-lsl</samp> are given.

</li><li><code class="code">B&lt;cc&gt; &lt;label&gt;</code> translated into a combination of
 <code class="code">B!&lt;cc&gt; *+8</code> and <code class="code">JMP &lt;label&gt;</code>, when &lt;label&gt; is not defined in the
 same section (and option <samp class="option">-opt-brajmp</samp> is given),
 or outside the range of -32768 to 32767 bytes from the current address
 when the selected CPU is not 68020 up, CPU32 or ColdFire ISA_B/C.

</li><li><code class="code">B&lt;cc&gt; &lt;label&gt;</code> is automatically optimized to 8-bit, 16-bit or
 32-bit (68020 up, CPU32, MCF5407 only), whatever fits best. When the
 selected CPU doesn&rsquo;t support 32-bit branches it will try to change the
 conditional branch into a <code class="code">B&lt;!cc&gt; *+8</code> and <code class="code">JMP &lt;label&gt;</code> sequence.

</li><li><code class="code">BRA &lt;label&gt;</code> translated to <code class="code">JMP &lt;label&gt;</code>, when &lt;label&gt; is
 not defined in the same section (and option <samp class="option">-opt-brajmp</samp> is given),
 or outside the range of -32768 to 32767 bytes from the current address
 when the selected CPU is not 68020 up, CPU32 or ColdFire ISA_B/C.

</li><li><code class="code">BSR &lt;label&gt;</code> translated to <code class="code">JSR &lt;label&gt;</code>, when &lt;label&gt; is
 not defined in the same section (and option <samp class="option">-opt-brajmp</samp> is given),
 or outside the range of -32768 to 32767 bytes from the current address
 when the selected CPU is not 68020 up, CPU32 or ColdFire ISA_B/C.

</li><li><code class="code">&lt;cp&gt;B&lt;cc&gt; &lt;label&gt;</code> is automatically optimized to 16-bit or 32-bit,
 whatever fits best. &lt;cp&gt; means coprocessor and is <code class="code">P</code> for the PMMU
 and <code class="code">F</code> for the FPU.

</li><li><code class="code">CLR.L Dn</code> optimized to <code class="code">MOVEQ #0,Dn</code>.

</li><li><code class="code">CMP.? #0,&lt;ea&gt;</code> optimized to <code class="code">TST.? &lt;ea&gt;</code>. The selected CPU type
 must be MC68020 up, ColdFire or CPU32 to support address register direct
 as effective address (<code class="code">&lt;ea&gt;</code>).

</li><li><code class="code">DIVS.W/DIVU.W #1,Dn</code> optimized to <code class="code">MVZ.W Dn,Dn</code>, for
ColdFire ISA_B/C (<samp class="option">-opt-div</samp>).

</li><li><code class="code">DIVS.W #-1,Dn</code> optimized to the sequence of <code class="code">NEG.W Dn</code> and
<code class="code">MVZ.W Dn,Dn</code> (<samp class="option">-opt-div</samp> and <samp class="option">-opt-speed</samp>).

</li><li><code class="code">DIVS.L/DIVU.L #1,Dn</code> optimized to <code class="code">TST.L Dn</code>
(<samp class="option">-opt-div</samp>).

</li><li><code class="code">DIVS.L #-1,Dn</code> optimized to <code class="code">NEG.L Dn</code>
(<samp class="option">-opt-div</samp>).

</li><li><code class="code">DIVU.L #2..256,Dn</code> optimized to <code class="code">LSR.L #x,Dn</code>
(<samp class="option">-opt-div</samp>).

</li><li><code class="code">EORI.? #-1,&lt;ea&gt;</code> optimized to <code class="code">NOT.? &lt;ea&gt;</code>.

</li><li><code class="code">EORI.? #0,&lt;ea&gt;</code> optimized to <code class="code">TST.? &lt;ea&gt;</code>.

</li><li><code class="code">FMOVEM.? &lt;reglist&gt;</code> is deleted when the register list was empty.

</li><li><code class="code">FxDIV.? #m,FPn</code> optimized to <code class="code">FxMUL.? #1/m,FPn</code> when m is
a power of 2 and option <samp class="option">-opt-fconst</samp> is given.

</li><li><code class="code">JMP &lt;label&gt;</code> optimized to <code class="code">BRA.? &lt;label&gt;</code>, when &lt;label&gt; is defined
 in the same section and in the range of -32768 to 32767 bytes from the
 current address.
 Note that <code class="code">JMP (&lt;lab&gt;,PC)</code> is never optimized, with the intention
 to preserve jump-tables.

</li><li><code class="code">JSR &lt;label&gt;</code> optimized to <code class="code">BSR.? &lt;label&gt;</code>, when &lt;label&gt; is defined
 in the same section and in the range of -32768 to 32767 bytes from the
 current address.
 Note that <code class="code">JSR (&lt;lab&gt;,PC)</code> is never optimized, with the intention
 to preserve jump-tables.

</li><li><code class="code">LEA 0,An</code> optimized to <code class="code">SUBA.L An,An</code>.

</li><li><code class="code">LEA (0,An),An</code> and <code class="code">LEA (An),An</code> will be deleted.

</li><li><code class="code">LEA (d,An),An</code> is optimized to <code class="code">ADDQ.L #d,An</code> when <code class="code">d</code>
 is between 1 and 8 and to <code class="code">SUBQ.L #-d,An</code> when <code class="code">d</code> is between
 -1 and -8.

</li><li><code class="code">LEA (d,Am),An</code> will be translated into a combination of
 <code class="code">MOVEA</code> and <code class="code">ADDA.L</code> for 68000 and 68010, when <code class="code">d</code> is lower
 than -32768 or higher than 32767. The <code class="code">MOVEA</code> will be omitted when
 <code class="code">Am</code> and <code class="code">An</code> are identical. Otherwise <samp class="option">-opt-speed</samp> is
 required.

</li><li><code class="code">LINK.L An,#x</code> optimized to <code class="code">LINK.W An,#x</code>, when <code class="code">x</code> is
 between -32768 and 32767.

</li><li><code class="code">LINK.W An,#x</code> translated to <code class="code">LINK.L An,#x</code>, when <code class="code">x</code> is
 not between -32768 and 32767 and selected CPU supports this instruction.

</li><li><code class="code">LSL.? #1,Dn</code> optimized to <code class="code">ADD.? Dn,Dn</code> for 68000 and 68010,
 when option <samp class="option">-opt-lsl</samp> is given.

</li><li><code class="code">LSL.? #2,Dn</code> optimized into a sequence of two <code class="code">ADD.? Dn,Dn</code>
for 68000 and 68010, when the operation size is either byte or word and
the options <samp class="option">-opt-speed</samp> and <samp class="option">-opt-lsl</samp> are given.

</li><li><code class="code">MOVE.? #0,&lt;ea&gt;</code> optimized to <code class="code">CLR.? &lt;ea&gt;</code>, when allowed by
 the option <samp class="option">-opt-clr</samp> or a different CPU than the MC68000 was
 selected.

</li><li><code class="code">MOVE.? #x,-(SP)</code> optimized to <code class="code">PEA x</code>, when allowed by the
 option <samp class="option">-opt-pea</samp>. The move-size must not be byte (<code class="code">.b</code>).

</li><li><code class="code">MOVE.B #-1,&lt;ea&gt;</code> optimized to <code class="code">ST &lt;ea&gt;</code>, when allowed by the
 option <samp class="option">-opt-st</samp>.

</li><li><code class="code">MOVE.L #x,Dn</code> optimized to <code class="code">MOVEQ #x,Dn</code>, when <code class="code">x</code> is
 between -128 and 127.

</li><li><code class="code">MOVE.L #x,Dn</code> optimized to the sequence of <code class="code">MOVEQ #x&gt;&gt;1,Dn</code>
 and <code class="code">ADD.W Dn,Dn</code>, when <code class="code">128&lt;=x&lt;=254</code> and <code class="code">x</code> is even.

</li><li><code class="code">MOVE.L #x,Dn</code> optimized to the sequence of <code class="code">MOVEQ #x^$ff,Dn</code>
 and <code class="code">NOT.B Dn</code>, when <code class="code">128&lt;=x&lt;=255</code> and the option
 <samp class="option">-opt-nmoveq</samp> was set.

</li><li><code class="code">MOVE.L #x,Dn</code> optimized to the sequence of <code class="code">MOVEQ #x&gt;&gt;16,Dn</code>
 and <code class="code">SWAP Dn</code>, when <code class="code">$10000&lt;=x&lt;=$7f0000</code> or
 <code class="code">$ff80ffff&lt;=x&lt;=$fffeffff</code>.

</li><li><code class="code">MOVE.L #x,Dn</code> optimized to the sequence of
 <code class="code">MOVEQ #-((int16_t)x),Dn</code> and <code class="code">NEG.W Dn</code>, when <code class="code">$ff81&lt;=x&lt;=$ffff</code>
 or <code class="code">$ffff0001&lt;=x&lt;=$ffff0080</code> and the option <samp class="option">-opt-nmoveq</samp> was set.

</li><li><code class="code">MOVE.L #x,Dn</code> optimized to the sequence of <code class="code">MOVEQ #x&gt;&gt;n,Dn</code>
 and <code class="code">LSL.W #n,Dn</code>, when <code class="code">0&lt;=x&lt;=$7fff</code> and the difference between
 the highest and lowest bit set is less than 8.
 <samp class="option">-opt-size</samp> needs to be set together with standard optimizations.

</li><li><code class="code">MOVE.L #x,&lt;ea&gt;</code> optimized to <code class="code">MOV3Q #x,&lt;ea&gt;</code>, for ColdFire
 ISA_B and ISA_C, when <code class="code">x</code> is -1 or between 1 and 7.

</li><li><code class="code">MOVEA.? #0,An</code> optimized to <code class="code">SUBA.L An,An</code>.

</li><li><code class="code">MOVEA.L #x,An</code> optimized to <code class="code">MOVEA.W #x,An</code>, when <code class="code">x</code> is
 between -32768 and 32767.

</li><li><code class="code">MOVEA.L #label,An</code> optimized to <code class="code">LEA label,An</code>, which could
 allow further optimization to <code class="code">LEA label(PC),An</code>.

</li><li><code class="code">MOVEM.? &lt;reglist&gt;</code> is deleted, when the register list was empty.

</li><li><code class="code">MOVEM.? &lt;ea&gt;,An</code> optimized to <code class="code">MOVE.? &lt;ea&gt;,An</code>, when the
 register list only contains a single address register.

</li><li><code class="code">MOVEM.? &lt;ea&gt;,Rn</code> optimized to <code class="code">MOVE.? &lt;ea&gt;,Rn</code> and
 <code class="code">MOVEM.? Rn,&lt;ea&gt;</code> optimized to <code class="code">MOVE.? Rn,&lt;ea&gt;</code>, when allowed
 by the option <samp class="option">-opt-movem</samp> or when just loading an address register.

</li><li><code class="code">MOVEM.? &lt;ea&gt;,Rm/Rn</code> and <code class="code">MOVEM.? Rm/Rn,&lt;ea&gt;</code> are optimized
 into a sequence of two <code class="code">MOVE</code> instructions when advantageous for
 the currently selected CPU.
 For example, for 68000 and 68010 it is no advantage to optimize
 <code class="code">MOVEM Rm/Rn,-(An)</code>, and addressing modes with displacements
 or absolute addresses are optimized for 68040 only (may additionally
 require <samp class="option">-opt-speed</samp>).

</li><li><code class="code">MULS.?/MULU.? #0,Dn</code> optimized to <code class="code">MOVEQ #0,Dn</code>
(<samp class="option">-opt-mul</samp>).

</li><li><code class="code">MULS.?/MULU.? #1,Dn</code> is deleted (<samp class="option">-opt-mul</samp>).

</li><li><code class="code">MULS.W #-1,Dn</code> optimized to the sequence <code class="code">EXT.L Dn</code> and
<code class="code">NEG.L Dn</code> (<samp class="option">-opt-mul</samp> and <samp class="option">-opt-speed</samp>).

</li><li><code class="code">MULS.L #-1,Dn</code> optimized to <code class="code">NEG.L Dn</code> (<samp class="option">-opt-mul</samp>).

</li><li><code class="code">MULS.W #2..256,Dn</code> optimized to the sequence <code class="code">EXT.L Dn</code> and
<code class="code">ASL.L #x,Dn</code> (<samp class="option">-opt-mul</samp> and <samp class="option">-opt-speed</samp>).

</li><li><code class="code">MULS.W #-2..-256,Dn</code> optimized to the sequence <code class="code">EXT.L Dn</code>,
<code class="code">ASL.L #x,Dn</code> and <code class="code">NEG.L Dn</code> (<samp class="option">-opt-mul</samp> and <samp class="option">-opt-speed</samp>).

</li><li><code class="code">MULS.L #2..256,Dn</code> optimized to <code class="code">ASL.L #x,Dn</code>
(<samp class="option">-opt-mul</samp>).

</li><li><code class="code">MULS.L #-2..-256,Dn</code> optimized to the sequence <code class="code">ASL.L #x,Dn</code>
and <code class="code">NEG.L Dn</code> (<samp class="option">-opt-mul</samp> and <samp class="option">-opt-speed</samp>).

</li><li><code class="code">MULU.W #2..256,Dn</code> optimized to the sequence <code class="code">MVZ.W Dn,Dn</code> and
<code class="code">ASL.L #x,Dn</code> for ColdFire ISA_B/C (<samp class="option">-opt-mul</samp> and <samp class="option">-opt-speed</samp>).

</li><li><code class="code">MULU.L #2..256,Dn</code> optimized to <code class="code">LSL.L #x,Dn</code>
(<samp class="option">-opt-mul</samp>).

</li><li><code class="code">MVZ.? #x,Dn</code> and <code class="code">MVS.? #x,Dn</code> are optimized to
 <code class="code">MOVEQ #x,Dn</code>.

</li><li><code class="code">ORI.? #0,&lt;ea&gt;</code> optimized to <code class="code">TST.? &lt;ea&gt;</code>.

</li><li><code class="code">SUB.? #x,&lt;ea&gt;</code> optimized to <code class="code">SUBQ.? #x,&lt;ea&gt;</code>, when <code class="code">x</code> is
 between 1 and 8.

</li><li><code class="code">SUB.? #x,&lt;ea&gt;</code> optimized to <code class="code">ADDQ.? #x,&lt;ea&gt;</code>, when <code class="code">x</code> is
 between -1 and -8.

</li><li><code class="code">SUBA.? #x,An</code> translated to <code class="code">LEA (-x,An),An</code>, when <code class="code">x</code> is
 between -32767 and 32768.

</li></ul>

</div>
</div>
<div class="section-level-extent" id="Known-Problems-21">
<h3 class="section"><span>23.7 Known Problems<a class="copiable-link" href="#Known-Problems-21"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>In some rare cases, mainly by stupid input sources, the optimizer
might oscillate forever between two states. When this happens, assembly
will be terminated automatically after some time.

</li><li>When using <code class="code">FMOVE</code> immediate addressing modes, but without
specifying a size extension, constants between <code class="code">$80000000</code> and
<code class="code">$ffffffff</code> are stored with 32 bits, which leads to sign-extension
problems when the instruction is really 64 or 96 bits.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-21">
<h3 class="section"><span>23.8 Error Messages<a class="copiable-link" href="#Error-Messages-21"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: instruction not supported on selected architecture
</li><li>2002: illegal addressing mode
</li><li>2003: invalid register list
</li><li>2004: missing ) in register indirect addressing mode
</li><li>2005: address register required
</li><li>2006: bad size extension
</li><li>2007: displacement at bad position
</li><li>2008: base or index register expected
</li><li>2009: missing ] in memory indirect addressing mode
</li><li>2010: no extension allowed here
</li><li>2011: illegal scale factor
</li><li>2012: can&rsquo;t scale PC register
</li><li>2013: index register expected
</li><li>2014: too many ] in memory indirect addressing mode
</li><li>2015: missing outer displacement
</li><li>2016: %c expected
</li><li>2017: can&rsquo;t use PC register as index
</li><li>2018: double registers in list
</li><li>2019: data register required
</li><li>2020: illegal bitfield width/offset
</li><li>2021: constant integer expression required
</li><li>2022: value from -64 to 63 required for k-factor
</li><li>2023: need 32 bits to reference a program label
</li><li>2024: option expected
</li><li>2025: absolute value expected
</li><li>2026: operand value out of range: %ld (valid: %ld..%ld)
</li><li>2027: label in operand required
</li><li>2028: using signed operand as unsigned: %ld (valid: %ld..%ld), %ld to fix
</li><li>2029: branch destination out of range
</li><li>2030: displacement out of range
</li><li>2031: absolute displacement expected
</li><li>2032: unknown option %c%c ignored
</li><li>2033: absolute short address out of range
</li><li>2034: 8-bit branch with zero displacement was converted to 16-bit
</li><li>2035: illegal opcode extension
</li><li>2036: extension for unsized instruction ignored
</li><li>2037: immediate operand out of range
</li><li>2038: immediate operand has illegal type or size
</li><li>2039: data objects with %d bits size are not supported
</li><li>2040: data out of range
</li><li>2041: data has illegal type
</li><li>2042: illegal combination of ColdFire addressing modes
</li><li>2043: FP register required
</li><li>2044: unknown cpu type
</li><li>2045: register expected
</li><li>2046: link.w changed to link.l
</li><li>2047: branch out of range changed to jmp
</li><li>2048: lea-displacement out of range, changed into move/add
</li><li>2049: translated (A%d) into (0,A%d) for movep
</li><li>2050: operand optimized: %s
</li><li>2051: operand translated: %s
</li><li>2051: instruction optimized: %s
</li><li>2053: instruction translated: %s
</li><li>2054: branch optimized into: b&lt;cc&gt;.%c
</li><li>2055: branch translated into: b&lt;cc&gt;.%c
</li><li>2056: basereg A%d already in use
</li><li>2057: basereg A%d is already free
</li><li>2058: short-branch to following instruction turned into a nop
</li><li>2059: not a valid small data register
</li><li>2060: small data mode is not enabled
</li><li>2061: division by zero
</li><li>2062: can&rsquo;t use B%d register as index
</li><li>2063: register list on both sides
</li><li>2064: &quot;%s&quot; directive was replaced by an instruction with the same name
</li><li>2065: Addr.reg. operand at level #0 causes F-line exception
</li><li>2066: Dr and Dq are identical, transforming DIVxL.L effectively into DIVx.L
</li><li>2068: trailing garbage in operand
</li><li>2069: encoding absolute displacement directly
</li><li>2070: internal symbol %s has been modified
</li><li>2071: instruction too large for bank prefix
</li><li>2072: bad FPU id %d for selected cpu type
</li><li>2073: absolute k-factor without &rsquo;#&rsquo;
</li><li>2074: %d-bit access to absolute address
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="PowerPC-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#c16x_002fst10-cpu-module" accesskey="n" rel="next">c16x/st10 cpu module</a>, Previous: <a href="#M68k-cpu-module" accesskey="p" rel="prev">M68k cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="PowerPC-cpu-module-1"><span>24 PowerPC cpu module<a class="copiable-link" href="#PowerPC-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the Backend for the PowerPC microprocessor family.
</p>
<ul class="mini-toc">
<li><a href="#Legal-22" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-19" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-18" accesskey="3">General</a></li>
<li><a href="#Extensions-1" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-1" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-22" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-22" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-22">
<h3 class="section"><span>24.1 Legal<a class="copiable-link" href="#Legal-22"> &para;</a></span></h3>

<p>This module is written in 2002-2016 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-19">
<h3 class="section"><span>24.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-19"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-big</samp></dt>
<dd><p>Select big-endian mode.
</p>
</dd>
<dt><samp class="option">-little</samp></dt>
<dd><p>Select little-endian mode.
</p>
</dd>
<dt><samp class="option">-many</samp></dt>
<dd><p>Allow both, 32- and 64-bit instructions.
</p>
</dd>
<dt><samp class="option">-mavec, -maltivec</samp></dt>
<dd><p>Generate code for the Altivec unit.
</p>
</dd>
<dt><samp class="option">-mcom</samp></dt>
<dd><p>Allow only common PPC instructions.
</p>
</dd>
<dt><samp class="option">-m601</samp></dt>
<dd><p>Generate code for the PPC 601.
</p>
</dd>
<dt><samp class="option">-mppc32, -mppc, -m603, -m604</samp></dt>
<dd><p>Generate code for the 32-bit PowerPC 6xx family.
</p>
</dd>
<dt><samp class="option">-mppc64, -m620</samp></dt>
<dd><p>Generate code for the 64-bit PowerPC 600 family.
</p>
</dd>
<dt><samp class="option">-m7400, -m7410, -m7455</samp></dt>
<dd><p>Generate code for the 32-bit PowerPC 74xx (G4) family.
</p>
</dd>
<dt><samp class="option">-m7450</samp></dt>
<dd><p>Generate code for the 32-bit PowerPC 7450.
</p>
</dd>
<dt><samp class="option">-m403, -m405</samp></dt>
<dd><p>Generate code for the IBM/AMCC 32-bit embedded 40x family.
</p>
</dd>
<dt><samp class="option">-m440, -m460</samp></dt>
<dd><p>Generate code for the AMCC 32-bit embedded 440/460 family.
</p>
</dd>
<dt><samp class="option">-m821, -m850, -m860</samp></dt>
<dd><p>Generate code for the 32-bit MPC8xx PowerQUICC I family.
</p>
</dd>
<dt><samp class="option">-mbooke</samp></dt>
<dd><p>Generate code for the 32-bit Book-E architecture.
</p>
</dd>
<dt><samp class="option">-me300</samp></dt>
<dd><p>Generate code for the 32-bit e300 core (MPC51xx, MPC52xx, MPC83xx).
</p>
</dd>
<dt><samp class="option">-me500</samp></dt>
<dd><p>Generate code for the 32-bit e500 core (MPC85xx), including SPE,
        EFS and PMR.
</p>
</dd>
<dt><samp class="option">-mpwr</samp></dt>
<dd><p>Generate code for the POWER family.
</p>
</dd>
<dt><samp class="option">-mpwrx, -mpwr2</samp></dt>
<dd><p>Generate code for the POWER2 family.
</p>
</dd>
<dt><samp class="option">-no-regnames</samp></dt>
<dd><p>Don&rsquo;t predefine any register-name symbols.
</p>
</dd>
<dt><samp class="option">-opt-branch</samp></dt>
<dd><p>Enables translation of 16-bit branches into
        &quot;B&lt;!cc&gt; $+8 ; B label&quot; sequences when destination is out of range.
</p>
</dd>
<dt><samp class="option">-sd2reg=&lt;n&gt;</samp></dt>
<dd><p>Sets the 2nd small data base register to <code class="code">Rn</code>.
</p>
</dd>
<dt><samp class="option">-sdreg=&lt;n&gt;</samp></dt>
<dd><p>Sets small data base register to <code class="code">Rn</code>.
</p>
</dd>
</dl>
<p>The default setting is to generate code for a 32-bit PPC G2, G3, G4 CPU
with Altivec support.
</p>
</div>
<div class="section-level-extent" id="General-18">
<h3 class="section"><span>24.3 General<a class="copiable-link" href="#General-18"> &para;</a></span></h3>

<p>This backend accepts PowerPC instructions as described in the
instruction set manuals from IBM, Motorola, Freescale and AMCC.
</p>
<p>The full instruction set of the following families is supported:
POWER, POWER2, 40x, 44x, 46x, 60x, 620, 750, 74xx, 860, Book-E,
e300 and e500.
</p>
<p>The target address type is 32 or 64 bits, depending on the selected
CPU model. Floating point constants in instructions and data are
supported and encoded in IEEE format.
</p>
<p>Default alignment for sections and instructions is 4 bytes. Data is
aligned to its natural alignment by default.
</p>
</div>
<div class="section-level-extent" id="Extensions-1">
<h3 class="section"><span>24.4 Extensions<a class="copiable-link" href="#Extensions-1"> &para;</a></span></h3>

<p>This backend provides the following specific extensions:
</p>
<ul class="itemize mark-minus">
<li>When not disabled by the option <code class="code">-no-regnames</code>, the registers r0 - r31,
 f0 - f31, v0 - v31, cr0 - cr7, vrsave, sp, rtoc, fp, fpscr, xer, lr, ctr,
 and the symbols lt, gt, so and un will be predefined on startup and may
 be referenced by the program.

</li></ul>

<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl class="table">
<dt><code class="code">.sdreg &lt;n&gt;</code></dt>
<dd><p>Sets the small data base register to <code class="code">Rn</code>.
</p>
</dd>
<dt><code class="code">.sd2reg &lt;n&gt;</code></dt>
<dd><p>Sets the 2nd small data base register to <code class="code">Rn</code>.
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="Optimizations-1">
<h3 class="section"><span>24.5 Optimizations<a class="copiable-link" href="#Optimizations-1"> &para;</a></span></h3>

<p>This backend performs the following optimizations:
</p>
<ul class="itemize mark-minus">
<li>16-bit branches, where the destination is out of range, are translated
 into <code class="code">B&lt;!cc&gt; $+8</code> and a 26-bit unconditional branch.

</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-22">
<h3 class="section"><span>24.6 Known Problems<a class="copiable-link" href="#Known-Problems-22"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>No real differentiation between 403, 750, 860 instructions
      at the moment.
</li><li>There may still be some unsupported PPC models.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-22">
<h3 class="section"><span>24.7 Error Messages<a class="copiable-link" href="#Error-Messages-22"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2002: instruction not supported on selected architecture
</li><li>2003: constant integer expression required
</li><li>2004: trailing garbage in operand
</li><li>2005: illegal operand type
</li><li>2006: missing closing parenthesis in load/store addressing mode
</li><li>2007: relocation does not allow hi/lo modifier
</li><li>2008: multiple relocation attributes
</li><li>2009: multiple hi/lo modifiers
</li><li>2010: data size %d not supported
</li><li>2011: data has illegal type
</li><li>2012: relocation attribute not supported by operand
</li><li>2013: operand out of range: %ld (allowed: %ld to %ld)
</li><li>2014: not a valid register (0-31)
</li><li>2015: missing base register in load/store addressing mode
</li><li>2016: missing mandatory operand
</li><li>2017: ignoring fake operand
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="c16x_002fst10-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#g_t6502-cpu-module" accesskey="n" rel="next">6502 cpu module</a>, Previous: <a href="#PowerPC-cpu-module" accesskey="p" rel="prev">PowerPC cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="c16x_002fst10-cpu-module-1"><span>25 c16x/st10 cpu module<a class="copiable-link" href="#c16x_002fst10-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the Backend for the c16x/st10 microcontroller family.
</p>
<p>Note that this module is not yet fully completed!
</p>
<ul class="mini-toc">
<li><a href="#Legal-23" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-20" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-19" accesskey="3">General</a></li>
<li><a href="#Extensions-2" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-2" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-23" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-23" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-23">
<h3 class="section"><span>25.1 Legal<a class="copiable-link" href="#Legal-23"> &para;</a></span></h3>

<p>This module is written in 2002-2004 by Volker Barthelmann and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-20">
<h3 class="section"><span>25.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-20"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-no-translations</samp></dt>
<dd><p>Do not translate between jump instructions.
        If the offset of a <code class="code">jmpr</code>
        instruction is too large, it will not be translated to
        <code class="code">jmps</code> but an error will be emitted.
</p>
<p>Also, <code class="code">jmpa</code> will not be optimized to <code class="code">jmpr</code>.
</p>
<p>The pseudo-instruction <code class="code">jmp</code> will still be translated.
</p>
</dd>
<dt><samp class="option">-jmpa</samp></dt>
<dd><p>A <code class="code">jmp</code> or <code class="code">jmpr</code> instruction that is translated due to
        its offset being larger than 8 bits will be translated to a
        <code class="code">jmpa</code> rather than a <code class="code">jmps</code>, if possible.
</p>
</dd>
</dl>

</div>
<div class="section-level-extent" id="General-19">
<h3 class="section"><span>25.3 General<a class="copiable-link" href="#General-19"> &para;</a></span></h3>

<p>This backend accepts c16x/st10 instructions as described in the
Infineon instruction set manuals.
</p>
<p>The target address type is 32bit.
</p>
<p>Default alignment for sections and instructions is 2 bytes.
</p>
</div>
<div class="section-level-extent" id="Extensions-2">
<h3 class="section"><span>25.4 Extensions<a class="copiable-link" href="#Extensions-2"> &para;</a></span></h3>

<p>This backend provides the following specific extensions:
</p>
<ul class="itemize mark-minus">
<li>There is a pseudo instruction <code class="code">jmp</code> that will be translated
        either to a <code class="code">jmpr</code> or <code class="code">jmpa</code> instruction, depending on
        the offset.

</li><li>The <code class="code">sfr</code> pseudo opcode can be used to declare special function
        registers. It has two, three of four arguments. The first argument
        is the identifier to be declared as special function register.
        The second argument is either the 16bit sfr address or its 8bit base
        address (0xfe for normal sfrs and
        0xf0 for extended special function registers). In the latter case,
        the third argument is
        the 8bit sfr number. If another argument is given, it specifies the
        bit-number in the sfr (i.e. the declaration declares a single bit).

<p>Example:
</p><div class="example">
<pre class="example-preformatted">.sfr    zeros,0xfe,0x8e
</pre></div>

</li><li><code class="code">SEG</code> and <code class="code">SOF</code> can be used to obtain the segment or
        segment offset of a full address.
Example:
<div class="example">
<pre class="example-preformatted">        mov r3,#SEG farfunc
</pre></div>

</li></ul>

</div>
<div class="section-level-extent" id="Optimizations-2">
<h3 class="section"><span>25.5 Optimizations<a class="copiable-link" href="#Optimizations-2"> &para;</a></span></h3>

<p>This backend performs the following optimizations:
</p>
<ul class="itemize mark-minus">
<li><code class="code">jmp</code> is translated to <code class="code">jmpr</code>, if possible. Also, if
        <samp class="option">-no-translations</samp> was not specified, <code class="code">jmpr</code> and
        <code class="code">jmpa</code> are translated.

</li><li>Relative jump instructions with an offset that does not fit into
        8 bits are translated to a <code class="code">jmps</code> instruction or an inverted
        jump around a <code class="code">jmps</code> instruction.

</li><li>For instruction that have two forms <code class="code">gpr,#IMM3/4</code> and
        <code class="code">reg,#IMM16</code> the smaller form is used, if possible.

</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-23">
<h3 class="section"><span>25.6 Known Problems<a class="copiable-link" href="#Known-Problems-23"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Lots...

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-23">
<h3 class="section"><span>25.7 Error Messages<a class="copiable-link" href="#Error-Messages-23"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: illegal operand
</li><li>2002: word register expected
</li><li>2004: value does not find in %d bits
</li><li>2005: data size not supported
</li><li>2006: illegal use of SOF
</li><li>2007: illegal use of SEG
</li><li>2008: illegal use of DPP prefix
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="g_t6502-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#SPC700-cpu-module" accesskey="n" rel="next">SPC700 cpu module</a>, Previous: <a href="#c16x_002fst10-cpu-module" accesskey="p" rel="prev">c16x/st10 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="g_t6502-cpu-module-1"><span>26 6502 cpu module<a class="copiable-link" href="#g_t6502-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the MOS/Rockwell 6502
microprocessor family. It also supports the Rockwell/WDC 65C02,
the 45GS02 from the MEGA65 project, the Hudson Soft HuC6280
and the WDC 65802/65816 instruction sets.
</p>
<ul class="mini-toc">
<li><a href="#Legal-24" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-21" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-20" accesskey="3">General</a></li>
<li><a href="#Extensions-3" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-3" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-24" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-24" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-24">
<h3 class="section"><span>26.1 Legal<a class="copiable-link" href="#Legal-24"> &para;</a></span></h3>

<p>This module is written in 2002,2006,2008-2012,2014-2024 by Frank Wille
    and is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-21">
<h3 class="section"><span>26.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-21"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-6280</samp></dt>
<dd><p>Recognize all HuC6280 instructions. Includes <code class="code">setdp $2000</code>, so
        zero-page addressing modes will be automatically used from
        <code class="code">$2000</code> to <code class="code">$20ff</code>.
    </p></dd>
<dt><samp class="option">-802</samp></dt>
<dd><p>Same as <samp class="option">-816</samp>. There is no difference in the instruction set.
    </p></dd>
<dt><samp class="option">-816</samp></dt>
<dd><p>Enables the 8/16 bit instruction set for the WDC65816/65802 and
        additional directives to switch loading of the accumulator and/or
        the index register between 8 and 16 bits.
        The target address size becomes 24 bits.
    </p></dd>
<dt><samp class="option">-am</samp></dt>
<dd><p>Automatically mask values to match their data size or the size
        of immediate addressing, which effectively disables any range
        checks on immediate and data values in the assembler and linker.
    </p></dd>
<dt><samp class="option">-bbcade</samp></dt>
<dd><p>Swap meaning of <code class="code">&lt;</code> and <code class="code">&gt;</code> selectors for compatibility
        with the BBC ADE assembler.
    </p></dd>
<dt><samp class="option">-c02</samp></dt>
<dd><p>Recognize all 65C02 instructions. This excludes DTV (<samp class="option">-dtv</samp>)
        and illegal (<samp class="option">-illegal</samp>) instructions.
    </p></dd>
<dt><samp class="option">-ce02</samp></dt>
<dd><p>Enables the Commodore CSG65CE02 instruction set, which extends on
        the WDC02 instruction set.
    </p></dd>
<dt><samp class="option">-dpo</samp></dt>
<dd><p>Generate 8-bit offset instead of absolute relocations when
        accessing a zero- or direct-page symbol.
    </p></dd>
<dt><samp class="option">-dtv</samp></dt>
<dd><p>Recognize the three additional C64-DTV instructions.
    </p></dd>
<dt><samp class="option">-illegal</samp></dt>
<dd><p>Allow &rsquo;illegal&rsquo; 6502 instructions to be recognized.
    </p></dd>
<dt><samp class="option">-mega65</samp></dt>
<dd><p>Enables the 45GS02 instruction set for the MEGA65 computer.
    </p></dd>
<dt><samp class="option">-opt-branch</samp></dt>
<dd><p>Enables translation of <code class="code">B&lt;cc&gt;</code> branches into sequences of
        <code class="code">B&lt;!cc&gt; *+5 ; JMP label</code> when necessary. <code class="code">BRA</code> (DTV, 65C02)
        is directly translated into a <code class="code">JMP</code> when out of range.
        It also performs optimization of <code class="code">JMP</code> to <code class="code">BRA</code>,
        whenever possible.
    </p></dd>
<dt><samp class="option">-wdc02</samp></dt>
<dd><p>Recognize all 65C02 instructions and the WDC65C02 extensions
        (<code class="code">RMB</code>, <code class="code">SMB</code>, <code class="code">BBR</code>, <code class="code">BBS</code>, <code class="code">STP</code>, <code class="code">WAI)</code>.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-20">
<h3 class="section"><span>26.3 General<a class="copiable-link" href="#General-20"> &para;</a></span></h3>

<p>This backend accepts 6502 family instructions as described in
the instruction set reference manuals from MOS and Rockwell, which are valid
for the following CPUs: 6502 - 6518, 6570, 6571, 6702, 7501, 8500, 8502.
</p>
<p>Optionally accepts 65C02 family instructions as described in the
instruction set reference manuals from Rockwell and WDC. Also supports
the WDC extensions in the W65C02 and W65C134.
</p>
<p>Optionally accepts 65CE02 family instructions as described in the
instruction set reference manuals from Commodore Semiconductor Group.
</p>
<p>Optionally accepts HuC6280 instructions as described in the instruction
set reference manuals from Hudson Soft.
</p>
<p>Optionally accepts 45GS02 instructions as defined by the Mega65 project.
</p>
<p>Optionally accepts WDC65816 insructions as described in the Programming
Manual by The Western Design Center.
</p>
<p>The target address type is 16 bits, or 24 bits in WDC65816 mode.
</p>
<p>Instructions consist of one up to three bytes for the standard 6502 family
(up to 7 bytes for the 6280) and require no alignment.
There is also no alignment requirement for sections and data.
</p>
<p>All known mnemonics for illegal 6502 instructions are optionally recognized
(e.g. <code class="code">dcm</code> and <code class="code">dcp</code> refer to the same instruction). Some illegal
insructions (e.g. <code class="code">$ab</code>) are known to show unpredictable behaviour,
or do not always work the same on different CPUs.
</p>
<p>Note that the WDC65816&rsquo;s <code class="code">MVN</code> and <code class="code">MVP</code> block move instructions
require a full 24-bit address (or a label) for the source and destination,
as documented in WDC&rsquo;s Programming Manual. To specify the bank only, you
have to use immediate addressing syntax. Example: <code class="code">mvn #$7f,#^label</code>.
</p>
</div>
<div class="section-level-extent" id="Extensions-3">
<h3 class="section"><span>26.4 Extensions<a class="copiable-link" href="#Extensions-3"> &para;</a></span></h3>

<p>Note that some of these extensions have changed with version 1.0 of
this backend. Bitstream-selectors (to get the low-byte, high-byte, etc. of
an expression) are no longer available as unary operators, to avoid
inconsistencies, and to better conform with classic assemblers and the
official WDC syntax.
</p>
<p>This backend provides the following specific extensions:
</p>
<ul class="itemize mark-minus">
<li>Immediate addressing mode operands and data directives allow
 bitstream selector prefixes as the first character in the operand.
 <code class="code">&lt;</code> selects the least significant bits which fit into the current
 immediate or data field width (AKA low-byte for 8-bit data).
 <code class="code">&gt;</code> selects the same, but shifts the value right by 8 bits first
 (AKA high-byte for 8-bit data).
 <code class="code">^</code> or <code class="code">`</code> shifts the value by 16 bits first (AKA bank-byte
 for 8-bit data).
 Refer to chapter 6.3.3.4 (Byte Selection Operator) of the W65C816S datasheet.
 These selector prefixes are always valid, no matter if 6502 or 65816
 mode is active.
 See also option <samp class="option">-bbcade</samp>, which swaps the meaning of the <code class="code">&lt;</code>
 and <code class="code">&gt;</code> selectors.

</li><li>Other operands allow an addressing mode selector prefix as the
 first character in the operand field, which can be used as a hint for the
 assembler in case the best addressing mode cannot be determined (e.g.
 externally defined symbols), or to enforce a specific addressing mode
 (Example: <code class="code">lda &gt;$12</code> to enforce a 16-bit instead of a zero-page address).
 <code class="code">&lt;</code> enforces 8-bit (direct/zero-page) addressing.
 <code class="code">|</code> or <code class="code">!</code> enforces 16-bit (absolute) addressing.
 <code class="code">&gt;</code> enforces 24-bit (long absolute) addressing in 65816 mode, 16-bit
 otherwise.
 Refer to chapter 6.3.3.5 of the W65C816S datasheet.

</li><li>The prefix character <code class="code">?</code> can be used in immediate addressing
 modes and data directives to retrieve a symbol&rsquo;s memory/bank ID. Note,
 that this feature depends on a special relocation type, which is only
 supported by <code class="code">vlink</code> and requires the <code class="code">VOBJ</code> format.

</li></ul>

<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl class="table">
<dt><code class="code">a8</code></dt>
<dd><p>Declares that immediate instructions accessing the accumulator
      have 8 bits width (default, WDC65816 only).
</p>
</dd>
<dt><code class="code">a16</code></dt>
<dd><p>Declares that immediate instructions accessing the accumulator
      have 16 bits width (WDC65816 only).
</p>
</dd>
<dt><code class="code">as</code></dt>
<dd><p>Alias for <code class="code">a8</code> (WDC65816 only).
</p>
</dd>
<dt><code class="code">al</code></dt>
<dd><p>Alias for <code class="code">a16</code> (WDC65816 only).
</p>
</dd>
<dt><code class="code">cpu &lt;name&gt;</code></dt>
<dd><p>Define the cpu model. Must be specified before any code is generated
      and has priority over cpu settings on the command line.
      Most common names are recognized, like: <code class="code">65c02</code>, <code class="code">wdc02</code>,
      <code class="code">65816</code>, <code class="code">HU6280</code>, <code class="code">45gs02</code>, <code class="code">6510</code>, etc.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; ezp &lt;expr&gt;</code></dt>
<dd><p>Works exactly like the <code class="code">equ</code> directive, but marks &lt;symbol&gt;
      as a zero/direct page symbol and use zero page addressing whenever
      &lt;symbol&gt; is used in a memory addressing mode.
</p>
</dd>
<dt><code class="code">longa on|off</code></dt>
<dd><p>Turns 16-bit accumulator width on or off.
      WDC-style alias for <code class="code">a16</code>/<code class="code">a8</code> (WDC65816 only).
</p>
</dd>
<dt><code class="code">longi on|off</code></dt>
<dd><p>Turns 16-bit index register width on or off.
      WDC-style alias for <code class="code">x16</code>/<code class="code">x8</code> (WDC65816 only).
</p>
</dd>
<dt><code class="code">setdp &lt;expr&gt;</code></dt>
<dd><p>Set the current base address of the zero/direct page for
      optimizations from absolute to direct-page addressing modes.
      Can be set to any 16-bit address on 65816 (defaults to zero).
      Is preset to <code class="code">$2000</code> for the HuC6280/PC-Engine.
</p>
</dd>
<dt><code class="code">x8</code></dt>
<dd><p>Declares that immediate instructions accessing the index registers
      have 8 bits width (default, WDC65816 only).
</p>
</dd>
<dt><code class="code">x16</code></dt>
<dd><p>Declares that immediate instructions accessing the index registers
      have 16 bits width (WDC65816 only).
</p>
</dd>
<dt><code class="code">xs</code></dt>
<dd><p>Alias for <code class="code">x8</code> (WDC65816 only).
</p>
</dd>
<dt><code class="code">xl</code></dt>
<dd><p>Alias for <code class="code">x16</code> (WDC65816 only).
</p>
</dd>
<dt><code class="code">zero</code></dt>
<dd><p>Switch to a zero/direct page section called <code class="code">zero</code> or <code class="code">.zero</code>,
      which has the type <code class="code">bss</code> with attributes <code class="code">&quot;aurwz&quot;</code>.
      Accesses to symbols from this section will default to zero page
      addressing mode.
</p>
</dd>
<dt><code class="code">zpage &lt;symbol1&gt; [,&lt;symbol2&gt;...]</code></dt>
<dd><p>Mark symbols as zero/direct page and use zero page addressing for
      expressions based on this symbol, unless overridden by an addressing
      mode selector (like <code class="code">&gt;</code>).
</p></dd>
</dl>

<p>All these directives are also available in the form starting with a
dot (<code class="code">.</code>).
</p>
</div>
<div class="section-level-extent" id="Optimizations-3">
<h3 class="section"><span>26.5 Optimizations<a class="copiable-link" href="#Optimizations-3"> &para;</a></span></h3>

<p>This backend performs the following operand optimizations and translations:
</p>
<ul class="itemize mark-minus">
<li>Absolute addressing modes are optimized to zero-page (or direct-page)
  addressing modes, whenever possible.
</li><li>An absolute addressing mode will be promoted to long addressing
  (24 bits) for the WDC65816, when needed.
</li><li>Conditional branches, where the destination is out of range, are
  translated into <code class="code">B&lt;!cc&gt; *+5</code> and an absolute <code class="code">JMP</code> instruction
  (<samp class="option">-opt-branch</samp>).
</li><li>Some CPUs also allow optimization of <code class="code">JMP</code> to <code class="code">BRA</code>,
  when <samp class="option">-opt-branch</samp> was given.

</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-24">
<h3 class="section"><span>26.6 Known Problems<a class="copiable-link" href="#Known-Problems-24"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None?

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-24">
<h3 class="section"><span>26.7 Error Messages<a class="copiable-link" href="#Error-Messages-24"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: instruction not supported on selected architecture
</li><li>2002: trailing garbage in operand
</li><li>2003: selector prefix ignored
</li><li>2004: data size %d not supported
</li><li>2005: relocation does not allow hi/lo modifier
</li><li>2006: operand doesn&rsquo;t fit into %d bits
</li><li>2007: branch destination out of range
</li><li>2008: illegal bit number
</li><li>2009: identifier expected
</li><li>2010: bad operand
</li><li>2011: zero/direct-page addressing not available
</li><li>2012: operand not in zero/direct-page range
</li><li>2013: absolute-long addressing not available
</li><li>2014: cpu must be defined before any code is generated
</li><li>2015: unknown cpu model: %s

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="SPC700-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#ARM-cpu-module" accesskey="n" rel="next">ARM cpu module</a>, Previous: <a href="#g_t6502-cpu-module" accesskey="p" rel="prev">6502 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="SPC700-cpu-module-1"><span>27 SPC700 cpu module<a class="copiable-link" href="#SPC700-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the SONY SPC700 CPU.
</p>
<ul class="mini-toc">
<li><a href="#Legal-25" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-22" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-21" accesskey="3">General</a></li>
<li><a href="#Extensions-4" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-4" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-25" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-25" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-25">
<h3 class="section"><span>27.1 Legal<a class="copiable-link" href="#Legal-25"> &para;</a></span></h3>

<p>This module is written in 2025 by Frank Wille
    and is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-22">
<h3 class="section"><span>27.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-22"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-am</samp></dt>
<dd><p>Automatically mask values to match their data size or the size
        of immediate addressing, which effectively disables any range
        checks on immediate and data values in the assembler and linker.
    </p></dd>
<dt><samp class="option">-dpo</samp></dt>
<dd><p>Generate 8-bit offset instead of absolute relocations when
        accessing a zero- or direct-page symbol.
    </p></dd>
<dt><samp class="option">-opt-branch</samp></dt>
<dd><p>Enables translation of <code class="code">B&lt;cc&gt;</code> branches into sequences of
        <code class="code">B&lt;!cc&gt; *+5 ; JMP label</code> when necessary. <code class="code">BRA</code>
        is directly translated into a <code class="code">JMP</code> when out of range.
        It also performs optimization of <code class="code">JMP</code> to <code class="code">BRA</code>,
        whenever possible.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-21">
<h3 class="section"><span>27.3 General<a class="copiable-link" href="#General-21"> &para;</a></span></h3>

<p>This backend accepts SPC700 instructions using the official names and
syntax as provided by Sony.
</p>
<p>The target address type is 16 bits.
</p>
<p>Instructions consist of one up to three bytes and require no alignment.
There is also no alignment requirement for sections and data.
</p>
</div>
<div class="section-level-extent" id="Extensions-4">
<h3 class="section"><span>27.4 Extensions<a class="copiable-link" href="#Extensions-4"> &para;</a></span></h3>

<p>This backend provides the following specific extensions:
</p>
<ul class="itemize mark-minus">
<li>Immediate addressing mode operands and data directives allow
 bitstream selector prefixes as the first character in the operand.
 <code class="code">&lt;</code> selects the least significant bits which fit into the current
 immediate or data field width (AKA low-byte for 8-bit data).
 <code class="code">&gt;</code> selects the same, but shifts the value right by 8 bits first
 (AKA high-byte for 8-bit data).

</li><li>The prefix character <code class="code">?</code> can be used in immediate addressing
 modes and data directives to retrieve a symbol&rsquo;s memory/bank ID. Note,
 that this feature depends on a special relocation type, which is only
 supported by <code class="code">vlink</code> and requires the <code class="code">VOBJ</code> format.

</li><li>The prefix character <code class="code">!</code> can be used to enforce 16-bit addressing
 modes. Otherwise the assembler tries to optimize operands to
 direct page (8-bit) addressing whenever possible.

</li></ul>

<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl class="table">
<dt><code class="code">&lt;symbol&gt; equd &lt;expr&gt;</code></dt>
<dd><p>Works exactly like the <code class="code">equ</code> directive, but marks &lt;symbol&gt;
      as a direct page symbol and use direct page addressing whenever
      &lt;symbol&gt; is used in a memory addressing mode.
</p>
</dd>
<dt><code class="code">p0</code></dt>
<dd><p>Informs the assembler about the current state of the <code class="code">P</code> flag.
      <code class="code">P0</code> assumes the direct page to reside at <code class="code">$0000</code> (default).
      This information is used to decide whether absolute address references
      can be optimized to direct page addressing modes.
</p>
</dd>
<dt><code class="code">p1</code></dt>
<dd><p>Informs the assembler about the current state of the <code class="code">P</code> flag.
      <code class="code">P1</code> assumes the direct page to reside at <code class="code">$0100</code>.
      This information is used to decide whether absolute address references
      can be optimized to direct page addressing modes.
</p>
</dd>
<dt><code class="code">direct</code></dt>
<dd><p>Switch to a direct page section called <code class="code">direct</code> or <code class="code">.direct</code>,
      which has the type <code class="code">bss</code> with attributes <code class="code">&quot;aurwz&quot;</code>.
      Accesses to symbols from this section will default to direct page
      addressing mode.
</p>
</dd>
<dt><code class="code">dpage &lt;symbol1&gt; [,&lt;symbol2&gt;...]</code></dt>
<dd><p>Mark symbols as direct page and use direct page addressing for
      expressions based on this symbol, unless overridden by the addressing
      mode selector <code class="code">!</code>.
</p></dd>
</dl>

<p>All these directives are also available in the form starting with a
dot (<code class="code">.</code>).
</p>
</div>
<div class="section-level-extent" id="Optimizations-4">
<h3 class="section"><span>27.5 Optimizations<a class="copiable-link" href="#Optimizations-4"> &para;</a></span></h3>

<p>This backend performs the following operand optimizations and translations:
</p>
<ul class="itemize mark-minus">
<li>Absolute addressing modes are optimized to direct-page
  addressing modes, whenever possible.
</li><li>Conditional branches, where the destination is out of range, are
  translated into <code class="code">B&lt;!cc&gt; *+5</code> and an absolute <code class="code">JMP</code> instruction
  (<samp class="option">-opt-branch</samp>).
</li><li><code class="code">JMP</code> may be optimized to <code class="code">BRA</code>, when <samp class="option">-opt-branch</samp>
  was given.

</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-25">
<h3 class="section"><span>27.6 Known Problems<a class="copiable-link" href="#Known-Problems-25"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None?

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-25">
<h3 class="section"><span>27.7 Error Messages<a class="copiable-link" href="#Error-Messages-25"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: instruction not supported on selected architecture
</li><li>2002: trailing garbage in operand
</li><li>2003: selector prefix ignored
</li><li>2004: data size %d not supported
</li><li>2005: operand doesn&rsquo;t fit into %d bits
</li><li>2006: branch destination out of range
</li><li>2007: illegal bit number
</li><li>2008: identifier expected
</li><li>2009: operand not in direct-page range
</li><li>2010: unsuitable addressing mode for retrieving memory id
</li><li>2011: no memory id defined, assuming 0

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="ARM-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#g_t80x86-cpu-module" accesskey="n" rel="next">80x86 cpu module</a>, Previous: <a href="#SPC700-cpu-module" accesskey="p" rel="prev">SPC700 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="ARM-cpu-module-1"><span>28 ARM cpu module<a class="copiable-link" href="#ARM-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the Advanced RISC Machine (ARM)
microprocessor family.
</p>
<ul class="mini-toc">
<li><a href="#Legal-26" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-23" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-22" accesskey="3">General</a></li>
<li><a href="#Extensions-5" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-5" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-26" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-26" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-26">
<h3 class="section"><span>28.1 Legal<a class="copiable-link" href="#Legal-26"> &para;</a></span></h3>

<p>This module is written in 2004,2006,2010-2015 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-23">
<h3 class="section"><span>28.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-23"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-a2</samp></dt>
<dd><p>Generate code compatible with ARM V2 architecture.
</p>
</dd>
<dt><samp class="option">-a3</samp></dt>
<dd><p>Generate code compatible with ARM V3 architecture.
</p>
</dd>
<dt><samp class="option">-a3m</samp></dt>
<dd><p>Generate code compatible with ARM V3m architecture.
</p>
</dd>
<dt><samp class="option">-a4</samp></dt>
<dd><p>Generate code compatible with ARM V4 architecture.
</p>
</dd>
<dt><samp class="option">-a4t</samp></dt>
<dd><p>Generate code compatible with ARM V4t architecture.
</p>
</dd>
<dt><samp class="option">-big</samp></dt>
<dd><p>Output big-endian code and data.
</p>
</dd>
<dt><samp class="option">-little</samp></dt>
<dd><p>Output little-endian code and data (default).
</p>
</dd>
<dt><samp class="option">-m2</samp></dt>
<dd><p>Generate code for the ARM2 CPU.
</p>
</dd>
<dt><samp class="option">-m250</samp></dt>
<dd><p>Generate code for the ARM250 CPU.
</p>
</dd>
<dt><samp class="option">-m3</samp></dt>
<dd><p>Generate code for the ARM3 CPU.
</p>
</dd>
<dt><samp class="option">-m6</samp></dt>
<dd><p>Generate code for the ARM6 CPU.
</p>
</dd>
<dt><samp class="option">-m600</samp></dt>
<dd><p>Generate code for the ARM600 CPU.
</p>
</dd>
<dt><samp class="option">-m610</samp></dt>
<dd><p>Generate code for the ARM610 CPU.
</p>
</dd>
<dt><samp class="option">-m7</samp></dt>
<dd><p>Generate code for the ARM7 CPU.
</p>
</dd>
<dt><samp class="option">-m710</samp></dt>
<dd><p>Generate code for the ARM710 CPU.
</p>
</dd>
<dt><samp class="option">-m7500</samp></dt>
<dd><p>Generate code for the ARM7500 CPU.
</p>
</dd>
<dt><samp class="option">-m7d</samp></dt>
<dd><p>Generate code for the ARM7d CPU.
</p>
</dd>
<dt><samp class="option">-m7di</samp></dt>
<dd><p>Generate code for the ARM7di CPU.
</p>
</dd>
<dt><samp class="option">-m7dm</samp></dt>
<dd><p>Generate code for the ARM7dm CPU.
</p>
</dd>
<dt><samp class="option">-m7dmi</samp></dt>
<dd><p>Generate code for the ARM7dmi CPU.
</p>
</dd>
<dt><samp class="option">-m7tdmi</samp></dt>
<dd><p>Generate code for the ARM7tdmi CPU.
</p>
</dd>
<dt><samp class="option">-m8</samp></dt>
<dd><p>Generate code for the ARM8 CPU.
</p>
</dd>
<dt><samp class="option">-m810</samp></dt>
<dd><p>Generate code for the ARM810 CPU.
</p>
</dd>
<dt><samp class="option">-m9</samp></dt>
<dd><p>Generate code for the ARM9 CPU.
</p>
</dd>
<dt><samp class="option">-m9</samp></dt>
<dd><p>Generate code for the ARM9 CPU.
</p>
</dd>
<dt><samp class="option">-m920</samp></dt>
<dd><p>Generate code for the ARM920 CPU.
</p>
</dd>
<dt><samp class="option">-m920t</samp></dt>
<dd><p>Generate code for the ARM920t CPU.
</p>
</dd>
<dt><samp class="option">-m9tdmi</samp></dt>
<dd><p>Generate code for the ARM9tdmi CPU.
</p>
</dd>
<dt><samp class="option">-msa1</samp></dt>
<dd><p>Generate code for the SA1 CPU.
</p>
</dd>
<dt><samp class="option">-mstrongarm</samp></dt>
<dd><p>Generate code for the STRONGARM CPU.
</p>
</dd>
<dt><samp class="option">-mstrongarm110</samp></dt>
<dd><p>Generate code for the STRONGARM110 CPU.
</p>
</dd>
<dt><samp class="option">-mstrongarm1100</samp></dt>
<dd><p>Generate code for the STRONGARM1100 CPU.
</p>
</dd>
<dt><samp class="option">-opt-adr</samp></dt>
<dd><p>The <code class="code">ADR</code> directive will be automatically converted into
        <code class="code">ADRL</code> if required (which inserts an additional
        <code class="code">ADD</code>/<code class="code">SUB</code> to calculate an address).
</p>
</dd>
<dt><samp class="option">-opt-ldrpc</samp></dt>
<dd><p>The maximum range in which PC-relative symbols can be accessed
        through <code class="code">LDR</code> and <code class="code">STR</code> is extended from +/-4KB to +/-1MB
        (or +/-256 Bytes to +/-65536 Bytes when accessing half-words).
        This is done by automatically inserting an additional <code class="code">ADD</code>
        or <code class="code">SUB</code> instruction before the <code class="code">LDR</code>/<code class="code">STR</code>.
</p>
</dd>
<dt><samp class="option">-thumb</samp></dt>
<dd><p>Start assembling in Thumb mode.
</p></dd>
</dl>


</div>
<div class="section-level-extent" id="General-22">
<h3 class="section"><span>28.3 General<a class="copiable-link" href="#General-22"> &para;</a></span></h3>

<p>This backend accepts ARM instructions as described in various ARM CPU
data sheets. Additionally some architectures support a second, more
dense, instruction set, called THUMB. There are special directives
to switch between these two instruction sets.
</p>
<p>The target address type is 32bit.
</p>
<p>Default alignment for instructions is 4 bytes for ARM and 2 bytes for
THUMB. Sections will be aligned to 4 bytes by default. Data is
aligned to its natural alignment by default.
</p>

</div>
<div class="section-level-extent" id="Extensions-5">
<h3 class="section"><span>28.4 Extensions<a class="copiable-link" href="#Extensions-5"> &para;</a></span></h3>

<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl class="table">
<dt><code class="code">.arm</code></dt>
<dd><p>Generate 32-bit ARM code.
</p>
</dd>
<dt><code class="code">.thumb</code></dt>
<dd><p>Generate 16-bit THUMB code.
</p></dd>
</dl>


</div>
<div class="section-level-extent" id="Optimizations-5">
<h3 class="section"><span>28.5 Optimizations<a class="copiable-link" href="#Optimizations-5"> &para;</a></span></h3>

<p>This backend performs the following optimizations and translations for
the ARM instruction set:
</p>
<ul class="itemize mark-minus">
<li><code class="code">LDR/STR Rd,symbol</code>, with a distance between symbol and PC larger
 than 4KB, is translated to
 <code class="code">ADD/SUB Rd,PC,#offset&amp;0xff000</code> +
 <code class="code">LDR/STR Rd,[Rd,#offset&amp;0xfff]</code>, when allowed by the option
 <code class="code">-opt-ldrpc</code>.

</li><li><code class="code">ADR Rd,symbol</code> is translated to
 <code class="code">ADD/SUB Rd,PC,#rotated_offset8</code>.

</li><li><code class="code">ADRL Rd,symbol</code> is translated to
 <code class="code">ADD/SUB Rd,PC,#hi_rotated8</code> + <code class="code">ADD/SUB Rd,Rd,#lo_rotated8</code>.
 <code class="code">ADR</code> will be automatically treated as <code class="code">ADRL</code> when required
 and when allowed by the option <code class="code">-opt-adr</code>.

</li><li>The immediate operand of ALU-instructions will be translated into
 the appropriate 8-bit-rotated value. When rotation alone doesn&rsquo;t
 succeed the backed will try it with inverted and negated values
 (inverting/negating the ALU-instruction too).
 Optionally you may specify the rotate constant yourself, as an
 additional operand.

</li></ul>

<p>For the THUMB instruction set the following optimizations and translations
are done:
</p>
<ul class="itemize mark-minus">
<li>A conditional branch with a branch-destination being out of range is
 translated into <code class="code">B&lt;!cc&gt; .+4</code> + <code class="code">B label</code>.

</li><li>The <code class="code">BL</code> instruction is translated into two sub-instructions combining
 the high- and low 22 bit of the branch displacement.

</li></ul>


</div>
<div class="section-level-extent" id="Known-Problems-26">
<h3 class="section"><span>28.6 Known Problems<a class="copiable-link" href="#Known-Problems-26"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Only instruction sets up to ARM architecture V4t are supported.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-26">
<h3 class="section"><span>28.7 Error Messages<a class="copiable-link" href="#Error-Messages-26"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: instruction not supported on selected architecture
</li><li>2002: trailing garbage in operand
</li><li>2003: label from current section required
</li><li>2004: branch offset (%ld) is out of range
</li><li>2005: PC-relative load/store (offset %ld) out of range
</li><li>2006: cannot make rotated immediate from PC-relative offset (0x%lx)
</li><li>2007: constant integer expression required
</li><li>2008: constant (0x%lx) not suitable for 8-bit rotated immediate
</li><li>2009: branch to an unaligned address (offset %ld)
</li><li>2010: not a valid ARM register
</li><li>2011: PC (r15) not allowed in this mode
</li><li>2012: PC (r15) not allowed for offset register Rm
</li><li>2013: PC (r15) not allowed with write-back
</li><li>2014: register r%ld was used multiple times
</li><li>2015: illegal immediate shift count (%ld)
</li><li>2016: not a valid shift register
</li><li>2017: 24-bit unsigned immediate expected
</li><li>2018: data size %d not supported
</li><li>2019: illegal addressing mode: %s
</li><li>2020: signed/halfword ldr/str doesn&rsquo;t support shifts
</li><li>2021: %d-bit immediate offset out of range (%ld)
</li><li>2022: post-indexed addressing mode expected
</li><li>2023: operation not allowed on external symbols
</li><li>2024: ldc/stc offset has to be a multiple of 4
</li><li>2025: illegal coprocessor operation mode or type: %ld\n
</li><li>2026: %d-bit unsigned immediate offset out of range (%ld)
</li><li>2027: offset has to be a multiple of %d
</li><li>2028: instruction at unaligned address
</li><li>2029: TSTP/TEQP/CMNP/CMPP deprecated on 32-bit architectures
</li><li>2030: rotate constant must be an even number between 0 and 30: %ld
</li><li>2031: %d-bit unsigned constant required: %ld

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="g_t80x86-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#Z80-cpu-module" accesskey="n" rel="next">Z80 cpu module</a>, Previous: <a href="#ARM-cpu-module" accesskey="p" rel="prev">ARM cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="g_t80x86-cpu-module-1"><span>29 80x86 cpu module<a class="copiable-link" href="#g_t80x86-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the Backend for the 80x86 microprocessor family.
</p>
<ul class="mini-toc">
<li><a href="#Legal-27" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-24" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-23" accesskey="3">General</a></li>
<li><a href="#Extensions-6" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-6" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-27" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-27" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-27">
<h3 class="section"><span>29.1 Legal<a class="copiable-link" href="#Legal-27"> &para;</a></span></h3>

<p>This module is written in 2005-2006,2011,2015-2019,2024 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-24">
<h3 class="section"><span>29.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-24"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-cpudebug=&lt;n&gt;</samp></dt>
<dd><p>Enables debugging output.
</p>
</dd>
<dt><samp class="option">-m8086</samp></dt>
<dd><p>Generate code for the 8086 CPU.
</p>
</dd>
<dt><samp class="option">-mi186</samp></dt>
<dd><p>Generate code for the 80186 CPU.
</p>
</dd>
<dt><samp class="option">-mi286</samp></dt>
<dd><p>Generate code for the 80286 CPU.
</p>
</dd>
<dt><samp class="option">-mi386</samp></dt>
<dd><p>Generate code for the 80386 CPU.
</p>
</dd>
<dt><samp class="option">-mi486</samp></dt>
<dd><p>Generate code for the 80486 CPU.
</p>
</dd>
<dt><samp class="option">-mi586</samp></dt>
<dd><p>Generate code for the Pentium.
</p>
</dd>
<dt><samp class="option">-mi686</samp></dt>
<dd><p>Generate code for the PentiumPro.
</p>
</dd>
<dt><samp class="option">-mpentium</samp></dt>
<dd><p>Generate code for the Pentium.
</p>
</dd>
<dt><samp class="option">-mpentiumpro</samp></dt>
<dd><p>Generate code for the PentiumPro.
</p>
</dd>
<dt><samp class="option">-mk6</samp></dt>
<dd><p>Generate code for the AMD K6.
</p>
</dd>
<dt><samp class="option">-mathlon</samp></dt>
<dd><p>Generate code for the AMD Athlon.
</p>
</dd>
<dt><samp class="option">-msledgehammer</samp></dt>
<dd><p>Generate code for the Sledgehammer CPU.
</p>
</dd>
<dt><samp class="option">-m64</samp></dt>
<dd><p>Generate code for 64-bit architectures (x86_64).
</p>
</dd>
</dl>

</div>
<div class="section-level-extent" id="General-23">
<h3 class="section"><span>29.3 General<a class="copiable-link" href="#General-23"> &para;</a></span></h3>

<p>This backend accepts 80x86 instructions as described in the
Intel Architecture Software Developer&rsquo;s Manual.
</p>
<p>The target address type is 32 bits. It is 64 bits when the x86_64
architecture was selected (<samp class="option">-m64</samp>). Floating point constants in
instructions and data are supported and encoded in IEEE format.
</p>
<p>Instructions do not need any alignment. Data is aligned to its natural
alignment by default.
</p>
<p>The backend uses AT&amp;T-syntax! This means the left operands are always the
source and the right operand is the destination. Register names have to
be prefixed by a &rsquo;%&rsquo;.
</p>
<p>The operation size is indicated by a &rsquo;b&rsquo;, &rsquo;w&rsquo;, &rsquo;l&rsquo;, etc. suffix directly
appended to the mnemonic. The assembler can also determine the operation
size from the size of the registers being used.
</p>
</div>
<div class="section-level-extent" id="Extensions-6">
<h3 class="section"><span>29.4 Extensions<a class="copiable-link" href="#Extensions-6"> &para;</a></span></h3>

<p>Predefined register symbols in this backend:
</p>
<ul class="itemize mark-minus">
<li>8-bit registers: <code class="code">al cl dl bl ah ch dh bh axl cxl dxl spl bpl sil dil r8b r9b r10b r11b r12b r13b r14b r15b</code>
</li><li>16-bit registers: <code class="code">ax cx dx bx sp bp si di r8w r9w r10w r11w r12w r13w r14w r15w</code>
</li><li>32-bit registers: <code class="code">eax ecx edx ebx esp ebp esi edi r8d r9d r10d r11d r12d r13d r14d r15d</code>
</li><li>64-bit registers: <code class="code">rax rcx rdx rbx rsp ebp rsi rdi r8 r9 r10 r11 r12 r13 r14 r15</code>
</li><li>segment registers: <code class="code">es cs ss ds fs gs</code>
</li><li>control registers: <code class="code">cr0 cr1 cr2 cr3 cr4 cr5 cr6 cr7 cr8 cr9 cr10 cr11 cr12 cr13 cr14 cr15</code>
</li><li>debug registers: <code class="code">dr0 dr1 dr2 dr3 dr4 dr5 dr6 dr7 dr8 dr9 dr10 dr11 dr12 dr13 dr14 dr15</code>
</li><li>test registers: <code class="code">tr0 tr1 tr2 tr3 tr4 tr5 tr6 tr7</code>
</li><li>MMX and SIMD registers: <code class="code">mm0 mm1 mm2 mm3 mm4 mm5 mm6 mm7 xmm0 xmm1 xmm2 xmm3 xmm4 xmm5 xmm6 xmm7 xmm8 xmm9 xmm10 xmm11 xmm12 xmm13 xmm14 xmm15</code>
</li><li>FPU registers: <code class="code">st st(0) st(1) st(2) st(3) st(4) st(5) st(6) st(7)</code>
</li></ul>

<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl class="table">
<dt><code class="code">.code16</code></dt>
<dd><p>Sets the assembler to 16-bit addressing mode.
</p>
</dd>
<dt><code class="code">.code32</code></dt>
<dd><p>Sets the assembler to 32-bit addressing mode, which is the default.
</p>
</dd>
<dt><code class="code">.code64</code></dt>
<dd><p>Sets the assembler to 64-bit addressing mode.
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="Optimizations-6">
<h3 class="section"><span>29.5 Optimizations<a class="copiable-link" href="#Optimizations-6"> &para;</a></span></h3>

<p>This backend performs the following optimizations:
</p>
<ul class="itemize mark-minus">
<li>Immediate operands are optimized to the smallest size which can
 still represent the absolute value.

</li><li>Displacement operands are optimized to the smallest size which
 can still represent the absolute value.

</li><li>Jump instructions are optimized to 8-bit displacements, when possible.

</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-27">
<h3 class="section"><span>29.6 Known Problems<a class="copiable-link" href="#Known-Problems-27"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>64-bit operations are incomplete and experimental.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-27">
<h3 class="section"><span>29.7 Error Messages<a class="copiable-link" href="#Error-Messages-27"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: instruction not supported on selected architecture
</li><li>2002: trailing garbage in operand
</li><li>2003: same type of prefix used twice
</li><li>2004: immediate operand illegal with absolute jump
</li><li>2005: base register expected
</li><li>2006: scale factor without index register
</li><li>2007: missing &rsquo;)&rsquo; in baseindex addressing mode
</li><li>2008: redundant %s prefix ignored
</li><li>2009: unknown register specified
</li><li>2010: using register %%%s instead of %%%s due to &rsquo;%c&rsquo; suffix
</li><li>2011: %%%s not allowed with &rsquo;%c&rsquo; suffix
</li><li>2012: illegal suffix &rsquo;%c&rsquo;
</li><li>2013: instruction has no suffix and no register operands - size is unknown
</li><li>2015: memory operand expected
</li><li>2016: you cannot pop %%%s
</li><li>2017: translating to %s %%%s,%%%s
</li><li>2018: translating to %s %%%s
</li><li>2019: absolute scale factor required
</li><li>2020: illegal scale factor (valid: 1,2,4,8)
</li><li>2021: data objects with %d bits size are not supported
</li><li>2022: need at least %d bits for a relocatable symbol
</li><li>2023: pc-relative jump destination out of range (%lld)
</li><li>2024: instruction doesn&rsquo;t support these operand sizes
</li><li>2025: cannot determine immediate operand size without a suffix
</li><li>2026: displacement doesn&rsquo;t fit into %d bits

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Z80-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#g_t6800-cpu-module" accesskey="n" rel="next">6800 cpu module</a>, Previous: <a href="#g_t80x86-cpu-module" accesskey="p" rel="prev">80x86 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Z80-cpu-module-1"><span>30 Z80 cpu module<a class="copiable-link" href="#Z80-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the 8080/z80/gbz80/64180/RCMx000
microprocessor family.
</p>
<ul class="mini-toc">
<li><a href="#Legal-28" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-25" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-24" accesskey="3">General</a></li>
<li><a href="#Extensions-7" accesskey="4">Extensions</a></li>
<li><a href="#Optimisations" accesskey="5">Optimisations</a></li>
<li><a href="#Known-Problems-28" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-28" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-28">
<h3 class="section"><span>30.1 Legal<a class="copiable-link" href="#Legal-28"> &para;</a></span></h3>

<p>This module is copyright in 2009 by Dominic Morris.
</p>
<div class="example">
<pre class="example-preformatted">Redistribution and use in source and binary forms, with or without 
modification, are permitted provided that the following conditions 
are met:
1. Redistributions of source code must retain the above copyright 
   notice, this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright 
   notice, this list of conditions and the following disclaimer in the
   documentation and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR 
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES 
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, 
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT 
NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY 
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF 
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</pre></div>


</div>
<div class="section-level-extent" id="Additional-options-for-this-module-25">
<h3 class="section"><span>30.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-25"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-8080</samp></dt>
<dd><p>Turns on 8080/8085 compatibility mode. Any use of z80 (or higher)
        opcodes will result in an error being generated.
    </p></dd>
<dt><samp class="option">-gbz80</samp></dt>
<dd><p>Turns on gbz80 compatibility mode. Any use of non-supported
        opcodes will result in an error being generated.
    </p></dd>
<dt><samp class="option">-hd64180</samp></dt>
<dd><p>Turns on 64180 mode supporting additional 64180 opcodes.
    </p></dd>
<dt><samp class="option">-intel-syntax</samp></dt>
<dd><p>Turns on the older Intel 8080 syntax mode.  When this mode is
        activated, mnemonics and operand types from the Intel 8080 syntax 
        instead of the Zilog Z80 syntax (such as <code class="code">STA 1234h</code>
        instead of <code class="code">ld (1234h),a</code>) will be valid.  This option can
        be used in parallel with -8080 to use both sets of mnemonics, 
        although this is discouraged, as two instructions (<code class="code">jp</code> and
        <code class="code">cp</code>) mean different things in each syntax. In this case, 
        these instructions will be assembled as the Intel syntax, and a 
        warning will be emitted.       
    </p></dd>
<dt><samp class="option">-rcm2000</samp></dt>
<dt><samp class="option">-rcm3000</samp></dt>
<dt><samp class="option">-rcm4000</samp></dt>
<dd><p>Turns on Rabbit compatibility mode, generating the correct
         codes for moved opcodes and supporting the additional Rabbit
         instructions. In this mode, 8 bit access to the 16 bit index
         registers is not permitted.
    </p></dd>
<dt><samp class="option">-rcmemu</samp></dt>
<dd><p>Turns on emulation of some instructions which aren&rsquo;t available
         on the Rabbit processors.
    </p></dd>
<dt><samp class="option">-swapixiy</samp></dt>
<dd><p>Swaps the usage of ix and iy registers. This is useful
        for compiling generic code that uses an index register that
        is reserved on the target machine.
    </p></dd>
<dt><samp class="option">-z80asm</samp></dt>
<dd><p>Switches on z80asm mode. This translates ASMPC to $ and accepts
         some pseudo opcodes that z80asm supports. Most emulation of 
         z80asm directives is provided by the oldsyntax syntax module.         
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-24">
<h3 class="section"><span>30.3 General<a class="copiable-link" href="#General-24"> &para;</a></span></h3>

<p>This backend accepts z80 family instructions in standard
Zilog syntax. Rabbit opcodes are accepted as defined in the 
publicly available reference material from Rabbit Semiconductor,
with the exception that the <code class="code">ljp</code> and <code class="code">lcall</code> opcodes need
to be supplied with a 24 bit number rather than an 8 bit <code class="code">xpc</code> and a
16 bit address.
</p>
<p>The target address type is 16 bit.
</p>
<p>Instructions consist of one up to six bytes and require no alignment.
There is also no alignment requirement for sections and data.
</p>
<p>The current PC symbol is <code class="code">$</code>.
</p>
</div>
<div class="section-level-extent" id="Extensions-7">
<h3 class="section"><span>30.4 Extensions<a class="copiable-link" href="#Extensions-7"> &para;</a></span></h3>

<p>This backend provides the following specific extensions:
</p>
<ul class="itemize mark-minus">
<li>Certain Rabbit opcodes can be prefixed by the <code class="code">altd</code> and/or the
 <code class="code">ioi</code>/<code class="code">ioe</code> modifier.
 For details of which instructions these are valid for please
 see the documentation from Rabbit.

</li><li>The parser understands a lo/hi-modifier to select low- or high-byte
 of a 16-bit word. The character <code class="code">&lt;</code> is used to select the low-byte
 and <code class="code">&gt;</code> for the high-byte. It has to be the first character before
 an expression.

</li><li>When applying the operation <code class="code">/256</code>, <code class="code">%256</code> or <code class="code">&amp;255</code>
 on a label, an appropriate lo/hi-byte relocation will automatically be
 generated.

</li></ul>

</div>
<div class="section-level-extent" id="Optimisations">
<h3 class="section"><span>30.5 Optimisations<a class="copiable-link" href="#Optimisations"> &para;</a></span></h3>

<p>This backend supports the emulation of certain z80 instructions on the
Rabbit/gbz80 processor. These instructions are <code class="code">rld</code>, <code class="code">rrd</code>,
<code class="code">cpi</code>, <code class="code">cpir</code>, <code class="code">cpd</code> and <code class="code">cpdr</code>.
The link stage should provide routines with the opcode name prefixed with
<code class="code">rcmx_</code> (eg <code class="code">rcmx_rld</code>) which implements the same functionality.
Example implementations are available within the z88dk CVS tree.
</p>
<p>Additionally, for the Rabbit targets the missing call <code class="code">cc</code>, opcodes
will be emulated.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-28">
<h3 class="section"><span>30.6 Known Problems<a class="copiable-link" href="#Known-Problems-28"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Not all RCM4000 opcodes are supported (<code class="code">llcall</code>, <code class="code">lljp</code>
 are not available).

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-28">
<h3 class="section"><span>30.7 Error Messages<a class="copiable-link" href="#Error-Messages-28"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: trailing garbage in operand
</li><li>2002: Opcode not supported by %s (%s)
</li><li>2003: Index registers not available on 8080
</li><li>2004: out of range for 8 bit expression (%d)
</li><li>2005: invalid bit number (%d) should be in range 0..7
</li><li>2006: rst value out of range (%d/0x%02x)  
</li><li>2007: %s value out of range (%d)
</li><li>2008: index offset should be a constant
</li><li>2009: invalid branch type for jr
</li><li>2010: Rabbit target doesn&rsquo;t support rst %d
</li><li>2011: Rabbit target doesn&rsquo;t support 8 bit index registers 
</li><li>2012: z180 target doesn&rsquo;t support 8 bit index registers
</li><li>2013: invalid branch type for jre
</li><li>2014: Opcode not supported by %s (%s) but it can be emulated (-rcmemu)
</li><li>2015: %s specifier is only valid for Rabbit processors
</li><li>2016: Only one of ioi and ioe can be specified at a time
</li><li>2017: %s specifier is not valid for the opcode %s
</li><li>2018: %s specifier redundant for the opcode %s
</li><li>2019: %s specifier has no effect on the opcode %s
</li><li>2020: Operand value must evaluate to a constant for opcode %s
</li><li>2021: Unhandled operand type wanted 0x%x got 0x%x
</li><li>2022: Missed matched index registers on %s
</li><li>2023: Only out (c),0 is supported for the opcode %s
</li><li>2024: Operations between different index registers are forbidden
</li><li>2025: Operations between ix/iy/hl are forbidden
</li><li>2026: Double indirection forbidden
</li><li>2027: Instruction %s will be assembled as &rsquo;%s&rsquo;
</li><li>2028: index offset out of bounds (%d)
</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="g_t6800-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#g_t6809-cpu-module" accesskey="n" rel="next">6809/6309/68HC12 cpu module</a>, Previous: <a href="#Z80-cpu-module" accesskey="p" rel="prev">Z80 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="g_t6800-cpu-module-1"><span>31 6800 cpu module<a class="copiable-link" href="#g_t6800-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the Motorola 6800
microprocessor family.
</p>
<ul class="mini-toc">
<li><a href="#Legal-29" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-26" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-25" accesskey="3">General</a></li>
<li><a href="#Extensions-8" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-7" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-29" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-29" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-29">
<h3 class="section"><span>31.1 Legal<a class="copiable-link" href="#Legal-29"> &para;</a></span></h3>

<p>This module is written in 2013-2016,2021 by Esben Norby and Frank Wille
    and is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-26">
<h3 class="section"><span>31.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-26"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-m6800</samp></dt>
<dd><p>Generate code for the 6800 CPU (default setting).
    </p></dd>
<dt><samp class="option">-m6801</samp></dt>
<dd><p>Generate code for the 6801 CPU.
    </p></dd>
<dt><samp class="option">-m68hc11</samp></dt>
<dd><p>Generate code for the 68HC11 CPU.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-25">
<h3 class="section"><span>31.3 General<a class="copiable-link" href="#General-25"> &para;</a></span></h3>

<p>This backend accepts 6800 family instructions for the following CPUs:
</p>
<ul class="itemize mark-bullet">
<li>6800 code generation: 6800, 6802, 6808.
</li><li>6801 code generation: 6801, 6803.
</li><li>68HC11.

</li></ul>

<p>The 6804, 6805 and 68HC08 are not supported, they use a similar
instruction set, but are not opcode compatible.
</p>
<p>The target address type is 16 bit.
</p>
<p>Instructions consist of one up to five bytes and require no alignment.
There is also no alignment requirement for sections and data.
</p>
</div>
<div class="section-level-extent" id="Extensions-8">
<h3 class="section"><span>31.4 Extensions<a class="copiable-link" href="#Extensions-8"> &para;</a></span></h3>

<p>This backend provides the following specific extensions:
</p>
<ul class="itemize mark-minus">
<li>When an instruction supports direct and extended addressing mode
 the <code class="code">&lt;</code> character can be used to force direct mode and the
 <code class="code">&gt;</code> character forces extended mode. Otherwise the assembler selects
 the best mode automatically, which defaults to extended mode for external
 symbols.

</li><li>When applying the operation <code class="code">/256</code>, <code class="code">%256</code> or <code class="code">&amp;256</code>
 on a label, an appropriate lo/hi-byte relocation will automatically be
 generated.

</li></ul>

</div>
<div class="section-level-extent" id="Optimizations-7">
<h3 class="section"><span>31.5 Optimizations<a class="copiable-link" href="#Optimizations-7"> &para;</a></span></h3>

<p>None.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-29">
<h3 class="section"><span>31.6 Known Problems<a class="copiable-link" href="#Known-Problems-29"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None?

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-29">
<h3 class="section"><span>31.7 Error Messages<a class="copiable-link" href="#Error-Messages-29"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: trailing garbage in operand
</li><li>2002: data size %d not supported
</li><li>2003: operand doesn&rsquo;t fit into 8-bits
</li><li>2004: branch destination out of range

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="g_t6809-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#Jaguar-RISC-cpu-module" accesskey="n" rel="next">Jaguar RISC cpu module</a>, Previous: <a href="#g_t6800-cpu-module" accesskey="p" rel="prev">6800 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="g_t6809_002f6309_002f68HC12-cpu-module"><span>32 6809/6309/68HC12 cpu module<a class="copiable-link" href="#g_t6809_002f6309_002f68HC12-cpu-module"> &para;</a></span></h2>
<p>This chapter documents the backend for the Motorola 6809, 68HC12 and
Hitachi 6309.
</p>
<ul class="mini-toc">
<li><a href="#Legal-30" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-27" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-26" accesskey="3">General</a></li>
<li><a href="#Extensions-9" accesskey="4">Extensions</a></li>
<li><a href="#Optimizations-8" accesskey="5">Optimizations</a></li>
<li><a href="#Known-Problems-30" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-30" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-30">
<h3 class="section"><span>32.1 Legal<a class="copiable-link" href="#Legal-30"> &para;</a></span></h3>

<p>This module is written in 2020-2025 by Frank Wille
    and is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-27">
<h3 class="section"><span>32.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-27"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-6809</samp></dt>
<dd><p>Generate code for the 6809 CPU (default setting).
        Also works on the 6309, which is backwards compatible.
    </p></dd>
<dt><samp class="option">-6309</samp></dt>
<dd><p>Generate code for the 6309 CPU.
    </p></dd>
<dt><samp class="option">-68hc12</samp></dt>
<dd><p>Generate code for the 68HC12 CPU.
    </p></dd>
<dt><samp class="option">-konami2</samp></dt>
<dd><p>Generate code for Konami&rsquo;s 6809 based arcade CPU (Konami-2).
    </p></dd>
<dt><samp class="option">-opt-branch</samp></dt>
<dd><p>Translate short-branches to long and optimize long-branches
        to short when required/possible.
        Also tries to optimize <code class="code">jmp</code> and <code class="code">jsr</code> instructions
        into short-branches.
    </p></dd>
<dt><samp class="option">-opt-offset</samp></dt>
<dd><p>Delete zero offsets in indexed addressing modes, when possible.
    </p></dd>
<dt><samp class="option">-opt-pc</samp></dt>
<dd><p>Convert all extended addressing modes with local or external
        labels to indexed, PC-relative addressing. Also translates
        absolute <code class="code">jmp</code>/<code class="code">jsr</code> instructions into PC-relative
        <code class="code">lbra</code>/<code class="code">lbsr</code> (or better).
    </p></dd>
<dt><samp class="option">-turbo9</samp></dt>
<dd><p>Generate code for the TURBO9 CPU.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-26">
<h3 class="section"><span>32.3 General<a class="copiable-link" href="#General-26"> &para;</a></span></h3>

<p>This backend accepts 6809/6309 instructions as described in the
Motorola 6809 and Hitachi 6309 Programmer&rsquo;s Reference (Copyright 2009
Darren Atkinson).
Optionally supports the 68HC12 instruction set as documented in
Motorola&rsquo;s CPU12 Reference Manual.
</p>
<p>The target address type is 16 bit.
</p>
<p>Instructions consist of one up to six bytes and require no alignment.
There is also no alignment requirement for sections and data.
</p>
</div>
<div class="section-level-extent" id="Extensions-9">
<h3 class="section"><span>32.4 Extensions<a class="copiable-link" href="#Extensions-9"> &para;</a></span></h3>

<p>The backend supports the unary operators <code class="code">&lt;</code> and <code class="code">&gt;</code> to either
select the size of an addressing mode or the LSB/MSB of a 16-bit word.
</p>
<ul class="itemize mark-minus">
<li>When direct or extended addressing modes are applicable,
 <code class="code">&lt;</code> enforces direct mode and <code class="code">&gt;</code> enforces extended mode.
</li><li>For indexed, PC-relative addressing modes <code class="code">&lt;</code> enforces an
 8-bit offset, while <code class="code">&gt;</code> enforces a 16-bit offset.
</li><li>For all other indexed addressing modes with a constant offset
 <code class="code">&lt;</code> enforces an 8-bit offset and <code class="code">&gt;</code> enforces a 16-bit offset.
</li><li>For immediate addressing modes or data constants <code class="code">&lt;</code> selects
 the LSB of a word and <code class="code">&gt;</code> selects the MSB.
</li><li>When applying the operation <code class="code">/256</code>, <code class="code">%256</code> or <code class="code">&amp;256</code>
 on a label in immediate addressing modes or data constants,
 an appropriate lo/hi-byte relocation will automatically be generated.
</li></ul>

<p>In absence of <code class="code">&lt;</code> or <code class="code">&gt;</code> vasm selects the best addressing
mode possible, i.e. the one which requires the least amount of memory
when the symbol value is known, or the one which allows the largest
symbol values, when it is unknown at assembly time.
</p>
<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl class="table">
<dt><code class="code">setdp &lt;expr&gt;</code></dt>
<dd><p>Set the current base address of the direct page. It is used
      to decide whether an extended addressing mode can be
      optimized to direct addressing. No effect for 68HC12.
</p>
</dd>
<dt><code class="code">direct &lt;symbol&gt;</code></dt>
<dd><p>Tell the assembler to use direct addressing for expressions
      based on this symbol.
</p></dd>
</dl>


</div>
<div class="section-level-extent" id="Optimizations-8">
<h3 class="section"><span>32.5 Optimizations<a class="copiable-link" href="#Optimizations-8"> &para;</a></span></h3>

<p>This backend performs the following operand optimizations:
</p>
<ul class="itemize mark-minus">
<li>Short-branches (<code class="code">Bcc</code>) are optionally translated into long-branches
  (<code class="code">LBcc</code>) when their destination is undefined, in a different
  section or out of range. Note that there is no <code class="code">LBSR</code> on the HC12.
</li><li>Long-branches (<code class="code">LBcc</code>) are optionally optimized into short-branches
  (<code class="code">Bcc</code>) when possible.
</li><li>Optionally optimize <code class="code">JMP</code> into <code class="code">BRA</code> and <code class="code">JSR</code> into
  <code class="code">BSR</code> when possible (same section, distance representable in 8 bits).
</li><li>Optionally translate <code class="code">JMP</code> into <code class="code">LBRA</code> and <code class="code">JSR</code> into
  <code class="code">LBSR</code> (<samp class="option">-opt-pc</samp>).
</li><li>Optionally translate all extended addressing, referring to local
  or external labels, to an indexed, PC-relative addressing mode
  (<samp class="option">-opt-pc</samp>).
</li><li>Optionally optimize indexed addressing modes with a constant zero
  offset into a no-offset addressing mode, which executes faster. Not
  possible on the HC12.
</li><li>Always select the shortest indexed addressing mode for constant
  offsets, unless externally defined.
</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-30">
<h3 class="section"><span>32.6 Known Problems<a class="copiable-link" href="#Known-Problems-30"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>HC12 PC-relative addressing modes in <code class="code">MOVx</code> instructions may be
      wrong. Needs testing.
</li><li>Some new Konami instructions dealing with 16-bit memory or D-register
      access may crash or do not work correctly with older CPU revisions
      (for example Konami-2 CPUs manufactured before 1990).
</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-30">
<h3 class="section"><span>32.7 Error Messages<a class="copiable-link" href="#Error-Messages-30"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: trailing garbage in operand
</li><li>2002: ] expected for indirect addressing mode
</li><li>2003: missing valid index register
</li><li>2004: pc-relative offset out of range: %ld
</li><li>2005: constant offset out of range: %ld
</li><li>2006: bad auto decrement/increment value: %d
</li><li>2007: indirect addressing not allowed
</li><li>2008: auto increment/decrement not allowed
</li><li>2009: short branch out of range: %ld
</li><li>2010: long branch out of range: %ld
</li><li>2011: decrement branch out of range: %ld
</li><li>2012: data size %d not supported
</li><li>2013: data expression doesn&rsquo;t fit into %d bits
</li><li>2014: illegal bit number specification: %d
</li><li>2015: omitted offset taken as 5-bit zero offset
</li><li>2016: immediate expression doesn&rsquo;t fit into %d bits
</li><li>2017: directive ignored as selected CPU has no DP register
</li><li>2018: double size modifier ignored
</li><li>2019: addressing mode not supported

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Jaguar-RISC-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#PDP11-cpu-module" accesskey="n" rel="next">PDP11 cpu module</a>, Previous: <a href="#g_t6809-cpu-module" accesskey="p" rel="prev">6809/6309/68HC12 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Jaguar-RISC-cpu-module-1"><span>33 Jaguar RISC cpu module<a class="copiable-link" href="#Jaguar-RISC-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the Atari Jaguar GPU/DSP RISC processor.
</p>
<ul class="mini-toc">
<li><a href="#Legal-31" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-28" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-27" accesskey="3">General</a></li>
<li><a href="#Optimizations-9" accesskey="4">Optimizations</a></li>
<li><a href="#Extensions-10" accesskey="5">Extensions</a></li>
<li><a href="#Known-Problems-31" accesskey="6">Known Problems</a></li>
<li><a href="#Error-Messages-31" accesskey="7">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-31">
<h3 class="section"><span>33.1 Legal<a class="copiable-link" href="#Legal-31"> &para;</a></span></h3>

<p>This module is written in 2014-2017,2020,2021,2024 by Frank Wille and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-28">
<h3 class="section"><span>33.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-28"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-big</samp></dt>
<dd><p>Output big-endian code and data (default).
</p>
</dd>
<dt><samp class="option">-little</samp></dt>
<dd><p>Output little-endian code and data.
</p>
</dd>
<dt><samp class="option">-many</samp></dt>
<dd><p>Generate code for GPU or DSP RISC. All instructions are accepted
        (default).
</p>
</dd>
<dt><samp class="option">-mdsp</samp></dt>
<dt><samp class="option">-mjerry</samp></dt>
<dd><p>Generate code for the DSP RISC (part of Jerry).
</p>
</dd>
<dt><samp class="option">-mgpu</samp></dt>
<dt><samp class="option">-mtom</samp></dt>
<dd><p>Generate code for the GPU RISC (part of Tom).
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="General-27">
<h3 class="section"><span>33.3 General<a class="copiable-link" href="#General-27"> &para;</a></span></h3>

<p>This backend accepts RISC instructions for the GPU or DSP in Atari&rsquo;s
Jaguar custom chip set according to the &quot;Jaguar Technical Reference Manual
for Tom &amp; Jerry&quot;, Revision 8. Documentation bugs were fixed by using
various sources on the net.
</p>
<p>The target address type is 32 bits.
</p>
<p>Default alignment for instructions is 2 bytes.
Data is aligned to its natural alignment by default.
</p>

</div>
<div class="section-level-extent" id="Optimizations-9">
<h3 class="section"><span>33.4 Optimizations<a class="copiable-link" href="#Optimizations-9"> &para;</a></span></h3>

<p>This backend performs the following optimizations and translations for
the GPU/DSP RISC instruction set:
</p>
<ul class="itemize mark-minus">
<li><code class="code">load (Rn+0),Rm</code> is optimized to <code class="code">load (Rn),Rm</code>.

</li><li><code class="code">store Rn,(Rm+0)</code> is optimized to <code class="code">store Rn,(Rm)</code>.

</li></ul>


</div>
<div class="section-level-extent" id="Extensions-10">
<h3 class="section"><span>33.5 Extensions<a class="copiable-link" href="#Extensions-10"> &para;</a></span></h3>

<p>This backend extends the selected syntax module by the following
directives (note that a leading dot is optional):
</p>
<dl class="table">
<dt><code class="code">&lt;symbol&gt; ccdef &lt;expression&gt;</code></dt>
<dd><p>Allows defining a symbol for the condition codes used in <code class="code">jump</code>
      and <code class="code">jr</code> instructions. Must be constant number in the range of
      0 to 31 or another condition code symbol.
</p>
</dd>
<dt><code class="code">ccundef &lt;symbol&gt;</code></dt>
<dd><p>Undefine a condition code symbol previously defined via <code class="code">ccdef</code>.
</p>
</dd>
<dt><code class="code">dsp</code></dt>
<dd><p>Select DSP instruction set.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; equr &lt;Rn&gt;</code></dt>
<dd><p>Define a new symbol named &lt;symbol&gt; and assign the address register
      <code class="code">Rn</code> to it. &lt;Rn&gt; may also be another register symbol.
      Note that a register symbol must be defined before it can be used.
</p>
</dd>
<dt><code class="code">equrundef &lt;symbol&gt;</code></dt>
<dd><p>Undefine a register symbol previously defined via <code class="code">equr</code>.
</p>
</dd>
<dt><code class="code">gpu</code></dt>
<dd><p>Select GPU instruction set.
</p>
</dd>
<dt><code class="code">&lt;symbol&gt; regequ &lt;Rn&gt;</code></dt>
<dd><p>Equivalent to <code class="code">equr</code>.
</p>
</dd>
<dt><code class="code">regundef &lt;symbol&gt;</code></dt>
<dd><p>Undefine a register symbol previously defined via <code class="code">regequ</code>.
</p>
</dd>
</dl>

<p>All directives may be optionally preceded by a dot (<code class="code">.</code>), for
compatibility with various syntax modules.
</p>

</div>
<div class="section-level-extent" id="Known-Problems-31">
<h3 class="section"><span>33.6 Known Problems<a class="copiable-link" href="#Known-Problems-31"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Encoding of <code class="code">MOVEI</code> instruction in little-endian mode is unknown.
</li><li>The developer has to provide the necessary <code class="code">NOP</code> instructions
      after jumps, or <code class="code">OR</code> instructions to work around hardware bugs,
      her/himself.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-31">
<h3 class="section"><span>33.7 Error Messages<a class="copiable-link" href="#Error-Messages-31"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: data size %d not supported
</li><li>2002: value from %ld to %ld required

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="PDP11-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#unSP-cpu-module" accesskey="n" rel="next">unSP cpu module</a>, Previous: <a href="#Jaguar-RISC-cpu-module" accesskey="p" rel="prev">Jaguar RISC cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="PDP11-cpu-module-1"><span>34 PDP11 cpu module<a class="copiable-link" href="#PDP11-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the PDP-11 CPU architecture.
</p>
<ul class="mini-toc">
<li><a href="#Legal-32" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-29" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-28" accesskey="3">General</a></li>
<li><a href="#Known-Problems-32" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-32" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-32">
<h3 class="section"><span>34.1 Legal<a class="copiable-link" href="#Legal-32"> &para;</a></span></h3>
<p>This module is written in 2020 by Frank Wille
    and is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="Additional-options-for-this-module-29">
<h3 class="section"><span>34.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-29"> &para;</a></span></h3>

<p>This module provides the following additional options:
</p>
<dl class="table">
<dt><samp class="option">-eis</samp></dt>
<dd><p>Enables the Extended Instruction Set option (EIS).
    </p></dd>
<dt><samp class="option">-fis</samp></dt>
<dd><p>Enables the Floating point Instruction Set option (FIS).
    </p></dd>
<dt><samp class="option">-msp</samp></dt>
<dd><p>Enables additional memory space instructions.
    </p></dd>
<dt><samp class="option">-opt-branch</samp></dt>
<dd><p>Enables optimization of <code class="code">jmp</code> instructions to <code class="code">br</code> when
        possible and translates <code class="code">br</code> instructions to <code class="code">jmp</code> when
        required.
        It will also translate conditional branches, where the destination
        is out of range, into a <code class="code">jmp</code> instruction and a negated
        conditional branch over this <code class="code">jmp</code>.
</p></dd>
</dl>

</div>
<div class="section-level-extent" id="General-28">
<h3 class="section"><span>34.3 General<a class="copiable-link" href="#General-28"> &para;</a></span></h3>

<p>This backend accepts PDP-11 instructions as described in the
PDP11/40 Processor Handbook, by Digital Equipment Corporation.
</p>
<p>The target address type is 16 bit.
</p>
<p>Instructions consist of two up to six bytes and required 16-bit alignment.
Data, when not accessed as single bytes, also requires 16-bit alignment.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-32">
<h3 class="section"><span>34.4 Known Problems<a class="copiable-link" href="#Known-Problems-32"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>Doesn&rsquo;t support all PDP-11 extensions.
</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-32">
<h3 class="section"><span>34.5 Error Messages<a class="copiable-link" href="#Error-Messages-32"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: bad addressing mode
</li><li>2002: bad register
</li><li>2003: pc-relative destination out of range: %ld (valid: %d..%d)
</li><li>2004: bad trap code %ld (valid: %d..%d)
</li><li>2005: displacement out of range: %ld
</li><li>2006: immediate value out of range: %ld
</li><li>2007: absolute address out of range: %ld
</li><li>2008: data size %d not supported
</li><li>2009: data expression doesn&rsquo;t fit into %d bits

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="unSP-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#HANS-cpu-module" accesskey="n" rel="next">HANS cpu module</a>, Previous: <a href="#PDP11-cpu-module" accesskey="p" rel="prev">PDP11 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="unSP-cpu-module-1"><span>35 unSP cpu module<a class="copiable-link" href="#unSP-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the unSP CPU architecture.
</p>
<ul class="mini-toc">
<li><a href="#Legal-33" accesskey="1">Legal</a></li>
<li><a href="#General-29" accesskey="2">General</a></li>
<li><a href="#Extensions-11" accesskey="3">Extensions</a></li>
<li><a href="#Compatibility-with-other-assemblers-and-disassemblers" accesskey="4">Compatibility with other assemblers and disassemblers</a></li>
<li><a href="#Known-Problems-33" accesskey="5">Known Problems</a></li>
</ul>
<div class="section-level-extent" id="Legal-33">
<h3 class="section"><span>35.1 Legal<a class="copiable-link" href="#Legal-33"> &para;</a></span></h3>
<p>This module is written in 2021-2024 by Adrien Destugues
    and is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="General-29">
<h3 class="section"><span>35.2 General<a class="copiable-link" href="#General-29"> &para;</a></span></h3>

<p>Instructions consist of one 16-bit word, sometimes followed by a 16-bit
immediate value or address.
</p>
<p>Single byte memory accesses are not possible.
</p>
<p>The address space is 22 bits, with a segment register which is used by adding a D: prefix to
addresses (otherwise, only 16 bit addresses to the &quot;zero page&quot; are accessible). The segment
register is adjusted automatically when a post or pre increment or decrement overflows the address
register. There is also a segment register for the PC, but that does not require specific handling
from the assembler at the moment (except for the presence of an LJMP instruction allowing to call
code in another segment).
</p>
<p>Conditional jump instructions in unSP are PC relative and allow to jump up to 63 instructions
forward or backwards. When the code in a conditional branch is longer than this, a 2-instruction
sequence is used: an opposite condition jump to PC+2, followed by a GOTO to the branch target.
This is done automatically as needed by vasm if you use the &quot;l&quot; prefix to the jump instruction
(for example LJAE instead of JAE). In this case, the long form instruction is used if necessary,
and the short form is used if the target is close enough. Without the prefix, the instruction can
only use the PC-relative mode and you get an assembler error if you try to jump too far.
</p>
</div>
<div class="section-level-extent" id="Extensions-11">
<h3 class="section"><span>35.3 Extensions<a class="copiable-link" href="#Extensions-11"> &para;</a></span></h3>

<p>This backend provides the following specific extensions:
</p>
<ul class="itemize mark-minus">
<li>The parser understands a lo/hi-modifier to select low- or high-byte
 of a 22-bit word. The character <code class="code">&lt;</code> is used to select the low-byte
 and <code class="code">&gt;</code> for the high-byte. It has to be the first character before
 an expression.

</li><li>When applying the operation <code class="code">/65536</code>, <code class="code">%65536</code> or <code class="code">&amp;65535</code>
 on a label, an appropriate lo/hi-byte relocation will automatically be
 generated.

</li></ul>

</div>
<div class="section-level-extent" id="Compatibility-with-other-assemblers-and-disassemblers">
<h3 class="section"><span>35.4 Compatibility with other assemblers and disassemblers<a class="copiable-link" href="#Compatibility-with-other-assemblers-and-disassemblers"> &para;</a></span></h3>

<p>This backend accepts instructions in a traditional format, reusing the mnemonics from naken_asm.
The official unSP documentation uses an unusual syntax, which would probably require a custom
syntax module.
</p>
<p>The closest syntax to naken_asm is the oldstyle one, but there are some differences:
</p>
<ul class="itemize mark-minus">
<li>Instructions must be prefixed by a tab or spaces. Everything on the first column is parsed as
a label.

</li><li>Addresses can be represented with parentheses in addition to square brackets:
      <code class="code">LD R1,(1234)</code> instead of <code class="code">LD R1, [1234]</code>

</li><li>The push/pop instructions list of registers is indicated as two operands instead of a range:
      <code class="code">PUSH R1, R1, (SP)</code> instead of <code class="code">PUSH R1-R1, [SP]</code>

</li><li>Hexadecimal numbers can be prefixed with $ instead of 0x

</li></ul>

<p>The backend internally outputs data in big endian format. This is not compatible with other tools,
which use little endian. The endianness can be changed at the output stage when generating a raw
binary, by using vasm standard -ole command-line switch.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-33">
<h3 class="section"><span>35.5 Known Problems<a class="copiable-link" href="#Known-Problems-33"> &para;</a></span></h3>

<p>Only version 1.0 and 1.1 of the ISA is supported (they are identical as far as instruction encoding
is concerned, but a few instructions have slight behavior differences).
Versions 1.2 and 1.3 are backwards compatible but introduce additional instructions:
</p>
<ul class="itemize mark-minus">
<li>CPU control: SECBANK ON/OFF; FRACTION ON/OFF; IRQNEST ON/OFF

</li><li>Load and stores of DS and flag registers

</li><li>Bit operations: TSTB, SETB, CLRB, INVB (with registers or indirect addressing)

</li><li>Shift operations: ASR, ASROR, LSL, LSLOR, LSR, LSROR, ROL, ROR

</li><li>Multiplication and MAC: unsigned * unsigned

</li><li>Divisions: DIVQ, DIVS, EXP

</li><li>Jumps: GOTO and CALL with indirect address (GOTO MR, CALL MR)

</li></ul>

<p>Version 2.0 is not fully compatible and introduces even more instructions.
</p>
<hr>
</div>
</div>
<div class="chapter-level-extent" id="HANS-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#Trillek-TR3200-cpu-module" accesskey="n" rel="next">Trillek TR3200 cpu module</a>, Previous: <a href="#unSP-cpu-module" accesskey="p" rel="prev">unSP cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="HANS-cpu-module-1"><span>36 HANS cpu module<a class="copiable-link" href="#HANS-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the backend for the &quot;Hans&quot; processor 
from the &quot;Hans&quot; project.
</p>
<ul class="mini-toc">
<li><a href="#Legal-34" accesskey="1">Legal</a></li>
<li><a href="#Additional-options-for-this-module-30" accesskey="2">Additional options for this module</a></li>
<li><a href="#General-30" accesskey="3">General</a></li>
<li><a href="#Known-Problems-34" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-33" accesskey="5">Error Messages</a></li>
</ul>
<div class="section-level-extent" id="Legal-34">
<h3 class="section"><span>36.1 Legal<a class="copiable-link" href="#Legal-34"> &para;</a></span></h3>

<p>This module is written in 2023-2024 by Yannik Stamm
   and is covered by the vasm copyright without modifications.
</p>
</div>
<div class="section-level-extent" id="Additional-options-for-this-module-30">
<h3 class="section"><span>36.2 Additional options for this module<a class="copiable-link" href="#Additional-options-for-this-module-30"> &para;</a></span></h3>

</div>
<div class="section-level-extent" id="General-30">
<h3 class="section"><span>36.3 General<a class="copiable-link" href="#General-30"> &para;</a></span></h3>

<p>This backend is made as part of a hobby project &quot;Hans&quot; which includes
a custom processor with a custom instruction set. The project is open source
under: <a class="url" href="https://github.com/Byter64/Hans">https://github.com/Byter64/Hans</a> (most part is German). 
</p>
<p>The instructions as well as all data is exactly 32-Bit, 
which is equal to 1 Byte on our system. Therefore, the target address
size is also 32-Bit.
</p>
</div>
<div class="section-level-extent" id="Known-Problems-34">
<h3 class="section"><span>36.4 Known Problems<a class="copiable-link" href="#Known-Problems-34"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>None.

</li></ul>

</div>
<div class="section-level-extent" id="Error-Messages-33">
<h3 class="section"><span>36.5 Error Messages<a class="copiable-link" href="#Error-Messages-33"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: data size of &quot;%d&quot; bits is not supported
</li><li>2002: value does not fit into immediate. Allowed range is [-32768:32767]. Value is %i
</li><li>2003: destination address (immediate value) is to far away. Allowed distance/immediate value is [-32768:32767].
 Actual distance/immediate value is %i
</li><li>2004: congratulations. Your jump distance (%i) actually goes beyond the scope of [-33,554,432:33,554,431]. We, the creators of Hans, are so proud of you for writing 33 million instructions. You should maybe take a break :D
</li><li>2005: immediate is %i but allowed range is %s for %s

</li></ul>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Trillek-TR3200-cpu-module">
<div class="nav-panel">
<p>
Next: <a href="#Interface" accesskey="n" rel="next">Interface</a>, Previous: <a href="#HANS-cpu-module" accesskey="p" rel="prev">HANS cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Trillek-TR3200-cpu-module-1"><span>37 Trillek TR3200 cpu module<a class="copiable-link" href="#Trillek-TR3200-cpu-module-1"> &para;</a></span></h2>
<p>This chapter documents the Backend for the TR3200 cpu.
</p>
<ul class="mini-toc">
<li><a href="#Legal-35" accesskey="1">Legal</a></li>
<li><a href="#General-31" accesskey="2">General</a></li>
<li><a href="#Extensions-12" accesskey="3">Extensions</a></li>
<li><a href="#Known-Problems-35" accesskey="4">Known Problems</a></li>
<li><a href="#Error-Messages-34" accesskey="5">Error Messages</a></li>
<li><a href="#Example" accesskey="6">Example</a></li>
</ul>
<div class="section-level-extent" id="Legal-35">
<h3 class="section"><span>37.1 Legal<a class="copiable-link" href="#Legal-35"> &para;</a></span></h3>

<p>This module is written in 2014 by Luis Panadero Guarde&ntilde;o and
    is covered by the vasm copyright without modifications.
</p>

</div>
<div class="section-level-extent" id="General-31">
<h3 class="section"><span>37.2 General<a class="copiable-link" href="#General-31"> &para;</a></span></h3>

<p>This backend accepts TR3200 instructions as described in the
<a class="uref" href="https://github.com/trillek-team/trillek-computer">TR3200 specification</a>
</p>
<p>The target address type is 32 bits.
</p>
<p>Default alignment for sections is 4 bytes. Instructions alignment is 4 bytes.
Data is aligned to its natural alignment by default, i.e. 2 byte wide data
alignment is 2 bytes and 4 byte wide data alignment is 4 byte.
</p>
<p>The backend uses TR3200 syntax! This means the left operand is always the
destination and the right operand is the source (except for single operand
instructions). Register names have to be prefixed by a &rsquo;<code class="code">%</code>&rsquo;
(<code class="code">%bp</code>, <code class="code">%r0</code>, etc.)
This means that it should accept WaveAsm assembly files if oldstyle syntax module
is being used. The instructions are lower case, <samp class="option">-dotdir</samp> option is being
used and directives are not in the first column.
</p>
</div>
<div class="section-level-extent" id="Extensions-12">
<h3 class="section"><span>37.3 Extensions<a class="copiable-link" href="#Extensions-12"> &para;</a></span></h3>

<p>Predefined register symbols in this backend:
</p>
<ul class="itemize mark-minus">
<li>register by number: <code class="code">r0 r1 r2 r3 r4 r5 r6 r7 r8 r9 r10 r11 r12 r13 r14 r15</code>
</li><li>special registers by name: <code class="code">bp sp y ia flags</code>
</li></ul>

</div>
<div class="section-level-extent" id="Known-Problems-35">
<h3 class="section"><span>37.4 Known Problems<a class="copiable-link" href="#Known-Problems-35"> &para;</a></span></h3>

<p>Some known problems of this module at the moment:
</p>
<ul class="itemize mark-minus">
<li>This module needs to be fully checked, but has been tested building a full
      program that could be found here : <a class="uref" href="https://github.com/Zardoz89/trillek-firmware">https://github.com/Zardoz89/trillek-firmware</a>
</li><li>Instruction relocations are missing.

</li></ul>


</div>
<div class="section-level-extent" id="Error-Messages-34">
<h3 class="section"><span>37.5 Error Messages<a class="copiable-link" href="#Error-Messages-34"> &para;</a></span></h3>

<p>This module has the following error messages:
</p>
<ul class="itemize mark-minus">
<li>2001: illegal operand
</li><li>2002: illegal qualifier &lt;%s&gt;
</li><li>2003: data size not supported
</li></ul>

</div>
<div class="section-level-extent" id="Example">
<h3 class="section"><span>37.6 Example<a class="copiable-link" href="#Example"> &para;</a></span></h3>

<p>It follows a little example to illustrate TR3200 assembly using
the oldstyle syntax module (option <samp class="option">-dotdir</samp> required):
</p>
<div class="example">
<pre class="example-preformatted">const   .equ 0xBEBACAFE           ; A constant
an_addr .equ 0x100                ; Other constant

; ROM code
      .org 0x100000
      .text
_start                            ; Label with or without a ending &quot;:&quot;
      mov %sp, 0x1000             ; Set the initial stack

      mov %r0, 0
      mov %r1, 0xA5
      mov %r2, 0
      storeb %r0, an_addr, %r1

      add %r0, %r2, %bp
      add %r0, %r2, 0
      add %r0, %r0, 10
      add %r0, %r0, 10h
      add %r0, %r0, 0x100010
      add %r0, %r0, (256 + 100)   ; vasm parses math expressions

      mov %r2, 0
      mov %r3, 0x10200

      loadb %r6, 0x100200
      loadb %r1, %r2, 0x100200
      loadb %r1, %r2, %r3
      loadb %r4, var1

      push %r0
      .repeat 2                 ; directives to repeat stuff!
      push const
      .endrepeat

      .repeat 2
      pop %r5
      .endrepeat
      pop %r0

      rcall foo                 ; Relative call/jump!
      sleep

foo:      ; Subrutine
      ifneq %r5, 0
        mul %r5, %r5, 2
      sub %r5, %r5, 1

      ret

; ROM data
      .org 0x100500
var1  .db 0x20                  ; A byte size variable
      .even                     ; Enforce to align to even address
var3  .dw 0x1020                ; A word size variable
var4  .dd 0x0A0B0C20            ; A double word size variable
str1  .asciiz &quot;Hello world!&quot;    ; ASCII string with null termination
str2  .string &quot;Hello world!&quot;    ; ASCII string with null termination
      .fill 5, 0xFF             ; Fill 5 bytes with 0xFF
      .reserve 5                ; Reserves space for 5 byte

</pre></div>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Interface">
<div class="nav-panel">
<p>
Previous: <a href="#Trillek-TR3200-cpu-module" accesskey="p" rel="prev">Trillek TR3200 cpu module</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<h2 class="chapter" id="Interface-1"><span>38 Interface<a class="copiable-link" href="#Interface-1"> &para;</a></span></h2>

<ul class="mini-toc">
<li><a href="#Introduction-1" accesskey="1">Introduction</a></li>
<li><a href="#Building-vasm" accesskey="2">Building vasm</a></li>
<li><a href="#vasm-global-variables" accesskey="3">vasm global variables</a></li>
<li><a href="#General-data-structures" accesskey="4">General data structures</a></li>
<li><a href="#Support-Functions" accesskey="5">Support Functions</a></li>
<li><a href="#Syntax-modules" accesskey="6">Syntax modules</a></li>
<li><a href="#CPU-modules" accesskey="7">CPU modules</a></li>
<li><a href="#Output-modules" accesskey="8">Output modules</a></li>
</ul>
<div class="section-level-extent" id="Introduction-1">
<h3 class="section"><span>38.1 Introduction<a class="copiable-link" href="#Introduction-1"> &para;</a></span></h3>

<p>This chapter is under construction!
</p>

<p>This chapter describes some of the internals of <code class="command">vasm</code>
and tries to explain
what has to be done to write a cpu module, a syntax module
or an output module for <code class="command">vasm</code>.
However, if someone wants to write one, I suggest to contact me first,
so that it can be integrated into the source tree.
</p>
<p>Note that this documentation may mention explicit values when introducing
symbolic constants. This is due to copying and pasting from the source
code. These values may not be up to date and in some cases can be overridden.
Therefore do never use the absolute values but rather the symbolic
representations.
</p>

</div>
<div class="section-level-extent" id="Building-vasm">
<h3 class="section"><span>38.2 Building vasm<a class="copiable-link" href="#Building-vasm"> &para;</a></span></h3>

<p>This section deals with the steps necessary to build the typical
<code class="command">vasm</code> executable from the sources.
</p>
<ul class="mini-toc">
<li><a href="#Directory-Structure" accesskey="1">Directory Structure</a></li>
<li><a href="#Adapting-the-Makefile" accesskey="2">Adapting the Makefile</a></li>
<li><a href="#Building-vasm-1" accesskey="3">Building vasm</a></li>
</ul>
<div class="subsection-level-extent" id="Directory-Structure">
<h4 class="subsection"><span>38.2.1 Directory Structure<a class="copiable-link" href="#Directory-Structure"> &para;</a></span></h4>

<p>The vasm-directory contains the following important files and
    directories:
</p><dl class="table">
<dt><samp class="file">vasm/</samp></dt>
<dd><p>The main directory containing the assembler sources.
</p>
</dd>
<dt><samp class="file">vasm/Makefile</samp></dt>
<dd><p>The Makefile used to build <code class="command">vasm</code>.
</p>
</dd>
<dt><samp class="file">vasm/syntax/&lt;syntax-module&gt;/</samp></dt>
<dd><p>Directories for the syntax modules.
</p>
</dd>
<dt><samp class="file">vasm/cpus/&lt;cpu-module&gt;/</samp></dt>
<dd><p>Directories for the cpu modules.
</p>
</dd>
<dt><samp class="file">vasm/obj/</samp></dt>
<dd><p>Directory the object files will be stored in.
</p>
</dd>
</dl>

<p>All compiling is done from the main directory and
    the executables will be placed there as well.
    The main assembler for a combination of <code class="code">&lt;cpu&gt;</code> and
    <code class="code">&lt;syntax&gt;</code> will be called <code class="command">vasm&lt;cpu&gt;_&lt;syntax&gt;</code>.
    All output modules are usually integrated in every executable
    and can be selected at runtime. Otherwise you have to adapt
    the <code class="code">OUTFMTS</code> definition in <samp class="file">make.rules</samp> and select
    those you want.
</p>
</div>
<div class="subsection-level-extent" id="Adapting-the-Makefile">
<h4 class="subsection"><span>38.2.2 Adapting the Makefile<a class="copiable-link" href="#Adapting-the-Makefile"> &para;</a></span></h4>

<p>Before building anything you have to insert correct values for
    your compiler and operating system in the <samp class="file">Makefile</samp>.
</p>
<dl class="table">
<dt><code class="code">TARGET</code></dt>
<dd><p>Here you may define an extension which is appended to the executable&rsquo;s
       name. Useful, if you build various targets in the same directory.
</p>
</dd>
<dt><code class="code">TARGETEXTENSION</code></dt>
<dd><p>Defines the file name extension for executable files. Not needed for
       most operating systems. For Windows it would be <samp class="file">.exe</samp>.
</p>
</dd>
<dt><code class="code">CC</code></dt>
<dd><p>Here you have to insert a command that invokes an ANSI C
       compiler you want to use to build vasm. It must support
       the <samp class="option">-I</samp> option in the same way like e.g. <code class="command">vc</code> or
       <code class="command">gcc</code>.
</p>
</dd>
<dt><code class="code">COPTS</code></dt>
<dd><p>Here you will usually define an option like <samp class="option">-c</samp> to instruct
       the compiler to generate an object file.
       Additional options, like the optimization level, should also be
       inserted here as well. Specifying the host OS helps to determine
       work-directories for DWARF and defines the appropriate internal
       symbol for the host&rsquo;s file system path style. The following are
       supported:
       </p><dl class="table">
<dt><code class="code">-DAMIGA</code></dt>
<dd><p>AmigaOS (M68k or PPC), MorphOS, AROS.
          Defines the internal symbol <code class="code">__AMIGAFS</code>.
          </p></dd>
<dt><code class="code">-DATARI</code></dt>
<dd><p>Atari TOS.
          Defines the internal symbol <code class="code">__MSDOSFS</code>.
          </p></dd>
<dt><code class="code">-DMSDOS</code></dt>
<dd><p>CP/M, MS-DOS, Windows.
          Defines the internal symbol <code class="code">__MSDOSFS</code>.
          </p></dd>
<dt><code class="code">-DUNIX</code></dt>
<dd><p>All kinds of Unix (Linux, BSD) including MacOSX and Atari-MiNT.
          Defines the internal symbol <code class="code">__UNIXFS</code>.
          </p></dd>
<dt><code class="code">-D_WIN32</code></dt>
<dd><p>Windows.
          Defines the internal symbol <code class="code">__MSDOSFS</code>.
       </p></dd>
</dl>
<p>Building without specifying a host-OS is allowed. Then vasm
       defaults to Unix-style path handling and will not define a
       file system symbol for conditional assembly.
       Other options:
       </p><dl class="table">
<dt><code class="code">-DLOWMEM</code></dt>
<dd><p>Builds for a host-OS with a low amount of memory. This will
          basically reduce all hash tables to minimal size.
       </p></dd>
</dl>

</dd>
<dt><code class="code">CCOUT</code></dt>
<dd><p>Here you define the option which is used to specify the name of
       an output file, which is usually <samp class="option">-o</samp>.
</p>
</dd>
<dt><code class="code">LD</code></dt>
<dd><p>Here you insert a command which starts the linker. This may be the
       the same as under <code class="code">CC</code>.
</p>
</dd>
<dt><code class="code">LDFLAGS</code></dt>
<dd><p>Here you have to add options which are necessary for linking.
       E.g. some compilers need special libraries for floating-point.
</p>
</dd>
<dt><code class="code">LDOUT</code></dt>
<dd><p>Here you define the option which is used by the linker to specify
       the output file name.
</p>
</dd>
<dt><code class="code">RM</code></dt>
<dd><p>Specify a command to delete a file, e.g. <code class="code">rm -f</code>.
</p></dd>
</dl>

<p>An example for the Amiga using <code class="command">vbcc</code> would be:
</p><div class="example">
<pre class="example-preformatted">      TARGET = _os3
      TARGETEXTENSION =
      CC = vc +aos68k
      CCOUT = -o
      COPTS = -c -c99 -cpu=68020 -DAMIGA -O1
      LD = $(CC)
      LDOUT = $(CCOUT)
      LDFLAGS = -lmieee
      RM = delete force quiet
</pre></div>

<p>An example for a typical Unix-installation would be:
</p><div class="example">
<pre class="example-preformatted">      TARGET =
      TARGETEXTENSION =
      CC = gcc
      CCOUT = -o
      COPTS = -c -O2
      LD = $(CC)
      LDOUT = $(CCOUT)
      LDFLAGS = -lm
      RM = rm -f
</pre></div>

<p>Open/Net/Free/Any BSD systems will probably require an additional
<samp class="option">-D_ANSI_SOURCE</samp> in <code class="code">COPTS</code>.
</p>

</div>
<div class="subsection-level-extent" id="Building-vasm-1">
<h4 class="subsection"><span>38.2.3 Building vasm<a class="copiable-link" href="#Building-vasm-1"> &para;</a></span></h4>

<p>Note to users of BSD systems: You will probably have to use
GNU make instead of BSD make, i.e. in the following examples replace &quot;make&quot;
with &quot;gmake&quot;.
</p>
<p>Type:
</p><div class="example">
<pre class="example-preformatted">      make CPU=&lt;cpu&gt; SYNTAX=&lt;syntax&gt;
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example-preformatted">      make CPU=ppc SYNTAX=std
</pre></div>

<p>The following CPU modules can be selected:
</p><ul class="itemize mark-bullet">
<li><code class="code">CPU=6502</code>
</li><li><code class="code">CPU=6800</code>
</li><li><code class="code">CPU=6809</code>
</li><li><code class="code">CPU=arm</code>
</li><li><code class="code">CPU=c16x</code>
</li><li><code class="code">CPU=hans</code>
</li><li><code class="code">CPU=jagrisc</code>
</li><li><code class="code">CPU=m68k</code>
</li><li><code class="code">CPU=pdp11</code>
</li><li><code class="code">CPU=ppc</code>
</li><li><code class="code">CPU=qnice</code>
</li><li><code class="code">CPU=spc700</code>
</li><li><code class="code">CPU=test</code>
</li><li><code class="code">CPU=tr3200</code>
</li><li><code class="code">CPU=unsp</code>
</li><li><code class="code">CPU=vidcore</code>
</li><li><code class="code">CPU=x86</code>
</li><li><code class="code">CPU=z80</code>
</li></ul>

<p>The following syntax modules can be selected:
</p><ul class="itemize mark-bullet">
<li><code class="code">SYNTAX=std</code>
</li><li><code class="code">SYNTAX=mot</code>
</li><li><code class="code">SYNTAX=madmac</code>
</li><li><code class="code">SYNTAX=oldstyle</code>
</li><li><code class="code">SYNTAX=test</code>
</li></ul>

<p>For Windows and various Amiga targets there are already Makefiles included,
which you may either copy on top of the default <samp class="file">Makefile</samp>, or call
it explicitly with <code class="command">make</code>&rsquo;s <samp class="option">-f</samp> option:
</p><div class="example">
<pre class="example-preformatted">    make -f Makefile.OS4 CPU=ppc SYNTAX=std
</pre></div>


</div>
</div>
<div class="section-level-extent" id="vasm-global-variables">
<h3 class="section"><span>38.3 vasm global variables<a class="copiable-link" href="#vasm-global-variables"> &para;</a></span></h3>

<p>Important global variables, which may be read or modified by
syntax-, cpu- or output-modules.
</p>
<dl class="table">
<dt><code class="code">source *cur_src;</code></dt>
<dd><p>Pointer to the current source text instance (see structures below).
</p>
</dd>
<dt><code class="code">char *defsectname;</code></dt>
<dd><p>Name of a default section which vasm creates when a label or code occurs
in the source without any preceding <code class="code">section</code> or <code class="code">org</code> directive.
Assigning NULL means that the default is an absolute section and its
base address is taken from <code class="code">defsectorg</code>.
These <code class="code">defsect...</code> variables can be overridden by syntax- or
output-modules.
</p>
</dd>
<dt><code class="code">taddr defsectorg;</code></dt>
<dd><p>Used when <code class="code">defsectname==NULL</code>. Defines the base address of a default
absolute <code class="code">org</code> section.
</p>
</dd>
<dt><code class="code">char *defsecttype;</code></dt>
<dd><p>Attributes of the default section (see above). May be NULL to indicate
that no default has been defined and vasm will show an error.
</p>
</dd>
<dt><code class="code">char emptystr[];</code></dt>
<dd><p>An empty string (zero length).
</p>
</dd>
<dt><code class="code">int exec_out;</code></dt>
<dd><p>Non-zero, when the output file is an executable and not an object file.
</p>
</dd>
<dt><code class="code">char *filename;</code></dt>
<dd><p>Defaults to the file part of the input source file name. Syntax modules
may modify it with <code class="code">setfilename(char *)</code> and output modules may
use it for their own purpose.
</p>
</dd>
<dt><code class="code">char *inname;</code></dt>
<dd><p>Input source file name.
</p>
</dd>
<dt><code class="code">int octetsperbyte;</code></dt>
<dd><p>Number of 8-bit bytes used to represent a backend&rsquo;s target-byte. The macro
<code class="code">OCTETS(n)</code> may be used to calculate the number of 8-bit bytes for
<code class="code">n</code> target-bytes.
</p>
</dd>
<dt><code class="code">char *outname;</code></dt>
<dd><p>Output object file name.
</p>
</dd>
<dt><code class="code">int output_bitsperbyte;</code></dt>
<dd><p>May be assigned by an output module with <code class="code">1</code> during its init function,
to indicate that it supports target-bytes with <code class="code">BITSPERBYTE</code>.
Otherwise an output module is expected to support 8-bit bytes only.
</p>
</dd>
</dl>


</div>
<div class="section-level-extent" id="General-data-structures">
<h3 class="section"><span>38.4 General data structures<a class="copiable-link" href="#General-data-structures"> &para;</a></span></h3>

<p>This section describes the fundamental data structures used in vasm
which are usually necessary to understand for writing any kind of
module (cpu, syntax or output). More detailed information is given in
the respective sections on writing specific modules where necessary.
</p>
<ul class="mini-toc">
<li><a href="#Source" accesskey="1">Source</a></li>
<li><a href="#Sections" accesskey="2">Sections</a></li>
<li><a href="#Symbols-1" accesskey="3">Symbols</a></li>
<li><a href="#Register-symbols" accesskey="4">Register symbols</a></li>
<li><a href="#Atoms" accesskey="5">Atoms</a></li>
<li><a href="#Relocations" accesskey="6">Relocations</a></li>
<li><a href="#CPU_002dspecific-Relocations" accesskey="7">CPU-specific Relocations</a></li>
<li><a href="#Errors" accesskey="8">Errors</a></li>
</ul>
<div class="subsection-level-extent" id="Source">
<h4 class="subsection"><span>38.4.1 Source<a class="copiable-link" href="#Source"> &para;</a></span></h4>

<p>A source structure represents a source text module, which can be
either the main source text, an included file, a macro or a repetition.
There is always a link to the parent source from where the current
source context was included or called.
</p>
<dl class="table">
<dt><code class="code">struct source *parent;</code></dt>
<dd><p>Pointer to the parent source context. Assembly continues there
        when the current source context ends.
</p>
</dd>
<dt><code class="code">int parent_line;</code></dt>
<dd><p>Line number in the parent source context, from where we were called.
        This information is needed, because line numbers are only reliable
        during parsing and later from the atoms. But an include directive
        doesn&rsquo;t create an atom.
</p>
</dd>
<dt><code class="code">struct source_file *srcfile;</code></dt>
<dd><p>The <code class="code">source_file</code> structure has the unique file name, index
        and text-pointer for this source text instance.
        Used for debugging output, like DWARF.
</p>
</dd>
<dt><code class="code">char *name;</code></dt>
<dd><p>File name of the main source or include file, or macro name.
</p>
</dd>
<dt><code class="code">char *text;</code></dt>
<dd><p>Pointer to the source text start.
</p>
</dd>
<dt><code class="code">size_t size;</code></dt>
<dd><p>Size of the source text to assemble in bytes.
</p>
</dd>
<dt><code class="code">struct source *defsrc;</code></dt>
<dd><p>This is a <code class="code">NULL</code>-pointer for real source text files. Otherwise
        it is a reference to the source which defines the current macro
        or repetition.
</p>
</dd>
<dt><code class="code">int defline;</code></dt>
<dd><p>Valid when <code class="code">defsrc</code> is not <code class="code">NULL</code>. Contains the starting
        line number of a macro or repetition in a source text file.
</p>
</dd>
<dt><code class="code">macro *macro;</code></dt>
<dd><p>Pointer to macro structure, when currently inside a macro
        (see also <code class="code">num_params</code>).
</p>
</dd>
<dt><code class="code">unsigned long repeat;</code></dt>
<dd><p>Number of repetitions of this source text. Usually this is 1, but
        for text blocks between a <code class="code">rept</code> and <code class="code">endr</code> (or similar)
        directive it allows any number of repetitions, which is decremented
        every time the end of the source text block is reached.
</p>
</dd>
<dt><code class="code">long reptn;</code></dt>
<dd><p>Current value of the repetition
        counter symbol in this source instance. So it can be restored when
        reentering this instance.
</p>
</dd>
<dt><code class="code">char *reptcntname;</code></dt>
<dd><p>Name of an optional iterator symbol (when <code class="code">reptcntname</code> is not
        <code class="code">NULL</code>), which is set to the current value of <code class="code">reptn</code>.
</p>
</dd>
<dt><code class="code">char *irpname;</code></dt>
<dd><p>Name of the iterator symbol in special repeat loops, which use a
        sequence of arbitrary values, being assigned to this symbol within
        the loop. Example: <code class="code">irp</code> directive in std-syntax.
</p>
</dd>
<dt><code class="code">struct macarg *irpvals;</code></dt>
<dd><p>A list of arbitrary values to iterate over in a loop. With each
        iteration the frontmost value is removed from the list until it is
        empty.
</p>
</dd>
<dt><code class="code">int cond_level;</code></dt>
<dd><p>Current level of conditional nesting while entering this source
        text. It is automatically restored to the previous level when
        leaving the source prematurely through <code class="code">end_source()</code>.
</p>
</dd>
<dt><code class="code">struct macarg *argnames;</code></dt>
<dd><p>The current list of named macro arguments.
</p>
</dd>
<dt><code class="code">int num_params;</code></dt>
<dd><p>Number of macro parameters passed at the invocation point from
        the parent source. For normal source files this entry will be -1.
        For macros 0 (no parameters) or higher.
</p>
</dd>
<dt><code class="code">char *param[MAXMACPARAMS];</code></dt>
<dd><p>Pointers to the macro arguments.
</p>
</dd>
<dt><code class="code">int param_len[MAXMACPARAMS];</code></dt>
<dd><p>Number of characters per macro argument.
</p>
</dd>
<dt><code class="code">int num_quals;</code></dt>
<dd><p>(If <code class="code">MAX_QUALIFIERS!=0</code>.) Number of qualifiers for a macro.
        when not passed on invocation these are the default qualifiers.
</p>
</dd>
<dt><code class="code">char *qual[MAX_QUALIFIERS];</code></dt>
<dd><p>(If <code class="code">MAX_QUALIFIERS!=0</code>.) Pointer to macro qualifiers.
</p>
</dd>
<dt><code class="code">int qual_len[MAX_QUALIFIERS];</code></dt>
<dd><p>(If <code class="code">MAX_QUALIFIERS!=0</code>.) Number of characters per macro qualifier.
</p>
</dd>
<dt><code class="code">unsigned long id;</code></dt>
<dd><p>Every source has its unique id. Useful for macros supporting
        the special <code class="code">\@</code> argument for creating unique labels.
</p>
</dd>
<dt><code class="code">char *srcptr;</code></dt>
<dd><p>The current source text pointer, pointing to the beginning of
        the next line to assemble.
</p>
</dd>
<dt><code class="code">int line;</code></dt>
<dd><p>Line number in the current source context. After parsing, the
        line number of the current atom is stored here.
</p>
</dd>
<dt><code class="code">size_t bufsize;</code></dt>
<dd><p>Current size of the line buffer (<code class="code">linebuf</code>). The size of the
        line buffer is extended automatically, when an overflow happens.
</p>
</dd>
<dt><code class="code">char *linebuf;</code></dt>
<dd><p>A buffer for the current line being assembled
        in this source text. A child-source, like a macro, can refer to
        arguments from this buffer, so every source has got its own.
        When returning to the parent source, the linebuf is deallocated
        to save memory.
</p>
</dd>
<dt><code class="code">expr *cargexp;</code></dt>
<dd><p>(If <code class="code">CARGSYM</code> was defined.) Pointer to the current expression
        assigned to the CARG-symbol (used to select a macro argument) in
        this source instance. So it can be restored when reentering this
        instance.
</p></dd>
</dl>

</div>
<div class="subsection-level-extent" id="Sections">
<h4 class="subsection"><span>38.4.2 Sections<a class="copiable-link" href="#Sections"> &para;</a></span></h4>

<p>One of the top level structures is a linked list of sections describing
continuous blocks of memory. A section is specified by an object of
type <code class="code">section</code> with the following members that can be accessed by
the modules:
</p>
<dl class="table">
<dt><code class="code">struct section *next;</code></dt>
<dd><p>A pointer to the next section in the list.
</p>
</dd>
<dt><code class="code">char *name;</code></dt>
<dd><p>The name of the section.
</p>
</dd>
<dt><code class="code">char *attr;</code></dt>
<dd><p>A string describing the section flags in ELF notation (see,
        for example, documentation of the <code class="code">.section</code> directive in
        the standard syntax module).
</p>
</dd>
<dt><code class="code">atom *first;</code></dt>
<dt><code class="code">atom *last;</code></dt>
<dd><p>Pointers to the first and last atom of the section. See following
        sections for information on atoms.
</p>
</dd>
<dt><code class="code">taddr align;</code></dt>
<dd><p>Alignment of the section in target-bytes.
</p>
</dd>
<dt><code class="code">uint32_t flags;</code></dt>
<dd><p>Flags of the section. Currently available flags are:
</p><dl class="table">
<dt><code class="code">HAS_SYMBOLS</code></dt>
<dd><p>At least one symbol is defined in this section.
</p></dd>
<dt><code class="code">RESOLVE_WARN</code></dt>
<dd><p>The current atom changed its size multiple times, so atom_size()
        is now called with this flag set in its section to make the
        backend (e.g. <code class="code">instruction_size()</code>) aware of it and do less
        aggressive optimizations.
</p></dd>
<dt><code class="code">UNALLOCATED</code></dt>
<dd><p>Section is unallocated, which means it doesn&rsquo;t use any memory space
        in the output file. Such a section will be removed before creating
        the output file and all its labels converted into absolute expression
        symbols. Used for &quot;offset&quot; sections. Refer to
        <code class="code">switch_offset_section()</code>.
</p></dd>
<dt><code class="code">LABELS_ARE_LOCAL</code></dt>
<dd><p>As long as this flag is set new labels in a section are defined
        as local labels, with the section name as global parent label.
</p></dd>
<dt><code class="code">ABSOLUTE</code></dt>
<dd><p>Section is loaded at an absolute address in memory.
</p></dd>
<dt><code class="code">PREVABS</code></dt>
<dd><p>Remembers state of the <code class="code">ABSOLUTE</code> flag before entering
        relocated-<code class="code">org</code> mode (<code class="code">IN_RORG</code>). So it can be restored later.
</p></dd>
<dt><code class="code">IN_RORG</code></dt>
<dd><p>Section has entered relocated-org mode, which also sets the
        <code class="code">ABSOLUTE</code> flag. In this mode code is written into the current
        section, but relocated to an absolute address. No relocation
        table entries are generated.
</p></dd>
<dt><code class="code">NEAR_ADDRESSING</code></dt>
<dd><p>Section is marked as suitable for cpu-specific &quot;near&quot; addressing
        modes. For example, base-register relative or zero/direct-page.
        The cpu backend can use this information as an optimization hint
        when referencing symbols from this section.
</p></dd>
<dt><code class="code">FAR_ADDRESSING</code></dt>
<dd><p>Section requires cpu-specific &quot;far&quot; addressing modes. For example
        an addressing mode including the bank or &quot;segment&quot;. The cpu backend
        may use this information to select appropriate addressing modes
        when referencing symbols from this section.
</p></dd>
</dl>

</dd>
<dt><code class="code">taddr org;</code></dt>
<dd><p>Start address of a section. Usually zero.
        Set to an absolute start address in <code class="code">ABSOLUTE</code> mode.
</p>
</dd>
<dt><code class="code">taddr pc;</code></dt>
<dd><p>Current address in this section. Can be used
        while traversing through the section. Has to be updated by a
        module using it. Is set to <code class="code">org</code> at the beginning.
</p>
</dd>
<dt><code class="code">unsigned long idx;</code></dt>
<dd><p>A member usable by the output module for private purposes.
</p>
</dd>
</dl>

</div>
<div class="subsection-level-extent" id="Symbols-1">
<h4 class="subsection"><span>38.4.3 Symbols<a class="copiable-link" href="#Symbols-1"> &para;</a></span></h4>

<p>Symbols are represented by a linked list of type <code class="code">symbol</code> with the
following members that can be accessed by the modules:.
</p>
<dl class="table">
<dt><code class="code">int type;</code></dt>
<dd><p>Type of the symbol. Available are:
</p><dl class="table">
<dt><code class="code">#define LABSYM 1</code></dt>
<dd><p>The symbol is a label defined at a specific location.
</p>
</dd>
<dt><code class="code">#define IMPORT 2</code></dt>
<dd><p>The symbol is externally defined and its value is unknown.
</p>
</dd>
<dt><code class="code">#define EXPRESSION 3</code></dt>
<dd><p>The symbol is defined using an expression (equate).
</p></dd>
</dl>

</dd>
<dt><code class="code">uint32_t flags;</code></dt>
<dd><p>Flags of this symbol. Available are:
</p><dl class="table">
<dt><code class="code">#define TYPE_UNKNOWN  0</code></dt>
<dd><p>The symbol has no type information.
</p>
</dd>
<dt><code class="code">#define TYPE_OBJECT   1</code></dt>
<dd><p>The symbol defines an object.
</p>
</dd>
<dt><code class="code">#define TYPE_FUNCTION 2</code></dt>
<dd><p>The symbol defines a function.
</p>
</dd>
<dt><code class="code">#define TYPE_SECTION  3</code></dt>
<dd><p>The symbol defines a section.
</p>
</dd>
<dt><code class="code">#define TYPE_FILE     4</code></dt>
<dd><p>The symbol defines a file.  
</p>
</dd>
<dt><code class="code">#define EXPORT (1&lt;&lt;3)</code></dt>
<dd><p>The symbol is exported to other object files.
</p>
</dd>
<dt><code class="code">#define INEVAL (1&lt;&lt;4)</code></dt>
<dd><p>Used internally.
</p>
</dd>
<dt><code class="code">#define COMMON (1&lt;&lt;5)</code></dt>
<dd><p>The symbol is a common symbol and also has a size.
        It will be allocated by the linker.
</p>
</dd>
<dt><code class="code">#define WEAK (1&lt;&lt;6)</code></dt>
<dd><p>The symbol is weak, which means the linker may overwrite it with
        any global definition of the same name. Weak symbols may also stay
        undefined, in which case the linker would assign them a value of
        zero.
</p>
</dd>
<dt><code class="code">#define LOCAL (1&lt;&lt;7)</code></dt>
<dd><p>Only informational. A symbol can be explicitly declared as local
        by a syntax-module directive. Otherwise all symbols without the
        <code class="code">EXPORT</code> flag are not considered for object linking.
</p>
</dd>
<dt><code class="code">#define VASMINTERN (1&lt;&lt;8)</code></dt>
<dd><p>Vasm-internal symbol, which must not be exported into an object
        file.
</p>
</dd>
<dt><code class="code">#define PROTECTED (1&lt;&lt;9)</code></dt>
<dd><p>Used internally to protect the current-PC symbol from deletion.
</p>
</dd>
<dt><code class="code">#define REFERENCED (1&lt;&lt;10)</code></dt>
<dd><p>Symbol was referenced in the source and a relocation entry has
        been created.
</p>
</dd>
<dt><code class="code">#define ABSLABEL (1&lt;&lt;11)</code></dt>
<dd><p>Label was defined inside an absolute section, or during a code block
        in relocated-org mode. Therefore it has an absolute address and will
        not generate a relocation entry when being referenced.
</p>
</dd>
<dt><code class="code">#define EQUATE (1&lt;&lt;12)</code></dt>
<dd><p>Symbols flagged as <code class="code">EQUATE</code> are constant expressions and their
        value must not be changed.
</p>
</dd>
<dt><code class="code">#define REGLIST (1&lt;&lt;13)</code></dt>
<dd><p>Symbol is a register list definition.
</p>
</dd>
<dt><code class="code">#define USED (1&lt;&lt;14)</code></dt>
<dd><p>Symbol appeared in an expression. Symbols which were only defined,
        (as label or equate) and otherwise never appear throughout the
        whole source, don&rsquo;t get this flag set.
</p>
</dd>
<dt><code class="code">#define NEAR (1&lt;&lt;15)</code></dt>
<dd><p>Symbol may be referenced by &quot;near&quot; addressing mode. For example,
        base register relative. Used as an optimization hint to the cpu
        backend.
</p>
</dd>
<dt><code class="code">#define XDEF (1&lt;&lt;16)</code></dt>
<dd><p>This symbol must become defined in the source. Which means
        its <code class="code">type</code> must not remain <code class="code">IMPORT</code>. Otherwise a
        warning is displayed.
</p>
</dd>
<dt><code class="code">#define XREF (1&lt;&lt;17)</code></dt>
<dd><p>Symbol is externally defined and its <code class="code">type</code> must never
        become something else than <code class="code">IMPORT</code>. Otherwise an error
        is displayed.
</p>
</dd>
<dt><code class="code">#define RSRVD_S (1L&lt;&lt;24)</code></dt>
<dd><p>The range from bit 24 to 27 (counted from the LSB) is reserved for
        use by the syntax module.
</p>
</dd>
<dt><code class="code">#define RSRVD_O (1L&lt;&lt;28)</code></dt>
<dd><p>The range from bit 28 to 31 (counted from the LSB) is reserved for
        use by the output module.
</p></dd>
</dl>

<p>The type-flags can be extracted using the <code class="code">TYPE()</code> macro which
expects a pointer to a symbol as argument.
</p>
</dd>
<dt><code class="code">char *name;</code></dt>
<dd><p>The name of the symbol.
</p>
</dd>
<dt><code class="code">expr *expr;</code></dt>
<dd><p>The expression in case of <code class="code">EXPRESSION</code> symbols.
</p>
</dd>
<dt><code class="code">expr *size;</code></dt>
<dd><p>The size of the symbol in target-bytes, if specified.
        Common symbols always have a size.
</p>
</dd>
<dt><code class="code">section *sec;</code></dt>
<dd><p>The section a <code class="code">LABSYM</code> symbol is defined in.
</p>
</dd>
<dt><code class="code">taddr pc;</code></dt>
<dd><p>The address of a <code class="code">LABSYM</code> symbol.
</p>
</dd>
<dt><code class="code">taddr align;</code></dt>
<dd><p>The alignment of the symbol in target-bytes.
</p>
</dd>
<dt><code class="code">unsigned long idx;</code></dt>
<dd><p>A member usable by the output module for private purposes.
</p>
</dd>
</dl>

</div>
<div class="subsection-level-extent" id="Register-symbols">
<h4 class="subsection"><span>38.4.4 Register symbols<a class="copiable-link" href="#Register-symbols"> &para;</a></span></h4>

<p>Optional register symbols are available when the backend defines
<code class="code">HAVE_REGSYMS</code> in <samp class="file">cpu.h</samp> together with the hash table size.
Example:
</p><div class="example">
<pre class="example-preformatted">#define HAVE_REGSYMS
#define REGSYMHTSIZE 256
</pre></div>

<p>A register symbol is defined by an object of type <code class="code">regsym</code>
with the following members that can be accessed by the modules:
</p>
<dl class="table">
<dt><code class="code">char *reg_name;</code></dt>
<dd><p>Symbol name.
</p></dd>
<dt><code class="code">int reg_type;</code></dt>
<dd><p>Optional type of register.
</p></dd>
<dt><code class="code">unsigned int reg_flags;</code></dt>
<dd><p>Optional register symbol flags.
</p></dd>
<dt><code class="code">unsigned int reg_num;</code></dt>
<dd><p>Register number or value.
</p></dd>
</dl>

<p>Refer to <samp class="file">symbol.h</samp> for functions to create and find register
symbols.
</p>
</div>
<div class="subsection-level-extent" id="Atoms">
<h4 class="subsection"><span>38.4.5 Atoms<a class="copiable-link" href="#Atoms"> &para;</a></span></h4>

<p>The contents of each section are a linked list built out of non-separable
atoms. The general structure of an atom is:
</p>
<div class="example">
<pre class="example-preformatted">struct atom {
  struct atom *next;
  int type;
  taddr align;
  taddr lastsize;
  unsigned changes;
  source *src;
  int line;
  listing *list;
  union {
    instruction *inst;
    dblock *db;
    symbol *label;
    sblock *sb;
    defblock *defb;
    void *opts;
    int srcline;
    char *ptext;
    printexpr *pexpr;
    expr *roffs;
    taddr *rorg;
    assertion *assert;
    aoutnlist *nlist;
  } content;
};
</pre></div>

<p>The members have the following meaning:
</p>
<dl class="table">
<dt><code class="code">struct atom *next;</code></dt>
<dd><p>Pointer to the following atom (<code class="code">NULL</code> if last).
</p>
</dd>
<dt><code class="code">int type;</code></dt>
<dd><p>The type of the atom. Can be one of
</p><dl class="table">
<dt><code class="code">#define VASMDEBUG 0</code></dt>
<dd><p>Used for internal debugging.
</p>
</dd>
<dt><code class="code">#define LABEL 1</code></dt>
<dd><p>A label is defined here.
</p>
</dd>
<dt><code class="code">#define DATA  2</code></dt>
<dd><p>A fixed number of target-bytes with constant data are put here.
</p>
</dd>
<dt><code class="code">#define INSTRUCTION 3</code></dt>
<dd><p>Generally refers to a machine instruction or pseudo/opcode. These atoms
can change their size during optimization passes and will be translated to
<code class="code">DATA</code>-atoms later.
</p>
</dd>
<dt><code class="code">#define SPACE 4</code></dt>
<dd><p>Defines a block of data filled with one value of a given size (up to
<code class="code">MAXPADSIZE</code> 8-bit bytes). BSS sections usually contain only such atoms,
but they are also sometimes useful as shorter versions of
<code class="code">DATA</code>-atoms in other sections.
</p>
</dd>
<dt><code class="code">#define DATADEF 5</code></dt>
<dd><p>Defines data of fixed size which can contain cpu specific operands and
expressions. Usually generated by data in a source text, which are no
machine instructions. Will be translated to <code class="code">DATA</code>-atoms later.
</p>
</dd>
<dt><code class="code">#define LINE 6</code></dt>
<dd><p>A source text line number (usually from a higher level language) is bound
to the atom&rsquo;s address. Useful for source level debugging in certain ABIs.
</p>
</dd>
<dt><code class="code">#define OPTS 7</code></dt>
<dd><p>A means to change assembler options at a specific source text line.
For example optimization settings, or the cpu type to generate code for.
The cpu backend has to define <code class="code">HAVE_CPU_OPTS</code> and export the required
functions if it wants to use this type of atom.
</p>
</dd>
<dt><code class="code">#define PRINTTEXT 8</code></dt>
<dd><p>A string is printed to stdout during the final assembler pass. A newline
is automatically appended.
</p>
</dd>
<dt><code class="code">#define PRINTEXPR 9</code></dt>
<dd><p>Prints the value of an expression during the final assembler pass to stdout.
</p>
</dd>
<dt><code class="code">#define ROFFS 10</code></dt>
<dd><p>Set the program counter to an address relative to the section&rsquo;s start
address. These atoms will be translated into <code class="code">SPACE</code> atoms in the
final pass.
</p>
</dd>
<dt><code class="code">#define RORG 11</code></dt>
<dd><p>Assemble this block under the given base address, while the code is still
written into the original memory region.
</p>
</dd>
<dt><code class="code">#define RORGEND 12</code></dt>
<dd><p>Ends a RORG block and returns to the original addressing.
</p>
</dd>
<dt><code class="code">#define ASSERT 13</code></dt>
<dd><p>The assertion expression is checked in the final pass and an error message
is generated (using the expression string and an optional message out of
this atom) when it evaluates to 0.
</p>
</dd>
<dt><code class="code">#define NLIST 14</code></dt>
<dd><p>Defines a stab-entry for the a.out object file format. nlist-style stabs
can also occur embedded in other object file formats, like ELF.
</p></dd>
</dl>

</dd>
<dt><code class="code">taddr align;</code></dt>
<dd><p>The alignment of this atom. Address must be dividable by <code class="code">align</code>.
</p>
</dd>
<dt><code class="code">taddr lastsize;</code></dt>
<dd><p>The size of this atom in the last resolver pass. When the size has
changed in the current pass, the assembler will request another resolver
run through the section.
</p>
</dd>
<dt><code class="code">unsigned changes;</code></dt>
<dd><p>Number of changes in the size of this atom since pass number
<code class="code">FASTOPTPHASE</code>. An increasing number usually indicates a problem in
the cpu backend&rsquo;s optimizer and will be flagged by setting
<code class="code">RESOLVE_WARN</code> in the Section flags, as soon as <code class="code">changes</code> exceeds
<code class="code">MAXSIZECHANGES</code>. So the backend can choose not to optimize this atom
as aggressive as before.
</p>
</dd>
<dt><code class="code">source *src;</code></dt>
<dd><p>Pointer to the source text object to which this atom belongs.
</p>
</dd>
<dt><code class="code">int line;</code></dt>
<dd><p>The source line number that created this atom.
</p>
</dd>
<dt><code class="code">listing *list;</code></dt>
<dd><p>Pointer to the listing file object to which this atom belongs.
</p>
</dd>
<dt><code class="code">instruction *inst;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to an instruction structure in the case
of an <code class="code">INSTRUCTION</code>-atom. Contains the following elements:
</p><dl class="table">
<dt><code class="code">int code;</code></dt>
<dd><p>The cpu specific code of this instruction.
</p>
</dd>
<dt><code class="code">char *qualifiers[MAX_QUALIFIERS];</code></dt>
<dd><p>(If <code class="code">MAX_QUALIFIERS!=0</code>.) Pointer to the qualifiers of this instruction.
</p>
</dd>
<dt><code class="code">operand *op[MAX_OPERANDS];</code></dt>
<dd><p>(If <code class="code">MAX_OPERANDS!=0</code>.) The cpu-specific operands of this instruction.
</p>
</dd>
<dt><code class="code">instruction_ext ext;</code></dt>
<dd><p>(If the cpu backend defines <code class="code">HAVE_INSTRUCTION_EXTENSION</code>.)
A cpu-specific structure. Typically used to store appropriate
opcodes, allowed addressing modes, supported cpu derivates etc.
</p></dd>
</dl>

</dd>
<dt><code class="code">dblock *db;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to a dblock structure in the case
of a <code class="code">DATA</code>-atom. Contains the following elements:
</p><dl class="table">
<dt><code class="code">taddr size;</code></dt>
<dd><p>The number of target-bytes stored in this atom.
</p>
</dd>
<dt><code class="code">uint8_t *data;</code></dt>
<dd><p>A pointer to the constant data. Consider using <code class="code">writebyte()</code> or
<code class="code">setval()</code> to write target-bytes which are different from 8 bits.
The internal ordering of target-bytes on an 8-bit host is big-endian,
and a target-byte will always allocate the next minimal number of
8-bit host-bytes. The macro <code class="code">OCTETS(n)</code> may be used to calculate
the number of host-bytes required to represent <code class="code">n</code> target-bytes.
</p>
</dd>
<dt><code class="code">rlist *relocs;</code></dt>
<dd><p>A pointer to relocation information for the data.
</p></dd>
</dl>

</dd>
<dt><code class="code">symbol *label;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to a symbol structure in the case
of a <code class="code">LABEL</code>-atom.
</p>
</dd>
<dt><code class="code">sblock *sb;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to a sblock structure in the case
of a <code class="code">SPACE</code>-atom. Contains the following elements:
</p><dl class="table">
<dt><code class="code">size_t space;</code></dt>
<dd><p>The number of space-elements (see below) to generate here.
</p>
</dd>
<dt><code class="code">expr *space_exp;</code></dt>
<dd><p>The above size as an expression, which will be evaluated during assembly
and copied to <code class="code">space</code> in the final pass.
</p>
</dd>
<dt><code class="code">size_t size;</code></dt>
<dd><p>The size of each space-element and of the fill-pattern in target-bytes.
</p>
</dd>
<dt><code class="code">uint8_t fill[MAXPADSIZE];</code></dt>
<dd><p>The fill pattern, up to MAXPADSIZE 8-bit bytes.
</p>
</dd>
<dt><code class="code">expr *fill_exp;</code></dt>
<dd><p>Optional. Evaluated and copied to <code class="code">fill</code> in the final pass, when not null.
</p>
</dd>
<dt><code class="code">rlist *relocs;</code></dt>
<dd><p>A pointer to relocation information for the space.
</p>
</dd>
<dt><code class="code">taddr maxalignbytes;</code></dt>
<dd><p>An optional number of maximum padding bytes to fulfil the atom&rsquo;s alignment
requirement. Zero means there is no restriction.
</p>
</dd>
<dt><code class="code">uint32_t flags;</code></dt>
<dd><dl class="table">
<dt><code class="code">SPC_UNINITIALIZED</code></dt>
<dd><p>This space is completely uninitialized. May be used as a hint by
        output modules.
</p></dd>
<dt><code class="code">SPC_DATABSS</code></dt>
<dd><p>The output module should not allocate any file space for this
        atom, when possible (example: DataBss section, as supported by
        the &quot;hunkexe&quot; output file format). It is not needed to set this
        flag when the output section is BSS.
</p></dd>
</dl>

</dd>
</dl>

</dd>
<dt><code class="code">defblock *defb;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to a defblock structure in the case
of a <code class="code">DATADEF</code>-atom. Contains the following elements:
</p><dl class="table">
<dt><code class="code">taddr bitsize;</code></dt>
<dd><p>The size of the definition in bits.
</p>
</dd>
<dt><code class="code">operand *op;</code></dt>
<dd><p>Pointer to a cpu-specific operand structure.
</p>
</dd>
</dl>

</dd>
<dt><code class="code">void *opts;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Points to a cpu-backend specific options object
in the case of a <code class="code">OPTS</code>-atom.
</p>
</dd>
<dt><code class="code">int srcline;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Line number for source level debugging in the
case of a <code class="code">LINE</code>-atom.
</p>
</dd>
<dt><code class="code">char *ptext;</code></dt>
<dd><p>(In union <code class="code">content</code>.) A string to print to stdout in case of a
<code class="code">PRINTTEXT</code>-atom.
</p>
</dd>
<dt><code class="code">printexpr *pexpr;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to a printexpr structure in the case of
a <code class="code">PRINTEXPR</code>-atom. Contains the following elements:
</p><dl class="table">
<dt><code class="code">expr *print_exp;</code></dt>
<dd><p>Pointer to an expression to evaluate and print.
</p>
</dd>
<dt><code class="code">short type;</code></dt>
<dd><p>Format type of the printed value. We can print as hexadecimal
(<code class="code">PEXP_HEX</code>), signed decimal (<code class="code">PEXP_SDEC</code>),
unsigned decimal (<code class="code">PEXP_UDEC</code>), binary (<code class="code">PEXP_BIN</code>) OR
ASCII (<code class="code">PEXP_ASC</code>).
</p>
</dd>
<dt><code class="code">short size;</code></dt>
<dd><p>Size (precision) of the printed value in bits. Excessive bits will be
masked out, and sign-extended when requested.
</p></dd>
</dl>

</dd>
<dt><code class="code">expr *roffs;</code></dt>
<dd><p>(In union <code class="code">content</code>.) The expression holds the relative section offset
to align to in case of a <code class="code">ROFFS</code>-atom.
</p>
</dd>
<dt><code class="code">taddr *rorg;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Assemble the code under the base address in
<code class="code">rorg</code> in case of a <code class="code">RORG</code>-atom.
</p>
</dd>
<dt><code class="code">assertion *assert;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to an assertion structure in the case of
an <code class="code">ASSERT</code>-atom. Contains the following elements:
</p><dl class="table">
<dt><code class="code">expr *assert_exp;</code></dt>
<dd><p>Pointer to an expression which should evaluate to non-zero.
</p>
</dd>
<dt><code class="code">char *exprstr;</code></dt>
<dd><p>Pointer to the expression as text (to be used in the output).
</p>
</dd>
<dt><code class="code">char *msgstr;</code></dt>
<dd><p>Pointer to the message, which would be printed when <code class="code">assert_exp</code> evaluates
to zero.
</p></dd>
</dl>

</dd>
<dt><code class="code">aoutnlist *nlist;</code></dt>
<dd><p>(In union <code class="code">content</code>.) Pointer to an nlist structure, describing an
aout stab entry, in case of an <code class="code">NLIST</code>-atom. Contains the following
elements:
</p><dl class="table">
<dt><code class="code">char *name;</code></dt>
<dd><p>Name of the stab symbol.
</p></dd>
<dt><code class="code">int type;</code></dt>
<dd><p>Symbol type. Refer to <code class="code">stabs.h</code> for definitions.
</p></dd>
<dt><code class="code">int other;</code></dt>
<dd><p>Defines the nature of the symbol (function, object, etc.).
</p></dd>
<dt><code class="code">int desc;</code></dt>
<dd><p>Debugger information.
</p></dd>
<dt><code class="code">expr *value;</code></dt>
<dd><p>Symbol&rsquo;s value.
</p></dd>
</dl>

</dd>
</dl>

</div>
<div class="subsection-level-extent" id="Relocations">
<h4 class="subsection"><span>38.4.6 Relocations<a class="copiable-link" href="#Relocations"> &para;</a></span></h4>

<p><code class="code">DATA</code> and <code class="code">SPACE</code> atoms can have a relocation list attached
that describes how this data must be modified when linking/relocating.
They always refer to the data in this atom only.
</p>
<p>There are a number of predefined standard relocations and it is possible
to add other cpu-specific relocations. Note however, that it is always
preferable to use standard relocations, if possible. Chances that an
output module supports a certain relocation are much higher if it is a
standard relocation.
</p>
<p>A relocation list uses this structure:
</p>
<div class="example">
<pre class="example-preformatted">typedef struct rlist {
  struct rlist *next;
  void *reloc;
  int type;
} rlist;
</pre></div>

<p><code class="code">type</code> identifies the relocation type. All the standard relocations have
type numbers between <code class="code">FIRST_STANDARD_RELOC</code> and 
<code class="code">LAST_STANDARD_RELOC</code>. Consider <samp class="file">reloc.h</samp> to see which
standard relocations are available.
</p>
<p>Standard types may be combined with the modifier flags <code class="code">REL_MOD_S</code>
for signed and <code class="code">REL_MOD_U</code> for unsigned relocations. The default,
when both flags are missing, is to check the value being inserted into
the given relocation field against both ranges, signed and unsigned.
Setting both flags together is illegal!
</p>
<p>Typical signed relocations are PC-relative. An example for an
unsigned relocation would be a zero- or direct-page addressing mode
on the 6502/6809 families. If you are unsure, just don&rsquo;t set any of
these flags.
</p>
<p>To get access to the real standard relocation type, without any
flags, you have to use the <code class="code">STD_REL_TYPE(type)</code> macro.
</p>
<p>The detailed information can be accessed
via the pointer <code class="code">reloc</code>. It will point to a structure that depends
on the relocation type, so a module must only use it if it knows the
relocation type.
</p>
<p>All standard relocations point to a type <code class="code">nreloc</code> structure
with the following members:
</p><dl class="table">
<dt><code class="code">size_t byteoffset;</code></dt>
<dd><p>Offset in target-bytes, from the start of the current <code class="code">DATA</code> atom, to
the beginning of the relocation field. This may also be the address which is
used as a basis for PC-relative relocations. Or a common basis for multiple
separated relocation fields, which will be translated into a single
relocation type by the output module.
</p>
</dd>
<dt><code class="code">size_t bitoffset;</code></dt>
<dd><p>Offset in bits to the beginning of the relocation field. Adds to
<code class="code">byteoffset*BITSPERBYTE</code>. Bits are counted in a bit-stream from lower
to higher address bytes. But note, that within a little-endian byte bits
are counted from the LSB to the MSB, while they are counted from the MSB to
the LSB for big-endian targets.
</p>
</dd>
<dt><code class="code">int size;</code></dt>
<dd><p>The size of the relocation field in bits.
</p>
</dd>
<dt><code class="code">taddr mask;</code></dt>
<dd><p>The mask defines which portion of the relocated value is set by this
relocation field.
</p>
</dd>
<dt><code class="code">taddr addend;</code></dt>
<dd><p>Value to be added to the symbol value.
</p>
</dd>
<dt><code class="code">symbol *sym;</code></dt>
<dd><p>The symbol referred by this relocation
</p>
</dd>
</dl>

<p>To describe the meaning of these entries, we will define the steps that
shall be executed when performing a relocation:
</p>
<ol class="enumerate">
<li> Extract <code class="code">size</code> number of bits from the <code class="code">DATA</code> atom, starting
        with bit number <code class="code">byteoffset*BITSPERBYTE+bitoffset</code>.
        We start counting bits from the lowest to the highest numbered byte
        in memory.
        Within a big-endian byte we count from the MSB to the LSB. Within
        a little-endian byte we count from the LSB to the MSB.

</li><li> Determine the relocation value of the symbol. For a simple absolute
        relocation, this will be the value of the symbol <code class="code">sym</code> plus
        the <code class="code">addend</code>. For other relocation types, more complex
        calculations will be needed.
        For example, in a program-counter relative relocation,
        the value will be obtained by subtracting the address of the data
        atom plus <code class="code">byteoffset</code> from the value
        of <code class="code">sym</code> plus <code class="code">addend</code>.

</li><li> Calculate the bit-wise <code class="code">AND</code> of the value obtained in the step
        above and the <code class="code">mask</code> value.

</li><li> Normalize, i.e. shift the value above right as many bit positions as
        there are low order zero bits in <code class="code">mask</code>.

</li><li> Add this value to the value extracted in step 1.

</li><li> Insert the low order <code class="code">size</code> bits of this value into the <code class="code">DATA</code>
        atom starting with bit <code class="code">byteoffset*BITSPERBYTE+bitoffset</code>.
</li></ol>


</div>
<div class="subsection-level-extent" id="CPU_002dspecific-Relocations">
<h4 class="subsection"><span>38.4.7 CPU-specific Relocations<a class="copiable-link" href="#CPU_002dspecific-Relocations"> &para;</a></span></h4>

<p>Whenever a CPU module requires a relocation type which cannot be
expresssed by any standard type you have the option to define your own,
beginning with <code class="code">FIRST_CPU_RELOC</code> (defined in <code class="code">reloc.h</code>).
The last CPU-specific relocation has to be defined in your backend&rsquo;s
<code class="code">cpu.h</code> by <code class="code">LAST_CPU_RELOC</code>, which is also a hint for the
assembler&rsquo;s core routines that CPU-specific relocations do exist.
</p>
<p>Example:
</p><div class="example">
<pre class="example-preformatted">/* PPC specific relocations */
#define REL_PPCEABI_SDA2 (FIRST_CPU_RELOC)
#define REL_PPCEABI_SDA21 (FIRST_CPU_RELOC+1)
#define REL_PPCEABI_SDAI16 (FIRST_CPU_RELOC+2)
#define REL_PPCEABI_SDA2I16 (FIRST_CPU_RELOC+3)
#define REL_MORPHOS_DREL (FIRST_CPU_RELOC+4)
#define REL_AMIGAOS_BREL (FIRST_CPU_RELOC+5)
#define LAST_CPU_RELOC REL_AMIGAOS_BREL
</pre></div>

<p>Also the CPU module must implement and export the following functions:
</p><dl class="table">
<dt><code class="code">size_t cpu_reloc_size(rlist *)</code></dt>
<dd><p>Return the size of your cpu-specific relocation in 8-bit host-bytes for
  the given type. If this type uses the standard <code class="code">nreloc</code> structure,
  just return zero.
</p></dd>
<dt><code class="code">void cpu_reloc_print(FILE *,rlist *)</code></dt>
<dd><p>Print the relocation name and its parameters to the given file.
  Usually it has the form:
  <code class="code">rname(startbyte,startbit-endbit,mask,addend,symbol)</code>.
  When using <code class="code">nreloc</code> you may call <code class="code">print_nreloc()</code>
  (refer to <code class="code">reloc.h</code>) to simplify output.
</p></dd>
<dt><code class="code">void cpu_reloc_write(FILE *,rlist *)</code></dt>
<dd><p>If this relocation type uses a cpu-specific structure, write it to
  the object file&rsquo;s relocation table in <code class="code">VOBJ</code> format.
</p></dd>
</dl>

<p>Note, that support for cpu-specific relocations has to be added to
other tools reading and writing the <code class="code">VOBJ</code> format, like
<code class="command">vlink</code> and <code class="command">vobjdump</code>, as well.
Otherwise they will be ignored (but do not cause any failure).
</p>
<p>Also, if you want cpu-specific relocations to be recognized in other
output modules, you have to handle these types there appropriately.
</p>

</div>
<div class="subsection-level-extent" id="Errors">
<h4 class="subsection"><span>38.4.8 Errors<a class="copiable-link" href="#Errors"> &para;</a></span></h4>

<p>Each module can provide a list of possible error messages contained
e.g. in <samp class="file">syntax_errors.h</samp> or <samp class="file">cpu_errors.h</samp>. They are a
comma-separated list of a printf-format string and error flags. Allowed
flags are <code class="code">WARNING</code>, <code class="code">ERROR</code>, <code class="code">FATAL</code>, <code class="code">MESSAGE</code> and
<code class="code">NOLINE</code>.
They can be combined using or (<code class="code">|</code>). <code class="code">NOLINE</code> has to be set for
error messages during initialization or while writing the output, when
no source context is available. Errors cause the assembler to return false.
<code class="code">FATAL</code> causes the assembler to terminate
immediately.
</p>
<p>The errors can be emitted using the function <code class="code">syntax_error(int n,...)</code>,
<code class="code">cpu_error(int n,...)</code> or <code class="code">output_error(int n,...)</code>. The first
argument is the number of the error message (starting from zero). Additional
arguments must be passed according to the format string of the
corresponding error message.
</p>

</div>
</div>
<div class="section-level-extent" id="Support-Functions">
<h3 class="section"><span>38.5 Support Functions<a class="copiable-link" href="#Support-Functions"> &para;</a></span></h3>

<p>Useful support functions for writing CPU-, Syntax- and Output-modules.
</p>
<ul class="mini-toc">
<li><a href="#Memory-Functions" accesskey="1">Memory Functions</a></li>
<li><a href="#Expressions-1" accesskey="2">Expressions</a></li>
<li><a href="#Symbols-2" accesskey="3">Symbols</a></li>
<li><a href="#Atoms-1" accesskey="4">Atoms</a></li>
</ul>
<div class="subsection-level-extent" id="Memory-Functions">
<h4 class="subsection"><span>38.5.1 Memory Functions<a class="copiable-link" href="#Memory-Functions"> &para;</a></span></h4>
<dl class="table">
<dt><code class="code">void *mymalloc(size_t sz)</code></dt>
<dd><p>Allocate memory. See also <code class="code">mycalloc()</code> and <code class="code">myrealloc()</code>.
</p></dd>
<dt><code class="code">void myfree(void *p)</code></dt>
<dd><p>Free an allocated memory block with one of the functions above.
</p></dd>
<dt><code class="code">uint64_t readval(int be,void *src,size_t size)</code></dt>
<dd><p>Reads an unsigned value with <code class="code">size</code> target-bytes and byte-ordering
  <code class="code">be</code> from the <code class="code">src</code> pointer (0 is little-, 1 is big-endian).
</p></dd>
<dt><code class="code">void *setval(int be,void *dest,size_t size,uint64_t val)</code></dt>
<dd><p>Stores the value <code class="code">val</code> to <code class="code">dest</code>, which has a size of
  <code class="code">size</code> target-bytes, using a byte-ordering of <code class="code">be</code>
  (0 is little-, 1 is big-endian).
</p></dd>
<dt><code class="code">uint64_t readbits(int be,void *p,unsigned bfsize,unsigned offset,unsigned size)</code></dt>
<dd><p>Reads an unsigned value from the bitfield with <code class="code">bfsize</code> bits at
  <code class="code">p</code>. <code class="code">size</code> bits at bit-offset <code class="code">offset</code> will be extracted.
  Use endianness <code class="code">be</code> while reading the bitfield.
</p></dd>
<dt><code class="code">void setbits(int be,void *p,unsigned bfsize,unsigned offset,unsigned size,uint64_t d)</code></dt>
<dd><p>Writes the value <code class="code">d</code> with <code class="code">size</code> bits into a bitfield at <code class="code">p</code>
  with <code class="code">bfsize</code> bits, starting at bit-offset <code class="code">offset</code>, following
  the rules of the given endianness <code class="code">be</code>.
</p></dd>
<dt><code class="code">utaddr readbyte(void *src)</code></dt>
<dd><p>Reads an unsigned target-byte from <code class="code">src</code>.
</p></dd>
<dt><code class="code">void writebyte(void *dest,utaddr val)</code></dt>
<dd><p>Stores the value <code class="code">val</code> into a target-byte at <code class="code">dest</code>.
</p></dd>
<dt><code class="code">OCTETS(n)</code></dt>
<dd><p>This macro expands to the number of 8-bit host-bytes required for <code class="code">n</code>
  target-bytes.
</p></dd>
</dl>

</div>
<div class="subsection-level-extent" id="Expressions-1">
<h4 class="subsection"><span>38.5.2 Expressions<a class="copiable-link" href="#Expressions-1"> &para;</a></span></h4>
<dl class="table">
<dt><code class="code">expr *parse_expr(char **pp)</code></dt>
<dd><p>Parses any expression starting at <code class="code">*pp</code>. Updates <code class="code">*pp</code> to point
  at the next character after the expression.
</p></dd>
<dt><code class="code">expr *parse_expr_tmplab(char **pp)</code></dt>
<dd><p>Same as <code class="code">parse_expr()</code>, but defines a temporary label for the PC
  symbol, so it does not change its value when this expression is
  evaluated at other section locations.
</p></dd>
<dt><code class="code">expr *parse_expr_huge(char **pp)</code></dt>
<dd><p>Parses a constant expression (no labels allowed) with 128 bit integers.
</p></dd>
<dt><code class="code">expr *parse_expr_float(char **pp)</code></dt>
<dd><p>Parses a floating point expression (no labels allowed), if the
  backend supports floating point constants (defines <code class="code">FLOAT_PARSER</code>).
</p></dd>
<dt><code class="code">taddr parse_constexpr(char **pp)</code></dt>
<dd><p>Parses an expression which is immediately evaluated to a constant value.
  Generates an error message and returns zero when it depends on
  non-constant, 128-bit (huge) or floating point values.
</p></dd>
<dt><code class="code">void free_expr(expr *tree)</code></dt>
<dd><p>Free an expression.
</p></dd>
<dt><code class="code">int type_of_expr(expr *tree)</code></dt>
<dd><p>Returns the type of an expression, which may be either <code class="code">NUM</code>,
  <code class="code">HUG</code> (128 bit constant) or <code class="code">FLT</code> (floating point). This
  will tell you which evaluation function to use (see below).
</p></dd>
<dt><code class="code">void simplify_expr(expr *tree)</code></dt>
<dd><p>Try to evaluate the expression as far as possible. Subexpressions
  only containing constants or absolute symbols are simplified.
</p></dd>
<dt><code class="code">int eval_expr(expr *tree,taddr *result,section *sec,taddr pc)</code></dt>
<dd><p>Evaluate an expression using the <code class="code">pc</code> in section <code class="code">sec</code> and
  store the result in <code class="code">*result</code>. The return value is non-zero
  when the result is constant (i.e. only depends on constants or absolute
  symbols).
</p></dd>
<dt><code class="code">int eval_expr_huge(expr *tree,thuge *result)</code></dt>
<dd><p>Evaluate a constant 128-bit integer expression, which is written to
  <code class="code">*result</code>. The return value becomes zero when there were problems
  (like unsupported operations).
</p></dd>
<dt><code class="code">int eval_expr_float(expr *tree,tfloat *result)</code></dt>
<dd><p>Evaluate a constant floating point expression and write the result to
  <code class="code">*result</code>. The return value becomes zero when there were problems
  (like unsupported operations).
</p></dd>
<dt><code class="code">int find_base(expr *p,symbol **base,section *sec,taddr pc)</code></dt>
<dd><p>Tests, if an expression is based only on one non-absolute symbol
  plus constants or minus label. Writes either that symbol-pointer to
  <code class="code">*base</code> or <code class="code">NULL</code>.
  The return value defines the type of base-relative
  operation, which is <code class="code">BASE_OK</code> (normal base plus constant),
  <code class="code">BASE_PCREL</code> (base minus label is pc-relative) or
  <code class="code">BASE_ILLEGAL</code> (illegal arithmetic operation with base symbol).
</p></dd>
<dt><code class="code">expr *number_expr(taddr val)</code></dt>
<dd><p>Create a constant expression from <code class="code">val</code>.
</p></dd>
<dt><code class="code">expr *huge_expr(thuge val)</code></dt>
<dd><p>Create a constant 128-bit expression from <code class="code">val</code>.
</p></dd>
<dt><code class="code">expr *float_expr(tfloat val)</code></dt>
<dd><p>Create a constant floating point expression from <code class="code">val</code>.
</p></dd>
</dl>

</div>
<div class="subsection-level-extent" id="Symbols-2">
<h4 class="subsection"><span>38.5.3 Symbols<a class="copiable-link" href="#Symbols-2"> &para;</a></span></h4>
<dl class="table">
<dt><code class="code">symbol *new_abs(const char *name,expr *tree)</code></dt>
<dd><p>Create a new absolute symbol (type <code class="code">EXPRESSION</code>).
</p></dd>
<dt><code class="code">symbol *new_equate(const char *name,expr *tree)</code></dt>
<dd><p>Same as <code class="code">new_abs()</code> but set the <code class="code">EQUATE</code> flag to indicate that
  the symbol must not change its value (unlike a <code class="code">.set</code> symbol).
</p></dd>
<dt><code class="code">symbol *new_import(const char *name)</code></dt>
<dd><p>Add an externally defined symbol name.
</p></dd>
<dt><code class="code">symbol *new_labsym(section *sec,const char *name)</code></dt>
<dd><p>Create a label symbol (type <code class="code">LABSYM</code>) for the current PC in the given
  section. Uses the current/default section when <code class="code">sec</code> is <code class="code">NULL</code>.
</p></dd>
<dt><code class="code">symbol *new_tmplabel(section *sec)</code></dt>
<dd><p>Create a temporary label symbol with a unique name for the given section.
</p></dd>
<dt><code class="code">symbol *internal_abs(const char *name)</code></dt>
<dd><p>Create an internal absolute symbol (type <code class="code">EXPRESSION</code>), which gets
  the flag <code class="code">VASMINTERN</code>, so it is never written into object files.
</p></dd>
<dt><code class="code">regsym *new_regsym(int redef,int no_case,const char *name,int type,unsigned int flags,unsigned int num)</code></dt>
<dd><p>Create a new CPU register symbol with name <code class="code">name</code> and number
  <code class="code">num</code>. The <code class="code">type</code> and <code class="code">flags</code> can be used by the
  backend as needed (for example integer and floating point register type).
  A non-zero <code class="code">redef</code> allows redefinition of a register symbol without
  error message. A non-zero <code class="code">no_case</code> defines that the case of the
  symbol name is ignored.
</p></dd>
<dt><code class="code">regsym *find_regsym(const char *name,int len)</code></dt>
<dd><p>Find register symbol with <code class="code">name</code> and <code class="code">len</code> characters.
</p></dd>
<dt><code class="code">regsym *find_regsym_nc(const char *name,int len)</code></dt>
<dd><p>Like above, but ignores the case of the symbol.
</p></dd>
</dl>

</div>
<div class="subsection-level-extent" id="Atoms-1">
<h4 class="subsection"><span>38.5.4 Atoms<a class="copiable-link" href="#Atoms-1"> &para;</a></span></h4>
<dl class="table">
<dt><code class="code">instruction *new_inst(const char *inst,int len,int op_cnt,char **op,int *op_len)</code></dt>
<dd><p>Traverses the backend&rsquo;s mnemonic table for instructions called <code class="code">inst</code>
  and tries to parse <code class="code">op_cnt</code> operands using the cpu module&rsquo;s
  <code class="code">parse_operand()</code> function. Returns an instruction pointer when the
  requirements from the mnemonic table were met or <code class="code">NULL</code>.
</p></dd>
<dt><code class="code">dblock *new_dblock(void)</code></dt>
<dd><p>Allocate a new <code class="code">dblock</code> structure for storing constant data.
</p></dd>
<dt><code class="code">sblock *new_sblock(expr *space,size_t size,expr *fill)</code></dt>
<dd><p>Allocate a new <code class="code">sblock</code> structure for storing <code class="code">space</code> elements
  of <code class="code">size</code> target-bytes, filled with <code class="code">fill</code>, or zeros when
  <code class="code">fill</code> is <code class="code">NULL</code>.
</p></dd>
<dt><code class="code">atom *new_inst_atom(instruction *p)</code></dt>
<dd><p>Allocate a new <code class="code">INSTRUCTION</code> atom from <code class="code">p</code>.
</p></dd>
<dt><code class="code">atom *new_data_atom(dblock *p,taddr align)</code></dt>
<dd><p>Allocate a new <code class="code">DATA</code> atom with alignment <code class="code">align</code> atom from
  <code class="code">p</code>.
</p></dd>
<dt><code class="code">atom *new_label_atom(symbol *p)</code></dt>
<dd><p>Allocate a new <code class="code">LABEL</code> atom from symbol <code class="code">p</code>.
</p></dd>
<dt><code class="code">atom *new_space_atom(expr *space,size_t size,expr *fill)</code></dt>
<dd><p>Allocate a new <code class="code">SPACE</code> atom with <code class="code">space</code> elements of
  <code class="code">size</code> target-bytes, filled with <code class="code">fill</code>, or zeros when
  <code class="code">fill</code> is <code class="code">NULL</code>.
</p></dd>
<dt><code class="code">atom *new_datadef_atom(size_t bitsize,operand *op)</code></dt>
<dd><p>Allocate a new <code class="code">DATADEF</code> atom from operand <code class="code">op</code> with
  <code class="code">bitsize</code> bits.
</p></dd>
<dt><code class="code">atom *new_atom(int type,taddr align)</code></dt>
<dd><p>Allocate a new atom with given type and alignment.
</p></dd>
<dt><code class="code">void add_atom(section *sec,atom *a)</code></dt>
<dd><p>Adds a new atom to the end of the specified section. If <code class="code">sec</code> is
  <code class="code">NULL</code> then the current section is used. If there is no current
  section yet, then a default section is created.
</p></dd>
</dl>

</div>
</div>
<div class="section-level-extent" id="Syntax-modules">
<h3 class="section"><span>38.6 Syntax modules<a class="copiable-link" href="#Syntax-modules"> &para;</a></span></h3>

<p>A new syntax module must have its own subdirectory under <samp class="file">vasm/syntax</samp>.
At least the files <samp class="file">syntax.h</samp>, <samp class="file">syntax.c</samp> and <samp class="file">syntax_errors.h</samp>
must be written.
</p>
<ul class="mini-toc">
<li><a href="#The-file-syntax_002eh" accesskey="1">The file <samp class="file">syntax.h</samp></a></li>
<li><a href="#The-file-syntax_002ec" accesskey="2">The file <samp class="file">syntax.c</samp></a></li>
</ul>
<div class="subsection-level-extent" id="The-file-syntax_002eh">
<h4 class="subsection"><span>38.6.1 The file <samp class="file">syntax.h</samp><a class="copiable-link" href="#The-file-syntax_002eh"> &para;</a></span></h4>

<dl class="table">
<dt><code class="code">#define ISIDSTART(x)/ISIDCHAR(x)</code></dt>
<dd><p>These macros should return non-zero if and only if the argument is a
valid character to start an identifier or a valid character inside an
identifier, respectively.
<code class="code">ISIDCHAR</code> must be a superset of <code class="code">ISIDSTART</code>.
</p>
</dd>
<dt><code class="code">#define ISBADID(p,l)</code></dt>
<dd><p>Even with <code class="code">ISIDSTART</code> and <code class="code">ISIDCHAR</code> checked, there may be
combinations of characters which do not form a valid initializer (for
example, a single character). This macro returns non-zero, when this is
the case. First argument is a pointer to the new identifier and second
is its length.
</p>
</dd>
<dt><code class="code">#define ISEOL(x)</code></dt>
<dd><p>This macro returns true when the string pointing at <code class="code">x</code> is either
a comment character or end-of-line.
</p>
</dd>
<dt><code class="code">#define CHKIDEND(s,e) chkidend((s),(e))</code></dt>
<dd><p>Defines an optional function to be called at the end of the identifier
recognition process. It allows you to adjust the length of the identifier
by returning a modified <code class="code">e</code>. Default is to return <code class="code">e</code>. The
function is defined as <code class="code">char *chkidend(char *startpos,char *endpos)</code>.
</p>
</dd>
<dt><code class="code">#define BOOLEAN(x) -(x)</code></dt>
<dd><p>Defines the result of boolean operations. Usually this is <code class="code">(x)</code>, as
in C, or <code class="code">-(x)</code> to return -1 for True.
</p>
</dd>
<dt><code class="code">#define NARGSYM &quot;NARG&quot;</code></dt>
<dd><p>Defines the name of an optional symbol which contains the number of
arguments in a macro.
</p>
</dd>
<dt><code class="code">#define CARGSYM &quot;CARG&quot;</code></dt>
<dd><p>Defines the name of an optional symbol which can be used to select a
specific macro argument with <code class="code">\.</code>, <code class="code">\+</code> and <code class="code">\-</code>.
</p>
</dd>
<dt><code class="code">#define REPTNSYM &quot;REPTN&quot;</code></dt>
<dd><p>Defines the name of an optional symbol containing the counter of the
current repeat iteration.
</p>
</dd>
<dt><code class="code">#define EXPSKIP() s=exp_skip(s)</code></dt>
<dd><p>Defines an optional replacement for skip() to be used in expr.c, to skip
blanks in an expression. Useful to forbid blanks in an expression and to
ignore the rest of the line (e.g. to treat the rest as comment). The
function is defined as <code class="code">char *exp_skip(char *stream)</code>.
</p>
</dd>
<dt><code class="code">#define IGNORE_FIRST_EXTRA_OP 1</code></dt>
<dd><p>Should be defined as non-zero (true) if the syntax module wants to ignore
the operand field on instructions without an operand. Useful, when everything
following the operand should be regarded as comment, without requiring a
comment character.
</p>
</dd>
<dt><code class="code">#define MAXMACPARAMS 35</code></dt>
<dd><p>Optionally defines the maximum number of macro arguments, if you need more than
the default number of 9.
</p>
</dd>
<dt><code class="code">#define SKIP_MACRO_ARGNAME(p) skip_identifier(p)</code></dt>
<dd><p>An optional function to skip a named macro argument in the macro
definition.
Argument is the current source stream pointer.
The default is to skip an identifier.
</p>
</dd>
<dt><code class="code">#define MACRO_ARG_OPTS(m,n,a,p) NULL</code></dt>
<dd><p>An optional function to parse and skip options, default values and
qualifiers for each macro argument. Returns <code class="code">NULL</code> when no argument
options have been found.
Arguments are:
  </p><dl class="table">
<dt><code class="code">struct macro *m;</code></dt>
<dd><p>Pointer to the macro structure being currently defined.
    </p></dd>
<dt><code class="code">int n;</code></dt>
<dd><p>Argument index, starting with zero.
    </p></dd>
<dt><code class="code">char *a;</code></dt>
<dd><p>Name of this argument.
    </p></dd>
<dt><code class="code">char *p;</code></dt>
<dd><p>Current source stream pointer. An updated pointer will be returned.
  </p></dd>
</dl>
<p>Defaults to unused.
</p>
</dd>
<dt><code class="code">#define MACRO_ARG_SEP(p) (*p==',' ? skip(p+1) : NULL)</code></dt>
<dd><p>An optional function to skip a separator between the macro argument
names in the macro definition. Returns NULL when no valid separator is
found.
Argument is the current source stream pointer.
Defaults to using comma as the only valid separator.
</p>
</dd>
<dt><code class="code">#define MACRO_PARAM_SEP(p) (*p==',' ? skip(p+1) : NULL)</code></dt>
<dd><p>An optional function to skip a separator between the macro parameters
in a macro call. Returns NULL when no valid separator is found.
Argument is the current source stream pointer.
Defaults to using comma as the only valid separator.
</p>
</dd>
<dt><code class="code">#define EXEC_MACRO(s)</code></dt>
<dd><p>An optional function to be called just before a macro starts execution.
Parameters and qualifiers are already parsed.
Argument is the <code class="code">source</code> pointer of the new macro.
Defaults to unused.
</p>
</dd>
</dl>

</div>
<div class="subsection-level-extent" id="The-file-syntax_002ec">
<h4 class="subsection"><span>38.6.2 The file <samp class="file">syntax.c</samp><a class="copiable-link" href="#The-file-syntax_002ec"> &para;</a></span></h4>

<p>A syntax module has to provide the following elements (all other functions
should be <code class="code">static</code> to prevent name clashes):
</p>
<dl class="table">
<dt><code class="code">const char *syntax_copyright;</code></dt>
<dd><p>A string that will be emitted as part of the copyright message.
</p>
</dd>
<dt><code class="code">hashtable *dirhash;</code></dt>
<dd><p>A pointer to the hash table with all directives.
</p>
</dd>
<dt><code class="code">char commentchar;</code></dt>
<dd><p>A character used to introduce a comment until the end of the line.
</p>
</dd>
<dt><code class="code">int dotdirs;</code></dt>
<dd><p>Define <code class="code">dotdirs</code> as non-zero, when the syntax module works with
directives starting with a dot (<code class="code">.</code>).
</p>
</dd>
<dt><code class="code">int init_syntax(void);</code></dt>
<dd><p>Will be called during startup, after argument parsing Must return zero if
initializations failed, non-zero otherwise.
</p>
</dd>
<dt><code class="code">int syntax_args(char *);</code></dt>
<dd><p>This function will be called with the command line arguments (unless they
were already recognized by other modules). If an argument was recognized,
return non-zero.
</p>
</dd>
<dt><code class="code">int syntax_defsect(void);</code></dt>
<dd><p>Lets the syntax module define a default section, which is used when no
section was created by any <code class="code">section</code> or <code class="code">org</code> directive, before
the first code or data is defined.
May set <code class="code">defsectname</code>, <code class="code">defsecttype</code> and <code class="code">defsectorg</code>
accordingly and return with non-zero. Or return with zero and accept
the defaults, which are: <code class="code">defsectname=&quot;.text&quot;</code> and
<code class="code">defsecttype=&quot;acrx&quot;</code>.
</p>
</dd>
<dt><code class="code">char *skip(char *);</code></dt>
<dd><p>A function to skip whitespace etc.
</p>
</dd>
<dt><code class="code">void eol(char *);</code></dt>
<dd><p>This function should check that the argument points to the end of a line
(only comments or whitespace following). If not, an error or warning
message should be omitted.
</p>
</dd>
<dt><code class="code">char *const_prefix(char *,int *);</code></dt>
<dd><p>Check if the first argument points to the start of a constant. If yes
return a pointer to the real start of the number (i.e. skip a prefix
that may indicate the base) and write the base of the number through the
pointer passed as second argument. Return zero if it does not point to a
number.
</p>
</dd>
<dt><code class="code">char *const_suffix(char *,char *);</code></dt>
<dd><p>First argument points to the start of the constant (including prefix) and
the second argument to first character after the constant (excluding suffix).
Checks for a constant-suffix and skips it. Return pointer to the first
character after that constant. Example: constants with a &rsquo;h&rsquo; suffix to
indicate a hexadecimal base.
</p>
</dd>
<dt><code class="code">void parse(void);</code></dt>
<dd><p>This is the main parsing function. It has to read source text lines via
the <code class="code">read_next_line()</code> function, parse them and create sections,
atoms and symbols. Pseudo directives are usually handled by the syntax 
module. Instructions can be parsed by the cpu module using
<code class="code">parse_instruction()</code>.
</p>
</dd>
<dt><code class="code">char *parse_macro_arg(struct macro *,char *,struct namelen *,struct namelen *);</code></dt>
<dd><p>Called to parse a macro parameter by using the source stream pointer in
the second argument. The start pointer and length of a single passed
parameter is written to the first <code class="code">struct namelen</code>, while the optionally
selected named macro argument is passed in the second <code class="code">struct namelen</code>.
When the <code class="code">len</code> field of the second <code class="code">namelen</code> is zero, then the
argument is selected by position instead by name. Returns the updated
source stream pointer after successful parsing.
</p>
</dd>
<dt><code class="code">int expand_macro(source *,char **,char *,int);</code></dt>
<dd><p>Expand parameters and special commands inside a macro source. The second
argument is a pointer to the current source stream pointer, which is
updated on any successful expansion. The function will return the
number of characters written to the destination buffer (third argument)
in this case. Returning <code class="code">-1</code> means: no expansion took place.
The last argument defines the space in characters which is left in the
destination buffer.
</p>
</dd>
<dt><code class="code">char *get_local_label(char **);</code></dt>
<dd><p>Gets a pointer to the current source pointer. Has to check if a valid
local label is found at this point. If yes return a pointer to the
vasm-internal symbol name representing the local label and update
the current source pointer to point behind the label.
</p>
<p>Have a look at the support functions provided by the frontend to help.
</p>
</dd>
</dl>

<p>Syntax modules may support additional features, which can be enabled or
disabled by a preprocessor define.
Like allowing the <code class="code">#</code> character for introducing comments in the
std-syntax module, when the CPU&rsquo;s operand parser doesn&rsquo;t need it
(Example: PPC or x86).
Defines for these optional features follow the general syntax
<code class="code">[module type]_[module name]_[feature name]</code>.
</p><div class="example">
<pre class="example-preformatted">#define SYNTAX_STD_COMMENTCHAR_HASH
</pre></div>

</div>
</div>
<div class="section-level-extent" id="CPU-modules">
<h3 class="section"><span>38.7 CPU modules<a class="copiable-link" href="#CPU-modules"> &para;</a></span></h3>

<p>A new cpu module must have its own subdirectory under <samp class="file">vasm/cpus</samp>.
At least the files <samp class="file">cpu.h</samp>, <samp class="file">cpu.c</samp> and <samp class="file">cpu_errors.h</samp>
must be written.
</p>
<ul class="mini-toc">
<li><a href="#The-file-cpu_002eh" accesskey="1">The file <samp class="file">cpu.h</samp></a></li>
<li><a href="#The-file-cpu_002ec" accesskey="2">The file <samp class="file">cpu.c</samp></a></li>
</ul>
<div class="subsection-level-extent" id="The-file-cpu_002eh">
<h4 class="subsection"><span>38.7.1 The file <samp class="file">cpu.h</samp><a class="copiable-link" href="#The-file-cpu_002eh"> &para;</a></span></h4>

<p>A cpu module has to provide the following elements (all other functions
should be <code class="code">static</code> to prevent name clashes) in <code class="code">cpu.h</code>:
</p>
<dl class="table">
<dt><code class="code">#define LITTLEENDIAN 1</code></dt>
<dt><code class="code">#define BIGENDIAN 0</code></dt>
<dd><p>Define these according to the target endianness. For CPUs which support big-
and little-endian, you may assign a global variable here. So be aware of
it, and never use <code class="code">#if BIGENDIAN</code>, but always <code class="code">if(BIGENDIAN)</code> in
your code.
</p>
</dd>
<dt><code class="code">#define VASM_CPU_&lt;cpu&gt; 1</code></dt>
<dd><p>Defines a cpu-specific macro. May be used to perform special handling in
syntax- or output-modules.
</p>
</dd>
<dt><code class="code">#define BITSPERBYTE 8</code></dt>
<dd><p>The number of bits per byte of the target cpu. Usually 8. We require
that vasm is running on a host architecture and file system which uses
8-bit bytes. When writing output for a backend with <code class="code">BITSPERBYTE &gt; 8</code>
the vasm-internal ordering of 8-bit host-bytes within a target-byte
is big-endian.
</p>
</dd>
<dt><code class="code">#define MAX_OPERANDS 3</code></dt>
<dd><p>Maximum number of operands of one instruction.
</p>
</dd>
<dt><code class="code">#define MAX_QUALIFIERS 0</code></dt>
<dd><p>Maximum number of mnemonic-qualifiers per mnemonic.
</p>
</dd>
<dt><code class="code">#define NO_MACRO_QUALIFIERS</code></dt>
<dd><p>Define this, when qualifiers shouldn&rsquo;t be allowed for macros. For some
architectures, like ARM, macro qualifiers make no sense.
</p>
</dd>
<dt><code class="code">typedef int32_t taddr;</code></dt>
<dd><p>Data type to represent a target-address. Preferably use the types from
<samp class="file">stdint.h</samp>. Does not necessarily have to match the cpu&rsquo;s address
bus size (refer to <code class="code">bytespertaddr</code>), but choose it according to the
largest data you will be able to do calculations with. For example, you may
want to allow 32-bit data definitions for an 8-bit cpu.
</p>
</dd>
<dt><code class="code">typedef uint32_t utaddr;</code></dt>
<dd><p>Unsigned data type to represent a target-address.
</p>
</dd>
<dt><code class="code">#define INST_ALIGN 2</code></dt>
<dd><p>Minimum instruction alignment.
</p>
</dd>
<dt><code class="code">#define DATA_ALIGN(n) ...</code></dt>
<dd><p>Default alignment for <code class="code">n</code>-bit data. Can also be a function.
</p>
</dd>
<dt><code class="code">#define DATA_OPERAND(n) ...</code></dt>
<dd><p>Operand class for n-bit data definitions. Can also be a function.
Negative values denote a floating point data definition of -n bits.
</p>
</dd>
<dt><code class="code">typedef ... operand;</code></dt>
<dd><p>Structure to store an operand for a machine instruction or a
data constant. Stores, for example, addressing modes and expressions.
</p>
</dd>
<dt><code class="code">typedef ... mnemonic_extension;</code></dt>
<dd><p>Mnemonic extension for the cpu&rsquo;s instruction table. Often used for the
actual opcode or cpu-model flags.
</p></dd>
</dl>

<p>Optional features, which can be enabled by defining the following macros:
</p>
<dl class="table">
<dt><code class="code">#define FLOAT_PARSER 1</code></dt>
<dd><p>Enables the floating point parser and floating point evalulation in the
expression module. With this option the backend has to be prepared that
expressions may contain floating point constants, which can be checked
by testing the result of <code class="code">type_of_expr(expression)</code> for <code class="code">FLT</code>.
Then use <code class="code">eval_expr_float(expression,&amp;float_val)</code> to retrieve the
floating point value with type <code class="code">tfloat</code>.
It is up to the backend to convert the host&rsquo;s floating point format,
which should be IEEE, into the backend&rsquo;s native format. The vasm frontend
only supports IEEE to IEEE conversion via <code class="code">conv2ieee32()</code> and
<code class="code">conv2ieee64()</code>.
</p>
</dd>
<dt><code class="code">#define HAVE_INSTRUCTION_EXTENSION 1</code></dt>
<dd><p>If cpu-specific data should be added to all instruction atoms.
</p>
</dd>
<dt><code class="code">typedef ... instruction_ext;</code></dt>
<dd><p>Type for the above extension.
</p>
</dd>
<dt><code class="code">#define CLEAR_OPERANDS_ON_START 1</code></dt>
<dd><p>Backend requires zeroed operand structures when calling <code class="code">parse_operand()</code>
for the first time. Might be useful to parse operands only once.
Defaults to undefined.
</p>
</dd>
<dt><code class="code">#define CLEAR_OPERANDS_ON_MNEMO 1</code></dt>
<dd><p>Backend requires zeroed operand structures when calling <code class="code">parse_operand()</code>
for any new mnemonic. Useful to parse the same operand multiple times on
the current mnemonic, but reset everything for the next mnemonic.
Defaults to undefined.
</p>
</dd>
<dt><code class="code">START_PARENTH(x)</code></dt>
<dd><p>Valid opening parenthesis for instruction operands. Defaults to <code class="code">'('</code>.
</p>
</dd>
<dt><code class="code">END_PARENTH(x)</code></dt>
<dd><p>Valid closing parenthesis for instruction operands. Defaults to <code class="code">')'</code>.
</p>
</dd>
<dt><code class="code">#define MNEMONIC_VALID(idx)</code></dt>
<dd><p>An optional function with the arguments <code class="code">(int idx)</code>. Returns true
when the mnemonic with index <code class="code">idx</code> is valid for the current state of
the backend (e.g. it is available for the selected cpu model).
</p>
</dd>
<dt><code class="code">#define MNEMOHTABSIZE 0x4000</code></dt>
<dd><p>You can optionally overwrite the default hash table size defined in
<samp class="file">vasm.h</samp>. May be necessary for larger mnemonic tables.
Run vasm with option <samp class="option">-debug</samp> to print the number of collisions
in the hash tables.
</p>
</dd>
<dt><code class="code">#define OPERAND_OPTIONAL(p,t)</code></dt>
<dd><p>When defined, this is a function with the arguments
<code class="code">(operand *op,int type)</code>, which returns true when the given operand
type (<code class="code">type</code>) is optional. The function is only called for missing
operands and should also initialize <code class="code">op</code> with default values (e.g. 0).
</p></dd>
</dl>

<p>Implementing additional target-specific unary operations is done by defining
the following optional macros:
</p>
<dl class="table">
<dt><code class="code">#define EXT_UNARY_NAME(s)</code></dt>
<dd><p>Should return True when the string in <code class="code">s</code> points to an operation name
we want to handle.
</p>
</dd>
<dt><code class="code">#define EXT_UNARY_TYPE(s)</code></dt>
<dd><p>Returns the operation type code for the string in <code class="code">s</code>. Note that the
last valid standard operation is defined as <code class="code">LAST_EXP_TYPE</code>, so the
target-specific types will start with <code class="code">LAST_EXP_TYPE+1</code>.
</p>
</dd>
<dt><code class="code">#define EXT_UNARY_EVAL(t,v,r,c)</code></dt>
<dd><p>Defines a function with the arguments <code class="code">(int t, taddr v, taddr *r, int c)</code>
to handle the operation type <code class="code">t</code> returning an <code class="code">int</code> to indicate
whether this type has been handled or not. Your operation will by applied on
the value <code class="code">v</code> and the result is stored in <code class="code">*r</code>. The flag <code class="code">c</code>
is passed as 1 when the value is constant (no relocatable addresses involved).
</p>
</dd>
<dt><code class="code">#define EXT_FIND_BASE(b,e,s,p)</code></dt>
<dd><p>Defines a function with the arguments
<code class="code">(symbol **b, expr *e, section *s, taddr p)</code>
to save a pointer to the base symbol of expression <code class="code">e</code> into the
symbol pointer, pointed to by <code class="code">b</code>. The type of this base is given
by an <code class="code">int</code> return code. Further on, <code class="code">e-&gt;type</code> has to checked
to be one of the operations to handle.
The section pointer <code class="code">s</code> and the current pc <code class="code">p</code> are needed to call
the standard <code class="code">find_base()</code> function.
</p></dd>
</dl>

</div>
<div class="subsection-level-extent" id="The-file-cpu_002ec">
<h4 class="subsection"><span>38.7.2 The file <samp class="file">cpu.c</samp><a class="copiable-link" href="#The-file-cpu_002ec"> &para;</a></span></h4>

<p>A cpu module has to provide the following elements (all other functions
and data should be <code class="code">static</code> to prevent name clashes) in <code class="code">cpu.c</code>:
</p>
<dl class="table">
<dt><code class="code">int bytespertaddr;</code></dt>
<dd><p>The number of bytes per target address. Note, that this really
defines the size of a backend&rsquo;s address pointer in target-bytes and
might differ from the actual size of <code class="code">taddr</code> (see above).
</p>
</dd>
<dt><code class="code">mnemonic mnemonics[];</code></dt>
<dd><p>The mnemonic table keeps a list of mnemonic names and operand types the
assembler will match against using <code class="code">parse_operand()</code>. It may also
include a target specific <code class="code">mnemonic_extension</code>.
</p>
</dd>
<dt><code class="code">const char *cpu_copyright;</code></dt>
<dd><p>A string that will be emitted as part of the copyright message.
</p>
</dd>
<dt><code class="code">const char *cpuname;</code></dt>
<dd><p>A string describing the target cpu.
</p>
</dd>
<dt><code class="code">int init_cpu(void);</code></dt>
<dd><p>Will be called during startup, after argument parsing. Must return zero if
initializations failed, non-zero otherwise.
</p>
</dd>
<dt><code class="code">int cpu_args(char *);</code></dt>
<dd><p>This function will be called with the command line arguments (unless they
were already recognized by other modules). If an argument was recognized,
return non-zero.
</p>
</dd>
<dt><code class="code">char *parse_cpu_special(char *);</code></dt>
<dd><p>This function will be called with a source line as argument and allows
the cpu module to handle cpu-specific directives etc. Functions like
<code class="code">eol()</code> and <code class="code">skip()</code> from the syntax-module should be used to
keep the syntax consistent.
</p>
</dd>
<dt><code class="code">operand *new_operand();</code></dt>
<dd><p>Allocate and initialize a new operand structure.
</p>
</dd>
<dt><code class="code">int parse_operand(char *text,int len,operand *op,int requires);</code></dt>
<dd><p>Parses the source text for an instruction&rsquo;s operand at <code class="code">text</code> with length
<code class="code">len</code> to fill the target specific operand structure pointed to by <code class="code">op</code>,
whenever the operand&rsquo;s type matches the type from <code class="code">requires</code>.
Return with one of the following codes:
</p><dl class="table">
<dt><code class="code">PO_NOMATCH</code></dt>
<dd><p>The source did no match the operand type given in <code class="code">requires</code>.
</p></dd>
<dt><code class="code">PO_CORRUPT</code></dt>
<dd><p>The source was definitely identified as garbage, making it useless to
try matching it against any other operand types.
</p></dd>
<dt><code class="code">PO_MATCH</code></dt>
<dd><p>The parsed source matches the operand type in <code class="code">requires</code>. As soon
as all the instruction&rsquo;s operands have been matched, the instruction
is successfully recognized.
</p></dd>
<dt><code class="code">PO_SKIP</code></dt>
<dd><p>Works like <code class="code">PO_MATCH</code>, but skips the next operand from the mnemonic
table. For example, because it was already handled together with the
current operand.
</p></dd>
<dt><code class="code">PO_COMB_OPT</code></dt>
<dd><p>Works like <code class="code">PO_MATCH</code>, but requests parsing of the next argument from
the source text, if any, with a pointer to the same <code class="code">operand</code> structure
as before. This makes it possible to merge multiple operands into a
single operand structure.
</p></dd>
<dt><code class="code">PO_COMB_REQ</code></dt>
<dd><p>Like <code class="code">PO_COMB_OPT</code>, requests parsing of the next argument
with a pointer to the same <code class="code">operand</code> structure. But this time the
additional argument is mandatory.
</p></dd>
<dt><code class="code">PO_NEXT</code></dt>
<dd><p>Source did not match the given operand type in <code class="code">requires</code>. Request
parsing the same chunk of source text again, but using the following
operand type. Can be used to break a <code class="code">PO_COMB_OPT</code> or <code class="code">PO_COMB_REQ</code>
attempt and continue normally.
</p></dd>
</dl>

</dd>
<dt><code class="code">size_t instruction_size(instruction *ip, section *sec, taddr pc);</code></dt>
<dd><p>Returns the size of the instruction <code class="code">ip</code> in target-bytes, which, in the
final pass, must be identical to the number of bytes written by
<code class="code">eval_instruction()</code>
(see below).
</p>
</dd>
<dt><code class="code">dblock *eval_instruction(instruction *ip, section *sec, taddr pc);</code></dt>
<dd><p>Converts the instruction <code class="code">ip</code> into a DATA atom, including relocations
when necessary.
</p>
</dd>
<dt><code class="code">dblock *eval_data(operand *op, taddr bitsize, section *sec, taddr pc);</code></dt>
<dd><p>Converts a data operand into a DATA atom, including relocations.
</p>
</dd>
<dt><code class="code">void init_instruction_ext(instruction_ext *);</code></dt>
<dd><p>(If <code class="code">HAVE_INSTRUCTION_EXTENSION</code> is set.)
Initialize an instruction extension.
</p>
</dd>
<dt><code class="code">char *parse_instruction(char *,int *,char **,int *,int *);</code></dt>
<dd><p>(If <code class="code">MAX_QUALIFIERS</code> is greater than 0.)
Parses instruction and saves extension locations.
</p>
</dd>
<dt><code class="code">int set_default_qualifiers(char **,int *);</code></dt>
<dd><p>(If <code class="code">MAX_QUALIFIERS</code> is greater than 0.)
Saves pointers and lengths of default qualifiers for the selected CPU and
returns the number of default qualifiers. Example: for a M680x0 CPU this
would be a single qualifier, called &quot;w&quot;. Used by <code class="code">execute_macro()</code>.
</p>
</dd>
<dt><code class="code">cpu_opts_init(section *);</code></dt>
<dd><p>(If <code class="code">HAVE_CPU_OPTS</code> is set.)
Gives the cpu module the chance to write out <code class="code">OPTS</code> atoms with
initial settings before the first atom for a section is generated.
</p>
</dd>
<dt><code class="code">cpu_opts(void *);</code></dt>
<dd><p>(If <code class="code">HAVE_CPU_OPTS</code> is set.)
Apply option modifications from an <code class="code">OPTS</code> atom. For example:
change cpu type or optimization flags.
</p>
</dd>
<dt><code class="code">print_cpu_opts(FILE *,void *);</code></dt>
<dd><p>(If <code class="code">HAVE_CPU_OPTS</code> is set.)
Called from <code class="code">print_atom()</code> to print an <code class="code">OPTS</code> atom&rsquo;s contents.
</p>
</dd>
</dl>


</div>
</div>
<div class="section-level-extent" id="Output-modules">
<h3 class="section"><span>38.8 Output modules<a class="copiable-link" href="#Output-modules"> &para;</a></span></h3>

<p>Output modules can be chosen at runtime rather than compile time. Therefore,
several output modules are linked into one vasm executable and their
structure differs somewhat from syntax and cpu modules.
</p>
<p>Usually, an output module for some object format <code class="code">fmt</code> should be contained
in a file <samp class="file">output_&lt;fmt&gt;.c</samp> (it may use/include other files if necessary).
To automatically include this format in the build process, the
<code class="code">OUTFMTS</code> definition in <samp class="file">make.rules</samp> has to be extended.
The module should be added to the <code class="code">OBJS</code> variable
at the start of <samp class="file">make.rules</samp>. Also, a dependency line should be added
(see the existing output modules).
</p>
<p>An output module must only export a single function which will return
pointers to necessary data/functions. This function should have the
following prototype:
</p><div class="example">
<pre class="example-preformatted">int init_output_&lt;fmt&gt;(
      char **copyright,
      void (**write_object)(FILE *,section *,symbol *),
      int (**output_args)(char *)
    );
</pre></div>

<p>In case of an error, zero must be returned.
Otherwise, It should perform all necessary initializations, return non-zero
and return the following output parameters via the pointers passed as arguments:
</p>
<dl class="table">
<dt><code class="code">copyright</code></dt>
<dd><p>A pointer to the copyright string.
</p>
</dd>
<dt><code class="code">write_object</code></dt>
<dd><p>A pointer to a function emitting the output. It will be called after the
assembler has completed and will receive pointers to the output file,
to the first section of the section list and to the first symbol
in the symbol list. See the section on general data structures for further
details.
</p>

</dd>
<dt><code class="code">output_args</code></dt>
<dd><p>A pointer to a function checking arguments. It will be called with all
command line arguments (unless already handled by other modules). If the
output module recognizes an appropriate option, it has to handle it
and return non-zero. If it is not an option relevant to this output module,
zero must be returned.
</p>
</dd>
</dl>

<p>At last, a call to the <code class="code">init_output_&lt;fmt&gt;()</code> has to be added in the
<code class="code">init_output()</code> function in <samp class="file">vasm.c</samp> (should be self-explanatory).
Besides assigning the above mentioned function pointers, this function
can be used to redefine the assembler&rsquo;s behaviour.
For example you may optionally set the following global variables:
</p>
<dl class="table">
<dt><code class="code">asciiout = 1;</code></dt>
<dd><p>Set when the output module likes the output file to be opened in
  text-mode instead of binary-mode.
</p></dd>
<dt><code class="code">unnamed_sections = 1;</code></dt>
<dd><p>Set when the output module cannot handle section names. Usually such
  an output module differentiates sections by their type only:
  text, data or bss.
</p></dd>
<dt><code class="code">secname_attr = 1;</code></dt>
<dd><p>Set when the section attributes are used to differentiate between
  two sections with the same name.
</p></dd>
<dt><code class="code">output_bitsperbyte = 1;</code></dt>
<dd><p>Set when the output module supports target-bytes with <code class="code">BITSPERBYTE</code>.
  Otherwise it is expected that all output modules do work at least
  with 8-bit target-bytes.
</p></dd>
</dl>

<p>Writing a section&rsquo;s contents is typically done by traversing over all
the section&rsquo;s atoms, establish alignment and write the contents of
a <code class="code">DATA</code> or <code class="code">SPACE</code> atom using <code class="code">fwdblock()</code> or
<code class="code">fwsblock()</code> into the output file.
</p><div class="example">
<pre class="example-preformatted">  section *s;
  atom *p;

  for (p=s-&gt;first,pc=(unsigned long long)s-&gt;org; p; p=p-&gt;next) {
    npc = fwpcalign(f,p,s,pc);

    if (p-&gt;type == DATA)
      fwdblock(f,p-&gt;content.db);
    else if (p-&gt;type == SPACE)
      fwsblock(f,p-&gt;content.sb);

    pc = npc + atom_size(p,s,npc);
  }
</pre></div>

<p>Useful support functions for output modules, when writing data into the
output file:
</p>
<dl class="table">
<dt><code class="code">void fw8(FILE *f,uint8_t x)</code></dt>
<dd><p>Write 8 bits of data.
</p></dd>
<dt><code class="code">void fw16(FILE *f,uint16_t x,int be)</code></dt>
<dd><p>Write 16 bits of data with endianness <code class="code">be</code> (0 is little, 1 is big).
</p></dd>
<dt><code class="code">void fw24(FILE *f,uint32_t x,int be)</code></dt>
<dd><p>Write 24 bits of data with endianness <code class="code">be</code> (0 is little, 1 is big).
</p></dd>
<dt><code class="code">void fw32(FILE *f,uint32_t x,int be)</code></dt>
<dd><p>Write 32 bits of data with endianness <code class="code">be</code> (0 is little, 1 is big).
</p></dd>
<dt><code class="code">void fwdata(FILE *f,const void *buf,size_t n)</code></dt>
<dd><p>Write <code class="code">n</code> 8-bit bytes of data.
</p></dd>
<dt><code class="code">void fwspace(FILE *f,size_t n)</code></dt>
<dd><p>Write <code class="code">n</code> zeroed 8-bit bytes.
</p></dd>
<dt><code class="code">void fwbytes(FILE *f,void *buf,size_t n)</code></dt>
<dd><p>Write <code class="code">n</code> target-bytes (<code class="code">BITSPERBYTE</code>).
</p></dd>
<dt><code class="code">void fwdblock(FILE *f,dblock *db)</code></dt>
<dd><p>Write the target-bytes within a <code class="code">dblock</code>.
</p></dd>
<dt><code class="code">void fwsblock(FILE *f,sblock *sb)</code></dt>
<dd><p>Write the target-bytes within a <code class="code">sblock</code>.
</p></dd>
<dt><code class="code">void fwalign(FILE *f,taddr n,taddr align)</code></dt>
<dd><p>Write as many zero target-bytes as required to align address <code class="code">n</code>
  to <code class="code">align</code> bytes.
</p></dd>
<dt><code class="code">int fwpattern(FILE *f,taddr n,uint8_t *pat,int patlen)</code></dt>
<dd><p>Write <code class="code">n</code> target-bytes, which are initialized with pattern <code class="code">pat</code>.
  The <code class="code">patlen</code> is given in target-bytes as well. Note, that the
  pattern output may be preceded by a number of zero-bytes when <code class="code">n</code>
  is not a multiple of <code class="code">patlen</code>. The function returns non-zero if
  that happened.
</p></dd>
<dt><code class="code">taddr fwpcalign(FILE *f,atom *a,section *sec,taddr pc)</code></dt>
<dd><p>Write as many target-bytes as required to achieve proper alignment
  for atom <code class="code">a</code>. This space will either be filled by a <code class="code">SPACE</code>
  atom&rsquo;s fill-pattern, or otherwise by the section&rsquo;s default pattern
  (<code class="code">section.pad</code>).
  The newly aligned <code class="code">pc</code> is returned.
</p></dd>
</dl>

<p>Some remarks:
</p><ul class="itemize mark-minus">
<li>Note, that the output of atoms and target-bytes, using the functions from
above, is done by writing 8-bit bytes to the host&rsquo;s file system. The
order of 8-bit bytes within target-bytes which are greater than 8 bits
can be selected by the options <samp class="option">-obe</samp> for big-endian and <samp class="option">-ole</samp>
for little-endian. The target-bytes are automatically written in that
selected order, when using the <code class="code">fw*</code> functions from above. Otherwise
you can check the global variable <code class="code">output_bytes_le</code>, which will be
zero for big-endian and non-zero for little-endian target-byte output.
The default is vasm&rsquo;s internal target-byte endianness, which is big-endian.

</li><li>Some output modules cannot handle all supported CPUs. Nevertheless,
they have to be written in a way that they can be compiled. If code
references CPU-specifics, they have to be enclosed in
<code class="code">#ifdef VASM_CPU_MYCPU</code> ... <code class="code">#endif</code> or similar.

<p>Also, if the selected CPU is not supported, the init function should fail.
</p>
</li><li>Error/warning messages can be emitted with the <code class="code">output_error</code> function.
As all output modules are linked together, they have a common list of error
messages in the file <samp class="file">output_errors.h</samp>. If a new message is needed, this
file has to be extended (see the section on general data structures for
details).
When the cause for an error relates to an <code class="code">atom</code> you may also use
the <code class="code">output_atom_error</code> function instead, which additionally prints
the atom&rsquo;s source text line.
In <samp class="file">output_errors.h</samp> use the <code class="code">NOLINE</code> flag when no atom is
available.

</li><li><code class="command">vasm</code> has a mechanism to specify rather complex relocations in a
standard way (see the section on general data structures). They can be
extended with CPU-specific relocations, but usually CPU modules will
try to create standard relocations (sometimes several standard relocations
can be used to implement a CPU-specific relocation). An output
module should try to find appropriate relocations supported by the
object format. The goal is to avoid special CPU-specific
relocations as much as possible.

</li></ul>

<p>Volker Barthelmann                                      vb@compilers.de
</p>
</div>
</div>



</body>
</html>
